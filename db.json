{"meta":{"version":1,"warehouse":"4.0.0"},"models":{"Asset":[{"_id":"source/CNAME","path":"CNAME","modified":1,"renderable":0},{"_id":"themes/next/source/css/main.styl","path":"css/main.styl","modified":1,"renderable":1},{"_id":"themes/next/source/images/algolia_logo.svg","path":"images/algolia_logo.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/avatar.gif","path":"images/avatar.gif","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","path":"images/cc-by-nc-nd.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","path":"images/cc-by-nc-sa.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc.svg","path":"images/cc-by-nc.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nd.svg","path":"images/cc-by-nd.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-sa.svg","path":"images/cc-by-sa.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by.svg","path":"images/cc-by.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-zero.svg","path":"images/cc-zero.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/loading.gif","path":"images/loading.gif","modified":1,"renderable":1},{"_id":"themes/next/source/images/placeholder.gif","path":"images/placeholder.gif","modified":1,"renderable":1},{"_id":"themes/next/source/images/quote-l.svg","path":"images/quote-l.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/quote-r.svg","path":"images/quote-r.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/searchicon.png","path":"images/searchicon.png","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/affix.js","path":"js/src/affix.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/algolia-search.js","path":"js/src/algolia-search.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/bootstrap.js","path":"js/src/bootstrap.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/exturl.js","path":"js/src/exturl.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/hook-duoshuo.js","path":"js/src/hook-duoshuo.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/js.cookie.js","path":"js/src/js.cookie.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/motion.js","path":"js/src/motion.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/post-details.js","path":"js/src/post-details.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/scroll-cookie.js","path":"js/src/scroll-cookie.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/scrollspy.js","path":"js/src/scrollspy.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/utils.js","path":"js/src/utils.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.css","path":"lib/algolia-instant-search/instantsearch.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.js","path":"lib/algolia-instant-search/instantsearch.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/canvas-nest/canvas-nest.min.js","path":"lib/canvas-nest/canvas-nest.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/canvas-ribbon/canvas-ribbon.js","path":"lib/canvas-ribbon/canvas-ribbon.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fastclick/LICENSE","path":"lib/fastclick/LICENSE","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fastclick/README.md","path":"lib/fastclick/README.md","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fastclick/bower.json","path":"lib/fastclick/bower.json","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","path":"lib/font-awesome/HELP-US-OUT.txt","modified":1,"renderable":1},{"_id":"themes/next/source/lib/jquery/index.js","path":"lib/jquery/index.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/CONTRIBUTING.md","path":"lib/jquery_lazyload/CONTRIBUTING.md","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/bower.json","path":"lib/font-awesome/bower.json","modified":1,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/README.md","path":"lib/jquery_lazyload/README.md","modified":1,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.lazyload.js","path":"lib/jquery_lazyload/jquery.lazyload.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.scrollstop.js","path":"lib/jquery_lazyload/jquery.scrollstop.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/three/canvas_lines.min.js","path":"lib/three/canvas_lines.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/three/canvas_sphere.min.js","path":"lib/three/canvas_sphere.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/three/three-waves.min.js","path":"lib/three/three-waves.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/three/three.min.js","path":"lib/three/three.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.js","path":"lib/velocity/velocity.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/velocity/bower.json","path":"lib/velocity/bower.json","modified":1,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.min.js","path":"lib/velocity/velocity.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","path":"lib/velocity/velocity.ui.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","path":"lib/velocity/velocity.ui.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/bower.json","path":"lib/jquery_lazyload/bower.json","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/schemes/pisces.js","path":"js/src/schemes/pisces.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.css","path":"lib/Han/dist/han.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.js","path":"lib/Han/dist/han.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.min.css","path":"lib/Han/dist/han.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.min.js","path":"lib/Han/dist/han.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/blank.gif","path":"lib/fancybox/source/blank.gif","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading@2x.gif","path":"lib/fancybox/source/fancybox_loading@2x.gif","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading.gif","path":"lib/fancybox/source/fancybox_loading.gif","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_overlay.png","path":"lib/fancybox/source/fancybox_overlay.png","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite.png","path":"lib/fancybox/source/fancybox_sprite.png","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite@2x.png","path":"lib/fancybox/source/fancybox_sprite@2x.png","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.css","path":"lib/fancybox/source/jquery.fancybox.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.js","path":"lib/fancybox/source/jquery.fancybox.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.pack.js","path":"lib/fancybox/source/jquery.fancybox.pack.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.js","path":"lib/fastclick/lib/fastclick.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.min.js","path":"lib/fastclick/lib/fastclick.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","path":"lib/font-awesome/css/font-awesome.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","path":"lib/font-awesome/css/font-awesome.css.map","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","path":"lib/font-awesome/css/font-awesome.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/FontAwesome.otf","path":"lib/font-awesome/fonts/FontAwesome.otf","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","path":"lib/font-awesome/fonts/fontawesome-webfont.eot","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.svg","path":"lib/font-awesome/fonts/fontawesome-webfont.svg","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.ttf","path":"lib/font-awesome/fonts/fontawesome-webfont.ttf","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","path":"lib/font-awesome/fonts/fontawesome-webfont.woff","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","path":"lib/font-awesome/fonts/fontawesome-webfont.woff2","modified":1,"renderable":1},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.min.js","path":"lib/ua-parser-js/dist/ua-parser.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.pack.js","path":"lib/ua-parser-js/dist/ua-parser.pack.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han-space.otf","path":"lib/Han/dist/font/han-space.otf","modified":1,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han-space.woff","path":"lib/Han/dist/font/han-space.woff","modified":1,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han.otf","path":"lib/Han/dist/font/han.otf","modified":1,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han.woff","path":"lib/Han/dist/font/han.woff","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/fancybox_buttons.png","path":"lib/fancybox/source/helpers/fancybox_buttons.png","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.css","path":"lib/fancybox/source/helpers/jquery.fancybox-buttons.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.js","path":"lib/fancybox/source/helpers/jquery.fancybox-buttons.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","path":"lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","path":"lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-media.js","path":"lib/fancybox/source/helpers/jquery.fancybox-media.js","modified":1,"renderable":1}],"Cache":[{"_id":"source/CNAME","hash":"03c4fe8ace49b5381fab088c6aee1ca0ca0ff87d","modified":1641120689043},{"_id":"source/_posts/.DS_Store","hash":"030875e28ef5c34cae2e3ddf672b76e76677dbd7","modified":1535220174000},{"_id":"source/_posts/from-result-to-error-handling.md","hash":"e0de78c1bbece6ff758c8a93a84cfa5591c21699","modified":1641122897640},{"_id":"source/_posts/cherry-blessing.md","hash":"4f86b0c15f42a4a984d7c7ae26e45bbc36807c02","modified":1641122769895},{"_id":"source/_posts/group-theory-and-category-theory.md","hash":"331ccf728bf6b2d26ec9a34251999a89e5727e36","modified":1641122807155},{"_id":"source/README.md","hash":"430812029f981e74415029cad78121b4802d26ec","modified":1641120689043},{"_id":"source/_posts/http-chunked-2.md","hash":"15770be52eeb9dc556f4abbbab584ac63e0a0a59","modified":1641123678349},{"_id":"source/_posts/http-chunked.md","hash":"759691cb63219a1c5dc176788bdc3351c0a7239f","modified":1641124000949},{"_id":"source/_posts/logging-system.md","hash":"4a8c214cc47623d8eeebc7dd8af7111dc4bf34b2","modified":1641122856392},{"_id":"source/_posts/pats.md","hash":"30866453b2e6842444473de0b85e56ca25b6c2f8","modified":1641122872361},{"_id":"source/_posts/parser-combinator.md","hash":"d01533ce2b0ce918312b4b244b31088d3cd8de9e","modified":1641122791731},{"_id":"source/tags/index.md","hash":"f6fb24a33f1509ae539de27321a24b703af648af","modified":1641120689047},{"_id":"source/_posts/plist-parser.md","hash":"4205bd6d84bf463859bd1d8536c2d68d3b0db36e","modified":1641122823726},{"_id":"source/.DS_Store","hash":"4f35b2832be884568b6c9757adc39d2d125e8652","modified":1502528898000},{"_id":"source/_posts/existential.md","hash":"c866d7deba430496023efe069b82183555a660c2","modified":1641122914031},{"_id":"themes/next/source/fonts/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1641120689118},{"_id":"themes/next/layout/_scripts/schemes/mist.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1641120689083},{"_id":"themes/next/layout/_scripts/schemes/muse.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1641120689083},{"_id":"themes/next/source/css/_mixins/Mist.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1641120689111},{"_id":"themes/next/source/css/_mixins/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1641120689111},{"_id":"themes/next/source/css/_mixins/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1641120689112},{"_id":"themes/next/source/css/_variables/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1641120689117},{"_id":"themes/next/source/css/_variables/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1641120689118},{"_id":"themes/next/.bowerrc","hash":"3228a58ed0ece9f85e1e3136352094080b8dece1","modified":1641120689070},{"_id":"themes/next/.editorconfig","hash":"792fd2bd8174ece1a75d5fd24ab16594886f3a7f","modified":1641120689070},{"_id":"themes/next/.gitattributes","hash":"44bd4729c74ccb88110804f41746fec07bf487d4","modified":1641120689070},{"_id":"themes/next/.hound.yml","hash":"b76daa84c9ca3ad292c78412603370a367cc2bc3","modified":1641120689071},{"_id":"themes/next/.javascript_ignore","hash":"f9ea3c5395f8feb225a24e2c32baa79afda30c16","modified":1641120689072},{"_id":"themes/next/.gitignore","hash":"32ea93f21d8693d5d8fa4eef1c51a21ad0670047","modified":1641120689071},{"_id":"themes/next/.jshintrc","hash":"9928f81bd822f6a8d67fdbc909b517178533bca9","modified":1641120689072},{"_id":"themes/next/.stylintrc","hash":"b28e24704a5d8de08346c45286574c8e76cc109f","modified":1641120689072},{"_id":"themes/next/.travis.yml","hash":"c42d9608c8c7fe90de7b1581a8dc3886e90c179e","modified":1641120689072},{"_id":"themes/next/LICENSE","hash":"f293bcfcdc06c0b77ba13570bb8af55eb5c059fd","modified":1641120689072},{"_id":"themes/next/README.en.md","hash":"4ece25ee5f64447cd522e54cb0fffd9a375f0bd4","modified":1641120689073},{"_id":"themes/next/bower.json","hash":"be0a430362cb73a7e3cf9ecf51a67edf8214b637","modified":1641120689073},{"_id":"themes/next/gulpfile.coffee","hash":"031bffc483e417b20e90eceb6cf358e7596d2e69","modified":1641120689074},{"_id":"themes/next/_config.yml","hash":"0113f7373827dd6f06102da88af8915312dd7bd1","modified":1641120689073},{"_id":"themes/next/package.json","hash":"7e87b2621104b39a30488654c2a8a0c6a563574b","modified":1641120689094},{"_id":"themes/next/README.md","hash":"500b5606eb6a09c979d16128f8b00f4bf9bc95ac","modified":1641120689073},{"_id":"themes/next/.github/CONTRIBUTING.md","hash":"3b5eafd32abb718e56ccf8d1cee0607ad8ce611d","modified":1641120689071},{"_id":"themes/next/.github/ISSUE_TEMPLATE.md","hash":"fdd63b77472612337309eb93ec415a059b90756b","modified":1641120689071},{"_id":"themes/next/languages/de.yml","hash":"306db8c865630f32c6b6260ade9d3209fbec8011","modified":1641120689074},{"_id":"themes/next/languages/default.yml","hash":"4cc6aeb1ac09a58330e494c8771773758ab354af","modified":1641120689074},{"_id":"themes/next/languages/en.yml","hash":"e7def07a709ef55684490b700a06998c67f35f39","modified":1641120689074},{"_id":"themes/next/languages/fr-FR.yml","hash":"24180322c83587a153cea110e74e96eacc3355ad","modified":1641120689075},{"_id":"themes/next/languages/id.yml","hash":"2835ea80dadf093fcf47edd957680973f1fb6b85","modified":1641120689075},{"_id":"themes/next/languages/ja.yml","hash":"1c3a05ab80a6f8be63268b66da6f19da7aa2c638","modified":1641120689075},{"_id":"themes/next/languages/ko.yml","hash":"be150543379150f78329815af427bf152c0e9431","modified":1641120689075},{"_id":"themes/next/languages/pt-BR.yml","hash":"958e49571818a34fdf4af3232a07a024050f8f4e","modified":1641120689075},{"_id":"themes/next/languages/pt.yml","hash":"36c8f60dacbe5d27d84d0e0d6974d7679f928da0","modified":1641120689076},{"_id":"themes/next/languages/ru.yml","hash":"1549a7c2fe23caa7cbedcd0aa2b77c46e57caf27","modified":1641120689076},{"_id":"themes/next/languages/zh-Hans.yml","hash":"3c0c7dfd0256457ee24df9e9879226c58cb084b5","modified":1641120689076},{"_id":"themes/next/languages/zh-hk.yml","hash":"1c917997413bf566cb79e0975789f3c9c9128ccd","modified":1641120689076},{"_id":"themes/next/languages/zh-tw.yml","hash":"0b2c18aa76570364003c8d1cd429fa158ae89022","modified":1641120689077},{"_id":"themes/next/layout/_layout.swig","hash":"9d1a23a6add6f3d0f88c2d17979956f14aaa37a4","modified":1641120689077},{"_id":"themes/next/layout/archive.swig","hash":"5de4dca06b05d99e4f6bad617a4b8f4f3592fb01","modified":1641120689092},{"_id":"themes/next/layout/category.swig","hash":"82e7bc278559b4335ad974659104eaaf04863032","modified":1641120689092},{"_id":"themes/next/layout/index.swig","hash":"03e8a2cda03bad42ac0cb827025eb81f95d496a2","modified":1641120689093},{"_id":"themes/next/layout/page.swig","hash":"2c6a78999133b991d9221f484aee2eacae894251","modified":1641120689093},{"_id":"themes/next/layout/post.swig","hash":"2d5f8d7f0a96b611e2d5a5e4d111fc17726a990f","modified":1641120689093},{"_id":"themes/next/layout/schedule.swig","hash":"f93c53f6fd5c712584f6efba6f770c30fa8a3e80","modified":1641120689093},{"_id":"themes/next/layout/tag.swig","hash":"2e73ee478e981092ea9a5d10dd472a9461db395b","modified":1641120689094},{"_id":"themes/next/scripts/merge-configs.js","hash":"13c8b3a2d9fce06c2488820d9248d190c8100e0a","modified":1641120689094},{"_id":"themes/next/test/.jshintrc","hash":"19f93d13d1689fe033c82eb2d5f3ce30b6543cc0","modified":1641120689148},{"_id":"themes/next/scripts/merge.js","hash":"9130dabe6a674c54b535f322b17d75fe6081472f","modified":1641120689095},{"_id":"themes/next/test/helpers.js","hash":"a1f5de25154c3724ffc24a91ddc576cdbd60864f","modified":1641120689149},{"_id":"themes/next/test/intern.js","hash":"11fa8a4f5c3b4119a179ae0a2584c8187f907a73","modified":1641120689149},{"_id":"themes/next/layout/_custom/header.swig","hash":"adc83b19e793491b1c6ea0fd8b46cd9f32e592fc","modified":1641120689077},{"_id":"themes/next/layout/_custom/sidebar.swig","hash":"adc83b19e793491b1c6ea0fd8b46cd9f32e592fc","modified":1641120689077},{"_id":"themes/next/layout/_partials/comments.swig","hash":"1c7d3c975e499b9aa3119d6724b030b7b00fc87e","modified":1641120689079},{"_id":"themes/next/layout/_partials/footer.swig","hash":"7172c6053118b7c291a56a7860128a652ae66b83","modified":1641120689079},{"_id":"themes/next/layout/_partials/head.swig","hash":"d4a05c51aac02f1f6248baccf2ddb8ee12b9122f","modified":1641120689080},{"_id":"themes/next/layout/_partials/page-header.swig","hash":"1efd925d34a5d4ba2dc0838d9c86ba911e705fc9","modified":1641120689080},{"_id":"themes/next/layout/_partials/header.swig","hash":"a1ffbb691dfad3eaf2832a11766e58a179003b8b","modified":1641120689080},{"_id":"themes/next/layout/_partials/pagination.swig","hash":"9e8e21d194ef44d271b1cca0bc1448c14d7edf4f","modified":1641120689081},{"_id":"themes/next/layout/_partials/search.swig","hash":"9dbd378e94abfcb3f864a5b8dbbf18d212ca2ee0","modified":1641120689081},{"_id":"themes/next/layout/_scripts/boostrap.swig","hash":"03aaebe9d50f6acb007ec38cc04acd1cfceb404d","modified":1641120689083},{"_id":"themes/next/layout/_scripts/commons.swig","hash":"766b2bdda29523ed6cd8d7aa197f996022f8fd94","modified":1641120689083},{"_id":"themes/next/layout/_scripts/vendors.swig","hash":"9baf90f7c40b3b10f288e9268c3191e895890cea","modified":1641120689084},{"_id":"themes/next/layout/_third-party/duoshuo-hot-articles.swig","hash":"5d4638c46aef65bf32a01681495b62416ccc98db","modified":1641120689089},{"_id":"themes/next/layout/_third-party/mathjax.swig","hash":"6d25596d6a7c57700d37b607f8d9a62d89708683","modified":1641120689090},{"_id":"themes/next/layout/_third-party/exturl.swig","hash":"7c04a42319d728be356746363aff8ea247791d24","modified":1641120689090},{"_id":"themes/next/layout/_third-party/schedule.swig","hash":"22369026c87fc23893c35a7f250b42f3bb1b60f1","modified":1641120689090},{"_id":"themes/next/layout/_third-party/scroll-cookie.swig","hash":"1ddb2336a1a19b47af3017047012c01ec5f54529","modified":1641120689090},{"_id":"themes/next/layout/_macro/post-collapse.swig","hash":"31322a7f57936cf2dc62e824af5490da5354cf02","modified":1641120689078},{"_id":"themes/next/layout/_macro/post-copyright.swig","hash":"b16fcbf0efd20c018d7545257a8533c497ea7647","modified":1641120689078},{"_id":"themes/next/layout/_macro/post.swig","hash":"c00261ee0dca8ef7d3f7753e8f8cd444f51118c4","modified":1641120689078},{"_id":"themes/next/layout/_macro/reward.swig","hash":"37e5b7c42ec17b9b6b786c5512bcc481a21c974e","modified":1641120689078},{"_id":"themes/next/layout/_macro/sidebar.swig","hash":"911b99ba0445b2c07373128d87a4ef2eb7de341a","modified":1641120689079},{"_id":"themes/next/layout/_macro/wechat-subscriber.swig","hash":"14e785adeb0e671ba0ff9a553e6f0d8def6c670c","modified":1641120689079},{"_id":"themes/next/scripts/tags/button.js","hash":"62e6dbeb53d07627a048132c79630b45d9a8f2cc","modified":1641120689095},{"_id":"themes/next/scripts/tags/center-quote.js","hash":"535fc542781021c4326dec24d8495cbb1387634a","modified":1641120689095},{"_id":"themes/next/scripts/tags/exturl.js","hash":"8d7e60f60779bde050d20fd76f6fdc36fc85e06d","modified":1641120689095},{"_id":"themes/next/scripts/tags/full-image.js","hash":"8eeb3fb89540299bdbb799edfdfdac3743b50596","modified":1641120689095},{"_id":"themes/next/scripts/tags/group-pictures.js","hash":"49252824cd53184dc9b97b2f2d87ff28e1b3ef27","modified":1641120689096},{"_id":"themes/next/scripts/tags/note.js","hash":"6752925eedbdb939d8ec4d11bdfb75199f18dd70","modified":1641120689096},{"_id":"themes/next/source/css/main.styl","hash":"20702c48d6053c92c5bcdbc68e8d0ef1369848a0","modified":1641120689118},{"_id":"themes/next/source/images/algolia_logo.svg","hash":"90035272fa31a3f65b3c0e2cb8a633876ef457dc","modified":1641120689118},{"_id":"themes/next/source/images/avatar.gif","hash":"264082bb3a1af70d5499c7d22b0902cb454b6d12","modified":1641120689118},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1641120689118},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1641120689119},{"_id":"themes/next/source/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1641120689119},{"_id":"themes/next/source/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1641120689119},{"_id":"themes/next/source/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1641120689119},{"_id":"themes/next/source/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1641120689119},{"_id":"themes/next/source/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1641120689119},{"_id":"themes/next/source/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1641120689120},{"_id":"themes/next/source/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1641120689120},{"_id":"themes/next/source/images/quote-l.svg","hash":"94e870b4c8c48da61d09522196d4dd40e277a98f","modified":1641120689120},{"_id":"themes/next/source/images/quote-r.svg","hash":"e60ae504f9d99b712c793c3740c6b100d057d4ec","modified":1641120689120},{"_id":"themes/next/source/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1641120689120},{"_id":"themes/next/layout/_partials/head/external-fonts.swig","hash":"7ce76358411184482bb0934e70037949dd0da8ca","modified":1641120689080},{"_id":"themes/next/layout/_partials/head/custom-head.swig","hash":"9e1b9666efa77f4cf8d8261bcfa445a9ac608e53","modified":1641120689080},{"_id":"themes/next/layout/_partials/search/localsearch.swig","hash":"957701729b85fb0c5bfcf2fb99c19d54582f91ed","modified":1641120689081},{"_id":"themes/next/layout/_partials/search/swiftype.swig","hash":"959b7e04a96a5596056e4009b73b6489c117597e","modified":1641120689081},{"_id":"themes/next/layout/_partials/search/tinysou.swig","hash":"eefe2388ff3d424694045eda21346989b123977c","modified":1641120689082},{"_id":"themes/next/layout/_partials/share/add-this.swig","hash":"23e23dc0f76ef3c631f24c65277adf7ea517b383","modified":1641120689082},{"_id":"themes/next/layout/_partials/share/baidushare.swig","hash":"1f1107468aaf03f7d0dcd7eb2b653e2813a675b4","modified":1641120689082},{"_id":"themes/next/layout/_partials/share/duoshuo_share.swig","hash":"89c5a5240ecb223acfe1d12377df5562a943fd5d","modified":1641120689082},{"_id":"themes/next/layout/_partials/share/jiathis.swig","hash":"63315fcf210799f894208c9f512737096df84962","modified":1641120689082},{"_id":"themes/next/layout/_scripts/schemes/pisces.swig","hash":"a44acf9b0d0f44ef3dfc767376a95c984cc127de","modified":1641120689084},{"_id":"themes/next/layout/_third-party/analytics/application-insights.swig","hash":"60426bf73f8a89ba61fb1be2df3ad5398e32c4ef","modified":1641120689084},{"_id":"themes/next/layout/_third-party/analytics/baidu-analytics.swig","hash":"deda6a814ed48debc694c4e0c466f06c127163d0","modified":1641120689084},{"_id":"themes/next/layout/_third-party/analytics/busuanzi-counter.swig","hash":"18e7bef8923d83ea42df6c97405e515a876cede4","modified":1641120689085},{"_id":"themes/next/layout/_third-party/analytics/cnzz-analytics.swig","hash":"8160b27bee0aa372c7dc7c8476c05bae57f58d0f","modified":1641120689085},{"_id":"themes/next/layout/_third-party/analytics/facebook-sdk.swig","hash":"394d008e5e94575280407ad8a1607a028026cbc3","modified":1641120689085},{"_id":"themes/next/layout/_third-party/analytics/google-analytics.swig","hash":"5d9943d74cc2e0a91badcf4f755c6de77eab193a","modified":1641120689085},{"_id":"themes/next/layout/_third-party/analytics/index.swig","hash":"3358d11b9a26185a2d36c96049e4340e701646e4","modified":1641120689085},{"_id":"themes/next/layout/_third-party/analytics/lean-analytics.swig","hash":"92dc60821307fc9769bea9b2d60adaeb798342af","modified":1641120689086},{"_id":"themes/next/layout/_third-party/analytics/tencent-analytics.swig","hash":"3658414379e0e8a34c45c40feadc3edc8dc55f88","modified":1641120689086},{"_id":"themes/next/layout/_third-party/analytics/vkontakte-api.swig","hash":"c3971fd154d781088e1cc665035f8561a4098f4c","modified":1641120689086},{"_id":"themes/next/layout/_third-party/comments/changyan.swig","hash":"0e3378f7c39b2b0f69638290873ede6b6b6825c0","modified":1641120689086},{"_id":"themes/next/layout/_third-party/comments/disqus.swig","hash":"c316758546dc9ba6c60cb4d852c17ca6bb6d6724","modified":1641120689087},{"_id":"themes/next/layout/_third-party/comments/duoshuo.swig","hash":"a356b2185d40914447fde817eb3d358ab6b3e4c3","modified":1641120689087},{"_id":"themes/next/layout/_third-party/comments/gentie.swig","hash":"03592d1d731592103a41ebb87437fe4b0a4c78ca","modified":1641120689088},{"_id":"themes/next/layout/_third-party/comments/hypercomments.swig","hash":"3e8dc5c6c912628a37e3b5f886bec7b2e5ed14ea","modified":1641120689089},{"_id":"themes/next/layout/_third-party/comments/index.swig","hash":"abb92620197a16ed2c0775edf18a0f044a82256e","modified":1641120689089},{"_id":"themes/next/layout/_third-party/comments/livere.swig","hash":"1d0d01aaeb7bcde3671263d736718f8837c20182","modified":1641120689089},{"_id":"themes/next/layout/_third-party/comments/youyan.swig","hash":"af9dd8a4aed7d06cf47b363eebff48850888566c","modified":1641120689089},{"_id":"themes/next/layout/_third-party/search/index.swig","hash":"c747fb5c6b1f500e8f0c583e44195878b66e4e29","modified":1641120689091},{"_id":"themes/next/layout/_third-party/search/localsearch.swig","hash":"1f349aa30dd1f7022f7d07a1f085eea5ace3f26d","modified":1641120689091},{"_id":"themes/next/layout/_third-party/search/tinysou.swig","hash":"cb3a5d36dbe1630bab84e03a52733a46df7c219b","modified":1641120689092},{"_id":"themes/next/layout/_third-party/seo/baidu-push.swig","hash":"c057b17f79e8261680fbae8dc4e81317a127c799","modified":1641120689092},{"_id":"themes/next/source/css/_custom/custom.styl","hash":"328d9a9696cc2ccf59c67d3c26000d569f46344c","modified":1641120689111},{"_id":"themes/next/source/css/_mixins/Pisces.styl","hash":"715d5b40dc52f319fe4bff0325beb874774d9bd9","modified":1641120689111},{"_id":"themes/next/source/css/_mixins/base.styl","hash":"78a83c38f69a8747bb74e420e6c9eeef1ea76525","modified":1641120689112},{"_id":"themes/next/source/css/_variables/Mist.styl","hash":"c8d35a6b9e3bff6d8fdb66de853065af9d37562d","modified":1641120689117},{"_id":"themes/next/source/css/_variables/Pisces.styl","hash":"06f432f328a5b8a9ef0dbd5301b002aba600b4ce","modified":1641120689117},{"_id":"themes/next/source/css/_variables/base.styl","hash":"d6a793bcada68d4b6c58392546bc48a482e4a7d3","modified":1641120689117},{"_id":"themes/next/source/js/src/affix.js","hash":"978e0422b5bf1b560236d8d10ebc1adcf66392e3","modified":1641120689120},{"_id":"themes/next/source/js/src/algolia-search.js","hash":"b172f697ed339a24b1e80261075232978d164c35","modified":1641120689121},{"_id":"themes/next/source/js/src/bootstrap.js","hash":"aab7be0a6e2724b3faa9338db93c19556c559625","modified":1641120689121},{"_id":"themes/next/source/js/src/exturl.js","hash":"e42e2aaab7bf4c19a0c8e779140e079c6aa5c0b1","modified":1641120689121},{"_id":"themes/next/source/js/src/hook-duoshuo.js","hash":"a6119070c0119f33e08b29da7d2cce2635eb40a0","modified":1641120689121},{"_id":"themes/next/source/js/src/js.cookie.js","hash":"9b37973a90fd50e71ea91682265715e45ae82c75","modified":1641120689121},{"_id":"themes/next/source/js/src/motion.js","hash":"269414e84df544a4ccb88519f6abae4943db3c67","modified":1641120689121},{"_id":"themes/next/source/js/src/post-details.js","hash":"af7a417dd1cb02465a7b98211653e7c6192e6d55","modified":1641120689121},{"_id":"themes/next/source/js/src/scroll-cookie.js","hash":"09dc828cbf5f31158ff6250d2bf7c3cde6365c67","modified":1641120689122},{"_id":"themes/next/source/js/src/scrollspy.js","hash":"fe4da1b9fe73518226446f5f27d2831e4426fc35","modified":1641120689122},{"_id":"themes/next/source/js/src/utils.js","hash":"803f684fa7d0e729115a48851023a31f6fb6d0a7","modified":1641120689122},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.css","hash":"90ef19edc982645b118b095615838d9c5eaba0de","modified":1641120689125},{"_id":"themes/next/source/lib/canvas-nest/canvas-nest.min.js","hash":"0387e75e23b1db108a755073fe52a0d03eb391a7","modified":1641120689127},{"_id":"themes/next/source/lib/fancybox/.bower.json","hash":"cc40a9b11e52348e554c84e4a5c058056f6b7aeb","modified":1495258266000},{"_id":"themes/next/source/lib/canvas-ribbon/canvas-ribbon.js","hash":"3587602ad777b031628bb5944864d1a4fcfea4ac","modified":1641120689127},{"_id":"themes/next/source/lib/fastclick/.bower.json","hash":"93ebd5b35e632f714dcf1753e1f6db77ec74449b","modified":1641120689130},{"_id":"themes/next/source/lib/fastclick/LICENSE","hash":"dcd5b6b43095d9e90353a28b09cb269de8d4838e","modified":1641120689131},{"_id":"themes/next/source/lib/fastclick/README.md","hash":"1decd8e1adad2cd6db0ab50cf56de6035156f4ea","modified":1641120689131},{"_id":"themes/next/source/lib/fastclick/bower.json","hash":"13379463c7463b4b96d13556b46faa4cc38d81e6","modified":1641120689131},{"_id":"themes/next/source/lib/font-awesome/.bower.json","hash":"a2aaaf12378db56bd10596ba3daae30950eac051","modified":1641120689132},{"_id":"themes/next/source/lib/font-awesome/.gitignore","hash":"69d152fa46b517141ec3b1114dd6134724494d83","modified":1641120689132},{"_id":"themes/next/source/lib/fancybox/.gitattributes","hash":"2db21acfbd457452462f71cc4048a943ee61b8e0","modified":1495258266000},{"_id":"themes/next/source/lib/font-awesome/.npmignore","hash":"dcf470ab3a358103bb896a539cc03caeda10fa8b","modified":1641120689132},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","hash":"4f7bf961f1bed448f6ba99aeb9219fabf930ba96","modified":1641120689132},{"_id":"themes/next/source/lib/jquery/.bower.json","hash":"91745c2cc6c946c7275f952b2b0760b880cea69e","modified":1641120689140},{"_id":"themes/next/source/lib/jquery_lazyload/.bower.json","hash":"b7638afc93e9cd350d0783565ee9a7da6805ad8e","modified":1641120689141},{"_id":"themes/next/source/lib/jquery_lazyload/CONTRIBUTING.md","hash":"4891864c24c28efecd81a6a8d3f261145190f901","modified":1641120689141},{"_id":"themes/next/source/lib/font-awesome/bower.json","hash":"279a8a718ab6c930a67c41237f0aac166c1b9440","modified":1641120689133},{"_id":"themes/next/source/lib/jquery_lazyload/README.md","hash":"895d50fa29759af7835256522e9dd7dac597765c","modified":1641120689142},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.lazyload.js","hash":"481fd478650e12b67c201a0ea41e92743f8b45a3","modified":1641120689142},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.scrollstop.js","hash":"0e9a81785a011c98be5ea821a8ed7d411818cfd1","modified":1641120689142},{"_id":"themes/next/source/lib/three/canvas_lines.min.js","hash":"dce4a3b65f8bf958f973690caa7ec4952f353b0c","modified":1641120689142},{"_id":"themes/next/source/lib/three/canvas_sphere.min.js","hash":"d8ea241a53c135a650f7335d2b6982b899fd58a9","modified":1641120689143},{"_id":"themes/next/source/lib/three/three-waves.min.js","hash":"d968cba6b3a50b3626a02d67b544f349d83b147c","modified":1641120689143},{"_id":"themes/next/layout/_scripts/pages/post-details.swig","hash":"069d1357c717572256e5cdee09574ebce529cbae","modified":1641120689083},{"_id":"themes/next/source/lib/velocity/.bower.json","hash":"05f960846f1c7a93dab1d3f9a1121e86812e8c88","modified":1641120689146},{"_id":"themes/next/source/lib/velocity/bower.json","hash":"2ec99573e84c7117368beccb9e94b6bf35d2db03","modified":1641120689146},{"_id":"themes/next/source/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1641120689148},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","hash":"6a1d101eab3de87527bb54fcc8c7b36b79d8f0df","modified":1641120689148},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1641120689148},{"_id":"themes/next/layout/_third-party/analytics/tencent-mta.swig","hash":"0ddc94ed4ba0c19627765fdf1abc4d8efbe53d5a","modified":1641120689086},{"_id":"themes/next/source/lib/jquery_lazyload/bower.json","hash":"65bc85d12197e71c40a55c0cd7f6823995a05222","modified":1641120689142},{"_id":"themes/next/layout/_third-party/search/algolia-search/assets.swig","hash":"28ff4ed6714c59124569ffcbd10f1173d53ca923","modified":1641120689091},{"_id":"themes/next/layout/_third-party/search/algolia-search/dom.swig","hash":"ba698f49dd3a868c95b240d802f5b1b24ff287e4","modified":1641120689091},{"_id":"themes/next/source/css/_common/components/back-to-top-sidebar.styl","hash":"59ad08bcc6fe9793594869ac2b4c525021453e78","modified":1641120689096},{"_id":"themes/next/source/css/_common/components/back-to-top.styl","hash":"ef089a407c90e58eca10c49bc47ec978f96e03ba","modified":1641120689097},{"_id":"themes/next/source/css/_common/components/buttons.styl","hash":"0dfb4b3ba3180d7285e66f270e1d3fa0f132c3d2","modified":1641120689097},{"_id":"themes/next/source/css/_common/components/comments.styl","hash":"471f1627891aca5c0e1973e09fbcb01e1510d193","modified":1641120689097},{"_id":"themes/next/source/css/_common/components/components.styl","hash":"a6bb5256be6195e76addbda12f4ed7c662d65e7a","modified":1641120689097},{"_id":"themes/next/source/css/_common/components/pagination.styl","hash":"711c8830886619d4f4a0598b0cde5499dce50c62","modified":1641120689101},{"_id":"themes/next/source/css/_common/components/tag-cloud.styl","hash":"dd8a3b22fc2f222ac6e6c05bd8a773fb039169c0","modified":1641120689106},{"_id":"themes/next/source/css/_common/outline/outline.styl","hash":"2186be20e317505cd31886f1291429cc21f76703","modified":1641120689110},{"_id":"themes/next/source/css/_common/scaffolding/helpers.styl","hash":"9c25c75311e1bd4d68df031d3f2ae6d141a90766","modified":1641120689110},{"_id":"themes/next/source/css/_common/scaffolding/base.styl","hash":"7804e31c44717c9a9ddf0f8482b9b9c1a0f74538","modified":1641120689110},{"_id":"themes/next/source/css/_common/scaffolding/normalize.styl","hash":"ece571f38180febaf02ace8187ead8318a300ea7","modified":1641120689110},{"_id":"themes/next/source/css/_common/scaffolding/scaffolding.styl","hash":"013619c472c7e4b08311c464fcbe9fcf5edde603","modified":1641120689110},{"_id":"themes/next/source/css/_common/scaffolding/tables.styl","hash":"64f5d56c08d74a338813df1265580ca0cbf0190b","modified":1641120689111},{"_id":"themes/next/source/css/_schemes/Mist/_base.styl","hash":"c2d079788d6fc2e9a191ccdae94e50d55bf849dc","modified":1641120689112},{"_id":"themes/next/source/css/_schemes/Mist/_header.styl","hash":"5ae7906dc7c1d9468c7f4b4a6feddddc555797a1","modified":1641120689112},{"_id":"themes/next/source/css/_schemes/Mist/_logo.styl","hash":"38e5df90c8689a71c978fd83ba74af3d4e4e5386","modified":1641120689112},{"_id":"themes/next/source/css/_schemes/Mist/_menu.styl","hash":"b0dcca862cd0cc6e732e33d975b476d744911742","modified":1641120689113},{"_id":"themes/next/source/css/_schemes/Mist/_posts-expanded.styl","hash":"fda14bc35be2e1b332809b55b3d07155a833dbf4","modified":1641120689113},{"_id":"themes/next/source/css/_schemes/Mist/_search.styl","hash":"1452cbe674cc1d008e1e9640eb4283841058fc64","modified":1641120689113},{"_id":"themes/next/source/css/_schemes/Mist/index.styl","hash":"9a5581a770af8964064fef7afd3e16963e45547f","modified":1641120689113},{"_id":"themes/next/source/css/_schemes/Muse/_layout.styl","hash":"0efa036a15c18f5abb058b7c0fad1dd9ac5eed4c","modified":1641120689114},{"_id":"themes/next/source/css/_schemes/Muse/_logo.styl","hash":"8829bc556ca38bfec4add4f15a2f028092ac6d46","modified":1641120689114},{"_id":"themes/next/source/css/_schemes/Muse/_menu.styl","hash":"82bbaa6322764779a1ac2e2c8390ce901c7972e2","modified":1641120689115},{"_id":"themes/next/source/css/_schemes/Muse/_search.styl","hash":"1452cbe674cc1d008e1e9640eb4283841058fc64","modified":1641120689115},{"_id":"themes/next/source/css/_schemes/Muse/index.styl","hash":"a0e2030a606c934fb2c5c7373aaae04a1caac4c5","modified":1641120689115},{"_id":"themes/next/source/css/_schemes/Pisces/_brand.styl","hash":"c4ed249798296f60bda02351fe6404fb3ef2126f","modified":1641120689115},{"_id":"themes/next/source/css/_schemes/Pisces/_layout.styl","hash":"5b93958239d3d2bf9aeaede44eced2434d784462","modified":1641120689116},{"_id":"themes/next/source/css/_schemes/Pisces/_menu.styl","hash":"215de948be49bcf14f06d500cef9f7035e406a43","modified":1641120689116},{"_id":"themes/next/source/css/_schemes/Pisces/_posts.styl","hash":"2f878213cb24c5ddc18877f6d15ec5c5f57745ac","modified":1641120689116},{"_id":"themes/next/source/css/_schemes/Pisces/_sidebar.styl","hash":"e3e23751d4ad24e8714b425d768cf68e37de7ded","modified":1641120689116},{"_id":"themes/next/source/css/_schemes/Pisces/index.styl","hash":"69ecd6c97e7cdfd822ac8102b45ad0ede85050db","modified":1641120689117},{"_id":"themes/next/source/js/src/schemes/pisces.js","hash":"79da92119bc246fe05d1626ac98426a83ec90a94","modified":1641120689122},{"_id":"themes/next/source/lib/Han/dist/han.min.css","hash":"d9c0b3dc9158e717fde36f554709e6c3a22b5f85","modified":1641120689124},{"_id":"themes/next/source/lib/Han/dist/han.min.js","hash":"f559c68a25065a14f47da954a7617d87263e409d","modified":1641120689125},{"_id":"themes/next/source/lib/fancybox/source/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1641120689128},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1641120689128},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1641120689128},{"_id":"themes/next/source/lib/fancybox/source/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1641120689128},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1641120689128},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1641120689128},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.css","hash":"5f163444617b6cf267342f06ac166a237bb62df9","modified":1641120689130},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.js","hash":"1cf3d47b5ccb7cb6e9019c64f2a88d03a64853e4","modified":1641120689130},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.pack.js","hash":"53360764b429c212f424399384417ccc233bb3be","modified":1641120689130},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.js","hash":"06cef196733a710e77ad7e386ced6963f092dc55","modified":1641120689131},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.min.js","hash":"2cae0f5a6c5d6f3cb993015e6863f9483fc4de18","modified":1641120689132},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","hash":"0140952c64e3f2b74ef64e050f2fe86eab6624c8","modified":1641120689133},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","hash":"0189d278706509412bac4745f96c83984e1d59f4","modified":1641120689133},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","hash":"512c7d79033e3028a9be61b540cf1a6870c896f8","modified":1641120689134},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.min.js","hash":"38628e75e4412cc6f11074e03e1c6d257aae495b","modified":1641120689146},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.pack.js","hash":"214dad442a92d36af77ed0ca1d9092b16687f02f","modified":1641120689146},{"_id":"themes/next/source/css/_common/components/footer/footer.styl","hash":"8994ffcce84deac0471532f270f97c44fea54dc0","modified":1641120689098},{"_id":"themes/next/source/css/_common/components/header/header.styl","hash":"ae1ca14e51de67b07dba8f61ec79ee0e2e344574","modified":1641120689098},{"_id":"themes/next/source/css/_common/components/header/headerband.styl","hash":"d27448f199fc2f9980b601bc22b87f08b5d64dd1","modified":1641120689098},{"_id":"themes/next/source/css/_common/components/header/menu.styl","hash":"8a2421cb9005352905fae9d41a847ae56957247e","modified":1641120689098},{"_id":"themes/next/source/css/_common/components/header/site-nav.styl","hash":"49c2b2c14a1e7fcc810c6be4b632975d0204c281","modified":1641120689099},{"_id":"themes/next/source/css/_common/components/header/site-meta.styl","hash":"6c00f6e0978f4d8f9a846a15579963728aaa6a17","modified":1641120689098},{"_id":"themes/next/source/css/_common/components/highlight/diff.styl","hash":"96f32ea6c3265a3889e6abe57587f6e2a2a40dfb","modified":1641120689099},{"_id":"themes/next/source/css/_common/components/highlight/highlight.styl","hash":"740d37f428b8f4574a76fc95cc25e50e0565f45e","modified":1641120689099},{"_id":"themes/next/source/css/_common/components/highlight/theme.styl","hash":"b76387934fb6bb75212b23c1a194486892cc495e","modified":1641120689099},{"_id":"themes/next/source/css/_common/components/pages/archive.styl","hash":"7778920dd105fa4de3a7ab206eeba30b1a7bac45","modified":1641120689100},{"_id":"themes/next/source/css/_common/components/pages/categories.styl","hash":"4eff5b252d7b614e500fc7d52c97ce325e57d3ab","modified":1641120689100},{"_id":"themes/next/source/css/_common/components/pages/pages.styl","hash":"2039590632bba3943c39319d80ef630af7928185","modified":1641120689100},{"_id":"themes/next/source/css/_common/components/pages/post-detail.styl","hash":"9bf4362a4d0ae151ada84b219d39fbe5bb8c790e","modified":1641120689100},{"_id":"themes/next/source/css/_common/components/pages/schedule.styl","hash":"a82afbb72d83ee394aedc7b37ac0008a9823b4f4","modified":1641120689101},{"_id":"themes/next/source/css/_common/components/post/post-button.styl","hash":"beccb53dcd658136fb91a0c5678dea8f37d6e0b6","modified":1641120689101},{"_id":"themes/next/source/css/_common/components/post/post-collapse.styl","hash":"dbc07ec641a537df5918b41ce40a6466712a44f6","modified":1641120689101},{"_id":"themes/next/source/css/_common/components/post/post-copyright.styl","hash":"f54367c0feda6986c030cc4d15a0ca6ceea14bcb","modified":1641120689101},{"_id":"themes/next/source/css/_common/components/post/post-eof.styl","hash":"2cdc094ecf907a02fce25ad4a607cd5c40da0f2b","modified":1641120689102},{"_id":"themes/next/source/css/_common/components/post/post-expand.styl","hash":"88c7d75646b66b168213190ee4cd874609afd5e3","modified":1641120689102},{"_id":"themes/next/source/css/_common/components/post/post-gallery.styl","hash":"387ce23bba52b22a586b2dfb4ec618fe1ffd3926","modified":1641120689102},{"_id":"themes/next/source/css/_common/components/post/post-meta.styl","hash":"c089419916988d0f51d89b225460fe11b631e0a3","modified":1641120689102},{"_id":"themes/next/source/css/_common/components/post/post-nav.styl","hash":"a5d8617a24d7cb6c5ad91ea621183ca2c0917331","modified":1641120689103},{"_id":"themes/next/source/css/_common/components/post/post-reward.styl","hash":"e792c8dc41561c96d128e9b421187f1c3dc978a0","modified":1641120689103},{"_id":"themes/next/source/css/_common/components/post/post-tags.styl","hash":"a352ae5b1f8857393bf770d2e638bf15f0c9585d","modified":1641120689103},{"_id":"themes/next/source/css/_common/components/post/post-title.styl","hash":"963105a531403d7aad6d9e5e23e3bfabb8ec065a","modified":1641120689103},{"_id":"themes/next/source/css/_common/components/post/post-type.styl","hash":"10251257aceecb117233c9554dcf8ecfef8e2104","modified":1641120689103},{"_id":"themes/next/source/css/_common/components/post/post.styl","hash":"8c0276883398651336853d5ec0e9da267a00dd86","modified":1641120689104},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author-links.styl","hash":"2e7ec9aaa3293941106b1bdd09055246aa3c3dc6","modified":1641120689104},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author.styl","hash":"920343e41c124221a17f050bbb989494d44f7a24","modified":1641120689104},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-blogroll.styl","hash":"5f6ea57aabfa30a437059bf8352f1ad829dbd4ff","modified":1641120689104},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-feed-link.styl","hash":"9486ddd2cb255227db102d09a7df4cae0fabad72","modified":1641120689105},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-nav.styl","hash":"45fa7193435a8eae9960267438750b4c9fa9587f","modified":1641120689105},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toc.styl","hash":"7690b9596ec3a49befbe529a5a2649abec0faf76","modified":1641120689105},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toggle.styl","hash":"a2ec22ef4a6817bbb2abe8660fcd99fe4ca0cc5e","modified":1641120689105},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar.styl","hash":"234facd038f144bd0fe09a31ed1357c5d74c517f","modified":1641120689106},{"_id":"themes/next/source/css/_common/components/sidebar/site-state.styl","hash":"3623e7fa4324ec1307370f33d8f287a9e20a5578","modified":1641120689106},{"_id":"themes/next/source/css/_common/components/tags/blockquote-center.styl","hash":"c2abe4d87148e23e15d49ee225bc650de60baf46","modified":1641120689106},{"_id":"themes/next/source/css/_common/components/tags/exturl.styl","hash":"1b3cc9f4e5a7f6e05b4100e9990b37b20d4a2005","modified":1641120689106},{"_id":"themes/next/source/css/_common/components/tags/full-image.styl","hash":"b8969e1654eec89a0fd10d88b337fee9cb03cd44","modified":1641120689107},{"_id":"themes/next/source/css/_common/components/tags/group-pictures.styl","hash":"4851b981020c5cbc354a1af9b831a2dcb3cf9d39","modified":1641120689107},{"_id":"themes/next/source/css/_common/components/tags/note.styl","hash":"74d0ba86f698165d13402670382a822c8736a556","modified":1641120689107},{"_id":"themes/next/source/css/_common/components/tags/tags.styl","hash":"dd310c2d999185e881db007360176ee2f811df10","modified":1641120689107},{"_id":"themes/next/source/css/_common/components/third-party/algolia-search.styl","hash":"fd42777b9125fd8969dc39d4f15473e2b91b4142","modified":1641120689108},{"_id":"themes/next/source/css/_common/components/third-party/baidushare.styl","hash":"93b08815c4d17e2b96fef8530ec1f1064dede6ef","modified":1641120689108},{"_id":"themes/next/source/css/_common/components/third-party/busuanzi-counter.styl","hash":"d4e6d8d7b34dc69994593c208f875ae8f7e8a3ae","modified":1641120689108},{"_id":"themes/next/source/css/_common/components/third-party/duoshuo.styl","hash":"2340dd9b3202c61d73cc708b790fac5adddbfc7f","modified":1641120689108},{"_id":"themes/next/source/css/_common/components/third-party/gentie.styl","hash":"586a3ec0f1015e7207cd6a2474362e068c341744","modified":1641120689108},{"_id":"themes/next/source/css/_common/components/third-party/han.styl","hash":"cce6772e2cdb4db85d35486ae4c6c59367fbdd40","modified":1641120689109},{"_id":"themes/next/source/css/_common/components/third-party/jiathis.styl","hash":"327b5f63d55ec26f7663185c1a778440588d9803","modified":1641120689109},{"_id":"themes/next/source/css/_common/components/third-party/localsearch.styl","hash":"d89c4b562b528e4746696b2ad8935764d133bdae","modified":1641120689109},{"_id":"themes/next/source/css/_common/components/third-party/third-party.styl","hash":"bb3be8374c31c372ed0995bd8030d2b920d581de","modified":1641120689109},{"_id":"themes/next/source/css/_schemes/Mist/outline/outline.styl","hash":"5dc4859c66305f871e56cba78f64bfe3bf1b5f01","modified":1641120689114},{"_id":"themes/next/source/css/_schemes/Mist/sidebar/sidebar-blogroll.styl","hash":"817587e46df49e819858c8ecbafa08b53d5ff040","modified":1641120689114},{"_id":"themes/next/source/css/_schemes/Muse/sidebar/sidebar-blogroll.styl","hash":"817587e46df49e819858c8ecbafa08b53d5ff040","modified":1641120689115},{"_id":"themes/next/source/lib/Han/dist/font/han-space.otf","hash":"07436f011b44051f61b8329c99de4bec64e86f4b","modified":1641120689123},{"_id":"themes/next/source/lib/Han/dist/font/han-space.woff","hash":"7a635062b10bf5662ae1d218ba0980171005d060","modified":1641120689123},{"_id":"themes/next/source/lib/Han/dist/font/han.otf","hash":"f1f6bb8f461f5672e000380195d3d2358a28494c","modified":1641120689123},{"_id":"themes/next/source/lib/Han/dist/font/han.woff","hash":"f38ff9b2eecaa17b50b66aa2dae87e9e7436d195","modified":1641120689123},{"_id":"themes/next/source/lib/fancybox/source/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1641120689129},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1641120689129},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.js","hash":"91e41741c2e93f732c82aaacec4cfc6e3f3ec876","modified":1641120689129},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1641120689129},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","hash":"53e194f4a72e649c04fb586dd57762b8c022800b","modified":1641120689129},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-media.js","hash":"3bdf69ed2469e4fb57f5a95f17300eef891ff90d","modified":1641120689129},{"_id":"themes/next/source/lib/jquery/index.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1641120689141},{"_id":"themes/next/source/lib/Han/dist/han.css","hash":"38e48f275ad00daa9dcdcb8d9b44e576acda4707","modified":1641120689123},{"_id":"themes/next/source/lib/Han/dist/han.js","hash":"e345397e0585c9fed1449e614ec13e0224acf2ab","modified":1641120689124},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1641120689140},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1641120689140},{"_id":"themes/next/source/lib/font-awesome/fonts/FontAwesome.otf","hash":"048707bc52ac4b6563aaa383bfe8660a0ddc908c","modified":1641120689135},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1641120689136},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.ttf","hash":"13b1eab65a983c7a73bc7997c479d66943f7c6cb","modified":1641120689139},{"_id":"themes/next/source/lib/velocity/velocity.js","hash":"9f08181baea0cc0e906703b7e5df9111b9ef3373","modified":1641120689147},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.js","hash":"9ccc6f8144f54e86df9a3fd33a18368d81cf3a4f","modified":1641120689127},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.svg","hash":"98a8aa5cf7d62c2eff5f07ede8d844b874ef06ed","modified":1641120689138},{"_id":"themes/next/source/lib/three/three.min.js","hash":"73f4cdc17e51a72b9bf5b9291f65386d615c483b","modified":1641120689145},{"_id":"public/README.html","hash":"2c6a78999133b991d9221f484aee2eacae894251","modified":1641125967315},{"_id":"public/tags/index.html","hash":"2c6a78999133b991d9221f484aee2eacae894251","modified":1641125967315},{"_id":"public/2020/04/15/http-chunked/index.html","hash":"2d5f8d7f0a96b611e2d5a5e4d111fc17726a990f","modified":1641125967315},{"_id":"public/2019/06/05/existential/index.html","hash":"2d5f8d7f0a96b611e2d5a5e4d111fc17726a990f","modified":1641125967315},{"_id":"public/2018/11/19/from-result-to-error-handling/index.html","hash":"2d5f8d7f0a96b611e2d5a5e4d111fc17726a990f","modified":1641125967315},{"_id":"public/2018/08/26/pats/index.html","hash":"2d5f8d7f0a96b611e2d5a5e4d111fc17726a990f","modified":1641125967315},{"_id":"public/2020/04/25/http-chunked-2/index.html","hash":"2d5f8d7f0a96b611e2d5a5e4d111fc17726a990f","modified":1641125967315},{"_id":"public/2017/08/10/plist-parser/index.html","hash":"2d5f8d7f0a96b611e2d5a5e4d111fc17726a990f","modified":1641125967315},{"_id":"public/2017/06/12/group-theory-and-category-theory/index.html","hash":"2d5f8d7f0a96b611e2d5a5e4d111fc17726a990f","modified":1641125967315},{"_id":"public/2018/08/26/logging-system/index.html","hash":"2d5f8d7f0a96b611e2d5a5e4d111fc17726a990f","modified":1641125967315},{"_id":"public/2017/05/28/parser-combinator/index.html","hash":"2d5f8d7f0a96b611e2d5a5e4d111fc17726a990f","modified":1641125967315},{"_id":"public/2017/05/20/cherry-blessing/index.html","hash":"2d5f8d7f0a96b611e2d5a5e4d111fc17726a990f","modified":1641125967315},{"_id":"public/archives/index.html","hash":"5de4dca06b05d99e4f6bad617a4b8f4f3592fb01","modified":1641125967315},{"_id":"public/archives/2017/index.html","hash":"5de4dca06b05d99e4f6bad617a4b8f4f3592fb01","modified":1641125967315},{"_id":"public/archives/2017/05/index.html","hash":"5de4dca06b05d99e4f6bad617a4b8f4f3592fb01","modified":1641125967315},{"_id":"public/archives/2017/06/index.html","hash":"5de4dca06b05d99e4f6bad617a4b8f4f3592fb01","modified":1641125967315},{"_id":"public/archives/2017/08/index.html","hash":"5de4dca06b05d99e4f6bad617a4b8f4f3592fb01","modified":1641125967315},{"_id":"public/archives/2018/index.html","hash":"5de4dca06b05d99e4f6bad617a4b8f4f3592fb01","modified":1641125967315},{"_id":"public/archives/2018/11/index.html","hash":"5de4dca06b05d99e4f6bad617a4b8f4f3592fb01","modified":1641125967315},{"_id":"public/archives/2018/08/index.html","hash":"5de4dca06b05d99e4f6bad617a4b8f4f3592fb01","modified":1641125967315},{"_id":"public/archives/2019/index.html","hash":"5de4dca06b05d99e4f6bad617a4b8f4f3592fb01","modified":1641125967315},{"_id":"public/archives/2019/06/index.html","hash":"5de4dca06b05d99e4f6bad617a4b8f4f3592fb01","modified":1641125967315},{"_id":"public/archives/2020/index.html","hash":"5de4dca06b05d99e4f6bad617a4b8f4f3592fb01","modified":1641125967315},{"_id":"public/archives/2020/04/index.html","hash":"5de4dca06b05d99e4f6bad617a4b8f4f3592fb01","modified":1641125967315},{"_id":"public/categories/advanced-swift/index.html","hash":"82e7bc278559b4335ad974659104eaaf04863032","modified":1641125967315},{"_id":"public/categories/functional-programming/index.html","hash":"82e7bc278559b4335ad974659104eaaf04863032","modified":1641125967315},{"_id":"public/categories/networking/index.html","hash":"82e7bc278559b4335ad974659104eaaf04863032","modified":1641125967315},{"_id":"public/tags/swift/index.html","hash":"2e73ee478e981092ea9a5d10dd472a9461db395b","modified":1641125967315},{"_id":"public/index.html","hash":"03e8a2cda03bad42ac0cb827025eb81f95d496a2","modified":1641125967315},{"_id":"public/tags/error-handling/index.html","hash":"2e73ee478e981092ea9a5d10dd472a9461db395b","modified":1641125967315},{"_id":"public/tags/result/index.html","hash":"2e73ee478e981092ea9a5d10dd472a9461db395b","modified":1641125967315},{"_id":"public/tags/group-theory/index.html","hash":"2e73ee478e981092ea9a5d10dd472a9461db395b","modified":1641125967315},{"_id":"public/tags/category-theory/index.html","hash":"2e73ee478e981092ea9a5d10dd472a9461db395b","modified":1641125967315},{"_id":"public/tags/semigroup/index.html","hash":"2e73ee478e981092ea9a5d10dd472a9461db395b","modified":1641125967315},{"_id":"public/tags/monoid/index.html","hash":"2e73ee478e981092ea9a5d10dd472a9461db395b","modified":1641125967315},{"_id":"public/tags/functor/index.html","hash":"2e73ee478e981092ea9a5d10dd472a9461db395b","modified":1641125967315},{"_id":"public/tags/applicative/index.html","hash":"2e73ee478e981092ea9a5d10dd472a9461db395b","modified":1641125967315},{"_id":"public/tags/monad/index.html","hash":"2e73ee478e981092ea9a5d10dd472a9461db395b","modified":1641125967315},{"_id":"public/tags/functional-programming/index.html","hash":"2e73ee478e981092ea9a5d10dd472a9461db395b","modified":1641125967315},{"_id":"public/tags/existential/index.html","hash":"2e73ee478e981092ea9a5d10dd472a9461db395b","modified":1641125967315},{"_id":"public/tags/protocol/index.html","hash":"2e73ee478e981092ea9a5d10dd472a9461db395b","modified":1641125967315},{"_id":"public/tags/generic/index.html","hash":"2e73ee478e981092ea9a5d10dd472a9461db395b","modified":1641125967315},{"_id":"public/tags/logger/index.html","hash":"2e73ee478e981092ea9a5d10dd472a9461db395b","modified":1641125967315},{"_id":"public/tags/logging/index.html","hash":"2e73ee478e981092ea9a5d10dd472a9461db395b","modified":1641125967315},{"_id":"public/tags/pats/index.html","hash":"2e73ee478e981092ea9a5d10dd472a9461db395b","modified":1641125967315},{"_id":"public/tags/chunked/index.html","hash":"2e73ee478e981092ea9a5d10dd472a9461db395b","modified":1641125967315},{"_id":"public/tags/streaming/index.html","hash":"2e73ee478e981092ea9a5d10dd472a9461db395b","modified":1641125967315},{"_id":"public/tags/http/index.html","hash":"2e73ee478e981092ea9a5d10dd472a9461db395b","modified":1641125967315},{"_id":"public/tags/parser/index.html","hash":"2e73ee478e981092ea9a5d10dd472a9461db395b","modified":1641125967315},{"_id":"public/tags/parser-combinator/index.html","hash":"2e73ee478e981092ea9a5d10dd472a9461db395b","modified":1641125967315},{"_id":"public/tags/type-erasure/index.html","hash":"2e73ee478e981092ea9a5d10dd472a9461db395b","modified":1641125967315},{"_id":"public/tags/type-erased/index.html","hash":"2e73ee478e981092ea9a5d10dd472a9461db395b","modified":1641125967315},{"_id":"public/tags/plist-parser/index.html","hash":"2e73ee478e981092ea9a5d10dd472a9461db395b","modified":1641125967315},{"_id":"public/images/avatar.gif","hash":"264082bb3a1af70d5499c7d22b0902cb454b6d12","modified":1641125967315},{"_id":"public/images/algolia_logo.svg","hash":"90035272fa31a3f65b3c0e2cb8a633876ef457dc","modified":1641125967315},{"_id":"public/CNAME","hash":"03c4fe8ace49b5381fab088c6aee1ca0ca0ff87d","modified":1641125967315},{"_id":"public/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1641125967315},{"_id":"public/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1641125967315},{"_id":"public/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1641125967315},{"_id":"public/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1641125967315},{"_id":"public/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1641125967315},{"_id":"public/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1641125967315},{"_id":"public/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1641125967315},{"_id":"public/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1641125967315},{"_id":"public/images/quote-l.svg","hash":"94e870b4c8c48da61d09522196d4dd40e277a98f","modified":1641125967315},{"_id":"public/images/quote-r.svg","hash":"e60ae504f9d99b712c793c3740c6b100d057d4ec","modified":1641125967315},{"_id":"public/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1641125967315},{"_id":"public/lib/fastclick/LICENSE","hash":"dcd5b6b43095d9e90353a28b09cb269de8d4838e","modified":1641125967315},{"_id":"public/lib/font-awesome/HELP-US-OUT.txt","hash":"4f7bf961f1bed448f6ba99aeb9219fabf930ba96","modified":1641125967315},{"_id":"public/lib/fancybox/source/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1641125967315},{"_id":"public/lib/fancybox/source/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1641125967315},{"_id":"public/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1641125967315},{"_id":"public/lib/fancybox/source/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1641125967315},{"_id":"public/lib/fancybox/source/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1641125967315},{"_id":"public/lib/font-awesome/css/font-awesome.css.map","hash":"0189d278706509412bac4745f96c83984e1d59f4","modified":1641125967315},{"_id":"public/lib/Han/dist/font/han-space.woff","hash":"7a635062b10bf5662ae1d218ba0980171005d060","modified":1641125967315},{"_id":"public/lib/Han/dist/font/han-space.otf","hash":"07436f011b44051f61b8329c99de4bec64e86f4b","modified":1641125967315},{"_id":"public/lib/Han/dist/font/han.otf","hash":"f1f6bb8f461f5672e000380195d3d2358a28494c","modified":1641125967315},{"_id":"public/lib/Han/dist/font/han.woff","hash":"f38ff9b2eecaa17b50b66aa2dae87e9e7436d195","modified":1641125967315},{"_id":"public/lib/fancybox/source/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1641125967315},{"_id":"public/lib/fancybox/source/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1641125967315},{"_id":"public/lib/fancybox/source/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1641125967315},{"_id":"public/js/src/affix.js","hash":"978e0422b5bf1b560236d8d10ebc1adcf66392e3","modified":1641125967315},{"_id":"public/js/src/algolia-search.js","hash":"b172f697ed339a24b1e80261075232978d164c35","modified":1641125967315},{"_id":"public/js/src/exturl.js","hash":"e42e2aaab7bf4c19a0c8e779140e079c6aa5c0b1","modified":1641125967315},{"_id":"public/js/src/bootstrap.js","hash":"aab7be0a6e2724b3faa9338db93c19556c559625","modified":1641125967315},{"_id":"public/js/src/hook-duoshuo.js","hash":"a6119070c0119f33e08b29da7d2cce2635eb40a0","modified":1641125967315},{"_id":"public/js/src/js.cookie.js","hash":"9b37973a90fd50e71ea91682265715e45ae82c75","modified":1641125967315},{"_id":"public/js/src/post-details.js","hash":"af7a417dd1cb02465a7b98211653e7c6192e6d55","modified":1641125967315},{"_id":"public/js/src/motion.js","hash":"269414e84df544a4ccb88519f6abae4943db3c67","modified":1641125967315},{"_id":"public/js/src/scroll-cookie.js","hash":"09dc828cbf5f31158ff6250d2bf7c3cde6365c67","modified":1641125967315},{"_id":"public/js/src/utils.js","hash":"803f684fa7d0e729115a48851023a31f6fb6d0a7","modified":1641125967315},{"_id":"public/js/src/scrollspy.js","hash":"fe4da1b9fe73518226446f5f27d2831e4426fc35","modified":1641125967315},{"_id":"public/lib/algolia-instant-search/instantsearch.min.css","hash":"90ef19edc982645b118b095615838d9c5eaba0de","modified":1641125967315},{"_id":"public/lib/canvas-nest/canvas-nest.min.js","hash":"0387e75e23b1db108a755073fe52a0d03eb391a7","modified":1641125967315},{"_id":"public/lib/canvas-ribbon/canvas-ribbon.js","hash":"3587602ad777b031628bb5944864d1a4fcfea4ac","modified":1641125967315},{"_id":"public/lib/fastclick/README.html","hash":"c88ed76304392b9e77b266fcbbc05f443c5df133","modified":1641125967315},{"_id":"public/lib/fastclick/bower.json","hash":"4dcecf83afddba148464d5339c93f6d0aa9f42e9","modified":1641125967315},{"_id":"public/lib/jquery_lazyload/CONTRIBUTING.html","hash":"bc6cf8951a99074bdc6ec9172f03fb7c0e412729","modified":1641125967315},{"_id":"public/lib/jquery_lazyload/README.html","hash":"96a5c2cc00de5b338ae972c1e8de879d2d919608","modified":1641125967315},{"_id":"public/lib/font-awesome/bower.json","hash":"64394a2a9aa00f8e321d8daa5e51a420f0e96dad","modified":1641125967315},{"_id":"public/lib/jquery_lazyload/jquery.lazyload.js","hash":"481fd478650e12b67c201a0ea41e92743f8b45a3","modified":1641125967315},{"_id":"public/lib/jquery_lazyload/jquery.scrollstop.js","hash":"0e9a81785a011c98be5ea821a8ed7d411818cfd1","modified":1641125967315},{"_id":"public/lib/velocity/bower.json","hash":"0ef14e7ccdfba5db6eb3f8fc6aa3b47282c36409","modified":1641125967315},{"_id":"public/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1641125967315},{"_id":"public/lib/jquery_lazyload/bower.json","hash":"ae3c3b61e6e7f9e1d7e3585ad854380ecc04cf53","modified":1641125967315},{"_id":"public/js/src/schemes/pisces.js","hash":"79da92119bc246fe05d1626ac98426a83ec90a94","modified":1641125967315},{"_id":"public/lib/fancybox/source/jquery.fancybox.css","hash":"5f163444617b6cf267342f06ac166a237bb62df9","modified":1641125967315},{"_id":"public/lib/fastclick/lib/fastclick.min.js","hash":"2cae0f5a6c5d6f3cb993015e6863f9483fc4de18","modified":1641125967315},{"_id":"public/lib/ua-parser-js/dist/ua-parser.min.js","hash":"38628e75e4412cc6f11074e03e1c6d257aae495b","modified":1641125967315},{"_id":"public/lib/ua-parser-js/dist/ua-parser.pack.js","hash":"214dad442a92d36af77ed0ca1d9092b16687f02f","modified":1641125967315},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1641125967315},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-buttons.js","hash":"91e41741c2e93f732c82aaacec4cfc6e3f3ec876","modified":1641125967315},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1641125967315},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","hash":"53e194f4a72e649c04fb586dd57762b8c022800b","modified":1641125967315},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-media.js","hash":"3bdf69ed2469e4fb57f5a95f17300eef891ff90d","modified":1641125967315},{"_id":"public/css/main.css","hash":"980d336d02264b60d00eb73f74d3786fde7a495a","modified":1641125967315},{"_id":"public/lib/algolia-instant-search/instantsearch.min.js","hash":"9ccc6f8144f54e86df9a3fd33a18368d81cf3a4f","modified":1641125967315},{"_id":"public/lib/jquery/index.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1641125967315},{"_id":"public/lib/three/canvas_lines.min.js","hash":"dce4a3b65f8bf958f973690caa7ec4952f353b0c","modified":1641125967315},{"_id":"public/lib/three/canvas_sphere.min.js","hash":"d8ea241a53c135a650f7335d2b6982b899fd58a9","modified":1641125967315},{"_id":"public/lib/three/three-waves.min.js","hash":"d968cba6b3a50b3626a02d67b544f349d83b147c","modified":1641125967315},{"_id":"public/lib/velocity/velocity.ui.js","hash":"6a1d101eab3de87527bb54fcc8c7b36b79d8f0df","modified":1641125967315},{"_id":"public/lib/Han/dist/han.css","hash":"38e48f275ad00daa9dcdcb8d9b44e576acda4707","modified":1641125967315},{"_id":"public/lib/Han/dist/han.js","hash":"e345397e0585c9fed1449e614ec13e0224acf2ab","modified":1641125967315},{"_id":"public/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1641125967315},{"_id":"public/lib/velocity/velocity.js","hash":"9f08181baea0cc0e906703b7e5df9111b9ef3373","modified":1641125967315},{"_id":"public/lib/fancybox/source/jquery.fancybox.pack.js","hash":"53360764b429c212f424399384417ccc233bb3be","modified":1641125967315},{"_id":"public/lib/Han/dist/han.min.js","hash":"f559c68a25065a14f47da954a7617d87263e409d","modified":1641125967315},{"_id":"public/lib/fastclick/lib/fastclick.js","hash":"06cef196733a710e77ad7e386ced6963f092dc55","modified":1641125967315},{"_id":"public/lib/font-awesome/css/font-awesome.min.css","hash":"512c7d79033e3028a9be61b540cf1a6870c896f8","modified":1641125967315},{"_id":"public/lib/fancybox/source/jquery.fancybox.js","hash":"1cf3d47b5ccb7cb6e9019c64f2a88d03a64853e4","modified":1641125967315},{"_id":"public/lib/font-awesome/css/font-awesome.css","hash":"0140952c64e3f2b74ef64e050f2fe86eab6624c8","modified":1641125967315},{"_id":"public/lib/three/three.min.js","hash":"73f4cdc17e51a72b9bf5b9291f65386d615c483b","modified":1641125967315},{"_id":"public/lib/Han/dist/han.min.css","hash":"d9c0b3dc9158e717fde36f554709e6c3a22b5f85","modified":1641125967315},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1641125967315},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1641125967315},{"_id":"public/lib/font-awesome/fonts/FontAwesome.otf","hash":"048707bc52ac4b6563aaa383bfe8660a0ddc908c","modified":1641125967315},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1641125967315},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.ttf","hash":"13b1eab65a983c7a73bc7997c479d66943f7c6cb","modified":1641125967315},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.svg","hash":"98a8aa5cf7d62c2eff5f07ede8d844b874ef06ed","modified":1641125967315}],"Category":[{"name":"advanced swift","_id":"ckxx810x600049ith5nfg6ej7"},{"name":"functional programming","_id":"ckxx810xb00099ithfzo6gcuj"},{"name":"networking","_id":"ckxx810xg000j9ith3w6fgxtw"}],"Data":[],"Page":[{"_content":"## Cherry Blessing\n","source":"README.md","raw":"## Cherry Blessing\n","date":"2022-01-02T10:51:29.043Z","updated":"2022-01-02T10:51:29.043Z","path":"README.html","title":"","comments":1,"layout":"page","_id":"ckxx810wy00009ithhftqbv27","content":"<h2 id=\"Cherry-Blessing\"><a href=\"#Cherry-Blessing\" class=\"headerlink\" title=\"Cherry Blessing\"></a>Cherry Blessing</h2>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Cherry-Blessing\"><a href=\"#Cherry-Blessing\" class=\"headerlink\" title=\"Cherry Blessing\"></a>Cherry Blessing</h2>"},{"title":"tags","date":"2017-06-05T14:30:24.000Z","type":"tags","_content":"\n\n","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2017-06-05 22:30:24\ntype: \"tags\"\n---\n\n\n","updated":"2022-01-02T10:51:29.047Z","path":"tags/index.html","comments":1,"layout":"page","_id":"ckxx810x400029ithakdi1f8b","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"From Result to Error Handling","date":"2018-11-19T12:00:00.000Z","_content":">  [Add Result to the Standard Library](swift-evolution/0235-add-result.md at master  apple/swift-evolution  GitHub) [](SE-0235 - Add Result to the Standard Library - Proposal Reviews - Swift Forums) `Either` \n\n## Result\n\n Swift `Result`  community  `Result` [Alamofire](https://github.com/Alamofire/Alamofire)  `Result` / `Result`  ****\n\n ****  `Result`  `Optional`  Monad `Result` \n\n## Error Handling\n\nsynchronizationconcurrency\n\n Cocoa  `throw` + `try catch` `throw`/`raise` `try catch`  C  Error  Error  Error \n\n Cocoa  block, delegate  notification  block  delegate  notification `Result`  [AVAssetExportSession](https://developer.apple.com/documentation/avfoundation/avassetexportsession) `completionHandler`  `@escaping () ->  Void` `var status: AVAssetExportSession.Status`  `var error: Error?` \n\n async/await  API  `completionHandler: (Value?, Error?) -> Void` `completionHandler: (Result<Value>) -> Void`\n\n Swift  `throw` + `try catch` Error  `throw` + `try catch`  `throw/throws/rethrows` ObjC  throw/raise \n\n `throw` + `try catch`\n\n```swift\nfunc remove(forKey key: StoreKey) throws {\n    queue.async {\n        let url = try disk.url(atPath: path(forKey: key), in: directory)\n        try disk.remove(at: url)\n    }\n}\n\nfunc remove(forKey key: StoreKey) throws {\n    try queue.async {\n        let url = try disk.url(atPath: path(forKey: key), in: directory)\n        try disk.remove(at: url)\n    }\n}\n```\n\n###  return\n\n Alligator \n\n```swift\n/// \n///\n/// - Parameter asset: \n/// - Parameter outputURL: \nfunc export(asset: AVAsset, to outputURL: URL) {\n    guard outputURL.isFileURL else {\n        assertionFailure(\"output url must be file url.\")\n        return\n    }\n    ...\n    guard let exportSession = AVAssetExportSession(asset: asset, presetName: AVAssetExportPresetHighestQuality) else {\n        return\n    }\n\n    exportSession.outputURL = outputURL\n    exportSession.outputFileType = .mp4\n    ...\n}\n```\n\n assertion`guard` \n\n\n\n```swift\n// VideoProcessor.swift\nfunc prepare() {\n    let videoWriterInput = \n    let audioWriterInput = \n    guard let videoWriter = try? AVAssetWriter(outputURL: outputURL, fileType: .mp4) else {\n        return\n    }\n    \n    if videoWriter.canAdd(videoWriterInput) {\n        videoWriter.add(videoWriterInput)\n    } else {\n        assertionFailure(\"can't add video writer input\")\n    }\n\n    if videoWriter.canAdd(audioWriterInput) {\n        videoWriter.add(audioWriterInput)\n    } else {\n        assertionFailure(\"can't add audio writer input\")\n    }\n    ...\n}\n```\n\n project  **** return  assertion  crash assertion  `print` :P\n\n UI \n\n\n\n```swift\n// AVAsset+Processor.swift\n\nextension Alligator where Base: AVAsset {\n    /// Merge the given video asset and audio asset\n    ///\n    /// - Parameters:\n    ///   - videoAsset: the given video asset\n    ///   - audioAsset: the given audio asset\n    /// - Returns: the merged asset\n    /// - Throws: throws error when the given asset is invalid. e.g. video asset without video tracks.\n    public static func merge(videoAsset: AVAsset, audioAsset: AVAsset) throws -> AVAsset {\n        let mixComposition = AVMutableComposition()\n        \n        try mixComposition.agt.add(.video, from: videoAsset)\n\n        let videoDuration = mixComposition.duration\n        try mixComposition.agt.add(.audio, from: audioAsset, maxBounds: videoDuration)\n\n        return mixComposition\n    }\n\n    /// Merge the given assets one by one\n    ///\n    /// - Parameters:\n    ///   - segments: given assets, it can't be empty\n    ///   - isMuted: if true, it will passthrough audio tracks\n    /// - Returns: merged asset\n    /// - Throws: throws error when segments is empry, or some segment is invalid.\n    public static func merge(segments: [AVAsset], isMuted: Bool) throws -> AVAsset {\n        guard !segments.isEmpty else {\n            throw Error.segmentsEmpty\n        }\n\n        if segments.count > 1 {\n            let mixComposition = AVMutableComposition()\n            try mixComposition.agt.add(segments, isMuted: isMuted)\n            return mixComposition\n        } else {\n            return segments[0]\n        }\n    }\n}\n```\n\n###  Optional\n\n Optional  `T`  `T?` `return nil` \n\n```swift\nstruct Formatter {\n    /// Format a string, replace invalid symbol with empty character\n    ///\n    /// - Parameter string: string needs to be format\n    /// - Returns: formatted string\n    func format(_ string: String) -> String? {\n        guard string.isEmpty else {\n            return nil\n        }\n        return string.replacingOccurrences(of: \"\\n\", with: \"\")\n    }\n}\n```\n\n\n\n```swift\nstruct Formatter {\n    /// Format a string, replace invalid symbol with empty character. If it is empty or contains `@`, `#`, return nil.\n    ///\n    /// - Parameter string: string needs to be format\n    /// - Returns: formatted string\n    func format(_ string: String) -> String? {\n        guard string.isEmpty else {\n            throw nil\n        }\n\n        guard !string.contains(\"@\") else {\n            return nil\n        }\n\n        guard !string.contains(\"#\") else {\n            return nil\n        }\n\n        return string.replacingOccurrences(of: \"\\n\", with: \"\")\n    }\n}\n```\n\n\n\n```swift\nstruct Formatter {\n    enum Error: Swift.Error {\n        case emptyString\n        case containsHashtag\n        case containsMention\n    }\n\n    /// Format a string, replace invalid symbol with empty character\n    ///\n    /// - Parameter string: string needs to be format\n    /// - Returns: formatted string\n    func format(_ string: String) throws -> String {\n        guard string.isEmpty else {\n            throw Error.emptyString\n        }\n\n        guard !string.contains(\"@\") else {\n            throw Error.containsMention\n        }\n\n        guard !string.contains(\"#\") else {\n            throw Error.containsHashtag\n        }\n\n        return string.replacingOccurrences(of: \"\\n\", with: \"\")\n    }\n}\n```\n\n** API  throw nil**\n\n `throw` `Optional`\n\n### \n\n `assertion`, `precondition`, `fatalError` \n\n\n\n```swift\nfunc tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {\n    guard let cell = tableView.dequeueReusableCell(withIdentifier: \"cell\", for: indexPath) else {\n        fataError(\"\")\n    }\n    return cell\n}\n```\n\n\n\n>  ObjC  API  `id` `return` \n\n## \n\n[Swift Package Manager](https://github.com/apple/swift-package-manager/blob/master/Sources/Basic/Result.swift)\n[Result&lt;T&gt;  Result&lt;T, E: Error&gt;](https://onevcat.com/2018/10/swift-result-error/)\n\n\n","source":"_posts/from-result-to-error-handling.md","raw":"---\ntitle: From Result to Error Handling\ndate: 2018-11-19 20:00:00\ntags:\n    - swift\n    - error handling\n    - result\ncategories: advanced swift\n---\n>  [Add Result to the Standard Library](swift-evolution/0235-add-result.md at master  apple/swift-evolution  GitHub) [](SE-0235 - Add Result to the Standard Library - Proposal Reviews - Swift Forums) `Either` \n\n## Result\n\n Swift `Result`  community  `Result` [Alamofire](https://github.com/Alamofire/Alamofire)  `Result` / `Result`  ****\n\n ****  `Result`  `Optional`  Monad `Result` \n\n## Error Handling\n\nsynchronizationconcurrency\n\n Cocoa  `throw` + `try catch` `throw`/`raise` `try catch`  C  Error  Error  Error \n\n Cocoa  block, delegate  notification  block  delegate  notification `Result`  [AVAssetExportSession](https://developer.apple.com/documentation/avfoundation/avassetexportsession) `completionHandler`  `@escaping () ->  Void` `var status: AVAssetExportSession.Status`  `var error: Error?` \n\n async/await  API  `completionHandler: (Value?, Error?) -> Void` `completionHandler: (Result<Value>) -> Void`\n\n Swift  `throw` + `try catch` Error  `throw` + `try catch`  `throw/throws/rethrows` ObjC  throw/raise \n\n `throw` + `try catch`\n\n```swift\nfunc remove(forKey key: StoreKey) throws {\n    queue.async {\n        let url = try disk.url(atPath: path(forKey: key), in: directory)\n        try disk.remove(at: url)\n    }\n}\n\nfunc remove(forKey key: StoreKey) throws {\n    try queue.async {\n        let url = try disk.url(atPath: path(forKey: key), in: directory)\n        try disk.remove(at: url)\n    }\n}\n```\n\n###  return\n\n Alligator \n\n```swift\n/// \n///\n/// - Parameter asset: \n/// - Parameter outputURL: \nfunc export(asset: AVAsset, to outputURL: URL) {\n    guard outputURL.isFileURL else {\n        assertionFailure(\"output url must be file url.\")\n        return\n    }\n    ...\n    guard let exportSession = AVAssetExportSession(asset: asset, presetName: AVAssetExportPresetHighestQuality) else {\n        return\n    }\n\n    exportSession.outputURL = outputURL\n    exportSession.outputFileType = .mp4\n    ...\n}\n```\n\n assertion`guard` \n\n\n\n```swift\n// VideoProcessor.swift\nfunc prepare() {\n    let videoWriterInput = \n    let audioWriterInput = \n    guard let videoWriter = try? AVAssetWriter(outputURL: outputURL, fileType: .mp4) else {\n        return\n    }\n    \n    if videoWriter.canAdd(videoWriterInput) {\n        videoWriter.add(videoWriterInput)\n    } else {\n        assertionFailure(\"can't add video writer input\")\n    }\n\n    if videoWriter.canAdd(audioWriterInput) {\n        videoWriter.add(audioWriterInput)\n    } else {\n        assertionFailure(\"can't add audio writer input\")\n    }\n    ...\n}\n```\n\n project  **** return  assertion  crash assertion  `print` :P\n\n UI \n\n\n\n```swift\n// AVAsset+Processor.swift\n\nextension Alligator where Base: AVAsset {\n    /// Merge the given video asset and audio asset\n    ///\n    /// - Parameters:\n    ///   - videoAsset: the given video asset\n    ///   - audioAsset: the given audio asset\n    /// - Returns: the merged asset\n    /// - Throws: throws error when the given asset is invalid. e.g. video asset without video tracks.\n    public static func merge(videoAsset: AVAsset, audioAsset: AVAsset) throws -> AVAsset {\n        let mixComposition = AVMutableComposition()\n        \n        try mixComposition.agt.add(.video, from: videoAsset)\n\n        let videoDuration = mixComposition.duration\n        try mixComposition.agt.add(.audio, from: audioAsset, maxBounds: videoDuration)\n\n        return mixComposition\n    }\n\n    /// Merge the given assets one by one\n    ///\n    /// - Parameters:\n    ///   - segments: given assets, it can't be empty\n    ///   - isMuted: if true, it will passthrough audio tracks\n    /// - Returns: merged asset\n    /// - Throws: throws error when segments is empry, or some segment is invalid.\n    public static func merge(segments: [AVAsset], isMuted: Bool) throws -> AVAsset {\n        guard !segments.isEmpty else {\n            throw Error.segmentsEmpty\n        }\n\n        if segments.count > 1 {\n            let mixComposition = AVMutableComposition()\n            try mixComposition.agt.add(segments, isMuted: isMuted)\n            return mixComposition\n        } else {\n            return segments[0]\n        }\n    }\n}\n```\n\n###  Optional\n\n Optional  `T`  `T?` `return nil` \n\n```swift\nstruct Formatter {\n    /// Format a string, replace invalid symbol with empty character\n    ///\n    /// - Parameter string: string needs to be format\n    /// - Returns: formatted string\n    func format(_ string: String) -> String? {\n        guard string.isEmpty else {\n            return nil\n        }\n        return string.replacingOccurrences(of: \"\\n\", with: \"\")\n    }\n}\n```\n\n\n\n```swift\nstruct Formatter {\n    /// Format a string, replace invalid symbol with empty character. If it is empty or contains `@`, `#`, return nil.\n    ///\n    /// - Parameter string: string needs to be format\n    /// - Returns: formatted string\n    func format(_ string: String) -> String? {\n        guard string.isEmpty else {\n            throw nil\n        }\n\n        guard !string.contains(\"@\") else {\n            return nil\n        }\n\n        guard !string.contains(\"#\") else {\n            return nil\n        }\n\n        return string.replacingOccurrences(of: \"\\n\", with: \"\")\n    }\n}\n```\n\n\n\n```swift\nstruct Formatter {\n    enum Error: Swift.Error {\n        case emptyString\n        case containsHashtag\n        case containsMention\n    }\n\n    /// Format a string, replace invalid symbol with empty character\n    ///\n    /// - Parameter string: string needs to be format\n    /// - Returns: formatted string\n    func format(_ string: String) throws -> String {\n        guard string.isEmpty else {\n            throw Error.emptyString\n        }\n\n        guard !string.contains(\"@\") else {\n            throw Error.containsMention\n        }\n\n        guard !string.contains(\"#\") else {\n            throw Error.containsHashtag\n        }\n\n        return string.replacingOccurrences(of: \"\\n\", with: \"\")\n    }\n}\n```\n\n** API  throw nil**\n\n `throw` `Optional`\n\n### \n\n `assertion`, `precondition`, `fatalError` \n\n\n\n```swift\nfunc tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {\n    guard let cell = tableView.dequeueReusableCell(withIdentifier: \"cell\", for: indexPath) else {\n        fataError(\"\")\n    }\n    return cell\n}\n```\n\n\n\n>  ObjC  API  `id` `return` \n\n## \n\n[Swift Package Manager](https://github.com/apple/swift-package-manager/blob/master/Sources/Basic/Result.swift)\n[Result&lt;T&gt;  Result&lt;T, E: Error&gt;](https://onevcat.com/2018/10/swift-result-error/)\n\n\n","slug":"from-result-to-error-handling","published":1,"updated":"2022-01-02T11:28:17.640Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckxx810x100019ithgkok4y2u","content":"<blockquote>\n<p> [Add Result to the Standard Library](swift-evolution/0235-add-result.md at master  apple/swift-evolution  GitHub) [](SE-0235 - Add Result to the Standard Library - Proposal Reviews - Swift Forums) <code>Either</code> </p>\n</blockquote>\n<h2 id=\"Result\"><a href=\"#Result\" class=\"headerlink\" title=\"Result\"></a>Result</h2><p> Swift <code>Result</code>  community  <code>Result</code> <a href=\"https://github.com/Alamofire/Alamofire\">Alamofire</a>  <code>Result</code> / <code>Result</code>  <strong></strong></p>\n<p> <strong></strong>  <code>Result</code>  <code>Optional</code>  Monad <code>Result</code> </p>\n<h2 id=\"Error-Handling\"><a href=\"#Error-Handling\" class=\"headerlink\" title=\"Error Handling\"></a>Error Handling</h2><p>synchronizationconcurrency</p>\n<p> Cocoa  <code>throw</code> + <code>try catch</code> <code>throw</code>/<code>raise</code> <code>try catch</code>  C  Error  Error  Error </p>\n<p> Cocoa  block, delegate  notification  block  delegate  notification <code>Result</code>  <a href=\"https://developer.apple.com/documentation/avfoundation/avassetexportsession\">AVAssetExportSession</a> <code>completionHandler</code>  <code>@escaping () -&gt;  Void</code> <code>var status: AVAssetExportSession.Status</code>  <code>var error: Error?</code> </p>\n<p> async/await  API  <code>completionHandler: (Value?, Error?) -&gt; Void</code> <code>completionHandler: (Result&lt;Value&gt;) -&gt; Void</code></p>\n<p> Swift  <code>throw</code> + <code>try catch</code> Error  <code>throw</code> + <code>try catch</code>  <code>throw/throws/rethrows</code> ObjC  throw/raise </p>\n<p> <code>throw</code> + <code>try catch</code></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">remove</span>(<span class=\"params\">forKey</span> <span class=\"params\">key</span>: <span class=\"type\">StoreKey</span>)</span> <span class=\"keyword\">throws</span> &#123;</span><br><span class=\"line\">    queue.async &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> url <span class=\"operator\">=</span> <span class=\"keyword\">try</span> disk.url(atPath: path(forKey: key), in: directory)</span><br><span class=\"line\">        <span class=\"keyword\">try</span> disk.remove(at: url)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">remove</span>(<span class=\"params\">forKey</span> <span class=\"params\">key</span>: <span class=\"type\">StoreKey</span>)</span> <span class=\"keyword\">throws</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> queue.async &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> url <span class=\"operator\">=</span> <span class=\"keyword\">try</span> disk.url(atPath: path(forKey: key), in: directory)</span><br><span class=\"line\">        <span class=\"keyword\">try</span> disk.remove(at: url)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"-return\"><a href=\"#-return\" class=\"headerlink\" title=\" return\"></a> return</h3><p> Alligator </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// </span></span><br><span class=\"line\"><span class=\"comment\">///</span></span><br><span class=\"line\"><span class=\"comment\">/// - Parameter asset: </span></span><br><span class=\"line\"><span class=\"comment\">/// - Parameter outputURL: </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">export</span>(<span class=\"params\">asset</span>: <span class=\"type\">AVAsset</span>, <span class=\"params\">to</span> <span class=\"params\">outputURL</span>: <span class=\"type\">URL</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">guard</span> outputURL.isFileURL <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">assertionFailure</span>(<span class=\"string\">&quot;output url must be file url.&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"operator\">...</span></span><br><span class=\"line\">    <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> exportSession <span class=\"operator\">=</span> <span class=\"type\">AVAssetExportSession</span>(asset: asset, presetName: <span class=\"type\">AVAssetExportPresetHighestQuality</span>) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    exportSession.outputURL <span class=\"operator\">=</span> outputURL</span><br><span class=\"line\">    exportSession.outputFileType <span class=\"operator\">=</span> .mp4</span><br><span class=\"line\">    <span class=\"operator\">...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> assertion<code>guard</code> </p>\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// VideoProcessor.swift</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">prepare</span>()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> videoWriterInput <span class=\"operator\">=</span> </span><br><span class=\"line\">    <span class=\"keyword\">let</span> audioWriterInput <span class=\"operator\">=</span> </span><br><span class=\"line\">    <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> videoWriter <span class=\"operator\">=</span> <span class=\"keyword\">try?</span> <span class=\"type\">AVAssetWriter</span>(outputURL: outputURL, fileType: .mp4) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">if</span> videoWriter.canAdd(videoWriterInput) &#123;</span><br><span class=\"line\">        videoWriter.add(videoWriterInput)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">assertionFailure</span>(<span class=\"string\">&quot;can&#x27;t add video writer input&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> videoWriter.canAdd(audioWriterInput) &#123;</span><br><span class=\"line\">        videoWriter.add(audioWriterInput)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">assertionFailure</span>(<span class=\"string\">&quot;can&#x27;t add audio writer input&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"operator\">...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> project  <strong></strong> return  assertion  crash assertion  <code>print</code> :P</p>\n<p> UI </p>\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// AVAsset+Processor.swift</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">Alligator</span> <span class=\"title\">where</span> <span class=\"title\">Base</span>: <span class=\"title\">AVAsset</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/// Merge the given video asset and audio asset</span></span><br><span class=\"line\">    <span class=\"comment\">///</span></span><br><span class=\"line\">    <span class=\"comment\">/// - Parameters:</span></span><br><span class=\"line\">    <span class=\"comment\">///   - videoAsset: the given video asset</span></span><br><span class=\"line\">    <span class=\"comment\">///   - audioAsset: the given audio asset</span></span><br><span class=\"line\">    <span class=\"comment\">/// - Returns: the merged asset</span></span><br><span class=\"line\">    <span class=\"comment\">/// - Throws: throws error when the given asset is invalid. e.g. video asset without video tracks.</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">merge</span>(<span class=\"params\">videoAsset</span>: <span class=\"type\">AVAsset</span>, <span class=\"params\">audioAsset</span>: <span class=\"type\">AVAsset</span>)</span> <span class=\"keyword\">throws</span> -&gt; <span class=\"type\">AVAsset</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> mixComposition <span class=\"operator\">=</span> <span class=\"type\">AVMutableComposition</span>()</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">try</span> mixComposition.agt.add(.video, from: videoAsset)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">let</span> videoDuration <span class=\"operator\">=</span> mixComposition.duration</span><br><span class=\"line\">        <span class=\"keyword\">try</span> mixComposition.agt.add(.audio, from: audioAsset, maxBounds: videoDuration)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> mixComposition</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/// Merge the given assets one by one</span></span><br><span class=\"line\">    <span class=\"comment\">///</span></span><br><span class=\"line\">    <span class=\"comment\">/// - Parameters:</span></span><br><span class=\"line\">    <span class=\"comment\">///   - segments: given assets, it can&#x27;t be empty</span></span><br><span class=\"line\">    <span class=\"comment\">///   - isMuted: if true, it will passthrough audio tracks</span></span><br><span class=\"line\">    <span class=\"comment\">/// - Returns: merged asset</span></span><br><span class=\"line\">    <span class=\"comment\">/// - Throws: throws error when segments is empry, or some segment is invalid.</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">merge</span>(<span class=\"params\">segments</span>: [<span class=\"type\">AVAsset</span>], <span class=\"params\">isMuted</span>: <span class=\"type\">Bool</span>)</span> <span class=\"keyword\">throws</span> -&gt; <span class=\"type\">AVAsset</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"operator\">!</span>segments.isEmpty <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"type\">Error</span>.segmentsEmpty</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> segments.count <span class=\"operator\">&gt;</span> <span class=\"number\">1</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> mixComposition <span class=\"operator\">=</span> <span class=\"type\">AVMutableComposition</span>()</span><br><span class=\"line\">            <span class=\"keyword\">try</span> mixComposition.agt.add(segments, isMuted: isMuted)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> mixComposition</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> segments[<span class=\"number\">0</span>]</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"-Optional\"><a href=\"#-Optional\" class=\"headerlink\" title=\" Optional\"></a> Optional</h3><p> Optional  <code>T</code>  <code>T?</code> <code>return nil</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Formatter</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/// Format a string, replace invalid symbol with empty character</span></span><br><span class=\"line\">    <span class=\"comment\">///</span></span><br><span class=\"line\">    <span class=\"comment\">/// - Parameter string: string needs to be format</span></span><br><span class=\"line\">    <span class=\"comment\">/// - Returns: formatted string</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">format</span>(<span class=\"keyword\">_</span> <span class=\"params\">string</span>: <span class=\"type\">String</span>)</span> -&gt; <span class=\"type\">String</span>? &#123;</span><br><span class=\"line\">        <span class=\"keyword\">guard</span> string.isEmpty <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> string.replacingOccurrences(of: <span class=\"string\">&quot;<span class=\"subst\">\\n</span>&quot;</span>, with: <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Formatter</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/// Format a string, replace invalid symbol with empty character. If it is empty or contains `@`, `#`, return nil.</span></span><br><span class=\"line\">    <span class=\"comment\">///</span></span><br><span class=\"line\">    <span class=\"comment\">/// - Parameter string: string needs to be format</span></span><br><span class=\"line\">    <span class=\"comment\">/// - Returns: formatted string</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">format</span>(<span class=\"keyword\">_</span> <span class=\"params\">string</span>: <span class=\"type\">String</span>)</span> -&gt; <span class=\"type\">String</span>? &#123;</span><br><span class=\"line\">        <span class=\"keyword\">guard</span> string.isEmpty <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"operator\">!</span>string.contains(<span class=\"string\">&quot;@&quot;</span>) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"operator\">!</span>string.contains(<span class=\"string\">&quot;#&quot;</span>) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> string.replacingOccurrences(of: <span class=\"string\">&quot;<span class=\"subst\">\\n</span>&quot;</span>, with: <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Formatter</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">enum</span> <span class=\"title\">Error</span>: <span class=\"title\">Swift</span>.<span class=\"title\">Error</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> emptyString</span><br><span class=\"line\">        <span class=\"keyword\">case</span> containsHashtag</span><br><span class=\"line\">        <span class=\"keyword\">case</span> containsMention</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/// Format a string, replace invalid symbol with empty character</span></span><br><span class=\"line\">    <span class=\"comment\">///</span></span><br><span class=\"line\">    <span class=\"comment\">/// - Parameter string: string needs to be format</span></span><br><span class=\"line\">    <span class=\"comment\">/// - Returns: formatted string</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">format</span>(<span class=\"keyword\">_</span> <span class=\"params\">string</span>: <span class=\"type\">String</span>)</span> <span class=\"keyword\">throws</span> -&gt; <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">guard</span> string.isEmpty <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"type\">Error</span>.emptyString</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"operator\">!</span>string.contains(<span class=\"string\">&quot;@&quot;</span>) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"type\">Error</span>.containsMention</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"operator\">!</span>string.contains(<span class=\"string\">&quot;#&quot;</span>) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"type\">Error</span>.containsHashtag</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> string.replacingOccurrences(of: <span class=\"string\">&quot;<span class=\"subst\">\\n</span>&quot;</span>, with: <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong> API  throw nil</strong></p>\n<p> <code>throw</code> <code>Optional</code></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> <code>assertion</code>, <code>precondition</code>, <code>fatalError</code> </p>\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">tableView</span>(<span class=\"keyword\">_</span> <span class=\"params\">tableView</span>: <span class=\"type\">UITableView</span>, <span class=\"params\">cellForRowAt</span> <span class=\"params\">indexPath</span>: <span class=\"type\">IndexPath</span>)</span> -&gt; <span class=\"type\">UITableViewCell</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> cell <span class=\"operator\">=</span> tableView.dequeueReusableCell(withIdentifier: <span class=\"string\">&quot;cell&quot;</span>, for: indexPath) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        fataError(<span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> cell</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<blockquote>\n<p> ObjC  API  <code>id</code> <code>return</code> </p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><a href=\"https://github.com/apple/swift-package-manager/blob/master/Sources/Basic/Result.swift\">Swift Package Manager</a><br><a href=\"https://onevcat.com/2018/10/swift-result-error/\">Result&lt;T&gt;  Result&lt;T, E: Error&gt;</a></p>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p> [Add Result to the Standard Library](swift-evolution/0235-add-result.md at master  apple/swift-evolution  GitHub) [](SE-0235 - Add Result to the Standard Library - Proposal Reviews - Swift Forums) <code>Either</code> </p>\n</blockquote>\n<h2 id=\"Result\"><a href=\"#Result\" class=\"headerlink\" title=\"Result\"></a>Result</h2><p> Swift <code>Result</code>  community  <code>Result</code> <a href=\"https://github.com/Alamofire/Alamofire\">Alamofire</a>  <code>Result</code> / <code>Result</code>  <strong></strong></p>\n<p> <strong></strong>  <code>Result</code>  <code>Optional</code>  Monad <code>Result</code> </p>\n<h2 id=\"Error-Handling\"><a href=\"#Error-Handling\" class=\"headerlink\" title=\"Error Handling\"></a>Error Handling</h2><p>synchronizationconcurrency</p>\n<p> Cocoa  <code>throw</code> + <code>try catch</code> <code>throw</code>/<code>raise</code> <code>try catch</code>  C  Error  Error  Error </p>\n<p> Cocoa  block, delegate  notification  block  delegate  notification <code>Result</code>  <a href=\"https://developer.apple.com/documentation/avfoundation/avassetexportsession\">AVAssetExportSession</a> <code>completionHandler</code>  <code>@escaping () -&gt;  Void</code> <code>var status: AVAssetExportSession.Status</code>  <code>var error: Error?</code> </p>\n<p> async/await  API  <code>completionHandler: (Value?, Error?) -&gt; Void</code> <code>completionHandler: (Result&lt;Value&gt;) -&gt; Void</code></p>\n<p> Swift  <code>throw</code> + <code>try catch</code> Error  <code>throw</code> + <code>try catch</code>  <code>throw/throws/rethrows</code> ObjC  throw/raise </p>\n<p> <code>throw</code> + <code>try catch</code></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">remove</span>(<span class=\"params\">forKey</span> <span class=\"params\">key</span>: <span class=\"type\">StoreKey</span>)</span> <span class=\"keyword\">throws</span> &#123;</span><br><span class=\"line\">    queue.async &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> url <span class=\"operator\">=</span> <span class=\"keyword\">try</span> disk.url(atPath: path(forKey: key), in: directory)</span><br><span class=\"line\">        <span class=\"keyword\">try</span> disk.remove(at: url)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">remove</span>(<span class=\"params\">forKey</span> <span class=\"params\">key</span>: <span class=\"type\">StoreKey</span>)</span> <span class=\"keyword\">throws</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> queue.async &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> url <span class=\"operator\">=</span> <span class=\"keyword\">try</span> disk.url(atPath: path(forKey: key), in: directory)</span><br><span class=\"line\">        <span class=\"keyword\">try</span> disk.remove(at: url)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"-return\"><a href=\"#-return\" class=\"headerlink\" title=\" return\"></a> return</h3><p> Alligator </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// </span></span><br><span class=\"line\"><span class=\"comment\">///</span></span><br><span class=\"line\"><span class=\"comment\">/// - Parameter asset: </span></span><br><span class=\"line\"><span class=\"comment\">/// - Parameter outputURL: </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">export</span>(<span class=\"params\">asset</span>: <span class=\"type\">AVAsset</span>, <span class=\"params\">to</span> <span class=\"params\">outputURL</span>: <span class=\"type\">URL</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">guard</span> outputURL.isFileURL <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">assertionFailure</span>(<span class=\"string\">&quot;output url must be file url.&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"operator\">...</span></span><br><span class=\"line\">    <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> exportSession <span class=\"operator\">=</span> <span class=\"type\">AVAssetExportSession</span>(asset: asset, presetName: <span class=\"type\">AVAssetExportPresetHighestQuality</span>) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    exportSession.outputURL <span class=\"operator\">=</span> outputURL</span><br><span class=\"line\">    exportSession.outputFileType <span class=\"operator\">=</span> .mp4</span><br><span class=\"line\">    <span class=\"operator\">...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> assertion<code>guard</code> </p>\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// VideoProcessor.swift</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">prepare</span>()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> videoWriterInput <span class=\"operator\">=</span> </span><br><span class=\"line\">    <span class=\"keyword\">let</span> audioWriterInput <span class=\"operator\">=</span> </span><br><span class=\"line\">    <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> videoWriter <span class=\"operator\">=</span> <span class=\"keyword\">try?</span> <span class=\"type\">AVAssetWriter</span>(outputURL: outputURL, fileType: .mp4) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">if</span> videoWriter.canAdd(videoWriterInput) &#123;</span><br><span class=\"line\">        videoWriter.add(videoWriterInput)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">assertionFailure</span>(<span class=\"string\">&quot;can&#x27;t add video writer input&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> videoWriter.canAdd(audioWriterInput) &#123;</span><br><span class=\"line\">        videoWriter.add(audioWriterInput)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">assertionFailure</span>(<span class=\"string\">&quot;can&#x27;t add audio writer input&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"operator\">...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> project  <strong></strong> return  assertion  crash assertion  <code>print</code> :P</p>\n<p> UI </p>\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// AVAsset+Processor.swift</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">Alligator</span> <span class=\"title\">where</span> <span class=\"title\">Base</span>: <span class=\"title\">AVAsset</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/// Merge the given video asset and audio asset</span></span><br><span class=\"line\">    <span class=\"comment\">///</span></span><br><span class=\"line\">    <span class=\"comment\">/// - Parameters:</span></span><br><span class=\"line\">    <span class=\"comment\">///   - videoAsset: the given video asset</span></span><br><span class=\"line\">    <span class=\"comment\">///   - audioAsset: the given audio asset</span></span><br><span class=\"line\">    <span class=\"comment\">/// - Returns: the merged asset</span></span><br><span class=\"line\">    <span class=\"comment\">/// - Throws: throws error when the given asset is invalid. e.g. video asset without video tracks.</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">merge</span>(<span class=\"params\">videoAsset</span>: <span class=\"type\">AVAsset</span>, <span class=\"params\">audioAsset</span>: <span class=\"type\">AVAsset</span>)</span> <span class=\"keyword\">throws</span> -&gt; <span class=\"type\">AVAsset</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> mixComposition <span class=\"operator\">=</span> <span class=\"type\">AVMutableComposition</span>()</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">try</span> mixComposition.agt.add(.video, from: videoAsset)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">let</span> videoDuration <span class=\"operator\">=</span> mixComposition.duration</span><br><span class=\"line\">        <span class=\"keyword\">try</span> mixComposition.agt.add(.audio, from: audioAsset, maxBounds: videoDuration)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> mixComposition</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/// Merge the given assets one by one</span></span><br><span class=\"line\">    <span class=\"comment\">///</span></span><br><span class=\"line\">    <span class=\"comment\">/// - Parameters:</span></span><br><span class=\"line\">    <span class=\"comment\">///   - segments: given assets, it can&#x27;t be empty</span></span><br><span class=\"line\">    <span class=\"comment\">///   - isMuted: if true, it will passthrough audio tracks</span></span><br><span class=\"line\">    <span class=\"comment\">/// - Returns: merged asset</span></span><br><span class=\"line\">    <span class=\"comment\">/// - Throws: throws error when segments is empry, or some segment is invalid.</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">merge</span>(<span class=\"params\">segments</span>: [<span class=\"type\">AVAsset</span>], <span class=\"params\">isMuted</span>: <span class=\"type\">Bool</span>)</span> <span class=\"keyword\">throws</span> -&gt; <span class=\"type\">AVAsset</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"operator\">!</span>segments.isEmpty <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"type\">Error</span>.segmentsEmpty</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> segments.count <span class=\"operator\">&gt;</span> <span class=\"number\">1</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> mixComposition <span class=\"operator\">=</span> <span class=\"type\">AVMutableComposition</span>()</span><br><span class=\"line\">            <span class=\"keyword\">try</span> mixComposition.agt.add(segments, isMuted: isMuted)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> mixComposition</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> segments[<span class=\"number\">0</span>]</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"-Optional\"><a href=\"#-Optional\" class=\"headerlink\" title=\" Optional\"></a> Optional</h3><p> Optional  <code>T</code>  <code>T?</code> <code>return nil</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Formatter</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/// Format a string, replace invalid symbol with empty character</span></span><br><span class=\"line\">    <span class=\"comment\">///</span></span><br><span class=\"line\">    <span class=\"comment\">/// - Parameter string: string needs to be format</span></span><br><span class=\"line\">    <span class=\"comment\">/// - Returns: formatted string</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">format</span>(<span class=\"keyword\">_</span> <span class=\"params\">string</span>: <span class=\"type\">String</span>)</span> -&gt; <span class=\"type\">String</span>? &#123;</span><br><span class=\"line\">        <span class=\"keyword\">guard</span> string.isEmpty <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> string.replacingOccurrences(of: <span class=\"string\">&quot;<span class=\"subst\">\\n</span>&quot;</span>, with: <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Formatter</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/// Format a string, replace invalid symbol with empty character. If it is empty or contains `@`, `#`, return nil.</span></span><br><span class=\"line\">    <span class=\"comment\">///</span></span><br><span class=\"line\">    <span class=\"comment\">/// - Parameter string: string needs to be format</span></span><br><span class=\"line\">    <span class=\"comment\">/// - Returns: formatted string</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">format</span>(<span class=\"keyword\">_</span> <span class=\"params\">string</span>: <span class=\"type\">String</span>)</span> -&gt; <span class=\"type\">String</span>? &#123;</span><br><span class=\"line\">        <span class=\"keyword\">guard</span> string.isEmpty <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"operator\">!</span>string.contains(<span class=\"string\">&quot;@&quot;</span>) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"operator\">!</span>string.contains(<span class=\"string\">&quot;#&quot;</span>) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> string.replacingOccurrences(of: <span class=\"string\">&quot;<span class=\"subst\">\\n</span>&quot;</span>, with: <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Formatter</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">enum</span> <span class=\"title\">Error</span>: <span class=\"title\">Swift</span>.<span class=\"title\">Error</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> emptyString</span><br><span class=\"line\">        <span class=\"keyword\">case</span> containsHashtag</span><br><span class=\"line\">        <span class=\"keyword\">case</span> containsMention</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/// Format a string, replace invalid symbol with empty character</span></span><br><span class=\"line\">    <span class=\"comment\">///</span></span><br><span class=\"line\">    <span class=\"comment\">/// - Parameter string: string needs to be format</span></span><br><span class=\"line\">    <span class=\"comment\">/// - Returns: formatted string</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">format</span>(<span class=\"keyword\">_</span> <span class=\"params\">string</span>: <span class=\"type\">String</span>)</span> <span class=\"keyword\">throws</span> -&gt; <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">guard</span> string.isEmpty <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"type\">Error</span>.emptyString</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"operator\">!</span>string.contains(<span class=\"string\">&quot;@&quot;</span>) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"type\">Error</span>.containsMention</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"operator\">!</span>string.contains(<span class=\"string\">&quot;#&quot;</span>) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"type\">Error</span>.containsHashtag</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> string.replacingOccurrences(of: <span class=\"string\">&quot;<span class=\"subst\">\\n</span>&quot;</span>, with: <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong> API  throw nil</strong></p>\n<p> <code>throw</code> <code>Optional</code></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> <code>assertion</code>, <code>precondition</code>, <code>fatalError</code> </p>\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">tableView</span>(<span class=\"keyword\">_</span> <span class=\"params\">tableView</span>: <span class=\"type\">UITableView</span>, <span class=\"params\">cellForRowAt</span> <span class=\"params\">indexPath</span>: <span class=\"type\">IndexPath</span>)</span> -&gt; <span class=\"type\">UITableViewCell</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> cell <span class=\"operator\">=</span> tableView.dequeueReusableCell(withIdentifier: <span class=\"string\">&quot;cell&quot;</span>, for: indexPath) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        fataError(<span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> cell</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<blockquote>\n<p> ObjC  API  <code>id</code> <code>return</code> </p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><a href=\"https://github.com/apple/swift-package-manager/blob/master/Sources/Basic/Result.swift\">Swift Package Manager</a><br><a href=\"https://onevcat.com/2018/10/swift-result-error/\">Result&lt;T&gt;  Result&lt;T, E: Error&gt;</a></p>\n"},{"title":"Group Theory and Category Theory","date":"2017-06-12T12:00:00.000Z","_content":" Functor, Monad \n\n## Group\n\n> G[wikipedia](https://zh.wikipedia.org/wiki/)\n\n **  ************  ****\n\n* Closure a,bGabG\n* Associativity a,b,cG(ab)c = a(bc)\n* IdentityG  e aGae = ea = a\n*  aG bG ab = ba = e\n\n `+` \n\n*  a,ba+b \n*  a,b,c(a+b)+c = a+(b+c)\n*  0 a+0 = 0+a = a\n*  a b=-a a+b = b+a = e\n\n `(, +)`  `*`  `1` \n\n\n\n### Semigroup\n\nsemigroup\n\n```swift\ninfix operator <>: AdditionPrecedence\n\nprotocol Semigroup {\n    static func <>(lhs: Self, rhs: Self) -> Self\n}\n\nextension Int: Semigroup {\n    static func <>(lhs: Int, rhs: Int) -> Int {\n        return lhs + rhs\n    }\n}\n\nextension Array: Semigroup {\n    static func <>(lhs: Array, rhs: Array) -> Array {\n        return lhs + rhs\n    }\n}\n\n//  fold\nfunc concat<S: Semigroup>(_ xs: [S], _ initial: S) -> S {\n    return xs.reduce(initial, <>)\n}\n```\n\n`1 <> 2 <> 3 <> 4`\n\n### Monoid\n\n Monoid\n\nmonoid\n\n```swift\nprotocol Monoid: Semigroup {\n    static var e: Self { get }\n}\n\nextension Int: Monoid {\n    static var e = 0\n}\n\nextension Array: Monoid {\n    static var e: Array {\n        return []\n    }\n}\n\nfunc concat<M: Monoid>(_ xs: [M]) -> M {\n    return xs.reduce(M.e, <>)\n}\n```\n\n`concat`  Monoid  Monoid   `<>`   `e` \n\n## Category Theory\n\n> [wikipedia](https://zh.wikipedia.org/wiki/)\n\n### Category\n\n C \n\n* object ob(C)\n* morphism-> hom(C) f a b a,b  ob(C)  ** a  b ** f: a->bidentity f: a->a id[a]\n*  h=gf\n\n\n\n* f: a->b, g: b->c, h: c->dh(gf) = (hg)f\n* id[a]f = id[b]f = f\n* f: a->b, g: b->c, h: a->c, h = fg\n\n\n\n*  C  Int  String \n*  f: Int->String\n\n ****\n\n\n### Functor\n\n>  [wikipedia](https://zh.wikipedia.org/wiki/)\n\n\n\n C  D  C  D  F:\n\n*  xC  F(x)D \n*  f: x->yC  F(f): F(x)->F(y)D \n\n\n\n*  xC F(id[x]) = id[F(x)]\n*  f: x->y, g: y->z F(fg) = F(f)F(g)\n\n\n **Endofunctor**\n\n#### \n\n C  `Int`  `String`  `Int -> String`  D  `Array<Int>`  `Array<String>`  `Array<Int> -> Array<String>`  F\n\n* `Int`  `Array<Int>` `String`  `Array<String>` \n*  `Int -> String`  `Array<Int> -> Array<String>` \n\nC: `Int`, `String`, f: `Int -> String`, D: `Array<Int>`, `Array<String>`, f: `Array<Int> -> Array<String>`\n\n* x: `Int` -> F(x): `Array<Int>``String` -> F(x): `Array<String>`\n* f: `(Int -> String)` -> F(f): `(Array<Int> -> Array<String>)`\n\n\n\n```swift\nfunc tmap<T>(x: T) -> F<T>\nfunc fmap<A, B>(f: A -> B) -> (F<A> -> F<B>)\n```\n\n\n\n```swift\n// Swift  Int  Array<Int>  Array \n// \n//  fmap  (F<A>, A -> B) -> F<B>  currying \n// \nfunc map<A, B>(x: F<A>, f: A -> B) -> F<B>\n```\n\n Swift  `Array`  `Optional` Swift  `A, B`  Swift  `A -> B` A `Array`  `Array<A>, Array<B>``Array`  `Array<A> -> Array<B>` B A  B  `Array` `Array`  `T`  `Array<T>``Optional` \n\n `Functor` Type Constructor `map`  Swift  `Array`  `Optional`  `map`  Haskell  `Lift` `map` \n\n D `Array<T>`  C Identity id[T] = T\n\n\n `typealias Parser<A> = (String) -> (A, String)?`  `func map<A, B>(x: Parser<A>, f: (A) -> B) -> Parser<B>`  `Parser<A>` \n\n### Endofunctor\n\n> A functor that maps a category to itself **Endofunctor**\n\n `Int -> Int`\n\n```swift\nfunc f(x: Int) -> Int { return x + 1 }\n```\n\nIdentity Function\n\n```swift\nfunc id(x: Int) -> Int { return x }\n```\n\n**Identity Functor** C g: `String -> Int`\n\n F `F(Int)`  `String``F(String)`  `Int` `F(f: Int -> String)`  g: `String -> Int`\n\nIdentity Functor F `F(Int)`  `Int` `F(String)`  `String` `F(f: Int -> String)`  `f: Int -> String` `F(g: String -> Int)`  g: `String -> Int` \n\n## Applicative\n\n> An applicative is a monoid in the category of endofunctors, what's the problem?\n\n Haskell  Monad  Applicative  Applicative  Monad \n\n[Applicative](https://www.reddit.com/r/haskell/comments/2lompe/where_do_the_applicative_laws_come_from/)\n\n## Monad\n\n> A monad is a monoid in the category of endofunctors -- Philip Wadler\n\n\n\n Endofunctor  ****\n\n* X F`X -> X`\n*  id[X]  F `id[X] -> F` (pure\n*  F  FF  F `FF -> F` (join\n\n\n\n* `func unit<T>(x: T) -> F<T> // x = id[x]` \n* `func join<T>(a: F<F<T>>) -> F<T>`\n\n  Composition\n Monoidal Category `unit`  `join`  Monoid  Monoid\n\nMonad Monoidal  Monoidal Tensor ProductFF -> FComposition Id Functor\n\n`bind`  `flatMap`  `>>=`  `map + join` [apple/swift](https://github.com/apple/swift)  `stdlib/public/core/FlatMap.swift`\n\n```swift\nfunc >>=<A, B>(x: F<A>, f: A -> F<B>) -> F<B>\n// Currying \nfunc >>=<A, B>(x: F<A>) -> (f: A -> F<B>) -> F<B>\n```\n\n## Ref\n\nToo much\n\n\n","source":"_posts/group-theory-and-category-theory.md","raw":"---\ntitle: Group Theory and Category Theory\ndate: 2017-06-12 20:00:00\ntags:\n\t- group theory\n\t- category theory\n\t- semigroup\n\t- monoid\n\t- functor\n\t- applicative\n\t- monad\n\t- functional programming\n\t- swift\ncategories: functional programming\n---\n Functor, Monad \n\n## Group\n\n> G[wikipedia](https://zh.wikipedia.org/wiki/)\n\n **  ************  ****\n\n* Closure a,bGabG\n* Associativity a,b,cG(ab)c = a(bc)\n* IdentityG  e aGae = ea = a\n*  aG bG ab = ba = e\n\n `+` \n\n*  a,ba+b \n*  a,b,c(a+b)+c = a+(b+c)\n*  0 a+0 = 0+a = a\n*  a b=-a a+b = b+a = e\n\n `(, +)`  `*`  `1` \n\n\n\n### Semigroup\n\nsemigroup\n\n```swift\ninfix operator <>: AdditionPrecedence\n\nprotocol Semigroup {\n    static func <>(lhs: Self, rhs: Self) -> Self\n}\n\nextension Int: Semigroup {\n    static func <>(lhs: Int, rhs: Int) -> Int {\n        return lhs + rhs\n    }\n}\n\nextension Array: Semigroup {\n    static func <>(lhs: Array, rhs: Array) -> Array {\n        return lhs + rhs\n    }\n}\n\n//  fold\nfunc concat<S: Semigroup>(_ xs: [S], _ initial: S) -> S {\n    return xs.reduce(initial, <>)\n}\n```\n\n`1 <> 2 <> 3 <> 4`\n\n### Monoid\n\n Monoid\n\nmonoid\n\n```swift\nprotocol Monoid: Semigroup {\n    static var e: Self { get }\n}\n\nextension Int: Monoid {\n    static var e = 0\n}\n\nextension Array: Monoid {\n    static var e: Array {\n        return []\n    }\n}\n\nfunc concat<M: Monoid>(_ xs: [M]) -> M {\n    return xs.reduce(M.e, <>)\n}\n```\n\n`concat`  Monoid  Monoid   `<>`   `e` \n\n## Category Theory\n\n> [wikipedia](https://zh.wikipedia.org/wiki/)\n\n### Category\n\n C \n\n* object ob(C)\n* morphism-> hom(C) f a b a,b  ob(C)  ** a  b ** f: a->bidentity f: a->a id[a]\n*  h=gf\n\n\n\n* f: a->b, g: b->c, h: c->dh(gf) = (hg)f\n* id[a]f = id[b]f = f\n* f: a->b, g: b->c, h: a->c, h = fg\n\n\n\n*  C  Int  String \n*  f: Int->String\n\n ****\n\n\n### Functor\n\n>  [wikipedia](https://zh.wikipedia.org/wiki/)\n\n\n\n C  D  C  D  F:\n\n*  xC  F(x)D \n*  f: x->yC  F(f): F(x)->F(y)D \n\n\n\n*  xC F(id[x]) = id[F(x)]\n*  f: x->y, g: y->z F(fg) = F(f)F(g)\n\n\n **Endofunctor**\n\n#### \n\n C  `Int`  `String`  `Int -> String`  D  `Array<Int>`  `Array<String>`  `Array<Int> -> Array<String>`  F\n\n* `Int`  `Array<Int>` `String`  `Array<String>` \n*  `Int -> String`  `Array<Int> -> Array<String>` \n\nC: `Int`, `String`, f: `Int -> String`, D: `Array<Int>`, `Array<String>`, f: `Array<Int> -> Array<String>`\n\n* x: `Int` -> F(x): `Array<Int>``String` -> F(x): `Array<String>`\n* f: `(Int -> String)` -> F(f): `(Array<Int> -> Array<String>)`\n\n\n\n```swift\nfunc tmap<T>(x: T) -> F<T>\nfunc fmap<A, B>(f: A -> B) -> (F<A> -> F<B>)\n```\n\n\n\n```swift\n// Swift  Int  Array<Int>  Array \n// \n//  fmap  (F<A>, A -> B) -> F<B>  currying \n// \nfunc map<A, B>(x: F<A>, f: A -> B) -> F<B>\n```\n\n Swift  `Array`  `Optional` Swift  `A, B`  Swift  `A -> B` A `Array`  `Array<A>, Array<B>``Array`  `Array<A> -> Array<B>` B A  B  `Array` `Array`  `T`  `Array<T>``Optional` \n\n `Functor` Type Constructor `map`  Swift  `Array`  `Optional`  `map`  Haskell  `Lift` `map` \n\n D `Array<T>`  C Identity id[T] = T\n\n\n `typealias Parser<A> = (String) -> (A, String)?`  `func map<A, B>(x: Parser<A>, f: (A) -> B) -> Parser<B>`  `Parser<A>` \n\n### Endofunctor\n\n> A functor that maps a category to itself **Endofunctor**\n\n `Int -> Int`\n\n```swift\nfunc f(x: Int) -> Int { return x + 1 }\n```\n\nIdentity Function\n\n```swift\nfunc id(x: Int) -> Int { return x }\n```\n\n**Identity Functor** C g: `String -> Int`\n\n F `F(Int)`  `String``F(String)`  `Int` `F(f: Int -> String)`  g: `String -> Int`\n\nIdentity Functor F `F(Int)`  `Int` `F(String)`  `String` `F(f: Int -> String)`  `f: Int -> String` `F(g: String -> Int)`  g: `String -> Int` \n\n## Applicative\n\n> An applicative is a monoid in the category of endofunctors, what's the problem?\n\n Haskell  Monad  Applicative  Applicative  Monad \n\n[Applicative](https://www.reddit.com/r/haskell/comments/2lompe/where_do_the_applicative_laws_come_from/)\n\n## Monad\n\n> A monad is a monoid in the category of endofunctors -- Philip Wadler\n\n\n\n Endofunctor  ****\n\n* X F`X -> X`\n*  id[X]  F `id[X] -> F` (pure\n*  F  FF  F `FF -> F` (join\n\n\n\n* `func unit<T>(x: T) -> F<T> // x = id[x]` \n* `func join<T>(a: F<F<T>>) -> F<T>`\n\n  Composition\n Monoidal Category `unit`  `join`  Monoid  Monoid\n\nMonad Monoidal  Monoidal Tensor ProductFF -> FComposition Id Functor\n\n`bind`  `flatMap`  `>>=`  `map + join` [apple/swift](https://github.com/apple/swift)  `stdlib/public/core/FlatMap.swift`\n\n```swift\nfunc >>=<A, B>(x: F<A>, f: A -> F<B>) -> F<B>\n// Currying \nfunc >>=<A, B>(x: F<A>) -> (f: A -> F<B>) -> F<B>\n```\n\n## Ref\n\nToo much\n\n\n","slug":"group-theory-and-category-theory","published":1,"updated":"2022-01-02T11:26:47.155Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckxx810x400039ith5vew3297","content":"<p> Functor, Monad </p>\n<h2 id=\"Group\"><a href=\"#Group\" class=\"headerlink\" title=\"Group\"></a>Group</h2><blockquote>\n<p>G<a href=\"https://zh.wikipedia.org/wiki/%E7%BE%A4\">wikipedia</a></p>\n</blockquote>\n<p> <em></em>  <strong></strong><strong></strong><strong></strong>  <strong></strong></p>\n<ul>\n<li>Closure a,bGabG</li>\n<li>Associativity a,b,cG(ab)c = a(bc)</li>\n<li>IdentityG  e aGae = ea = a</li>\n<li> aG bG ab = ba = e</li>\n</ul>\n<p> <code>+</code> </p>\n<ul>\n<li> a,ba+b </li>\n<li> a,b,c(a+b)+c = a+(b+c)</li>\n<li> 0 a+0 = 0+a = a</li>\n<li> a b=-a a+b = b+a = e</li>\n</ul>\n<p> <code>(, +)</code>  <code>*</code>  <code>1</code> </p>\n<p></p>\n<h3 id=\"Semigroup\"><a href=\"#Semigroup\" class=\"headerlink\" title=\"Semigroup\"></a>Semigroup</h3><p>semigroup</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">infix</span> <span class=\"keyword\">operator</span> <span class=\"title\">&lt;&gt;</span>: <span class=\"type\">AdditionPrecedence</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">protocol</span> <span class=\"title\">Semigroup</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">&lt;&gt;</span>(<span class=\"params\">lhs</span>: <span class=\"keyword\">Self</span>, <span class=\"params\">rhs</span>: <span class=\"keyword\">Self</span>)</span> -&gt; <span class=\"keyword\">Self</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">Int</span>: <span class=\"title\">Semigroup</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">&lt;&gt;</span>(<span class=\"params\">lhs</span>: <span class=\"type\">Int</span>, <span class=\"params\">rhs</span>: <span class=\"type\">Int</span>)</span> -&gt; <span class=\"type\">Int</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> lhs <span class=\"operator\">+</span> rhs</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">Array</span>: <span class=\"title\">Semigroup</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">&lt;&gt;</span>(<span class=\"params\">lhs</span>: <span class=\"type\">Array</span>, <span class=\"params\">rhs</span>: <span class=\"type\">Array</span>)</span> -&gt; <span class=\"type\">Array</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> lhs <span class=\"operator\">+</span> rhs</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  fold</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">concat</span>&lt;<span class=\"type\">S</span>: <span class=\"type\">Semigroup</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">xs</span>: [<span class=\"type\">S</span>], <span class=\"keyword\">_</span> <span class=\"params\">initial</span>: <span class=\"type\">S</span>)</span> -&gt; <span class=\"type\">S</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> xs.reduce(initial, <span class=\"operator\">&lt;&gt;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>1 &lt;&gt; 2 &lt;&gt; 3 &lt;&gt; 4</code></p>\n<h3 id=\"Monoid\"><a href=\"#Monoid\" class=\"headerlink\" title=\"Monoid\"></a>Monoid</h3><p> Monoid</p>\n<p>monoid</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">protocol</span> <span class=\"title\">Monoid</span>: <span class=\"title\">Semigroup</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">var</span> e: <span class=\"keyword\">Self</span> &#123; <span class=\"keyword\">get</span> &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">Int</span>: <span class=\"title\">Monoid</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">var</span> e <span class=\"operator\">=</span> <span class=\"number\">0</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">Array</span>: <span class=\"title\">Monoid</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">var</span> e: <span class=\"type\">Array</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> []</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">concat</span>&lt;<span class=\"type\">M</span>: <span class=\"type\">Monoid</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">xs</span>: [<span class=\"type\">M</span>])</span> -&gt; <span class=\"type\">M</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> xs.reduce(<span class=\"type\">M</span>.e, <span class=\"operator\">&lt;&gt;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>concat</code>  Monoid  Monoid   <code>&lt;&gt;</code>   <code>e</code> </p>\n<h2 id=\"Category-Theory\"><a href=\"#Category-Theory\" class=\"headerlink\" title=\"Category Theory\"></a>Category Theory</h2><blockquote>\n<p><a href=\"https://zh.wikipedia.org/wiki/%E8%8C%83%E7%95%B4%E8%AE%BA\">wikipedia</a></p>\n</blockquote>\n<h3 id=\"Category\"><a href=\"#Category\" class=\"headerlink\" title=\"Category\"></a>Category</h3><p> C </p>\n<ul>\n<li>object ob(C)</li>\n<li>morphism-&gt; hom(C) f a b a,b  ob(C)  <strong> a  b </strong> f: a-&gt;bidentity f: a-&gt;a id[a]</li>\n<li> h=gf</li>\n</ul>\n<p></p>\n<ul>\n<li>f: a-&gt;b, g: b-&gt;c, h: c-&gt;dh(gf) = (hg)f</li>\n<li>id[a]f = id[b]f = f</li>\n<li>f: a-&gt;b, g: b-&gt;c, h: a-&gt;c, h = fg</li>\n</ul>\n<p></p>\n<ul>\n<li> C  Int  String </li>\n<li> f: Int-&gt;String</li>\n</ul>\n<p> <strong></strong><br></p>\n<h3 id=\"Functor\"><a href=\"#Functor\" class=\"headerlink\" title=\"Functor\"></a>Functor</h3><blockquote>\n<p> <a href=\"https://zh.wikipedia.org/wiki/%E5%87%BD%E5%AD%90\">wikipedia</a></p>\n</blockquote>\n<p></p>\n<p> C  D  C  D  F:</p>\n<ul>\n<li> xC  F(x)D </li>\n<li> f: x-&gt;yC  F(f): F(x)-&gt;F(y)D </li>\n</ul>\n<p></p>\n<ul>\n<li> xC F(id[x]) = id[F(x)]</li>\n<li> f: x-&gt;y, g: y-&gt;z F(fg) = F(f)F(g)</li>\n</ul>\n<p><br> <strong>Endofunctor</strong></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> C  <code>Int</code>  <code>String</code>  <code>Int -&gt; String</code>  D  <code>Array&lt;Int&gt;</code>  <code>Array&lt;String&gt;</code>  <code>Array&lt;Int&gt; -&gt; Array&lt;String&gt;</code>  F</p>\n<ul>\n<li><code>Int</code>  <code>Array&lt;Int&gt;</code> <code>String</code>  <code>Array&lt;String&gt;</code> </li>\n<li> <code>Int -&gt; String</code>  <code>Array&lt;Int&gt; -&gt; Array&lt;String&gt;</code> </li>\n</ul>\n<p>C: <code>Int</code>, <code>String</code>, f: <code>Int -&gt; String</code>, D: <code>Array&lt;Int&gt;</code>, <code>Array&lt;String&gt;</code>, f: <code>Array&lt;Int&gt; -&gt; Array&lt;String&gt;</code></p>\n<ul>\n<li>x: <code>Int</code> -&gt; F(x): <code>Array&lt;Int&gt;</code><code>String</code> -&gt; F(x): <code>Array&lt;String&gt;</code></li>\n<li>f: <code>(Int -&gt; String)</code> -&gt; F(f): <code>(Array&lt;Int&gt; -&gt; Array&lt;String&gt;)</code></li>\n</ul>\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">tmap</span>&lt;<span class=\"type\">T</span>&gt;(<span class=\"params\">x</span>: <span class=\"type\">T</span>)</span> -&gt; <span class=\"type\">F</span>&lt;<span class=\"type\">T</span>&gt;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">fmap</span>&lt;<span class=\"type\">A</span>, <span class=\"type\">B</span>&gt;(<span class=\"params\">f</span>: <span class=\"type\">A</span> -&gt; <span class=\"type\">B</span>)</span> -&gt; (<span class=\"type\">F</span>&lt;<span class=\"type\">A</span>&gt; -&gt; <span class=\"type\">F</span>&lt;<span class=\"type\">B</span>&gt;)</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Swift  Int  Array&lt;Int&gt;  Array </span></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">//  fmap  (F&lt;A&gt;, A -&gt; B) -&gt; F&lt;B&gt;  currying </span></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">map</span>&lt;<span class=\"type\">A</span>, <span class=\"type\">B</span>&gt;(<span class=\"params\">x</span>: <span class=\"type\">F</span>&lt;<span class=\"type\">A</span>&gt;, <span class=\"params\">f</span>: <span class=\"type\">A</span> -&gt; <span class=\"type\">B</span>)</span> -&gt; <span class=\"type\">F</span>&lt;<span class=\"type\">B</span>&gt;</span><br></pre></td></tr></table></figure>\n\n<p> Swift  <code>Array</code>  <code>Optional</code> Swift  <code>A, B</code>  Swift  <code>A -&gt; B</code> A <code>Array</code>  <code>Array&lt;A&gt;, Array&lt;B&gt;</code><code>Array</code>  <code>Array&lt;A&gt; -&gt; Array&lt;B&gt;</code> B A  B  <code>Array</code> <code>Array</code>  <code>T</code>  <code>Array&lt;T&gt;</code><code>Optional</code> </p>\n<p> <code>Functor</code> Type Constructor <code>map</code>  Swift  <code>Array</code>  <code>Optional</code>  <code>map</code>  Haskell  <code>Lift</code> <code>map</code> </p>\n<p> D <code>Array&lt;T&gt;</code>  C Identity id[T] = T</p>\n<p><br> <code>typealias Parser&lt;A&gt; = (String) -&gt; (A, String)?</code>  <code>func map&lt;A, B&gt;(x: Parser&lt;A&gt;, f: (A) -&gt; B) -&gt; Parser&lt;B&gt;</code>  <code>Parser&lt;A&gt;</code> </p>\n<h3 id=\"Endofunctor\"><a href=\"#Endofunctor\" class=\"headerlink\" title=\"Endofunctor\"></a>Endofunctor</h3><blockquote>\n<p>A functor that maps a category to itself <strong>Endofunctor</strong></p>\n</blockquote>\n<p> <code>Int -&gt; Int</code></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">f</span>(<span class=\"params\">x</span>: <span class=\"type\">Int</span>)</span> -&gt; <span class=\"type\">Int</span> &#123; <span class=\"keyword\">return</span> x <span class=\"operator\">+</span> <span class=\"number\">1</span> &#125;</span><br></pre></td></tr></table></figure>\n\n<p>Identity Function</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">id</span>(<span class=\"params\">x</span>: <span class=\"type\">Int</span>)</span> -&gt; <span class=\"type\">Int</span> &#123; <span class=\"keyword\">return</span> x &#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>Identity Functor</strong> C g: <code>String -&gt; Int</code></p>\n<p> F <code>F(Int)</code>  <code>String</code><code>F(String)</code>  <code>Int</code> <code>F(f: Int -&gt; String)</code>  g: <code>String -&gt; Int</code></p>\n<p>Identity Functor F <code>F(Int)</code>  <code>Int</code> <code>F(String)</code>  <code>String</code> <code>F(f: Int -&gt; String)</code>  <code>f: Int -&gt; String</code> <code>F(g: String -&gt; Int)</code>  g: <code>String -&gt; Int</code> </p>\n<h2 id=\"Applicative\"><a href=\"#Applicative\" class=\"headerlink\" title=\"Applicative\"></a>Applicative</h2><blockquote>\n<p>An applicative is a monoid in the category of endofunctors, whats the problem?</p>\n</blockquote>\n<p> Haskell  Monad  Applicative  Applicative  Monad </p>\n<p><a href=\"https://www.reddit.com/r/haskell/comments/2lompe/where_do_the_applicative_laws_come_from/\">Applicative</a></p>\n<h2 id=\"Monad\"><a href=\"#Monad\" class=\"headerlink\" title=\"Monad\"></a>Monad</h2><blockquote>\n<p>A monad is a monoid in the category of endofunctors  Philip Wadler</p>\n</blockquote>\n<p></p>\n<p> Endofunctor  <strong></strong></p>\n<ul>\n<li>X F<code>X -&gt; X</code></li>\n<li> id[X]  F <code>id[X] -&gt; F</code> (pure</li>\n<li> F  FF  F <code>FF -&gt; F</code> (join</li>\n</ul>\n<p></p>\n<ul>\n<li><code>func unit&lt;T&gt;(x: T) -&gt; F&lt;T&gt; // x = id[x]</code> </li>\n<li><code>func join&lt;T&gt;(a: F&lt;F&lt;T&gt;&gt;) -&gt; F&lt;T&gt;</code></li>\n</ul>\n<p>  Composition<br> Monoidal Category <code>unit</code>  <code>join</code>  Monoid  Monoid</p>\n<p>Monad Monoidal  Monoidal Tensor ProductFF -&gt; FComposition Id Functor</p>\n<p><code>bind</code>  <code>flatMap</code>  <code>&gt;&gt;=</code>  <code>map + join</code> <a href=\"https://github.com/apple/swift\">apple/swift</a>  <code>stdlib/public/core/FlatMap.swift</code></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">&gt;&gt;=&lt;</span></span><span class=\"type\">A</span>, <span class=\"type\">B</span><span class=\"operator\">&gt;</span>(x: <span class=\"type\">F</span>&lt;<span class=\"type\">A</span>&gt;, f: <span class=\"type\">A</span> -&gt; <span class=\"type\">F</span>&lt;<span class=\"type\">B</span>&gt;) -&gt; <span class=\"type\">F</span>&lt;<span class=\"type\">B</span>&gt;</span><br><span class=\"line\"><span class=\"comment\">// Currying </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">&gt;&gt;=&lt;</span></span><span class=\"type\">A</span>, <span class=\"type\">B</span><span class=\"operator\">&gt;</span>(x: <span class=\"type\">F</span>&lt;<span class=\"type\">A</span>&gt;) -&gt; (f: <span class=\"type\">A</span> -&gt; <span class=\"type\">F</span>&lt;<span class=\"type\">B</span>&gt;) -&gt; <span class=\"type\">F</span>&lt;<span class=\"type\">B</span>&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Ref\"><a href=\"#Ref\" class=\"headerlink\" title=\"Ref\"></a>Ref</h2><p>Too much</p>\n","site":{"data":{}},"excerpt":"","more":"<p> Functor, Monad </p>\n<h2 id=\"Group\"><a href=\"#Group\" class=\"headerlink\" title=\"Group\"></a>Group</h2><blockquote>\n<p>G<a href=\"https://zh.wikipedia.org/wiki/%E7%BE%A4\">wikipedia</a></p>\n</blockquote>\n<p> <em></em>  <strong></strong><strong></strong><strong></strong>  <strong></strong></p>\n<ul>\n<li>Closure a,bGabG</li>\n<li>Associativity a,b,cG(ab)c = a(bc)</li>\n<li>IdentityG  e aGae = ea = a</li>\n<li> aG bG ab = ba = e</li>\n</ul>\n<p> <code>+</code> </p>\n<ul>\n<li> a,ba+b </li>\n<li> a,b,c(a+b)+c = a+(b+c)</li>\n<li> 0 a+0 = 0+a = a</li>\n<li> a b=-a a+b = b+a = e</li>\n</ul>\n<p> <code>(, +)</code>  <code>*</code>  <code>1</code> </p>\n<p></p>\n<h3 id=\"Semigroup\"><a href=\"#Semigroup\" class=\"headerlink\" title=\"Semigroup\"></a>Semigroup</h3><p>semigroup</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">infix</span> <span class=\"keyword\">operator</span> <span class=\"title\">&lt;&gt;</span>: <span class=\"type\">AdditionPrecedence</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">protocol</span> <span class=\"title\">Semigroup</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">&lt;&gt;</span>(<span class=\"params\">lhs</span>: <span class=\"keyword\">Self</span>, <span class=\"params\">rhs</span>: <span class=\"keyword\">Self</span>)</span> -&gt; <span class=\"keyword\">Self</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">Int</span>: <span class=\"title\">Semigroup</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">&lt;&gt;</span>(<span class=\"params\">lhs</span>: <span class=\"type\">Int</span>, <span class=\"params\">rhs</span>: <span class=\"type\">Int</span>)</span> -&gt; <span class=\"type\">Int</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> lhs <span class=\"operator\">+</span> rhs</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">Array</span>: <span class=\"title\">Semigroup</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">&lt;&gt;</span>(<span class=\"params\">lhs</span>: <span class=\"type\">Array</span>, <span class=\"params\">rhs</span>: <span class=\"type\">Array</span>)</span> -&gt; <span class=\"type\">Array</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> lhs <span class=\"operator\">+</span> rhs</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  fold</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">concat</span>&lt;<span class=\"type\">S</span>: <span class=\"type\">Semigroup</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">xs</span>: [<span class=\"type\">S</span>], <span class=\"keyword\">_</span> <span class=\"params\">initial</span>: <span class=\"type\">S</span>)</span> -&gt; <span class=\"type\">S</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> xs.reduce(initial, <span class=\"operator\">&lt;&gt;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>1 &lt;&gt; 2 &lt;&gt; 3 &lt;&gt; 4</code></p>\n<h3 id=\"Monoid\"><a href=\"#Monoid\" class=\"headerlink\" title=\"Monoid\"></a>Monoid</h3><p> Monoid</p>\n<p>monoid</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">protocol</span> <span class=\"title\">Monoid</span>: <span class=\"title\">Semigroup</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">var</span> e: <span class=\"keyword\">Self</span> &#123; <span class=\"keyword\">get</span> &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">Int</span>: <span class=\"title\">Monoid</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">var</span> e <span class=\"operator\">=</span> <span class=\"number\">0</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">Array</span>: <span class=\"title\">Monoid</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">var</span> e: <span class=\"type\">Array</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> []</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">concat</span>&lt;<span class=\"type\">M</span>: <span class=\"type\">Monoid</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">xs</span>: [<span class=\"type\">M</span>])</span> -&gt; <span class=\"type\">M</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> xs.reduce(<span class=\"type\">M</span>.e, <span class=\"operator\">&lt;&gt;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>concat</code>  Monoid  Monoid   <code>&lt;&gt;</code>   <code>e</code> </p>\n<h2 id=\"Category-Theory\"><a href=\"#Category-Theory\" class=\"headerlink\" title=\"Category Theory\"></a>Category Theory</h2><blockquote>\n<p><a href=\"https://zh.wikipedia.org/wiki/%E8%8C%83%E7%95%B4%E8%AE%BA\">wikipedia</a></p>\n</blockquote>\n<h3 id=\"Category\"><a href=\"#Category\" class=\"headerlink\" title=\"Category\"></a>Category</h3><p> C </p>\n<ul>\n<li>object ob(C)</li>\n<li>morphism-&gt; hom(C) f a b a,b  ob(C)  <strong> a  b </strong> f: a-&gt;bidentity f: a-&gt;a id[a]</li>\n<li> h=gf</li>\n</ul>\n<p></p>\n<ul>\n<li>f: a-&gt;b, g: b-&gt;c, h: c-&gt;dh(gf) = (hg)f</li>\n<li>id[a]f = id[b]f = f</li>\n<li>f: a-&gt;b, g: b-&gt;c, h: a-&gt;c, h = fg</li>\n</ul>\n<p></p>\n<ul>\n<li> C  Int  String </li>\n<li> f: Int-&gt;String</li>\n</ul>\n<p> <strong></strong><br></p>\n<h3 id=\"Functor\"><a href=\"#Functor\" class=\"headerlink\" title=\"Functor\"></a>Functor</h3><blockquote>\n<p> <a href=\"https://zh.wikipedia.org/wiki/%E5%87%BD%E5%AD%90\">wikipedia</a></p>\n</blockquote>\n<p></p>\n<p> C  D  C  D  F:</p>\n<ul>\n<li> xC  F(x)D </li>\n<li> f: x-&gt;yC  F(f): F(x)-&gt;F(y)D </li>\n</ul>\n<p></p>\n<ul>\n<li> xC F(id[x]) = id[F(x)]</li>\n<li> f: x-&gt;y, g: y-&gt;z F(fg) = F(f)F(g)</li>\n</ul>\n<p><br> <strong>Endofunctor</strong></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> C  <code>Int</code>  <code>String</code>  <code>Int -&gt; String</code>  D  <code>Array&lt;Int&gt;</code>  <code>Array&lt;String&gt;</code>  <code>Array&lt;Int&gt; -&gt; Array&lt;String&gt;</code>  F</p>\n<ul>\n<li><code>Int</code>  <code>Array&lt;Int&gt;</code> <code>String</code>  <code>Array&lt;String&gt;</code> </li>\n<li> <code>Int -&gt; String</code>  <code>Array&lt;Int&gt; -&gt; Array&lt;String&gt;</code> </li>\n</ul>\n<p>C: <code>Int</code>, <code>String</code>, f: <code>Int -&gt; String</code>, D: <code>Array&lt;Int&gt;</code>, <code>Array&lt;String&gt;</code>, f: <code>Array&lt;Int&gt; -&gt; Array&lt;String&gt;</code></p>\n<ul>\n<li>x: <code>Int</code> -&gt; F(x): <code>Array&lt;Int&gt;</code><code>String</code> -&gt; F(x): <code>Array&lt;String&gt;</code></li>\n<li>f: <code>(Int -&gt; String)</code> -&gt; F(f): <code>(Array&lt;Int&gt; -&gt; Array&lt;String&gt;)</code></li>\n</ul>\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">tmap</span>&lt;<span class=\"type\">T</span>&gt;(<span class=\"params\">x</span>: <span class=\"type\">T</span>)</span> -&gt; <span class=\"type\">F</span>&lt;<span class=\"type\">T</span>&gt;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">fmap</span>&lt;<span class=\"type\">A</span>, <span class=\"type\">B</span>&gt;(<span class=\"params\">f</span>: <span class=\"type\">A</span> -&gt; <span class=\"type\">B</span>)</span> -&gt; (<span class=\"type\">F</span>&lt;<span class=\"type\">A</span>&gt; -&gt; <span class=\"type\">F</span>&lt;<span class=\"type\">B</span>&gt;)</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Swift  Int  Array&lt;Int&gt;  Array </span></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">//  fmap  (F&lt;A&gt;, A -&gt; B) -&gt; F&lt;B&gt;  currying </span></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">map</span>&lt;<span class=\"type\">A</span>, <span class=\"type\">B</span>&gt;(<span class=\"params\">x</span>: <span class=\"type\">F</span>&lt;<span class=\"type\">A</span>&gt;, <span class=\"params\">f</span>: <span class=\"type\">A</span> -&gt; <span class=\"type\">B</span>)</span> -&gt; <span class=\"type\">F</span>&lt;<span class=\"type\">B</span>&gt;</span><br></pre></td></tr></table></figure>\n\n<p> Swift  <code>Array</code>  <code>Optional</code> Swift  <code>A, B</code>  Swift  <code>A -&gt; B</code> A <code>Array</code>  <code>Array&lt;A&gt;, Array&lt;B&gt;</code><code>Array</code>  <code>Array&lt;A&gt; -&gt; Array&lt;B&gt;</code> B A  B  <code>Array</code> <code>Array</code>  <code>T</code>  <code>Array&lt;T&gt;</code><code>Optional</code> </p>\n<p> <code>Functor</code> Type Constructor <code>map</code>  Swift  <code>Array</code>  <code>Optional</code>  <code>map</code>  Haskell  <code>Lift</code> <code>map</code> </p>\n<p> D <code>Array&lt;T&gt;</code>  C Identity id[T] = T</p>\n<p><br> <code>typealias Parser&lt;A&gt; = (String) -&gt; (A, String)?</code>  <code>func map&lt;A, B&gt;(x: Parser&lt;A&gt;, f: (A) -&gt; B) -&gt; Parser&lt;B&gt;</code>  <code>Parser&lt;A&gt;</code> </p>\n<h3 id=\"Endofunctor\"><a href=\"#Endofunctor\" class=\"headerlink\" title=\"Endofunctor\"></a>Endofunctor</h3><blockquote>\n<p>A functor that maps a category to itself <strong>Endofunctor</strong></p>\n</blockquote>\n<p> <code>Int -&gt; Int</code></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">f</span>(<span class=\"params\">x</span>: <span class=\"type\">Int</span>)</span> -&gt; <span class=\"type\">Int</span> &#123; <span class=\"keyword\">return</span> x <span class=\"operator\">+</span> <span class=\"number\">1</span> &#125;</span><br></pre></td></tr></table></figure>\n\n<p>Identity Function</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">id</span>(<span class=\"params\">x</span>: <span class=\"type\">Int</span>)</span> -&gt; <span class=\"type\">Int</span> &#123; <span class=\"keyword\">return</span> x &#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>Identity Functor</strong> C g: <code>String -&gt; Int</code></p>\n<p> F <code>F(Int)</code>  <code>String</code><code>F(String)</code>  <code>Int</code> <code>F(f: Int -&gt; String)</code>  g: <code>String -&gt; Int</code></p>\n<p>Identity Functor F <code>F(Int)</code>  <code>Int</code> <code>F(String)</code>  <code>String</code> <code>F(f: Int -&gt; String)</code>  <code>f: Int -&gt; String</code> <code>F(g: String -&gt; Int)</code>  g: <code>String -&gt; Int</code> </p>\n<h2 id=\"Applicative\"><a href=\"#Applicative\" class=\"headerlink\" title=\"Applicative\"></a>Applicative</h2><blockquote>\n<p>An applicative is a monoid in the category of endofunctors, whats the problem?</p>\n</blockquote>\n<p> Haskell  Monad  Applicative  Applicative  Monad </p>\n<p><a href=\"https://www.reddit.com/r/haskell/comments/2lompe/where_do_the_applicative_laws_come_from/\">Applicative</a></p>\n<h2 id=\"Monad\"><a href=\"#Monad\" class=\"headerlink\" title=\"Monad\"></a>Monad</h2><blockquote>\n<p>A monad is a monoid in the category of endofunctors  Philip Wadler</p>\n</blockquote>\n<p></p>\n<p> Endofunctor  <strong></strong></p>\n<ul>\n<li>X F<code>X -&gt; X</code></li>\n<li> id[X]  F <code>id[X] -&gt; F</code> (pure</li>\n<li> F  FF  F <code>FF -&gt; F</code> (join</li>\n</ul>\n<p></p>\n<ul>\n<li><code>func unit&lt;T&gt;(x: T) -&gt; F&lt;T&gt; // x = id[x]</code> </li>\n<li><code>func join&lt;T&gt;(a: F&lt;F&lt;T&gt;&gt;) -&gt; F&lt;T&gt;</code></li>\n</ul>\n<p>  Composition<br> Monoidal Category <code>unit</code>  <code>join</code>  Monoid  Monoid</p>\n<p>Monad Monoidal  Monoidal Tensor ProductFF -&gt; FComposition Id Functor</p>\n<p><code>bind</code>  <code>flatMap</code>  <code>&gt;&gt;=</code>  <code>map + join</code> <a href=\"https://github.com/apple/swift\">apple/swift</a>  <code>stdlib/public/core/FlatMap.swift</code></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">&gt;&gt;=&lt;</span></span><span class=\"type\">A</span>, <span class=\"type\">B</span><span class=\"operator\">&gt;</span>(x: <span class=\"type\">F</span>&lt;<span class=\"type\">A</span>&gt;, f: <span class=\"type\">A</span> -&gt; <span class=\"type\">F</span>&lt;<span class=\"type\">B</span>&gt;) -&gt; <span class=\"type\">F</span>&lt;<span class=\"type\">B</span>&gt;</span><br><span class=\"line\"><span class=\"comment\">// Currying </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">&gt;&gt;=&lt;</span></span><span class=\"type\">A</span>, <span class=\"type\">B</span><span class=\"operator\">&gt;</span>(x: <span class=\"type\">F</span>&lt;<span class=\"type\">A</span>&gt;) -&gt; (f: <span class=\"type\">A</span> -&gt; <span class=\"type\">F</span>&lt;<span class=\"type\">B</span>&gt;) -&gt; <span class=\"type\">F</span>&lt;<span class=\"type\">B</span>&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Ref\"><a href=\"#Ref\" class=\"headerlink\" title=\"Ref\"></a>Ref</h2><p>Too much</p>\n"},{"title":" Existential","date":"2019-06-05T12:00:00.000Z","_content":" **existential**  [Swift Associated Types, cont.](http://www.russbishop.net/swift-associated-types-cont)  `typealias Any = protocol<>` \n\n [Understanding Swift Performance - WWDC 2016](https://developer.apple.com/videos/play/wwdc2016/416/)\n\n [PATs](http://blessingsoft.com/2018/08/26/pats/)  **existential**  PATs \n\n **existential** \n\n> \n\n## Existential Type\n\n **existential** **existential values**, **existential containers**  **witness tables** \n\n [existential type](https://en.wikipedia.org/wiki/Type_system#Existential_types)  `protocol`  **existential type** `protocol` \n\n `protocol`  `protocol`  `non-final class`  override [](https://github.com/apple/swift/blob/master/docs/ABIStabilityManifesto.md#method-dispatch) `Protocol`  **witness table** \n\n### Existential Value\n\n**existential type**  **existential value**:P\n\n### Existential Container\n\n```swift\nprotocol Foo {}\nlet foos: [Foo] = ... // What's the memory storage looks like?\n```\n\n **existential of a protocol**  box `protocol`  **Existential Container** **witness**\n\n **existential container** [Understanding Swift Performance - WWDC 2016](https://developer.apple.com/videos/play/wwdc2016/416/)  [ABIStabilityManifesto  GitHub](https://github.com/apple/swift/blob/master/docs/ABIStabilityManifesto.md) \n\n 5  *value buffer* *value buffer*  *value buffer* \n `vwt` (*value witness table*) \n `pwt` (*protocol witness table*) \n\n `class`  `protocol``containers`  `vwt`  buffer `Any` `protocol` `Any`  `containers`  *witness table* `Any`  **existential**  Swift 3  `Any`  keyword `protocol <>`  **existential** \n\n### VWT\n\nconcrete type *value witness table*metadata\n\n### PWT\n\n*Protocol witness table*  `protocol`  associated type associated type  metadata\n\n>  **existential**  `protocol` \n\n## Protocol\n\n `protocol`  **existential**\n\n```swift\nprotocol Foo {}\n\nfunc bar<T: Foo>(_ foo: T) {} // This requires a concrete T that conforms to Foo\nfunc baz(_ foo: Foo) {} // This requires a variable of type Foo (pedantically: \"a Foo existential\")\n\nlet foo: Foo = ... // existential of protocol `Foo`\nbar(foo) //  Protocol type 'Foo' cannot conform to 'Foo' because only concrete types can conform to protocols\nbaz(foo) // \n```\n\n \"a protocol doesn't conform to itself\"  \"the existential of a protocol doesn't conform to that protocol\" \n\n## Generic\n\n**Existentials** `generic` `protocol`\n\n> While protocols create existential (\"there exists\") types, generics create universal (\"for all\") types. \n\n\n\n*  `func swap<T>(_ a: inout T, _ b: inout T)`\n*  `<T>`\n*  `Queue<T>`\n*  `<T: Protocol, U: Class>`\n*  `associatedtype T`\n*  `func foo<T: P, U: P>(_ a: T, _ b: T) where T: Equatable, T.Item == U.Item`\n\n **existentials**\n\n```swift\nfunc bar<T: Foo>(_ foo: T) {}\nlet foo: Foo = ...\nbar(foo) // Protocol type 'Foo' cannot conform to 'Foo' because only concrete types can conform to protocols\n```\n\n## PATs\n **existentials**  **type eraser** \n\n [PATs](http://blessingsoft.com/2018/08/26/pats/) \n\n> Protocol 'Caching' can only be used as generic constraint because it has Self or associated type requirements\n\n`Caching`   PATs  **existential**.\n\n> Using 'Logging' as a concrete type conforming to protocol 'Hashable' is no supported\n\n `Logging`  **existential**  `Hashable` \n\n PATs  **existential**  **generalized existentials**  **implicit existential**\n\n **existential**  **existential**  `generic`  `protocol`  **existential container**  `protocol`  *associated types*  `Self` Any **existential container**Swift **generic specialization** `Any`  PATs `let strings: Any<Sequence where .Iterator.Element == String> = [\"a\", \"b\", \"c\"]` `AnySequence<String>` \n\n  `protocol`  `existential container` `protocol`  PATs  *generic specialization*  **existential**  `protocol` \n\n **existential**  `init`  `static`  `Decodable` **existential** \n\n```swift\npublic protocol Decodable {\n    init(from decoder: Decoder) throws\n}\n\nstruct Model: Decodable {\n    let x: String\n}\n\nfunc decode(_ decodable: Decodable) {\n}\nlet decodable: Decodable = Model(x: \"x\")\ndecode(decodable)\n//  *existential*\n//  decode(_:)  Decoder  Decodable \n\nfunc decode(_ type: Decodable.Type) {\n    let decodable = JSONDecoder().decode(type, from: data)\n    // let decodable = JSONDecoder().decode(Decodable.self, from: data)\n    // Protocol type 'Decodable' cannot conform to 'Decodable' because only concrete types can conform to protocols\n}\n//  `Protocol type 'Decodable' cannot conform to 'Decodable' because only concrete types can conform to protocols`\n```\n\n **type eraser**  **existentials**  duals  generic  `Any<T>`   protocol  **explicit existential**\n\n## Existential in Other Language\n\n### Existential type in Java\n\nJava  **Wildcards**  existential type `java.util.List<?>`\n\n Java [](h)  `List[Int]`  `List[String]`\n\n```java\nList foo = new ArrayList();\nfoo.add(\"foo\");\nfoo.get(0); // \"foo\"\n```\n\n existential \n\n```java\nList<?>\nList<? extends Number>\nList<? super Integer>\n```\n\n### Existential type in Kotlin\n\nKotlin  **existential type** **The Existential** \n\n```kotlin\nabstract class Animal()\nclass Dog()\nclass Bar<T> {\n}\nvar dogBar: Bar<Dog> = Bar()\nvar animalBar: Bar<Animal> = dogBar // \n```\n\n```kotlin\nclass Bar<out T> {\n}\nvar dogBar: Bar<Dog> = Bar()\nvar animalBar: Bar<Animal> = dogBar // \n```\n\n### Existential type in Scala\n\n`ArrayList() == List[]`\n\n```scala\nobject Trait {\n  def foo(seq: Seq[String]): Seq[String]\n  def foo(seq: Seq[Int]): Seq[Int]\n}\n// Error, have the same type after erasure\n\nList[_] // List[T] forSome { type T }\ntrait List[+T]\n```\n\n### Existential type in Rust\n\n `fn foo() -> impl Trait`\n\n `impl Trait` Swift 5.1 [Opaque Result Types](https://github.com/apple/swift-evolution/blob/master/proposals/0244-opaque-result-types.md)  `func foo() -> some P` \n\n## Conclusion\n\n**Existential** **Existential**  `protocol`  work \n\n## Ref\n\n[Swift Associated Types, cont. - Russ Bishop](http://www.russbishop.net/swift-associated-types-cont)\n[ABIStabilityManifesto  GitHub](https://github.com/apple/swift/blob/master/docs/ABIStabilityManifesto.md)\n[GenericsManifesto  GitHub](https://github.com/apple/swift/blob/master/docs/GenericsManifesto.md)\n[Improving the UI of generics - Swift Forums](https://forums.swift.org/t/improving-the-ui-of-generics/22814)\n[Protocols III: Existential Spelling - Cocoaphony](http://robnapier.net/existential-spelling)\n[Existential types - Wikipedia](https://en.wikipedia.org/wiki/Type_system#Existential_types)\n[Understanding Swift Performance - WWDC 2016](https://developer.apple.com/videos/play/wwdc2016/416/)\n[0244-opaque-result-types - GitHub](https://github.com/apple/swift-evolution/blob/master/proposals/0244-opaque-result-types.md)","source":"_posts/existential.md","raw":"---\ntitle:  Existential\ndate: 2019-06-05 20:00:00\ntags:\n    - swift\n    - existential\n    - protocol\n    - generic\n    - pats\ncategories: advanced swift\n---\n **existential**  [Swift Associated Types, cont.](http://www.russbishop.net/swift-associated-types-cont)  `typealias Any = protocol<>` \n\n [Understanding Swift Performance - WWDC 2016](https://developer.apple.com/videos/play/wwdc2016/416/)\n\n [PATs](http://blessingsoft.com/2018/08/26/pats/)  **existential**  PATs \n\n **existential** \n\n> \n\n## Existential Type\n\n **existential** **existential values**, **existential containers**  **witness tables** \n\n [existential type](https://en.wikipedia.org/wiki/Type_system#Existential_types)  `protocol`  **existential type** `protocol` \n\n `protocol`  `protocol`  `non-final class`  override [](https://github.com/apple/swift/blob/master/docs/ABIStabilityManifesto.md#method-dispatch) `Protocol`  **witness table** \n\n### Existential Value\n\n**existential type**  **existential value**:P\n\n### Existential Container\n\n```swift\nprotocol Foo {}\nlet foos: [Foo] = ... // What's the memory storage looks like?\n```\n\n **existential of a protocol**  box `protocol`  **Existential Container** **witness**\n\n **existential container** [Understanding Swift Performance - WWDC 2016](https://developer.apple.com/videos/play/wwdc2016/416/)  [ABIStabilityManifesto  GitHub](https://github.com/apple/swift/blob/master/docs/ABIStabilityManifesto.md) \n\n 5  *value buffer* *value buffer*  *value buffer* \n `vwt` (*value witness table*) \n `pwt` (*protocol witness table*) \n\n `class`  `protocol``containers`  `vwt`  buffer `Any` `protocol` `Any`  `containers`  *witness table* `Any`  **existential**  Swift 3  `Any`  keyword `protocol <>`  **existential** \n\n### VWT\n\nconcrete type *value witness table*metadata\n\n### PWT\n\n*Protocol witness table*  `protocol`  associated type associated type  metadata\n\n>  **existential**  `protocol` \n\n## Protocol\n\n `protocol`  **existential**\n\n```swift\nprotocol Foo {}\n\nfunc bar<T: Foo>(_ foo: T) {} // This requires a concrete T that conforms to Foo\nfunc baz(_ foo: Foo) {} // This requires a variable of type Foo (pedantically: \"a Foo existential\")\n\nlet foo: Foo = ... // existential of protocol `Foo`\nbar(foo) //  Protocol type 'Foo' cannot conform to 'Foo' because only concrete types can conform to protocols\nbaz(foo) // \n```\n\n \"a protocol doesn't conform to itself\"  \"the existential of a protocol doesn't conform to that protocol\" \n\n## Generic\n\n**Existentials** `generic` `protocol`\n\n> While protocols create existential (\"there exists\") types, generics create universal (\"for all\") types. \n\n\n\n*  `func swap<T>(_ a: inout T, _ b: inout T)`\n*  `<T>`\n*  `Queue<T>`\n*  `<T: Protocol, U: Class>`\n*  `associatedtype T`\n*  `func foo<T: P, U: P>(_ a: T, _ b: T) where T: Equatable, T.Item == U.Item`\n\n **existentials**\n\n```swift\nfunc bar<T: Foo>(_ foo: T) {}\nlet foo: Foo = ...\nbar(foo) // Protocol type 'Foo' cannot conform to 'Foo' because only concrete types can conform to protocols\n```\n\n## PATs\n **existentials**  **type eraser** \n\n [PATs](http://blessingsoft.com/2018/08/26/pats/) \n\n> Protocol 'Caching' can only be used as generic constraint because it has Self or associated type requirements\n\n`Caching`   PATs  **existential**.\n\n> Using 'Logging' as a concrete type conforming to protocol 'Hashable' is no supported\n\n `Logging`  **existential**  `Hashable` \n\n PATs  **existential**  **generalized existentials**  **implicit existential**\n\n **existential**  **existential**  `generic`  `protocol`  **existential container**  `protocol`  *associated types*  `Self` Any **existential container**Swift **generic specialization** `Any`  PATs `let strings: Any<Sequence where .Iterator.Element == String> = [\"a\", \"b\", \"c\"]` `AnySequence<String>` \n\n  `protocol`  `existential container` `protocol`  PATs  *generic specialization*  **existential**  `protocol` \n\n **existential**  `init`  `static`  `Decodable` **existential** \n\n```swift\npublic protocol Decodable {\n    init(from decoder: Decoder) throws\n}\n\nstruct Model: Decodable {\n    let x: String\n}\n\nfunc decode(_ decodable: Decodable) {\n}\nlet decodable: Decodable = Model(x: \"x\")\ndecode(decodable)\n//  *existential*\n//  decode(_:)  Decoder  Decodable \n\nfunc decode(_ type: Decodable.Type) {\n    let decodable = JSONDecoder().decode(type, from: data)\n    // let decodable = JSONDecoder().decode(Decodable.self, from: data)\n    // Protocol type 'Decodable' cannot conform to 'Decodable' because only concrete types can conform to protocols\n}\n//  `Protocol type 'Decodable' cannot conform to 'Decodable' because only concrete types can conform to protocols`\n```\n\n **type eraser**  **existentials**  duals  generic  `Any<T>`   protocol  **explicit existential**\n\n## Existential in Other Language\n\n### Existential type in Java\n\nJava  **Wildcards**  existential type `java.util.List<?>`\n\n Java [](h)  `List[Int]`  `List[String]`\n\n```java\nList foo = new ArrayList();\nfoo.add(\"foo\");\nfoo.get(0); // \"foo\"\n```\n\n existential \n\n```java\nList<?>\nList<? extends Number>\nList<? super Integer>\n```\n\n### Existential type in Kotlin\n\nKotlin  **existential type** **The Existential** \n\n```kotlin\nabstract class Animal()\nclass Dog()\nclass Bar<T> {\n}\nvar dogBar: Bar<Dog> = Bar()\nvar animalBar: Bar<Animal> = dogBar // \n```\n\n```kotlin\nclass Bar<out T> {\n}\nvar dogBar: Bar<Dog> = Bar()\nvar animalBar: Bar<Animal> = dogBar // \n```\n\n### Existential type in Scala\n\n`ArrayList() == List[]`\n\n```scala\nobject Trait {\n  def foo(seq: Seq[String]): Seq[String]\n  def foo(seq: Seq[Int]): Seq[Int]\n}\n// Error, have the same type after erasure\n\nList[_] // List[T] forSome { type T }\ntrait List[+T]\n```\n\n### Existential type in Rust\n\n `fn foo() -> impl Trait`\n\n `impl Trait` Swift 5.1 [Opaque Result Types](https://github.com/apple/swift-evolution/blob/master/proposals/0244-opaque-result-types.md)  `func foo() -> some P` \n\n## Conclusion\n\n**Existential** **Existential**  `protocol`  work \n\n## Ref\n\n[Swift Associated Types, cont. - Russ Bishop](http://www.russbishop.net/swift-associated-types-cont)\n[ABIStabilityManifesto  GitHub](https://github.com/apple/swift/blob/master/docs/ABIStabilityManifesto.md)\n[GenericsManifesto  GitHub](https://github.com/apple/swift/blob/master/docs/GenericsManifesto.md)\n[Improving the UI of generics - Swift Forums](https://forums.swift.org/t/improving-the-ui-of-generics/22814)\n[Protocols III: Existential Spelling - Cocoaphony](http://robnapier.net/existential-spelling)\n[Existential types - Wikipedia](https://en.wikipedia.org/wiki/Type_system#Existential_types)\n[Understanding Swift Performance - WWDC 2016](https://developer.apple.com/videos/play/wwdc2016/416/)\n[0244-opaque-result-types - GitHub](https://github.com/apple/swift-evolution/blob/master/proposals/0244-opaque-result-types.md)","slug":"existential","published":1,"updated":"2022-01-02T11:28:34.031Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckxx810x800069ithgptq97vn","content":"<p> <strong>existential</strong>  <a href=\"http://www.russbishop.net/swift-associated-types-cont\">Swift Associated Types, cont.</a>  <code>typealias Any = protocol&lt;&gt;</code> </p>\n<p> <a href=\"https://developer.apple.com/videos/play/wwdc2016/416/\">Understanding Swift Performance - WWDC 2016</a></p>\n<p> <a href=\"http://blessingsoft.com/2018/08/26/pats/\">PATs</a>  <strong>existential</strong>  PATs </p>\n<p> <strong>existential</strong> </p>\n<blockquote>\n<p></p>\n</blockquote>\n<h2 id=\"Existential-Type\"><a href=\"#Existential-Type\" class=\"headerlink\" title=\"Existential Type\"></a>Existential Type</h2><p> <strong>existential</strong> <strong>existential values</strong>, <strong>existential containers</strong>  <strong>witness tables</strong> </p>\n<p> <a href=\"https://en.wikipedia.org/wiki/Type_system#Existential_types\">existential type</a>  <code>protocol</code>  <strong>existential type</strong> <code>protocol</code> </p>\n<p> <code>protocol</code>  <code>protocol</code>  <code>non-final class</code>  override <a href=\"https://github.com/apple/swift/blob/master/docs/ABIStabilityManifesto.md#method-dispatch\"></a> <code>Protocol</code>  <strong>witness table</strong> </p>\n<h3 id=\"Existential-Value\"><a href=\"#Existential-Value\" class=\"headerlink\" title=\"Existential Value\"></a>Existential Value</h3><p><strong>existential type</strong>  <strong>existential value</strong>:P</p>\n<h3 id=\"Existential-Container\"><a href=\"#Existential-Container\" class=\"headerlink\" title=\"Existential Container\"></a>Existential Container</h3><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">protocol</span> <span class=\"title\">Foo</span> </span>&#123;&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> foos: [<span class=\"type\">Foo</span>] <span class=\"operator\">=</span> <span class=\"operator\">...</span> <span class=\"comment\">// What&#x27;s the memory storage looks like?</span></span><br></pre></td></tr></table></figure>\n\n<p> <strong>existential of a protocol</strong>  box <code>protocol</code>  <strong>Existential Container</strong> <strong>witness</strong></p>\n<p> <strong>existential container</strong> <a href=\"https://developer.apple.com/videos/play/wwdc2016/416/\">Understanding Swift Performance - WWDC 2016</a>  <a href=\"https://github.com/apple/swift/blob/master/docs/ABIStabilityManifesto.md\">ABIStabilityManifesto  GitHub</a> </p>\n<p> 5  <em>value buffer</em> <em>value buffer</em>  <em>value buffer</em> <br> <code>vwt</code> (<em>value witness table</em>) <br> <code>pwt</code> (<em>protocol witness table</em>) </p>\n<p> <code>class</code>  <code>protocol</code><code>containers</code>  <code>vwt</code>  buffer <code>Any</code> <code>protocol</code> <code>Any</code>  <code>containers</code>  <em>witness table</em> <code>Any</code>  <strong>existential</strong>  Swift 3  <code>Any</code>  keyword <code>protocol &lt;&gt;</code>  <strong>existential</strong> </p>\n<h3 id=\"VWT\"><a href=\"#VWT\" class=\"headerlink\" title=\"VWT\"></a>VWT</h3><p>concrete type <em>value witness table</em>metadata</p>\n<h3 id=\"PWT\"><a href=\"#PWT\" class=\"headerlink\" title=\"PWT\"></a>PWT</h3><p><em>Protocol witness table</em>  <code>protocol</code>  associated type associated type  metadata</p>\n<blockquote>\n<p> <strong>existential</strong>  <code>protocol</code> </p>\n</blockquote>\n<h2 id=\"Protocol\"><a href=\"#Protocol\" class=\"headerlink\" title=\"Protocol\"></a>Protocol</h2><p> <code>protocol</code>  <strong>existential</strong></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">protocol</span> <span class=\"title\">Foo</span> </span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">bar</span>&lt;<span class=\"type\">T</span>: <span class=\"type\">Foo</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">foo</span>: <span class=\"type\">T</span>)</span> &#123;&#125; <span class=\"comment\">// This requires a concrete T that conforms to Foo</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">baz</span>(<span class=\"keyword\">_</span> <span class=\"params\">foo</span>: <span class=\"type\">Foo</span>)</span> &#123;&#125; <span class=\"comment\">// This requires a variable of type Foo (pedantically: &quot;a Foo existential&quot;)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> foo: <span class=\"type\">Foo</span> <span class=\"operator\">=</span> <span class=\"operator\">...</span> <span class=\"comment\">// existential of protocol `Foo`</span></span><br><span class=\"line\">bar(foo) <span class=\"comment\">//  Protocol type &#x27;Foo&#x27; cannot conform to &#x27;Foo&#x27; because only concrete types can conform to protocols</span></span><br><span class=\"line\">baz(foo) <span class=\"comment\">// </span></span><br></pre></td></tr></table></figure>\n\n<p> a protocol doesnt conform to itself  the existential of a protocol doesnt conform to that protocol </p>\n<h2 id=\"Generic\"><a href=\"#Generic\" class=\"headerlink\" title=\"Generic\"></a>Generic</h2><p><strong>Existentials</strong> <code>generic</code> <code>protocol</code></p>\n<blockquote>\n<p>While protocols create existential (there exists) types, generics create universal (for all) types. </p>\n</blockquote>\n<p></p>\n<ul>\n<li> <code>func swap&lt;T&gt;(_ a: inout T, _ b: inout T)</code></li>\n<li> <code>&lt;T&gt;</code></li>\n<li> <code>Queue&lt;T&gt;</code></li>\n<li> <code>&lt;T: Protocol, U: Class&gt;</code></li>\n<li> <code>associatedtype T</code></li>\n<li> <code>func foo&lt;T: P, U: P&gt;(_ a: T, _ b: T) where T: Equatable, T.Item == U.Item</code></li>\n</ul>\n<p> <strong>existentials</strong></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">bar</span>&lt;<span class=\"type\">T</span>: <span class=\"type\">Foo</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">foo</span>: <span class=\"type\">T</span>)</span> &#123;&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> foo: <span class=\"type\">Foo</span> <span class=\"operator\">=</span> <span class=\"operator\">...</span></span><br><span class=\"line\">bar(foo) <span class=\"comment\">// Protocol type &#x27;Foo&#x27; cannot conform to &#x27;Foo&#x27; because only concrete types can conform to protocols</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"PATs\"><a href=\"#PATs\" class=\"headerlink\" title=\"PATs\"></a>PATs</h2><p> <strong>existentials</strong>  <strong>type eraser</strong> </p>\n<p> <a href=\"http://blessingsoft.com/2018/08/26/pats/\">PATs</a> </p>\n<blockquote>\n<p>Protocol Caching can only be used as generic constraint because it has Self or associated type requirements</p>\n</blockquote>\n<p><code>Caching</code>   PATs  <strong>existential</strong>.</p>\n<blockquote>\n<p>Using Logging as a concrete type conforming to protocol Hashable is no supported</p>\n</blockquote>\n<p> <code>Logging</code>  <strong>existential</strong>  <code>Hashable</code> </p>\n<p> PATs  <strong>existential</strong>  <strong>generalized existentials</strong>  <strong>implicit existential</strong></p>\n<p> <strong>existential</strong>  <strong>existential</strong>  <code>generic</code>  <code>protocol</code>  <strong>existential container</strong>  <code>protocol</code>  <em>associated types</em>  <code>Self</code> Any <strong>existential container</strong>Swift <strong>generic specialization</strong> <code>Any</code>  PATs <code>let strings: Any&lt;Sequence where .Iterator.Element == String&gt; = [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]</code> <code>AnySequence&lt;String&gt;</code> </p>\n<p>  <code>protocol</code>  <code>existential container</code> <code>protocol</code>  PATs  <em>generic specialization</em>  <strong>existential</strong>  <code>protocol</code> </p>\n<p> <strong>existential</strong>  <code>init</code>  <code>static</code>  <code>Decodable</code> <strong>existential</strong> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">protocol</span> <span class=\"title\">Decodable</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">init</span>(<span class=\"params\">from</span> <span class=\"params\">decoder</span>: <span class=\"type\">Decoder</span>)</span> <span class=\"keyword\">throws</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Model</span>: <span class=\"title\">Decodable</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> x: <span class=\"type\">String</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">decode</span>(<span class=\"keyword\">_</span> <span class=\"params\">decodable</span>: <span class=\"type\">Decodable</span>)</span> &#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> decodable: <span class=\"type\">Decodable</span> <span class=\"operator\">=</span> <span class=\"type\">Model</span>(x: <span class=\"string\">&quot;x&quot;</span>)</span><br><span class=\"line\">decode(decodable)</span><br><span class=\"line\"><span class=\"comment\">//  *existential*</span></span><br><span class=\"line\"><span class=\"comment\">//  decode(_:)  Decoder  Decodable </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">decode</span>(<span class=\"keyword\">_</span> <span class=\"params\">type</span>: <span class=\"type\">Decodable</span>.<span class=\"keyword\">Type</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> decodable <span class=\"operator\">=</span> <span class=\"type\">JSONDecoder</span>().decode(type, from: data)</span><br><span class=\"line\">    <span class=\"comment\">// let decodable = JSONDecoder().decode(Decodable.self, from: data)</span></span><br><span class=\"line\">    <span class=\"comment\">// Protocol type &#x27;Decodable&#x27; cannot conform to &#x27;Decodable&#x27; because only concrete types can conform to protocols</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//  `Protocol type &#x27;Decodable&#x27; cannot conform to &#x27;Decodable&#x27; because only concrete types can conform to protocols`</span></span><br></pre></td></tr></table></figure>\n\n<p> <strong>type eraser</strong>  <strong>existentials</strong>  duals  generic  <code>Any&lt;T&gt;</code>   protocol  <strong>explicit existential</strong></p>\n<h2 id=\"Existential-in-Other-Language\"><a href=\"#Existential-in-Other-Language\" class=\"headerlink\" title=\"Existential in Other Language\"></a>Existential in Other Language</h2><h3 id=\"Existential-type-in-Java\"><a href=\"#Existential-type-in-Java\" class=\"headerlink\" title=\"Existential type in Java\"></a>Existential type in Java</h3><p>Java  <strong>Wildcards</strong>  existential type <code>java.util.List&lt;?&gt;</code></p>\n<p> Java <a href=\"h\"></a>  <code>List[Int]</code>  <code>List[String]</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">List foo = <span class=\"keyword\">new</span> ArrayList();</span><br><span class=\"line\">foo.add(<span class=\"string\">&quot;foo&quot;</span>);</span><br><span class=\"line\">foo.get(<span class=\"number\">0</span>); <span class=\"comment\">// &quot;foo&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p> existential </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">List&lt;?&gt;</span><br><span class=\"line\">List&lt;? extends Number&gt;</span><br><span class=\"line\">List&lt;? <span class=\"keyword\">super</span> Integer&gt;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Existential-type-in-Kotlin\"><a href=\"#Existential-type-in-Kotlin\" class=\"headerlink\" title=\"Existential type in Kotlin\"></a>Existential type in Kotlin</h3><p>Kotlin  <strong>existential type</strong> <strong>The Existential</strong> </p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">abstract</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Animal</span></span>()</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Dog</span></span>()</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Bar</span>&lt;<span class=\"type\">T</span>&gt; </span>&#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> dogBar: Bar&lt;Dog&gt; = Bar()</span><br><span class=\"line\"><span class=\"keyword\">var</span> animalBar: Bar&lt;Animal&gt; = dogBar <span class=\"comment\">// </span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Bar</span>&lt;<span class=\"type\">out T</span>&gt; </span>&#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> dogBar: Bar&lt;Dog&gt; = Bar()</span><br><span class=\"line\"><span class=\"keyword\">var</span> animalBar: Bar&lt;Animal&gt; = dogBar <span class=\"comment\">// </span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Existential-type-in-Scala\"><a href=\"#Existential-type-in-Scala\" class=\"headerlink\" title=\"Existential type in Scala\"></a>Existential type in Scala</h3><p><code>ArrayList() == List[]</code></p>\n<figure class=\"highlight scala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">object</span> <span class=\"title\">Trait</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">foo</span></span>(seq: <span class=\"type\">Seq</span>[<span class=\"type\">String</span>]): <span class=\"type\">Seq</span>[<span class=\"type\">String</span>]</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">foo</span></span>(seq: <span class=\"type\">Seq</span>[<span class=\"type\">Int</span>]): <span class=\"type\">Seq</span>[<span class=\"type\">Int</span>]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// Error, have the same type after erasure</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">List</span>[_] <span class=\"comment\">// List[T] forSome &#123; type T &#125;</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">trait</span> <span class=\"title\">List</span>[+<span class=\"type\">T</span>]</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Existential-type-in-Rust\"><a href=\"#Existential-type-in-Rust\" class=\"headerlink\" title=\"Existential type in Rust\"></a>Existential type in Rust</h3><p> <code>fn foo() -&gt; impl Trait</code></p>\n<p> <code>impl Trait</code> Swift 5.1 <a href=\"https://github.com/apple/swift-evolution/blob/master/proposals/0244-opaque-result-types.md\">Opaque Result Types</a>  <code>func foo() -&gt; some P</code> </p>\n<h2 id=\"Conclusion\"><a href=\"#Conclusion\" class=\"headerlink\" title=\"Conclusion\"></a>Conclusion</h2><p><strong>Existential</strong> <strong>Existential</strong>  <code>protocol</code>  work </p>\n<h2 id=\"Ref\"><a href=\"#Ref\" class=\"headerlink\" title=\"Ref\"></a>Ref</h2><p><a href=\"http://www.russbishop.net/swift-associated-types-cont\">Swift Associated Types, cont. - Russ Bishop</a><br><a href=\"https://github.com/apple/swift/blob/master/docs/ABIStabilityManifesto.md\">ABIStabilityManifesto  GitHub</a><br><a href=\"https://github.com/apple/swift/blob/master/docs/GenericsManifesto.md\">GenericsManifesto  GitHub</a><br><a href=\"https://forums.swift.org/t/improving-the-ui-of-generics/22814\">Improving the UI of generics - Swift Forums</a><br><a href=\"http://robnapier.net/existential-spelling\">Protocols III: Existential Spelling - Cocoaphony</a><br><a href=\"https://en.wikipedia.org/wiki/Type_system#Existential_types\">Existential types - Wikipedia</a><br><a href=\"https://developer.apple.com/videos/play/wwdc2016/416/\">Understanding Swift Performance - WWDC 2016</a><br><a href=\"https://github.com/apple/swift-evolution/blob/master/proposals/0244-opaque-result-types.md\">0244-opaque-result-types - GitHub</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p> <strong>existential</strong>  <a href=\"http://www.russbishop.net/swift-associated-types-cont\">Swift Associated Types, cont.</a>  <code>typealias Any = protocol&lt;&gt;</code> </p>\n<p> <a href=\"https://developer.apple.com/videos/play/wwdc2016/416/\">Understanding Swift Performance - WWDC 2016</a></p>\n<p> <a href=\"http://blessingsoft.com/2018/08/26/pats/\">PATs</a>  <strong>existential</strong>  PATs </p>\n<p> <strong>existential</strong> </p>\n<blockquote>\n<p></p>\n</blockquote>\n<h2 id=\"Existential-Type\"><a href=\"#Existential-Type\" class=\"headerlink\" title=\"Existential Type\"></a>Existential Type</h2><p> <strong>existential</strong> <strong>existential values</strong>, <strong>existential containers</strong>  <strong>witness tables</strong> </p>\n<p> <a href=\"https://en.wikipedia.org/wiki/Type_system#Existential_types\">existential type</a>  <code>protocol</code>  <strong>existential type</strong> <code>protocol</code> </p>\n<p> <code>protocol</code>  <code>protocol</code>  <code>non-final class</code>  override <a href=\"https://github.com/apple/swift/blob/master/docs/ABIStabilityManifesto.md#method-dispatch\"></a> <code>Protocol</code>  <strong>witness table</strong> </p>\n<h3 id=\"Existential-Value\"><a href=\"#Existential-Value\" class=\"headerlink\" title=\"Existential Value\"></a>Existential Value</h3><p><strong>existential type</strong>  <strong>existential value</strong>:P</p>\n<h3 id=\"Existential-Container\"><a href=\"#Existential-Container\" class=\"headerlink\" title=\"Existential Container\"></a>Existential Container</h3><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">protocol</span> <span class=\"title\">Foo</span> </span>&#123;&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> foos: [<span class=\"type\">Foo</span>] <span class=\"operator\">=</span> <span class=\"operator\">...</span> <span class=\"comment\">// What&#x27;s the memory storage looks like?</span></span><br></pre></td></tr></table></figure>\n\n<p> <strong>existential of a protocol</strong>  box <code>protocol</code>  <strong>Existential Container</strong> <strong>witness</strong></p>\n<p> <strong>existential container</strong> <a href=\"https://developer.apple.com/videos/play/wwdc2016/416/\">Understanding Swift Performance - WWDC 2016</a>  <a href=\"https://github.com/apple/swift/blob/master/docs/ABIStabilityManifesto.md\">ABIStabilityManifesto  GitHub</a> </p>\n<p> 5  <em>value buffer</em> <em>value buffer</em>  <em>value buffer</em> <br> <code>vwt</code> (<em>value witness table</em>) <br> <code>pwt</code> (<em>protocol witness table</em>) </p>\n<p> <code>class</code>  <code>protocol</code><code>containers</code>  <code>vwt</code>  buffer <code>Any</code> <code>protocol</code> <code>Any</code>  <code>containers</code>  <em>witness table</em> <code>Any</code>  <strong>existential</strong>  Swift 3  <code>Any</code>  keyword <code>protocol &lt;&gt;</code>  <strong>existential</strong> </p>\n<h3 id=\"VWT\"><a href=\"#VWT\" class=\"headerlink\" title=\"VWT\"></a>VWT</h3><p>concrete type <em>value witness table</em>metadata</p>\n<h3 id=\"PWT\"><a href=\"#PWT\" class=\"headerlink\" title=\"PWT\"></a>PWT</h3><p><em>Protocol witness table</em>  <code>protocol</code>  associated type associated type  metadata</p>\n<blockquote>\n<p> <strong>existential</strong>  <code>protocol</code> </p>\n</blockquote>\n<h2 id=\"Protocol\"><a href=\"#Protocol\" class=\"headerlink\" title=\"Protocol\"></a>Protocol</h2><p> <code>protocol</code>  <strong>existential</strong></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">protocol</span> <span class=\"title\">Foo</span> </span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">bar</span>&lt;<span class=\"type\">T</span>: <span class=\"type\">Foo</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">foo</span>: <span class=\"type\">T</span>)</span> &#123;&#125; <span class=\"comment\">// This requires a concrete T that conforms to Foo</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">baz</span>(<span class=\"keyword\">_</span> <span class=\"params\">foo</span>: <span class=\"type\">Foo</span>)</span> &#123;&#125; <span class=\"comment\">// This requires a variable of type Foo (pedantically: &quot;a Foo existential&quot;)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> foo: <span class=\"type\">Foo</span> <span class=\"operator\">=</span> <span class=\"operator\">...</span> <span class=\"comment\">// existential of protocol `Foo`</span></span><br><span class=\"line\">bar(foo) <span class=\"comment\">//  Protocol type &#x27;Foo&#x27; cannot conform to &#x27;Foo&#x27; because only concrete types can conform to protocols</span></span><br><span class=\"line\">baz(foo) <span class=\"comment\">// </span></span><br></pre></td></tr></table></figure>\n\n<p> a protocol doesnt conform to itself  the existential of a protocol doesnt conform to that protocol </p>\n<h2 id=\"Generic\"><a href=\"#Generic\" class=\"headerlink\" title=\"Generic\"></a>Generic</h2><p><strong>Existentials</strong> <code>generic</code> <code>protocol</code></p>\n<blockquote>\n<p>While protocols create existential (there exists) types, generics create universal (for all) types. </p>\n</blockquote>\n<p></p>\n<ul>\n<li> <code>func swap&lt;T&gt;(_ a: inout T, _ b: inout T)</code></li>\n<li> <code>&lt;T&gt;</code></li>\n<li> <code>Queue&lt;T&gt;</code></li>\n<li> <code>&lt;T: Protocol, U: Class&gt;</code></li>\n<li> <code>associatedtype T</code></li>\n<li> <code>func foo&lt;T: P, U: P&gt;(_ a: T, _ b: T) where T: Equatable, T.Item == U.Item</code></li>\n</ul>\n<p> <strong>existentials</strong></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">bar</span>&lt;<span class=\"type\">T</span>: <span class=\"type\">Foo</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">foo</span>: <span class=\"type\">T</span>)</span> &#123;&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> foo: <span class=\"type\">Foo</span> <span class=\"operator\">=</span> <span class=\"operator\">...</span></span><br><span class=\"line\">bar(foo) <span class=\"comment\">// Protocol type &#x27;Foo&#x27; cannot conform to &#x27;Foo&#x27; because only concrete types can conform to protocols</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"PATs\"><a href=\"#PATs\" class=\"headerlink\" title=\"PATs\"></a>PATs</h2><p> <strong>existentials</strong>  <strong>type eraser</strong> </p>\n<p> <a href=\"http://blessingsoft.com/2018/08/26/pats/\">PATs</a> </p>\n<blockquote>\n<p>Protocol Caching can only be used as generic constraint because it has Self or associated type requirements</p>\n</blockquote>\n<p><code>Caching</code>   PATs  <strong>existential</strong>.</p>\n<blockquote>\n<p>Using Logging as a concrete type conforming to protocol Hashable is no supported</p>\n</blockquote>\n<p> <code>Logging</code>  <strong>existential</strong>  <code>Hashable</code> </p>\n<p> PATs  <strong>existential</strong>  <strong>generalized existentials</strong>  <strong>implicit existential</strong></p>\n<p> <strong>existential</strong>  <strong>existential</strong>  <code>generic</code>  <code>protocol</code>  <strong>existential container</strong>  <code>protocol</code>  <em>associated types</em>  <code>Self</code> Any <strong>existential container</strong>Swift <strong>generic specialization</strong> <code>Any</code>  PATs <code>let strings: Any&lt;Sequence where .Iterator.Element == String&gt; = [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]</code> <code>AnySequence&lt;String&gt;</code> </p>\n<p>  <code>protocol</code>  <code>existential container</code> <code>protocol</code>  PATs  <em>generic specialization</em>  <strong>existential</strong>  <code>protocol</code> </p>\n<p> <strong>existential</strong>  <code>init</code>  <code>static</code>  <code>Decodable</code> <strong>existential</strong> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">protocol</span> <span class=\"title\">Decodable</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">init</span>(<span class=\"params\">from</span> <span class=\"params\">decoder</span>: <span class=\"type\">Decoder</span>)</span> <span class=\"keyword\">throws</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Model</span>: <span class=\"title\">Decodable</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> x: <span class=\"type\">String</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">decode</span>(<span class=\"keyword\">_</span> <span class=\"params\">decodable</span>: <span class=\"type\">Decodable</span>)</span> &#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> decodable: <span class=\"type\">Decodable</span> <span class=\"operator\">=</span> <span class=\"type\">Model</span>(x: <span class=\"string\">&quot;x&quot;</span>)</span><br><span class=\"line\">decode(decodable)</span><br><span class=\"line\"><span class=\"comment\">//  *existential*</span></span><br><span class=\"line\"><span class=\"comment\">//  decode(_:)  Decoder  Decodable </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">decode</span>(<span class=\"keyword\">_</span> <span class=\"params\">type</span>: <span class=\"type\">Decodable</span>.<span class=\"keyword\">Type</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> decodable <span class=\"operator\">=</span> <span class=\"type\">JSONDecoder</span>().decode(type, from: data)</span><br><span class=\"line\">    <span class=\"comment\">// let decodable = JSONDecoder().decode(Decodable.self, from: data)</span></span><br><span class=\"line\">    <span class=\"comment\">// Protocol type &#x27;Decodable&#x27; cannot conform to &#x27;Decodable&#x27; because only concrete types can conform to protocols</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//  `Protocol type &#x27;Decodable&#x27; cannot conform to &#x27;Decodable&#x27; because only concrete types can conform to protocols`</span></span><br></pre></td></tr></table></figure>\n\n<p> <strong>type eraser</strong>  <strong>existentials</strong>  duals  generic  <code>Any&lt;T&gt;</code>   protocol  <strong>explicit existential</strong></p>\n<h2 id=\"Existential-in-Other-Language\"><a href=\"#Existential-in-Other-Language\" class=\"headerlink\" title=\"Existential in Other Language\"></a>Existential in Other Language</h2><h3 id=\"Existential-type-in-Java\"><a href=\"#Existential-type-in-Java\" class=\"headerlink\" title=\"Existential type in Java\"></a>Existential type in Java</h3><p>Java  <strong>Wildcards</strong>  existential type <code>java.util.List&lt;?&gt;</code></p>\n<p> Java <a href=\"h\"></a>  <code>List[Int]</code>  <code>List[String]</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">List foo = <span class=\"keyword\">new</span> ArrayList();</span><br><span class=\"line\">foo.add(<span class=\"string\">&quot;foo&quot;</span>);</span><br><span class=\"line\">foo.get(<span class=\"number\">0</span>); <span class=\"comment\">// &quot;foo&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p> existential </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">List&lt;?&gt;</span><br><span class=\"line\">List&lt;? extends Number&gt;</span><br><span class=\"line\">List&lt;? <span class=\"keyword\">super</span> Integer&gt;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Existential-type-in-Kotlin\"><a href=\"#Existential-type-in-Kotlin\" class=\"headerlink\" title=\"Existential type in Kotlin\"></a>Existential type in Kotlin</h3><p>Kotlin  <strong>existential type</strong> <strong>The Existential</strong> </p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">abstract</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Animal</span></span>()</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Dog</span></span>()</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Bar</span>&lt;<span class=\"type\">T</span>&gt; </span>&#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> dogBar: Bar&lt;Dog&gt; = Bar()</span><br><span class=\"line\"><span class=\"keyword\">var</span> animalBar: Bar&lt;Animal&gt; = dogBar <span class=\"comment\">// </span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Bar</span>&lt;<span class=\"type\">out T</span>&gt; </span>&#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> dogBar: Bar&lt;Dog&gt; = Bar()</span><br><span class=\"line\"><span class=\"keyword\">var</span> animalBar: Bar&lt;Animal&gt; = dogBar <span class=\"comment\">// </span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Existential-type-in-Scala\"><a href=\"#Existential-type-in-Scala\" class=\"headerlink\" title=\"Existential type in Scala\"></a>Existential type in Scala</h3><p><code>ArrayList() == List[]</code></p>\n<figure class=\"highlight scala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">object</span> <span class=\"title\">Trait</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">foo</span></span>(seq: <span class=\"type\">Seq</span>[<span class=\"type\">String</span>]): <span class=\"type\">Seq</span>[<span class=\"type\">String</span>]</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">foo</span></span>(seq: <span class=\"type\">Seq</span>[<span class=\"type\">Int</span>]): <span class=\"type\">Seq</span>[<span class=\"type\">Int</span>]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// Error, have the same type after erasure</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">List</span>[_] <span class=\"comment\">// List[T] forSome &#123; type T &#125;</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">trait</span> <span class=\"title\">List</span>[+<span class=\"type\">T</span>]</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Existential-type-in-Rust\"><a href=\"#Existential-type-in-Rust\" class=\"headerlink\" title=\"Existential type in Rust\"></a>Existential type in Rust</h3><p> <code>fn foo() -&gt; impl Trait</code></p>\n<p> <code>impl Trait</code> Swift 5.1 <a href=\"https://github.com/apple/swift-evolution/blob/master/proposals/0244-opaque-result-types.md\">Opaque Result Types</a>  <code>func foo() -&gt; some P</code> </p>\n<h2 id=\"Conclusion\"><a href=\"#Conclusion\" class=\"headerlink\" title=\"Conclusion\"></a>Conclusion</h2><p><strong>Existential</strong> <strong>Existential</strong>  <code>protocol</code>  work </p>\n<h2 id=\"Ref\"><a href=\"#Ref\" class=\"headerlink\" title=\"Ref\"></a>Ref</h2><p><a href=\"http://www.russbishop.net/swift-associated-types-cont\">Swift Associated Types, cont. - Russ Bishop</a><br><a href=\"https://github.com/apple/swift/blob/master/docs/ABIStabilityManifesto.md\">ABIStabilityManifesto  GitHub</a><br><a href=\"https://github.com/apple/swift/blob/master/docs/GenericsManifesto.md\">GenericsManifesto  GitHub</a><br><a href=\"https://forums.swift.org/t/improving-the-ui-of-generics/22814\">Improving the UI of generics - Swift Forums</a><br><a href=\"http://robnapier.net/existential-spelling\">Protocols III: Existential Spelling - Cocoaphony</a><br><a href=\"https://en.wikipedia.org/wiki/Type_system#Existential_types\">Existential types - Wikipedia</a><br><a href=\"https://developer.apple.com/videos/play/wwdc2016/416/\">Understanding Swift Performance - WWDC 2016</a><br><a href=\"https://github.com/apple/swift-evolution/blob/master/proposals/0244-opaque-result-types.md\">0244-opaque-result-types - GitHub</a></p>\n"},{"title":"Cherry Blessing","date":"2017-05-20T12:00:00.000Z","_content":"Welcome to Cherry Blessing.\n\n\n","source":"_posts/cherry-blessing.md","raw":"---\ntitle: Cherry Blessing\ndate: 2017-05-20 20:00:00\n---\nWelcome to Cherry Blessing.\n\n\n","slug":"cherry-blessing","published":1,"updated":"2022-01-02T11:26:09.895Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckxx810x900079ith425v0gmn","content":"<p>Welcome to Cherry Blessing.</p>\n","site":{"data":{}},"excerpt":"","more":"<p>Welcome to Cherry Blessing.</p>\n"},{"title":"How to design a lightweight Logging System","date":"2018-08-26T12:00:00.000Z","_content":">  [CocoaLumberjack](https://github.com/CocoaLumberjack/CocoaLumberjack)  Log  Pure-Swift  Log  [CocoaLumberjack](https://github.com/CocoaLumberjack/CocoaLumberjack)  Swift  ~~~~ \n\n## Logging System\n\n iOS  Swift  `print()`  `debugPrint()`  Xcode Console  Foundation  `NSLog()`  [os_log](https://developer.apple.com/documentation/os/logging) \n\n* **print**/**debugPrint**: Swift  Xcode Console Apple System LogsMac Console.app\n* **NSLog**: Foundation  Xcode Console  Console.app \n* **os_log**:  [Unified Logging and Activity Tracing - WWDC 2016 - Videos - Apple Developer](https://developer.apple.com/videos/play/wwdc2016/721/) [Measuring Performance Using Logging - WWDC 2018 - Videos - Apple Developer](https://developer.apple.com/videos/play/wwdc2018/405/)\n\nXcode Console  Apple System Logs  log log  log / API \n\n\n\n*  release  Xcode Console\n* ~~ release ~~  Apple System Logs\n* \n*  Web\n* \n* \n\n## Design\n\n### Level\n\nLevel \n\n* \n* \n\n level \n\n```swift\npublic enum Level: Int {\n    case off = 0\n    case error = 1 // Flag.error | Level.off\n    case warning = 3 // Flag.warning | Level.error\n    case info = 7 // Flag.info | Level.warning\n    case debug = 15 // Flag.debug | Level.info\n}\n\npublic struct Flag: OptionSet {\n    public let rawValue: Int\n\n    public static let error = Flag(rawValue: 1 << 0) // 1\n    public static let warning = Flag(rawValue: 1 << 1) // 2\n    public static let info = Flag(rawValue: 1 << 2) // 4\n    public static let debug = Flag(rawValue: 1 << 3) // 8\n\n    public init(rawValue: Int) {\n        self.rawValue = rawValue\n    }\n}\n```\n\n### Message & Formatter\n\n\n\n `Message`  format  `Formatter` \n\n Pure-Swift `Message`  `struct` Value Type `class` Reference Type`Codable`, `CustomStringConvertible`, `Equatable` \n\n `Formatter` logger  format logger  app  Xcode Console  `Formatter`  `protocol`\n\n```swift\npublic struct Message {\n\n    public let message: String\n\n    public let level: Level\n\n    public let flag: Flag\n\n    public let context: Int\n\n    public let file: String\n\n    public let function: StaticString\n\n    public let line: UInt\n\n    public let timestamp: Date\n}\n\npublic protocol Formatter {\n    func format(message: Message) -> String\n}\n```\n\n### Logging\n\n logger `ConsoleLogger``FileLogger`  `WebLogger`  logger \n\n\n\n```swift\nopen class Logging {\n    public enum Type {\n        case console\n        case file\n        case web\n    }\n\n    open var type: Type {\n        return .console\n    }\n    \n    open func log(_ message: String) {\n        fatalError(\"must override this method in subclass.\")\n    }\n}\n\nopen class ConsoleLogger: Logging {\n    override open var type: Type {\n        return .console\n    }\n    override open func log(_ message: String) {\n        //\n    }\n}\nopen class FileLogger: Logging {\n    override open var type: Type {\n        return .file\n    }\n    override open func log(_ message: String) {\n        //\n    }\n}\n```\n\n\n\n```swift\nprotocol Logging {\n    var type: Type { get }\n\n    func log(_ message: String)\n}\n\nstruct ConsoleLogger: Logging {\n    var type: Type {\n        return .console\n    }\n\n    func log(_ message: String) {\n        //\n    }\n}\n\nstruct FileLogger: Logging {\n    var type: Type {\n        return .file\n    }\n\n    func log(_ message: String) {\n        //\n    }\n}\n```\n\n\n* \n* \n\n logger  `protocol extension` \n\n **** Swift \n\n `Type` `enum`  Type\n\n `Type`  `String`  `name`  debug\n\n### Interface\n\n Logging \n\n```swift\npublic protocol Logging {\n\n    var formatter: Formatter { get }\n\n    var name: String { get }\n\n    var level: Level { get }\n\n    func log(message: Message)\n\n    func flush()\n\n    func start()\n\n    func teardown()\n}\n\npublic extension Logging {\n\n    var name: String {\n        return \"Unified\"\n    }\n\n    func flush() {}\n\n    func start() {}\n\n    func teardown() {}\n}\n```\n\n### Logger\n\n `logger`  `logger`  `log(message:)`  `logger` `logger`\n\n```swift\npublic class Logger {\n    public static let shared = Logger()\n\n    private var queue = DispatchQueue(label: \"com.xspyhack.logger.queue\")\n\n    public private(set) var loggers: Set<AnyLogger> = []\n\n    deinit {\n        loggers.forEach {\n            $0.teardown()\n        }\n\n        loggers = []\n    }\n}\n\npublic extension Logger {\n   public func add(_ logger: Logging) {\n        loggers.update(with: logger)\n    }\n}\n\npublic extension Logger {\n    public func log(message: Message, asynchronous: Bool) {\n        let work = DispatchWorkItem {\n            self.loggers.forEach { logger in\n                guard message.flag.rawValue & logger.level.rawValue != 0 else {\n                    return\n                }\n                logger.log(message: message)\n            }\n        }\n\n        if asynchronous {\n            queue.async(execute: work)\n        } else {\n            queue.sync(execute: work)\n        }\n    }\n\n    public func start() {\n        loggers.forEach {\n            $0.start()\n        }\n    }\n\n    public func flush() {\n        let work = DispatchWorkItem {\n            self.loggers.forEach { logger in\n                logger.flush()\n            }\n        }\n\n        queue.sync(execute: work)\n    }\n}\n```\n\n `loggers`  `logger` \n\n### Log\n\n `Logging`  `logger` `logger`  `Logger` ~~Charmander~~ Logging System\n\n `loggers`  `Formatter` `Logger`  log   `Message` `Logger.shared.log(message:)` \n\n `Message` \n\n```swift\npublic static func log(_ message: @autoclosure () -> String, level: Level, flag: Flag, context: Int = 0, file: String = #file, function: StaticString = #function, line: UInt = #line, asynchronous: Bool = false) {\n\n    let message = Message(message: message(), level: level, flag: flag, context: context, file: file, function: function, line: line, timestamp: Date())\n\n    Logger.shared.log(message: message, asynchronous: asynchronous)\n}\n```\n\n `level`  `flag`  `print`  log  `level` \n\n```swift\nLog.d(\"This is a debug level log\")\nLog.i(\"This is an info level log\")\nLog.w(\"This is a warning level log\")\nLog.e(\"This is an error level log\")\n```\n\n>  `log`  message  `@autoclosure`\n\n> `Swift.print` \n\n## Implementation\n\n[GitHub - xspyhack/Keldeo: A lightweight logging library written in Swift.](https://github.com/xspyhack/Keldeo)\n\n### Why AnyLogger\n\n `AnyLogger` `logger`  Xcode  `logger`  `WebLogger`  `logger`  `logger`  `Equatable` `loggers` \n\n> Why `protocol Logging: Equatable {}` needs `AnyLogger` [PATs](http://blessingsoft.com/2018/08/26/pats/)\n\n## Ref\n\n* [GitHub - CocoaLumberjack/CocoaLumberjack: A fast & simple, yet powerful & flexible logging framework for Mac and iOS](https://github.com/CocoaLumberjack/CocoaLumberjack)\n* [Kingfisher/ImageCache.swift at master  onevcat/Kingfisher  GitHub](https://github.com/onevcat/Kingfisher/blob/master/Sources/ImageCache.swift)\n* [swift/AnyHashable.swift at swift-3.0-branch  apple/swift  GitHub](https://github.com/apple/swift/blob/swift-3.0-branch/stdlib/public/core/AnyHashable.swift)\n\n\n\n","source":"_posts/logging-system.md","raw":"---\ntitle: How to design a lightweight Logging System\ndate: 2018-08-26 20:00:00\ntags:\n    - swift\n    - logger\n    - logging\ncategories: advanced swift\n---\n>  [CocoaLumberjack](https://github.com/CocoaLumberjack/CocoaLumberjack)  Log  Pure-Swift  Log  [CocoaLumberjack](https://github.com/CocoaLumberjack/CocoaLumberjack)  Swift  ~~~~ \n\n## Logging System\n\n iOS  Swift  `print()`  `debugPrint()`  Xcode Console  Foundation  `NSLog()`  [os_log](https://developer.apple.com/documentation/os/logging) \n\n* **print**/**debugPrint**: Swift  Xcode Console Apple System LogsMac Console.app\n* **NSLog**: Foundation  Xcode Console  Console.app \n* **os_log**:  [Unified Logging and Activity Tracing - WWDC 2016 - Videos - Apple Developer](https://developer.apple.com/videos/play/wwdc2016/721/) [Measuring Performance Using Logging - WWDC 2018 - Videos - Apple Developer](https://developer.apple.com/videos/play/wwdc2018/405/)\n\nXcode Console  Apple System Logs  log log  log / API \n\n\n\n*  release  Xcode Console\n* ~~ release ~~  Apple System Logs\n* \n*  Web\n* \n* \n\n## Design\n\n### Level\n\nLevel \n\n* \n* \n\n level \n\n```swift\npublic enum Level: Int {\n    case off = 0\n    case error = 1 // Flag.error | Level.off\n    case warning = 3 // Flag.warning | Level.error\n    case info = 7 // Flag.info | Level.warning\n    case debug = 15 // Flag.debug | Level.info\n}\n\npublic struct Flag: OptionSet {\n    public let rawValue: Int\n\n    public static let error = Flag(rawValue: 1 << 0) // 1\n    public static let warning = Flag(rawValue: 1 << 1) // 2\n    public static let info = Flag(rawValue: 1 << 2) // 4\n    public static let debug = Flag(rawValue: 1 << 3) // 8\n\n    public init(rawValue: Int) {\n        self.rawValue = rawValue\n    }\n}\n```\n\n### Message & Formatter\n\n\n\n `Message`  format  `Formatter` \n\n Pure-Swift `Message`  `struct` Value Type `class` Reference Type`Codable`, `CustomStringConvertible`, `Equatable` \n\n `Formatter` logger  format logger  app  Xcode Console  `Formatter`  `protocol`\n\n```swift\npublic struct Message {\n\n    public let message: String\n\n    public let level: Level\n\n    public let flag: Flag\n\n    public let context: Int\n\n    public let file: String\n\n    public let function: StaticString\n\n    public let line: UInt\n\n    public let timestamp: Date\n}\n\npublic protocol Formatter {\n    func format(message: Message) -> String\n}\n```\n\n### Logging\n\n logger `ConsoleLogger``FileLogger`  `WebLogger`  logger \n\n\n\n```swift\nopen class Logging {\n    public enum Type {\n        case console\n        case file\n        case web\n    }\n\n    open var type: Type {\n        return .console\n    }\n    \n    open func log(_ message: String) {\n        fatalError(\"must override this method in subclass.\")\n    }\n}\n\nopen class ConsoleLogger: Logging {\n    override open var type: Type {\n        return .console\n    }\n    override open func log(_ message: String) {\n        //\n    }\n}\nopen class FileLogger: Logging {\n    override open var type: Type {\n        return .file\n    }\n    override open func log(_ message: String) {\n        //\n    }\n}\n```\n\n\n\n```swift\nprotocol Logging {\n    var type: Type { get }\n\n    func log(_ message: String)\n}\n\nstruct ConsoleLogger: Logging {\n    var type: Type {\n        return .console\n    }\n\n    func log(_ message: String) {\n        //\n    }\n}\n\nstruct FileLogger: Logging {\n    var type: Type {\n        return .file\n    }\n\n    func log(_ message: String) {\n        //\n    }\n}\n```\n\n\n* \n* \n\n logger  `protocol extension` \n\n **** Swift \n\n `Type` `enum`  Type\n\n `Type`  `String`  `name`  debug\n\n### Interface\n\n Logging \n\n```swift\npublic protocol Logging {\n\n    var formatter: Formatter { get }\n\n    var name: String { get }\n\n    var level: Level { get }\n\n    func log(message: Message)\n\n    func flush()\n\n    func start()\n\n    func teardown()\n}\n\npublic extension Logging {\n\n    var name: String {\n        return \"Unified\"\n    }\n\n    func flush() {}\n\n    func start() {}\n\n    func teardown() {}\n}\n```\n\n### Logger\n\n `logger`  `logger`  `log(message:)`  `logger` `logger`\n\n```swift\npublic class Logger {\n    public static let shared = Logger()\n\n    private var queue = DispatchQueue(label: \"com.xspyhack.logger.queue\")\n\n    public private(set) var loggers: Set<AnyLogger> = []\n\n    deinit {\n        loggers.forEach {\n            $0.teardown()\n        }\n\n        loggers = []\n    }\n}\n\npublic extension Logger {\n   public func add(_ logger: Logging) {\n        loggers.update(with: logger)\n    }\n}\n\npublic extension Logger {\n    public func log(message: Message, asynchronous: Bool) {\n        let work = DispatchWorkItem {\n            self.loggers.forEach { logger in\n                guard message.flag.rawValue & logger.level.rawValue != 0 else {\n                    return\n                }\n                logger.log(message: message)\n            }\n        }\n\n        if asynchronous {\n            queue.async(execute: work)\n        } else {\n            queue.sync(execute: work)\n        }\n    }\n\n    public func start() {\n        loggers.forEach {\n            $0.start()\n        }\n    }\n\n    public func flush() {\n        let work = DispatchWorkItem {\n            self.loggers.forEach { logger in\n                logger.flush()\n            }\n        }\n\n        queue.sync(execute: work)\n    }\n}\n```\n\n `loggers`  `logger` \n\n### Log\n\n `Logging`  `logger` `logger`  `Logger` ~~Charmander~~ Logging System\n\n `loggers`  `Formatter` `Logger`  log   `Message` `Logger.shared.log(message:)` \n\n `Message` \n\n```swift\npublic static func log(_ message: @autoclosure () -> String, level: Level, flag: Flag, context: Int = 0, file: String = #file, function: StaticString = #function, line: UInt = #line, asynchronous: Bool = false) {\n\n    let message = Message(message: message(), level: level, flag: flag, context: context, file: file, function: function, line: line, timestamp: Date())\n\n    Logger.shared.log(message: message, asynchronous: asynchronous)\n}\n```\n\n `level`  `flag`  `print`  log  `level` \n\n```swift\nLog.d(\"This is a debug level log\")\nLog.i(\"This is an info level log\")\nLog.w(\"This is a warning level log\")\nLog.e(\"This is an error level log\")\n```\n\n>  `log`  message  `@autoclosure`\n\n> `Swift.print` \n\n## Implementation\n\n[GitHub - xspyhack/Keldeo: A lightweight logging library written in Swift.](https://github.com/xspyhack/Keldeo)\n\n### Why AnyLogger\n\n `AnyLogger` `logger`  Xcode  `logger`  `WebLogger`  `logger`  `logger`  `Equatable` `loggers` \n\n> Why `protocol Logging: Equatable {}` needs `AnyLogger` [PATs](http://blessingsoft.com/2018/08/26/pats/)\n\n## Ref\n\n* [GitHub - CocoaLumberjack/CocoaLumberjack: A fast & simple, yet powerful & flexible logging framework for Mac and iOS](https://github.com/CocoaLumberjack/CocoaLumberjack)\n* [Kingfisher/ImageCache.swift at master  onevcat/Kingfisher  GitHub](https://github.com/onevcat/Kingfisher/blob/master/Sources/ImageCache.swift)\n* [swift/AnyHashable.swift at swift-3.0-branch  apple/swift  GitHub](https://github.com/apple/swift/blob/swift-3.0-branch/stdlib/public/core/AnyHashable.swift)\n\n\n\n","slug":"logging-system","published":1,"updated":"2022-01-02T11:27:36.392Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckxx810xa00089ithdlbsbdbf","content":"<blockquote>\n<p> <a href=\"https://github.com/CocoaLumberjack/CocoaLumberjack\">CocoaLumberjack</a>  Log  Pure-Swift  Log  <a href=\"https://github.com/CocoaLumberjack/CocoaLumberjack\">CocoaLumberjack</a>  Swift  <del></del> </p>\n</blockquote>\n<h2 id=\"Logging-System\"><a href=\"#Logging-System\" class=\"headerlink\" title=\"Logging System\"></a>Logging System</h2><p> iOS  Swift  <code>print()</code>  <code>debugPrint()</code>  Xcode Console  Foundation  <code>NSLog()</code>  <a href=\"https://developer.apple.com/documentation/os/logging\">os_log</a> </p>\n<ul>\n<li><strong>print</strong>/<strong>debugPrint</strong>: Swift  Xcode Console Apple System LogsMac Console.app</li>\n<li><strong>NSLog</strong>: Foundation  Xcode Console  Console.app </li>\n<li><strong>os_log</strong>:  <a href=\"https://developer.apple.com/videos/play/wwdc2016/721/\">Unified Logging and Activity Tracing - WWDC 2016 - Videos - Apple Developer</a> <a href=\"https://developer.apple.com/videos/play/wwdc2018/405/\">Measuring Performance Using Logging - WWDC 2018 - Videos - Apple Developer</a></li>\n</ul>\n<p>Xcode Console  Apple System Logs  log log  log / API </p>\n<p></p>\n<ul>\n<li> release  Xcode Console</li>\n<li><del> release </del>  Apple System Logs</li>\n<li></li>\n<li> Web</li>\n<li></li>\n<li></li>\n</ul>\n<h2 id=\"Design\"><a href=\"#Design\" class=\"headerlink\" title=\"Design\"></a>Design</h2><h3 id=\"Level\"><a href=\"#Level\" class=\"headerlink\" title=\"Level\"></a>Level</h3><p>Level </p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p> level </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">enum</span> <span class=\"title\">Level</span>: <span class=\"title\">Int</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> off <span class=\"operator\">=</span> <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">case</span> error <span class=\"operator\">=</span> <span class=\"number\">1</span> <span class=\"comment\">// Flag.error | Level.off</span></span><br><span class=\"line\">    <span class=\"keyword\">case</span> warning <span class=\"operator\">=</span> <span class=\"number\">3</span> <span class=\"comment\">// Flag.warning | Level.error</span></span><br><span class=\"line\">    <span class=\"keyword\">case</span> info <span class=\"operator\">=</span> <span class=\"number\">7</span> <span class=\"comment\">// Flag.info | Level.warning</span></span><br><span class=\"line\">    <span class=\"keyword\">case</span> debug <span class=\"operator\">=</span> <span class=\"number\">15</span> <span class=\"comment\">// Flag.debug | Level.info</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Flag</span>: <span class=\"title\">OptionSet</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">let</span> rawValue: <span class=\"type\">Int</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">let</span> error <span class=\"operator\">=</span> <span class=\"type\">Flag</span>(rawValue: <span class=\"number\">1</span> <span class=\"operator\">&lt;&lt;</span> <span class=\"number\">0</span>) <span class=\"comment\">// 1</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">let</span> warning <span class=\"operator\">=</span> <span class=\"type\">Flag</span>(rawValue: <span class=\"number\">1</span> <span class=\"operator\">&lt;&lt;</span> <span class=\"number\">1</span>) <span class=\"comment\">// 2</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">let</span> info <span class=\"operator\">=</span> <span class=\"type\">Flag</span>(rawValue: <span class=\"number\">1</span> <span class=\"operator\">&lt;&lt;</span> <span class=\"number\">2</span>) <span class=\"comment\">// 4</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">let</span> debug <span class=\"operator\">=</span> <span class=\"type\">Flag</span>(rawValue: <span class=\"number\">1</span> <span class=\"operator\">&lt;&lt;</span> <span class=\"number\">3</span>) <span class=\"comment\">// 8</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">init</span>(<span class=\"params\">rawValue</span>: <span class=\"type\">Int</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.rawValue <span class=\"operator\">=</span> rawValue</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Message-amp-Formatter\"><a href=\"#Message-amp-Formatter\" class=\"headerlink\" title=\"Message &amp; Formatter\"></a>Message &amp; Formatter</h3><p></p>\n<p> <code>Message</code>  format  <code>Formatter</code> </p>\n<p> Pure-Swift <code>Message</code>  <code>struct</code> Value Type <code>class</code> Reference Type<code>Codable</code>, <code>CustomStringConvertible</code>, <code>Equatable</code> </p>\n<p> <code>Formatter</code> logger  format logger  app  Xcode Console  <code>Formatter</code>  <code>protocol</code></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Message</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">let</span> message: <span class=\"type\">String</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">let</span> level: <span class=\"type\">Level</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">let</span> flag: <span class=\"type\">Flag</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">let</span> context: <span class=\"type\">Int</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">let</span> file: <span class=\"type\">String</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">let</span> function: <span class=\"type\">StaticString</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">let</span> line: <span class=\"type\">UInt</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">let</span> timestamp: <span class=\"type\">Date</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">protocol</span> <span class=\"title\">Formatter</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">format</span>(<span class=\"params\">message</span>: <span class=\"type\">Message</span>)</span> -&gt; <span class=\"type\">String</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Logging\"><a href=\"#Logging\" class=\"headerlink\" title=\"Logging\"></a>Logging</h3><p> logger <code>ConsoleLogger</code><code>FileLogger</code>  <code>WebLogger</code>  logger </p>\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">open</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Logging</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">enum</span> <span class=\"title\">Type</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> console</span><br><span class=\"line\">        <span class=\"keyword\">case</span> file</span><br><span class=\"line\">        <span class=\"keyword\">case</span> web</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">open</span> <span class=\"keyword\">var</span> type: <span class=\"type\">Type</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> .console</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">open</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">log</span>(<span class=\"keyword\">_</span> <span class=\"params\">message</span>: <span class=\"type\">String</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">fatalError</span>(<span class=\"string\">&quot;must override this method in subclass.&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">open</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ConsoleLogger</span>: <span class=\"title\">Logging</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"keyword\">open</span> <span class=\"keyword\">var</span> type: <span class=\"type\">Type</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> .console</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"keyword\">open</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">log</span>(<span class=\"keyword\">_</span> <span class=\"params\">message</span>: <span class=\"type\">String</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">open</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FileLogger</span>: <span class=\"title\">Logging</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"keyword\">open</span> <span class=\"keyword\">var</span> type: <span class=\"type\">Type</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> .file</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"keyword\">open</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">log</span>(<span class=\"keyword\">_</span> <span class=\"params\">message</span>: <span class=\"type\">String</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">protocol</span> <span class=\"title\">Logging</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> type: <span class=\"type\">Type</span> &#123; <span class=\"keyword\">get</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">log</span>(<span class=\"keyword\">_</span> <span class=\"params\">message</span>: <span class=\"type\">String</span>)</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">ConsoleLogger</span>: <span class=\"title\">Logging</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> type: <span class=\"type\">Type</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> .console</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">log</span>(<span class=\"keyword\">_</span> <span class=\"params\">message</span>: <span class=\"type\">String</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">FileLogger</span>: <span class=\"title\">Logging</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> type: <span class=\"type\">Type</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> .file</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">log</span>(<span class=\"keyword\">_</span> <span class=\"params\">message</span>: <span class=\"type\">String</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p> logger  <code>protocol extension</code> </p>\n<p> <strong></strong> Swift </p>\n<p> <code>Type</code> <code>enum</code>  Type</p>\n<p> <code>Type</code>  <code>String</code>  <code>name</code>  debug</p>\n<h3 id=\"Interface\"><a href=\"#Interface\" class=\"headerlink\" title=\"Interface\"></a>Interface</h3><p> Logging </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">protocol</span> <span class=\"title\">Logging</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> formatter: <span class=\"type\">Formatter</span> &#123; <span class=\"keyword\">get</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> name: <span class=\"type\">String</span> &#123; <span class=\"keyword\">get</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> level: <span class=\"type\">Level</span> &#123; <span class=\"keyword\">get</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">log</span>(<span class=\"params\">message</span>: <span class=\"type\">Message</span>)</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">flush</span>()</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">start</span>()</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">teardown</span>()</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">Logging</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> name: <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;Unified&quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">flush</span>()</span> &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">start</span>()</span> &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">teardown</span>()</span> &#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Logger\"><a href=\"#Logger\" class=\"headerlink\" title=\"Logger\"></a>Logger</h3><p> <code>logger</code>  <code>logger</code>  <code>log(message:)</code>  <code>logger</code> <code>logger</code></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Logger</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">let</span> shared <span class=\"operator\">=</span> <span class=\"type\">Logger</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">var</span> queue <span class=\"operator\">=</span> <span class=\"type\">DispatchQueue</span>(label: <span class=\"string\">&quot;com.xspyhack.logger.queue&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">private(set)</span> <span class=\"keyword\">var</span> loggers: <span class=\"type\">Set</span>&lt;<span class=\"type\">AnyLogger</span>&gt; <span class=\"operator\">=</span> []</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">deinit</span> &#123;</span><br><span class=\"line\">        loggers.forEach &#123;</span><br><span class=\"line\">            <span class=\"variable\">$0</span>.teardown()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        loggers <span class=\"operator\">=</span> []</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">Logger</span> </span>&#123;</span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">add</span>(<span class=\"keyword\">_</span> <span class=\"params\">logger</span>: <span class=\"type\">Logging</span>)</span> &#123;</span><br><span class=\"line\">        loggers.update(with: logger)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">Logger</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">log</span>(<span class=\"params\">message</span>: <span class=\"type\">Message</span>, <span class=\"params\">asynchronous</span>: <span class=\"type\">Bool</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> work <span class=\"operator\">=</span> <span class=\"type\">DispatchWorkItem</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">self</span>.loggers.forEach &#123; logger <span class=\"keyword\">in</span></span><br><span class=\"line\">                <span class=\"keyword\">guard</span> message.flag.rawValue <span class=\"operator\">&amp;</span> logger.level.rawValue <span class=\"operator\">!=</span> <span class=\"number\">0</span> <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                logger.log(message: message)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> asynchronous &#123;</span><br><span class=\"line\">            queue.async(execute: work)</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            queue.sync(execute: work)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">start</span>()</span> &#123;</span><br><span class=\"line\">        loggers.forEach &#123;</span><br><span class=\"line\">            <span class=\"variable\">$0</span>.start()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">flush</span>()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> work <span class=\"operator\">=</span> <span class=\"type\">DispatchWorkItem</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">self</span>.loggers.forEach &#123; logger <span class=\"keyword\">in</span></span><br><span class=\"line\">                logger.flush()</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        queue.sync(execute: work)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>loggers</code>  <code>logger</code> </p>\n<h3 id=\"Log\"><a href=\"#Log\" class=\"headerlink\" title=\"Log\"></a>Log</h3><p> <code>Logging</code>  <code>logger</code> <code>logger</code>  <code>Logger</code> <del>Charmander</del> Logging System</p>\n<p> <code>loggers</code>  <code>Formatter</code> <code>Logger</code>  log   <code>Message</code> <code>Logger.shared.log(message:)</code> </p>\n<p> <code>Message</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">log</span>(<span class=\"keyword\">_</span> <span class=\"params\">message</span>: <span class=\"keyword\">@autoclosure</span> () -&gt; <span class=\"type\">String</span>, <span class=\"params\">level</span>: <span class=\"type\">Level</span>, <span class=\"params\">flag</span>: <span class=\"type\">Flag</span>, <span class=\"params\">context</span>: <span class=\"type\">Int</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>, <span class=\"params\">file</span>: <span class=\"type\">String</span> <span class=\"operator\">=</span> #file, <span class=\"params\">function</span>: <span class=\"type\">StaticString</span> <span class=\"operator\">=</span> #function, <span class=\"params\">line</span>: <span class=\"type\">UInt</span> <span class=\"operator\">=</span> #line, <span class=\"params\">asynchronous</span>: <span class=\"type\">Bool</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> message <span class=\"operator\">=</span> <span class=\"type\">Message</span>(message: message(), level: level, flag: flag, context: context, file: file, function: function, line: line, timestamp: <span class=\"type\">Date</span>())</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">Logger</span>.shared.log(message: message, asynchronous: asynchronous)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>level</code>  <code>flag</code>  <code>print</code>  log  <code>level</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">Log</span>.d(<span class=\"string\">&quot;This is a debug level log&quot;</span>)</span><br><span class=\"line\"><span class=\"type\">Log</span>.i(<span class=\"string\">&quot;This is an info level log&quot;</span>)</span><br><span class=\"line\"><span class=\"type\">Log</span>.w(<span class=\"string\">&quot;This is a warning level log&quot;</span>)</span><br><span class=\"line\"><span class=\"type\">Log</span>.e(<span class=\"string\">&quot;This is an error level log&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> <code>log</code>  message  <code>@autoclosure</code></p>\n</blockquote>\n<blockquote>\n<p><code>Swift.print</code> </p>\n</blockquote>\n<h2 id=\"Implementation\"><a href=\"#Implementation\" class=\"headerlink\" title=\"Implementation\"></a>Implementation</h2><p><a href=\"https://github.com/xspyhack/Keldeo\">GitHub - xspyhack/Keldeo: A lightweight logging library written in Swift.</a></p>\n<h3 id=\"Why-AnyLogger\"><a href=\"#Why-AnyLogger\" class=\"headerlink\" title=\"Why AnyLogger\"></a>Why AnyLogger</h3><p> <code>AnyLogger</code> <code>logger</code>  Xcode  <code>logger</code>  <code>WebLogger</code>  <code>logger</code>  <code>logger</code>  <code>Equatable</code> <code>loggers</code> </p>\n<blockquote>\n<p>Why <code>protocol Logging: Equatable &#123;&#125;</code> needs <code>AnyLogger</code> <a href=\"http://blessingsoft.com/2018/08/26/pats/\">PATs</a></p>\n</blockquote>\n<h2 id=\"Ref\"><a href=\"#Ref\" class=\"headerlink\" title=\"Ref\"></a>Ref</h2><ul>\n<li><a href=\"https://github.com/CocoaLumberjack/CocoaLumberjack\">GitHub - CocoaLumberjack/CocoaLumberjack: A fast &amp; simple, yet powerful &amp; flexible logging framework for Mac and iOS</a></li>\n<li><a href=\"https://github.com/onevcat/Kingfisher/blob/master/Sources/ImageCache.swift\">Kingfisher/ImageCache.swift at master  onevcat/Kingfisher  GitHub</a></li>\n<li><a href=\"https://github.com/apple/swift/blob/swift-3.0-branch/stdlib/public/core/AnyHashable.swift\">swift/AnyHashable.swift at swift-3.0-branch  apple/swift  GitHub</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p> <a href=\"https://github.com/CocoaLumberjack/CocoaLumberjack\">CocoaLumberjack</a>  Log  Pure-Swift  Log  <a href=\"https://github.com/CocoaLumberjack/CocoaLumberjack\">CocoaLumberjack</a>  Swift  <del></del> </p>\n</blockquote>\n<h2 id=\"Logging-System\"><a href=\"#Logging-System\" class=\"headerlink\" title=\"Logging System\"></a>Logging System</h2><p> iOS  Swift  <code>print()</code>  <code>debugPrint()</code>  Xcode Console  Foundation  <code>NSLog()</code>  <a href=\"https://developer.apple.com/documentation/os/logging\">os_log</a> </p>\n<ul>\n<li><strong>print</strong>/<strong>debugPrint</strong>: Swift  Xcode Console Apple System LogsMac Console.app</li>\n<li><strong>NSLog</strong>: Foundation  Xcode Console  Console.app </li>\n<li><strong>os_log</strong>:  <a href=\"https://developer.apple.com/videos/play/wwdc2016/721/\">Unified Logging and Activity Tracing - WWDC 2016 - Videos - Apple Developer</a> <a href=\"https://developer.apple.com/videos/play/wwdc2018/405/\">Measuring Performance Using Logging - WWDC 2018 - Videos - Apple Developer</a></li>\n</ul>\n<p>Xcode Console  Apple System Logs  log log  log / API </p>\n<p></p>\n<ul>\n<li> release  Xcode Console</li>\n<li><del> release </del>  Apple System Logs</li>\n<li></li>\n<li> Web</li>\n<li></li>\n<li></li>\n</ul>\n<h2 id=\"Design\"><a href=\"#Design\" class=\"headerlink\" title=\"Design\"></a>Design</h2><h3 id=\"Level\"><a href=\"#Level\" class=\"headerlink\" title=\"Level\"></a>Level</h3><p>Level </p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p> level </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">enum</span> <span class=\"title\">Level</span>: <span class=\"title\">Int</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> off <span class=\"operator\">=</span> <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">case</span> error <span class=\"operator\">=</span> <span class=\"number\">1</span> <span class=\"comment\">// Flag.error | Level.off</span></span><br><span class=\"line\">    <span class=\"keyword\">case</span> warning <span class=\"operator\">=</span> <span class=\"number\">3</span> <span class=\"comment\">// Flag.warning | Level.error</span></span><br><span class=\"line\">    <span class=\"keyword\">case</span> info <span class=\"operator\">=</span> <span class=\"number\">7</span> <span class=\"comment\">// Flag.info | Level.warning</span></span><br><span class=\"line\">    <span class=\"keyword\">case</span> debug <span class=\"operator\">=</span> <span class=\"number\">15</span> <span class=\"comment\">// Flag.debug | Level.info</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Flag</span>: <span class=\"title\">OptionSet</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">let</span> rawValue: <span class=\"type\">Int</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">let</span> error <span class=\"operator\">=</span> <span class=\"type\">Flag</span>(rawValue: <span class=\"number\">1</span> <span class=\"operator\">&lt;&lt;</span> <span class=\"number\">0</span>) <span class=\"comment\">// 1</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">let</span> warning <span class=\"operator\">=</span> <span class=\"type\">Flag</span>(rawValue: <span class=\"number\">1</span> <span class=\"operator\">&lt;&lt;</span> <span class=\"number\">1</span>) <span class=\"comment\">// 2</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">let</span> info <span class=\"operator\">=</span> <span class=\"type\">Flag</span>(rawValue: <span class=\"number\">1</span> <span class=\"operator\">&lt;&lt;</span> <span class=\"number\">2</span>) <span class=\"comment\">// 4</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">let</span> debug <span class=\"operator\">=</span> <span class=\"type\">Flag</span>(rawValue: <span class=\"number\">1</span> <span class=\"operator\">&lt;&lt;</span> <span class=\"number\">3</span>) <span class=\"comment\">// 8</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">init</span>(<span class=\"params\">rawValue</span>: <span class=\"type\">Int</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.rawValue <span class=\"operator\">=</span> rawValue</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Message-amp-Formatter\"><a href=\"#Message-amp-Formatter\" class=\"headerlink\" title=\"Message &amp; Formatter\"></a>Message &amp; Formatter</h3><p></p>\n<p> <code>Message</code>  format  <code>Formatter</code> </p>\n<p> Pure-Swift <code>Message</code>  <code>struct</code> Value Type <code>class</code> Reference Type<code>Codable</code>, <code>CustomStringConvertible</code>, <code>Equatable</code> </p>\n<p> <code>Formatter</code> logger  format logger  app  Xcode Console  <code>Formatter</code>  <code>protocol</code></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Message</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">let</span> message: <span class=\"type\">String</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">let</span> level: <span class=\"type\">Level</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">let</span> flag: <span class=\"type\">Flag</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">let</span> context: <span class=\"type\">Int</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">let</span> file: <span class=\"type\">String</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">let</span> function: <span class=\"type\">StaticString</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">let</span> line: <span class=\"type\">UInt</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">let</span> timestamp: <span class=\"type\">Date</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">protocol</span> <span class=\"title\">Formatter</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">format</span>(<span class=\"params\">message</span>: <span class=\"type\">Message</span>)</span> -&gt; <span class=\"type\">String</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Logging\"><a href=\"#Logging\" class=\"headerlink\" title=\"Logging\"></a>Logging</h3><p> logger <code>ConsoleLogger</code><code>FileLogger</code>  <code>WebLogger</code>  logger </p>\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">open</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Logging</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">enum</span> <span class=\"title\">Type</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> console</span><br><span class=\"line\">        <span class=\"keyword\">case</span> file</span><br><span class=\"line\">        <span class=\"keyword\">case</span> web</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">open</span> <span class=\"keyword\">var</span> type: <span class=\"type\">Type</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> .console</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">open</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">log</span>(<span class=\"keyword\">_</span> <span class=\"params\">message</span>: <span class=\"type\">String</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">fatalError</span>(<span class=\"string\">&quot;must override this method in subclass.&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">open</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ConsoleLogger</span>: <span class=\"title\">Logging</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"keyword\">open</span> <span class=\"keyword\">var</span> type: <span class=\"type\">Type</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> .console</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"keyword\">open</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">log</span>(<span class=\"keyword\">_</span> <span class=\"params\">message</span>: <span class=\"type\">String</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">open</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FileLogger</span>: <span class=\"title\">Logging</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"keyword\">open</span> <span class=\"keyword\">var</span> type: <span class=\"type\">Type</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> .file</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"keyword\">open</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">log</span>(<span class=\"keyword\">_</span> <span class=\"params\">message</span>: <span class=\"type\">String</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">protocol</span> <span class=\"title\">Logging</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> type: <span class=\"type\">Type</span> &#123; <span class=\"keyword\">get</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">log</span>(<span class=\"keyword\">_</span> <span class=\"params\">message</span>: <span class=\"type\">String</span>)</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">ConsoleLogger</span>: <span class=\"title\">Logging</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> type: <span class=\"type\">Type</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> .console</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">log</span>(<span class=\"keyword\">_</span> <span class=\"params\">message</span>: <span class=\"type\">String</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">FileLogger</span>: <span class=\"title\">Logging</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> type: <span class=\"type\">Type</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> .file</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">log</span>(<span class=\"keyword\">_</span> <span class=\"params\">message</span>: <span class=\"type\">String</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p> logger  <code>protocol extension</code> </p>\n<p> <strong></strong> Swift </p>\n<p> <code>Type</code> <code>enum</code>  Type</p>\n<p> <code>Type</code>  <code>String</code>  <code>name</code>  debug</p>\n<h3 id=\"Interface\"><a href=\"#Interface\" class=\"headerlink\" title=\"Interface\"></a>Interface</h3><p> Logging </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">protocol</span> <span class=\"title\">Logging</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> formatter: <span class=\"type\">Formatter</span> &#123; <span class=\"keyword\">get</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> name: <span class=\"type\">String</span> &#123; <span class=\"keyword\">get</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> level: <span class=\"type\">Level</span> &#123; <span class=\"keyword\">get</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">log</span>(<span class=\"params\">message</span>: <span class=\"type\">Message</span>)</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">flush</span>()</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">start</span>()</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">teardown</span>()</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">Logging</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> name: <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;Unified&quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">flush</span>()</span> &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">start</span>()</span> &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">teardown</span>()</span> &#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Logger\"><a href=\"#Logger\" class=\"headerlink\" title=\"Logger\"></a>Logger</h3><p> <code>logger</code>  <code>logger</code>  <code>log(message:)</code>  <code>logger</code> <code>logger</code></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Logger</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">let</span> shared <span class=\"operator\">=</span> <span class=\"type\">Logger</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">var</span> queue <span class=\"operator\">=</span> <span class=\"type\">DispatchQueue</span>(label: <span class=\"string\">&quot;com.xspyhack.logger.queue&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">private(set)</span> <span class=\"keyword\">var</span> loggers: <span class=\"type\">Set</span>&lt;<span class=\"type\">AnyLogger</span>&gt; <span class=\"operator\">=</span> []</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">deinit</span> &#123;</span><br><span class=\"line\">        loggers.forEach &#123;</span><br><span class=\"line\">            <span class=\"variable\">$0</span>.teardown()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        loggers <span class=\"operator\">=</span> []</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">Logger</span> </span>&#123;</span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">add</span>(<span class=\"keyword\">_</span> <span class=\"params\">logger</span>: <span class=\"type\">Logging</span>)</span> &#123;</span><br><span class=\"line\">        loggers.update(with: logger)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">Logger</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">log</span>(<span class=\"params\">message</span>: <span class=\"type\">Message</span>, <span class=\"params\">asynchronous</span>: <span class=\"type\">Bool</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> work <span class=\"operator\">=</span> <span class=\"type\">DispatchWorkItem</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">self</span>.loggers.forEach &#123; logger <span class=\"keyword\">in</span></span><br><span class=\"line\">                <span class=\"keyword\">guard</span> message.flag.rawValue <span class=\"operator\">&amp;</span> logger.level.rawValue <span class=\"operator\">!=</span> <span class=\"number\">0</span> <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                logger.log(message: message)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> asynchronous &#123;</span><br><span class=\"line\">            queue.async(execute: work)</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            queue.sync(execute: work)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">start</span>()</span> &#123;</span><br><span class=\"line\">        loggers.forEach &#123;</span><br><span class=\"line\">            <span class=\"variable\">$0</span>.start()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">flush</span>()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> work <span class=\"operator\">=</span> <span class=\"type\">DispatchWorkItem</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">self</span>.loggers.forEach &#123; logger <span class=\"keyword\">in</span></span><br><span class=\"line\">                logger.flush()</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        queue.sync(execute: work)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>loggers</code>  <code>logger</code> </p>\n<h3 id=\"Log\"><a href=\"#Log\" class=\"headerlink\" title=\"Log\"></a>Log</h3><p> <code>Logging</code>  <code>logger</code> <code>logger</code>  <code>Logger</code> <del>Charmander</del> Logging System</p>\n<p> <code>loggers</code>  <code>Formatter</code> <code>Logger</code>  log   <code>Message</code> <code>Logger.shared.log(message:)</code> </p>\n<p> <code>Message</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">log</span>(<span class=\"keyword\">_</span> <span class=\"params\">message</span>: <span class=\"keyword\">@autoclosure</span> () -&gt; <span class=\"type\">String</span>, <span class=\"params\">level</span>: <span class=\"type\">Level</span>, <span class=\"params\">flag</span>: <span class=\"type\">Flag</span>, <span class=\"params\">context</span>: <span class=\"type\">Int</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>, <span class=\"params\">file</span>: <span class=\"type\">String</span> <span class=\"operator\">=</span> #file, <span class=\"params\">function</span>: <span class=\"type\">StaticString</span> <span class=\"operator\">=</span> #function, <span class=\"params\">line</span>: <span class=\"type\">UInt</span> <span class=\"operator\">=</span> #line, <span class=\"params\">asynchronous</span>: <span class=\"type\">Bool</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> message <span class=\"operator\">=</span> <span class=\"type\">Message</span>(message: message(), level: level, flag: flag, context: context, file: file, function: function, line: line, timestamp: <span class=\"type\">Date</span>())</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">Logger</span>.shared.log(message: message, asynchronous: asynchronous)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>level</code>  <code>flag</code>  <code>print</code>  log  <code>level</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">Log</span>.d(<span class=\"string\">&quot;This is a debug level log&quot;</span>)</span><br><span class=\"line\"><span class=\"type\">Log</span>.i(<span class=\"string\">&quot;This is an info level log&quot;</span>)</span><br><span class=\"line\"><span class=\"type\">Log</span>.w(<span class=\"string\">&quot;This is a warning level log&quot;</span>)</span><br><span class=\"line\"><span class=\"type\">Log</span>.e(<span class=\"string\">&quot;This is an error level log&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> <code>log</code>  message  <code>@autoclosure</code></p>\n</blockquote>\n<blockquote>\n<p><code>Swift.print</code> </p>\n</blockquote>\n<h2 id=\"Implementation\"><a href=\"#Implementation\" class=\"headerlink\" title=\"Implementation\"></a>Implementation</h2><p><a href=\"https://github.com/xspyhack/Keldeo\">GitHub - xspyhack/Keldeo: A lightweight logging library written in Swift.</a></p>\n<h3 id=\"Why-AnyLogger\"><a href=\"#Why-AnyLogger\" class=\"headerlink\" title=\"Why AnyLogger\"></a>Why AnyLogger</h3><p> <code>AnyLogger</code> <code>logger</code>  Xcode  <code>logger</code>  <code>WebLogger</code>  <code>logger</code>  <code>logger</code>  <code>Equatable</code> <code>loggers</code> </p>\n<blockquote>\n<p>Why <code>protocol Logging: Equatable &#123;&#125;</code> needs <code>AnyLogger</code> <a href=\"http://blessingsoft.com/2018/08/26/pats/\">PATs</a></p>\n</blockquote>\n<h2 id=\"Ref\"><a href=\"#Ref\" class=\"headerlink\" title=\"Ref\"></a>Ref</h2><ul>\n<li><a href=\"https://github.com/CocoaLumberjack/CocoaLumberjack\">GitHub - CocoaLumberjack/CocoaLumberjack: A fast &amp; simple, yet powerful &amp; flexible logging framework for Mac and iOS</a></li>\n<li><a href=\"https://github.com/onevcat/Kingfisher/blob/master/Sources/ImageCache.swift\">Kingfisher/ImageCache.swift at master  onevcat/Kingfisher  GitHub</a></li>\n<li><a href=\"https://github.com/apple/swift/blob/swift-3.0-branch/stdlib/public/core/AnyHashable.swift\">swift/AnyHashable.swift at swift-3.0-branch  apple/swift  GitHub</a></li>\n</ul>\n"},{"title":"HTTP Streaming/Chunked 2","date":"2020-04-25T12:00:00.000Z","_content":"## TL;DR\n\n`Azure`  `Cocoa`  `chunk`  `Cocoa` `HTTP/1.1`  `chunk`  `chunk`  `CRLF` `Cocoa`  `CRLF`  `chunk`  `chunk`  `chunk`  `chunk` `chunk`  `chunk`  `Azure`  `chunk`  `CRLF` `downlink` \n\n## Chunked Transfer Encoding\n\n `HTTP/1.1`  [RFC](https://www.w3.org/Protocols/rfc2616/rfc2616-sec3.html)  `Chunked Transfer Encoding` \n\n```yaml\nChunked-Body   = *chunk\n                last-chunk\n                trailer\n                CRLF\nchunk          = chunk-size [ chunk-extension ] CRLF\n                chunk-data CRLF\nchunk-size     = 1*HEX\nlast-chunk     = 1*(\"0\") [ chunk-extension ] CRLF\nchunk-extension= *( \";\" chunk-ext-name [ \"=\" chunk-ext-val ] )\nchunk-ext-name = token\nchunk-ext-val  = token | quoted-string\nchunk-data     = chunk-size(OCTET)\ntrailer        = *(entity-header CRLF)\n```\n\n `chunk`  `chunk`  16  `chunk-size`  `CRLF` `chunk-data` `CRLF`\n\n```yaml\nchunk          = chunk-size [ chunk-extension ] CRLF\n                chunk-data CRLF\n```\n\n `Cocoa`  [CFHTTPFilter.c](https://opensource.apple.com/source/CFNetwork/CFNetwork-128.2/HTTP/CFHTTPFilter.c.auto.html) `RFC`  `chunk header`  `first chunk`  `CRLF` `leading CRLF` `chunk`  `CRLF`\n\n```objc\n// CFIndex <= uint64 so no more than 16 characters to encode + 2 for CRLF + 2 for leading CRLF\n#define MAX_CHUNK_HEADER_SIZE (20)\nstatic void sendChunkHeader(CFWriteStreamRef stream, CFIndex chunkLength, Boolean firstChunk, CFStreamError *error) {\n    // hex representation of chunkLength, followed by CRLF\n    UInt8 writeBuffer[MAX_CHUNK_HEADER_SIZE];\n    UInt8 *writeBase;\n    CFIndex bytesWritten;\n    error->error = 0;\n    writeBuffer[MAX_CHUNK_HEADER_SIZE - 1] = '\\n';\n    writeBuffer[MAX_CHUNK_HEADER_SIZE - 2] = '\\r';\n    writeBase = &(writeBuffer[MAX_CHUNK_HEADER_SIZE-3]); \n    while (chunkLength > 0) {\n        int nextDigit = chunkLength & 0xF;\n        *writeBase = nextDigit < 10 ? '0' + nextDigit : 'A' + nextDigit - 10;\n        writeBase --;\n        chunkLength = chunkLength >> 4;\n    }\n    if (firstChunk) {\n        writeBase ++;\n    } else {\n        *writeBase = '\\n';\n        writeBase --;\n        *writeBase = '\\r';\n    }\n    while (writeBase < writeBuffer + MAX_CHUNK_HEADER_SIZE) {\n        bytesWritten = CFWriteStreamWrite(stream, writeBase, writeBuffer + MAX_CHUNK_HEADER_SIZE - writeBase);\n        if (bytesWritten < 0) {\n            *error = CFWriteStreamGetError(stream);\n            break;\n        } else if (bytesWritten == 0) {\n            // Premature EOF; can we come up with a better error code?\n            error->domain = kCFStreamErrorDomainHTTP;\n            error->error = kCFStreamErrorHTTPParseFailure;\n            break;\n        } else {\n            writeBase += bytesWritten;\n        }\n    }\n}\n```\n\n\n\n```yaml\n7\\r\\n\nChunk_1\\r\\n\n7\\r\\n\nChunk_2\\r\\n\n```\n\n `Cocoa` \n\n```yaml\n7\\r\\n\nChunk_1\n\\r\\n\n7\\r\\n\nChunk_2\n```\n\n## \n\n `Cocoa`  `Azure`  ****  `Azure`  `chunk`\n\n###  CRLF\n\n `Azure`  `CRLF` `chunk`  `CRLF`  `CRLF`  `chunk-size`  `chunk`  `CRLFCRLF` `chunk`  `0CRLFCRLF` `CRLFCRLF` \n\n###  chunk\n\n `CRLF` `name_channel`  `chunk` `Azure` \n\n```yaml\nC\\r\\n\nname_channel\n\n\\r\\n\n2\\r\\n\nOK\n```\n\n `chunk` `\\r\\n` \n\n```yaml\nC\\r\\nname_channel\\r\\n2\\r\\nOK\n```\n\n `Azure`  `chunk` `C\\r\\nname_channel\\r\\n` `chunk`  `CRLF` `Azure`  `name_channel`  `chunk` \n\n `chunk`  `chunk` `ack`  `ack` \n\n### libcurl\n\n `libcurl`  `chunk`  `CRLF`\n\n## Conclusion\n\nA  B B  C C  A  A  C  A  C \n\n `chunk`  `http`  `https` `Azure CDN` \n\n [HTTP request smuggling - Wikipedia](https://en.wikipedia.org/wiki/HTTP_request_smuggling)  `Azure` ","source":"_posts/http-chunked-2.md","raw":"---\ntitle: HTTP Streaming/Chunked 2\ndate: 2020-04-25 20:00:00\ntags:\n    - swift\n    - chunked\n    - streaming\n    - http\ncategories: networking\n---\n## TL;DR\n\n`Azure`  `Cocoa`  `chunk`  `Cocoa` `HTTP/1.1`  `chunk`  `chunk`  `CRLF` `Cocoa`  `CRLF`  `chunk`  `chunk`  `chunk`  `chunk` `chunk`  `chunk`  `Azure`  `chunk`  `CRLF` `downlink` \n\n## Chunked Transfer Encoding\n\n `HTTP/1.1`  [RFC](https://www.w3.org/Protocols/rfc2616/rfc2616-sec3.html)  `Chunked Transfer Encoding` \n\n```yaml\nChunked-Body   = *chunk\n                last-chunk\n                trailer\n                CRLF\nchunk          = chunk-size [ chunk-extension ] CRLF\n                chunk-data CRLF\nchunk-size     = 1*HEX\nlast-chunk     = 1*(\"0\") [ chunk-extension ] CRLF\nchunk-extension= *( \";\" chunk-ext-name [ \"=\" chunk-ext-val ] )\nchunk-ext-name = token\nchunk-ext-val  = token | quoted-string\nchunk-data     = chunk-size(OCTET)\ntrailer        = *(entity-header CRLF)\n```\n\n `chunk`  `chunk`  16  `chunk-size`  `CRLF` `chunk-data` `CRLF`\n\n```yaml\nchunk          = chunk-size [ chunk-extension ] CRLF\n                chunk-data CRLF\n```\n\n `Cocoa`  [CFHTTPFilter.c](https://opensource.apple.com/source/CFNetwork/CFNetwork-128.2/HTTP/CFHTTPFilter.c.auto.html) `RFC`  `chunk header`  `first chunk`  `CRLF` `leading CRLF` `chunk`  `CRLF`\n\n```objc\n// CFIndex <= uint64 so no more than 16 characters to encode + 2 for CRLF + 2 for leading CRLF\n#define MAX_CHUNK_HEADER_SIZE (20)\nstatic void sendChunkHeader(CFWriteStreamRef stream, CFIndex chunkLength, Boolean firstChunk, CFStreamError *error) {\n    // hex representation of chunkLength, followed by CRLF\n    UInt8 writeBuffer[MAX_CHUNK_HEADER_SIZE];\n    UInt8 *writeBase;\n    CFIndex bytesWritten;\n    error->error = 0;\n    writeBuffer[MAX_CHUNK_HEADER_SIZE - 1] = '\\n';\n    writeBuffer[MAX_CHUNK_HEADER_SIZE - 2] = '\\r';\n    writeBase = &(writeBuffer[MAX_CHUNK_HEADER_SIZE-3]); \n    while (chunkLength > 0) {\n        int nextDigit = chunkLength & 0xF;\n        *writeBase = nextDigit < 10 ? '0' + nextDigit : 'A' + nextDigit - 10;\n        writeBase --;\n        chunkLength = chunkLength >> 4;\n    }\n    if (firstChunk) {\n        writeBase ++;\n    } else {\n        *writeBase = '\\n';\n        writeBase --;\n        *writeBase = '\\r';\n    }\n    while (writeBase < writeBuffer + MAX_CHUNK_HEADER_SIZE) {\n        bytesWritten = CFWriteStreamWrite(stream, writeBase, writeBuffer + MAX_CHUNK_HEADER_SIZE - writeBase);\n        if (bytesWritten < 0) {\n            *error = CFWriteStreamGetError(stream);\n            break;\n        } else if (bytesWritten == 0) {\n            // Premature EOF; can we come up with a better error code?\n            error->domain = kCFStreamErrorDomainHTTP;\n            error->error = kCFStreamErrorHTTPParseFailure;\n            break;\n        } else {\n            writeBase += bytesWritten;\n        }\n    }\n}\n```\n\n\n\n```yaml\n7\\r\\n\nChunk_1\\r\\n\n7\\r\\n\nChunk_2\\r\\n\n```\n\n `Cocoa` \n\n```yaml\n7\\r\\n\nChunk_1\n\\r\\n\n7\\r\\n\nChunk_2\n```\n\n## \n\n `Cocoa`  `Azure`  ****  `Azure`  `chunk`\n\n###  CRLF\n\n `Azure`  `CRLF` `chunk`  `CRLF`  `CRLF`  `chunk-size`  `chunk`  `CRLFCRLF` `chunk`  `0CRLFCRLF` `CRLFCRLF` \n\n###  chunk\n\n `CRLF` `name_channel`  `chunk` `Azure` \n\n```yaml\nC\\r\\n\nname_channel\n\n\\r\\n\n2\\r\\n\nOK\n```\n\n `chunk` `\\r\\n` \n\n```yaml\nC\\r\\nname_channel\\r\\n2\\r\\nOK\n```\n\n `Azure`  `chunk` `C\\r\\nname_channel\\r\\n` `chunk`  `CRLF` `Azure`  `name_channel`  `chunk` \n\n `chunk`  `chunk` `ack`  `ack` \n\n### libcurl\n\n `libcurl`  `chunk`  `CRLF`\n\n## Conclusion\n\nA  B B  C C  A  A  C  A  C \n\n `chunk`  `http`  `https` `Azure CDN` \n\n [HTTP request smuggling - Wikipedia](https://en.wikipedia.org/wiki/HTTP_request_smuggling)  `Azure` ","slug":"http-chunked-2","published":1,"updated":"2022-01-02T11:41:18.349Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckxx810xb000b9ith7wjda3v3","content":"<h2 id=\"TL-DR\"><a href=\"#TL-DR\" class=\"headerlink\" title=\"TL;DR\"></a>TL;DR</h2><p><code>Azure</code>  <code>Cocoa</code>  <code>chunk</code>  <code>Cocoa</code> <code>HTTP/1.1</code>  <code>chunk</code>  <code>chunk</code>  <code>CRLF</code> <code>Cocoa</code>  <code>CRLF</code>  <code>chunk</code>  <code>chunk</code>  <code>chunk</code>  <code>chunk</code> <code>chunk</code>  <code>chunk</code>  <code>Azure</code>  <code>chunk</code>  <code>CRLF</code> <code>downlink</code> </p>\n<h2 id=\"Chunked-Transfer-Encoding\"><a href=\"#Chunked-Transfer-Encoding\" class=\"headerlink\" title=\"Chunked Transfer Encoding\"></a>Chunked Transfer Encoding</h2><p> <code>HTTP/1.1</code>  <a href=\"https://www.w3.org/Protocols/rfc2616/rfc2616-sec3.html\">RFC</a>  <code>Chunked Transfer Encoding</code> </p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">Chunked-Body</span>   <span class=\"string\">=</span> <span class=\"meta\">*chunk</span></span><br><span class=\"line\">                <span class=\"string\">last-chunk</span></span><br><span class=\"line\">                <span class=\"string\">trailer</span></span><br><span class=\"line\">                <span class=\"string\">CRLF</span></span><br><span class=\"line\"><span class=\"string\">chunk</span>          <span class=\"string\">=</span> <span class=\"string\">chunk-size</span> [ <span class=\"string\">chunk-extension</span> ] <span class=\"string\">CRLF</span></span><br><span class=\"line\">                <span class=\"string\">chunk-data</span> <span class=\"string\">CRLF</span></span><br><span class=\"line\"><span class=\"string\">chunk-size</span>     <span class=\"string\">=</span> <span class=\"number\">1</span><span class=\"meta\">*HEX</span></span><br><span class=\"line\"><span class=\"string\">last-chunk</span>     <span class=\"string\">=</span> <span class=\"number\">1</span><span class=\"string\">*(&quot;0&quot;)</span> [ <span class=\"string\">chunk-extension</span> ] <span class=\"string\">CRLF</span></span><br><span class=\"line\"><span class=\"string\">chunk-extension=</span> <span class=\"string\">*(</span> <span class=\"string\">&quot;;&quot;</span> <span class=\"string\">chunk-ext-name</span> [ <span class=\"string\">&quot;=&quot;</span> <span class=\"string\">chunk-ext-val</span> ] <span class=\"string\">)</span></span><br><span class=\"line\"><span class=\"string\">chunk-ext-name</span> <span class=\"string\">=</span> <span class=\"string\">token</span></span><br><span class=\"line\"><span class=\"string\">chunk-ext-val</span>  <span class=\"string\">=</span> <span class=\"string\">token</span> <span class=\"string\">|</span> <span class=\"string\">quoted-string</span></span><br><span class=\"line\"><span class=\"string\">chunk-data</span>     <span class=\"string\">=</span> <span class=\"string\">chunk-size(OCTET)</span></span><br><span class=\"line\"><span class=\"string\">trailer</span>        <span class=\"string\">=</span> <span class=\"string\">*(entity-header</span> <span class=\"string\">CRLF)</span></span><br></pre></td></tr></table></figure>\n\n<p> <code>chunk</code>  <code>chunk</code>  16  <code>chunk-size</code>  <code>CRLF</code> <code>chunk-data</code> <code>CRLF</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">chunk</span>          <span class=\"string\">=</span> <span class=\"string\">chunk-size</span> [ <span class=\"string\">chunk-extension</span> ] <span class=\"string\">CRLF</span></span><br><span class=\"line\">                <span class=\"string\">chunk-data</span> <span class=\"string\">CRLF</span></span><br></pre></td></tr></table></figure>\n\n<p> <code>Cocoa</code>  <a href=\"https://opensource.apple.com/source/CFNetwork/CFNetwork-128.2/HTTP/CFHTTPFilter.c.auto.html\">CFHTTPFilter.c</a> <code>RFC</code>  <code>chunk header</code>  <code>first chunk</code>  <code>CRLF</code> <code>leading CRLF</code> <code>chunk</code>  <code>CRLF</code></p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// CFIndex &lt;= uint64 so no more than 16 characters to encode + 2 for CRLF + 2 for leading CRLF</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MAX_CHUNK_HEADER_SIZE (20)</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> sendChunkHeader(<span class=\"built_in\">CFWriteStreamRef</span> stream, <span class=\"built_in\">CFIndex</span> chunkLength, Boolean firstChunk, <span class=\"built_in\">CFStreamError</span> *error) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// hex representation of chunkLength, followed by CRLF</span></span><br><span class=\"line\">    <span class=\"built_in\">UInt8</span> writeBuffer[MAX_CHUNK_HEADER_SIZE];</span><br><span class=\"line\">    <span class=\"built_in\">UInt8</span> *writeBase;</span><br><span class=\"line\">    <span class=\"built_in\">CFIndex</span> bytesWritten;</span><br><span class=\"line\">    error-&gt;error = <span class=\"number\">0</span>;</span><br><span class=\"line\">    writeBuffer[MAX_CHUNK_HEADER_SIZE - <span class=\"number\">1</span>] = <span class=\"string\">&#x27;\\n&#x27;</span>;</span><br><span class=\"line\">    writeBuffer[MAX_CHUNK_HEADER_SIZE - <span class=\"number\">2</span>] = <span class=\"string\">&#x27;\\r&#x27;</span>;</span><br><span class=\"line\">    writeBase = &amp;(writeBuffer[MAX_CHUNK_HEADER_SIZE<span class=\"number\">-3</span>]); </span><br><span class=\"line\">    <span class=\"keyword\">while</span> (chunkLength &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> nextDigit = chunkLength &amp; <span class=\"number\">0xF</span>;</span><br><span class=\"line\">        *writeBase = nextDigit &lt; <span class=\"number\">10</span> ? <span class=\"string\">&#x27;0&#x27;</span> + nextDigit : <span class=\"string\">&#x27;A&#x27;</span> + nextDigit - <span class=\"number\">10</span>;</span><br><span class=\"line\">        writeBase --;</span><br><span class=\"line\">        chunkLength = chunkLength &gt;&gt; <span class=\"number\">4</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (firstChunk) &#123;</span><br><span class=\"line\">        writeBase ++;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        *writeBase = <span class=\"string\">&#x27;\\n&#x27;</span>;</span><br><span class=\"line\">        writeBase --;</span><br><span class=\"line\">        *writeBase = <span class=\"string\">&#x27;\\r&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (writeBase &lt; writeBuffer + MAX_CHUNK_HEADER_SIZE) &#123;</span><br><span class=\"line\">        bytesWritten = <span class=\"built_in\">CFWriteStreamWrite</span>(stream, writeBase, writeBuffer + MAX_CHUNK_HEADER_SIZE - writeBase);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (bytesWritten &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            *error = <span class=\"built_in\">CFWriteStreamGetError</span>(stream);</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (bytesWritten == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// Premature EOF; can we come up with a better error code?</span></span><br><span class=\"line\">            error-&gt;domain = kCFStreamErrorDomainHTTP;</span><br><span class=\"line\">            error-&gt;error = kCFStreamErrorHTTPParseFailure;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            writeBase += bytesWritten;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">7</span><span class=\"string\">\\r\\n</span></span><br><span class=\"line\"><span class=\"string\">Chunk_1\\r\\n</span></span><br><span class=\"line\"><span class=\"number\">7</span><span class=\"string\">\\r\\n</span></span><br><span class=\"line\"><span class=\"string\">Chunk_2\\r\\n</span></span><br></pre></td></tr></table></figure>\n\n<p> <code>Cocoa</code> </p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">7</span><span class=\"string\">\\r\\n</span></span><br><span class=\"line\"><span class=\"string\">Chunk_1</span></span><br><span class=\"line\"><span class=\"string\">\\r\\n</span></span><br><span class=\"line\"><span class=\"number\">7</span><span class=\"string\">\\r\\n</span></span><br><span class=\"line\"><span class=\"string\">Chunk_2</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> <code>Cocoa</code>  <code>Azure</code>  <strong></strong>  <code>Azure</code>  <code>chunk</code></p>\n<h3 id=\"-CRLF\"><a href=\"#-CRLF\" class=\"headerlink\" title=\" CRLF\"></a> CRLF</h3><p> <code>Azure</code>  <code>CRLF</code> <code>chunk</code>  <code>CRLF</code>  <code>CRLF</code>  <code>chunk-size</code>  <code>chunk</code>  <code>CRLFCRLF</code> <code>chunk</code>  <code>0CRLFCRLF</code> <code>CRLFCRLF</code> </p>\n<h3 id=\"-chunk\"><a href=\"#-chunk\" class=\"headerlink\" title=\" chunk\"></a> chunk</h3><p> <code>CRLF</code> <code>name_channel</code>  <code>chunk</code> <code>Azure</code> </p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">C\\r\\n</span></span><br><span class=\"line\"><span class=\"string\">name_channel</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">\\r\\n</span></span><br><span class=\"line\"><span class=\"number\">2</span><span class=\"string\">\\r\\n</span></span><br><span class=\"line\"><span class=\"string\">OK</span></span><br></pre></td></tr></table></figure>\n\n<p> <code>chunk</code> <code>\\r\\n</code> </p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">C\\r\\nname_channel\\r\\n2\\r\\nOK</span></span><br></pre></td></tr></table></figure>\n\n<p> <code>Azure</code>  <code>chunk</code> <code>C\\r\\nname_channel\\r\\n</code> <code>chunk</code>  <code>CRLF</code> <code>Azure</code>  <code>name_channel</code>  <code>chunk</code> </p>\n<p> <code>chunk</code>  <code>chunk</code> <code>ack</code>  <code>ack</code> </p>\n<h3 id=\"libcurl\"><a href=\"#libcurl\" class=\"headerlink\" title=\"libcurl\"></a>libcurl</h3><p> <code>libcurl</code>  <code>chunk</code>  <code>CRLF</code></p>\n<h2 id=\"Conclusion\"><a href=\"#Conclusion\" class=\"headerlink\" title=\"Conclusion\"></a>Conclusion</h2><p>A  B B  C C  A  A  C  A  C </p>\n<p> <code>chunk</code>  <code>http</code>  <code>https</code> <code>Azure CDN</code> </p>\n<p> <a href=\"https://en.wikipedia.org/wiki/HTTP_request_smuggling\">HTTP request smuggling - Wikipedia</a>  <code>Azure</code> </p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"TL-DR\"><a href=\"#TL-DR\" class=\"headerlink\" title=\"TL;DR\"></a>TL;DR</h2><p><code>Azure</code>  <code>Cocoa</code>  <code>chunk</code>  <code>Cocoa</code> <code>HTTP/1.1</code>  <code>chunk</code>  <code>chunk</code>  <code>CRLF</code> <code>Cocoa</code>  <code>CRLF</code>  <code>chunk</code>  <code>chunk</code>  <code>chunk</code>  <code>chunk</code> <code>chunk</code>  <code>chunk</code>  <code>Azure</code>  <code>chunk</code>  <code>CRLF</code> <code>downlink</code> </p>\n<h2 id=\"Chunked-Transfer-Encoding\"><a href=\"#Chunked-Transfer-Encoding\" class=\"headerlink\" title=\"Chunked Transfer Encoding\"></a>Chunked Transfer Encoding</h2><p> <code>HTTP/1.1</code>  <a href=\"https://www.w3.org/Protocols/rfc2616/rfc2616-sec3.html\">RFC</a>  <code>Chunked Transfer Encoding</code> </p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">Chunked-Body</span>   <span class=\"string\">=</span> <span class=\"meta\">*chunk</span></span><br><span class=\"line\">                <span class=\"string\">last-chunk</span></span><br><span class=\"line\">                <span class=\"string\">trailer</span></span><br><span class=\"line\">                <span class=\"string\">CRLF</span></span><br><span class=\"line\"><span class=\"string\">chunk</span>          <span class=\"string\">=</span> <span class=\"string\">chunk-size</span> [ <span class=\"string\">chunk-extension</span> ] <span class=\"string\">CRLF</span></span><br><span class=\"line\">                <span class=\"string\">chunk-data</span> <span class=\"string\">CRLF</span></span><br><span class=\"line\"><span class=\"string\">chunk-size</span>     <span class=\"string\">=</span> <span class=\"number\">1</span><span class=\"meta\">*HEX</span></span><br><span class=\"line\"><span class=\"string\">last-chunk</span>     <span class=\"string\">=</span> <span class=\"number\">1</span><span class=\"string\">*(&quot;0&quot;)</span> [ <span class=\"string\">chunk-extension</span> ] <span class=\"string\">CRLF</span></span><br><span class=\"line\"><span class=\"string\">chunk-extension=</span> <span class=\"string\">*(</span> <span class=\"string\">&quot;;&quot;</span> <span class=\"string\">chunk-ext-name</span> [ <span class=\"string\">&quot;=&quot;</span> <span class=\"string\">chunk-ext-val</span> ] <span class=\"string\">)</span></span><br><span class=\"line\"><span class=\"string\">chunk-ext-name</span> <span class=\"string\">=</span> <span class=\"string\">token</span></span><br><span class=\"line\"><span class=\"string\">chunk-ext-val</span>  <span class=\"string\">=</span> <span class=\"string\">token</span> <span class=\"string\">|</span> <span class=\"string\">quoted-string</span></span><br><span class=\"line\"><span class=\"string\">chunk-data</span>     <span class=\"string\">=</span> <span class=\"string\">chunk-size(OCTET)</span></span><br><span class=\"line\"><span class=\"string\">trailer</span>        <span class=\"string\">=</span> <span class=\"string\">*(entity-header</span> <span class=\"string\">CRLF)</span></span><br></pre></td></tr></table></figure>\n\n<p> <code>chunk</code>  <code>chunk</code>  16  <code>chunk-size</code>  <code>CRLF</code> <code>chunk-data</code> <code>CRLF</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">chunk</span>          <span class=\"string\">=</span> <span class=\"string\">chunk-size</span> [ <span class=\"string\">chunk-extension</span> ] <span class=\"string\">CRLF</span></span><br><span class=\"line\">                <span class=\"string\">chunk-data</span> <span class=\"string\">CRLF</span></span><br></pre></td></tr></table></figure>\n\n<p> <code>Cocoa</code>  <a href=\"https://opensource.apple.com/source/CFNetwork/CFNetwork-128.2/HTTP/CFHTTPFilter.c.auto.html\">CFHTTPFilter.c</a> <code>RFC</code>  <code>chunk header</code>  <code>first chunk</code>  <code>CRLF</code> <code>leading CRLF</code> <code>chunk</code>  <code>CRLF</code></p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// CFIndex &lt;= uint64 so no more than 16 characters to encode + 2 for CRLF + 2 for leading CRLF</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MAX_CHUNK_HEADER_SIZE (20)</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> sendChunkHeader(<span class=\"built_in\">CFWriteStreamRef</span> stream, <span class=\"built_in\">CFIndex</span> chunkLength, Boolean firstChunk, <span class=\"built_in\">CFStreamError</span> *error) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// hex representation of chunkLength, followed by CRLF</span></span><br><span class=\"line\">    <span class=\"built_in\">UInt8</span> writeBuffer[MAX_CHUNK_HEADER_SIZE];</span><br><span class=\"line\">    <span class=\"built_in\">UInt8</span> *writeBase;</span><br><span class=\"line\">    <span class=\"built_in\">CFIndex</span> bytesWritten;</span><br><span class=\"line\">    error-&gt;error = <span class=\"number\">0</span>;</span><br><span class=\"line\">    writeBuffer[MAX_CHUNK_HEADER_SIZE - <span class=\"number\">1</span>] = <span class=\"string\">&#x27;\\n&#x27;</span>;</span><br><span class=\"line\">    writeBuffer[MAX_CHUNK_HEADER_SIZE - <span class=\"number\">2</span>] = <span class=\"string\">&#x27;\\r&#x27;</span>;</span><br><span class=\"line\">    writeBase = &amp;(writeBuffer[MAX_CHUNK_HEADER_SIZE<span class=\"number\">-3</span>]); </span><br><span class=\"line\">    <span class=\"keyword\">while</span> (chunkLength &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> nextDigit = chunkLength &amp; <span class=\"number\">0xF</span>;</span><br><span class=\"line\">        *writeBase = nextDigit &lt; <span class=\"number\">10</span> ? <span class=\"string\">&#x27;0&#x27;</span> + nextDigit : <span class=\"string\">&#x27;A&#x27;</span> + nextDigit - <span class=\"number\">10</span>;</span><br><span class=\"line\">        writeBase --;</span><br><span class=\"line\">        chunkLength = chunkLength &gt;&gt; <span class=\"number\">4</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (firstChunk) &#123;</span><br><span class=\"line\">        writeBase ++;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        *writeBase = <span class=\"string\">&#x27;\\n&#x27;</span>;</span><br><span class=\"line\">        writeBase --;</span><br><span class=\"line\">        *writeBase = <span class=\"string\">&#x27;\\r&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (writeBase &lt; writeBuffer + MAX_CHUNK_HEADER_SIZE) &#123;</span><br><span class=\"line\">        bytesWritten = <span class=\"built_in\">CFWriteStreamWrite</span>(stream, writeBase, writeBuffer + MAX_CHUNK_HEADER_SIZE - writeBase);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (bytesWritten &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            *error = <span class=\"built_in\">CFWriteStreamGetError</span>(stream);</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (bytesWritten == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// Premature EOF; can we come up with a better error code?</span></span><br><span class=\"line\">            error-&gt;domain = kCFStreamErrorDomainHTTP;</span><br><span class=\"line\">            error-&gt;error = kCFStreamErrorHTTPParseFailure;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            writeBase += bytesWritten;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">7</span><span class=\"string\">\\r\\n</span></span><br><span class=\"line\"><span class=\"string\">Chunk_1\\r\\n</span></span><br><span class=\"line\"><span class=\"number\">7</span><span class=\"string\">\\r\\n</span></span><br><span class=\"line\"><span class=\"string\">Chunk_2\\r\\n</span></span><br></pre></td></tr></table></figure>\n\n<p> <code>Cocoa</code> </p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">7</span><span class=\"string\">\\r\\n</span></span><br><span class=\"line\"><span class=\"string\">Chunk_1</span></span><br><span class=\"line\"><span class=\"string\">\\r\\n</span></span><br><span class=\"line\"><span class=\"number\">7</span><span class=\"string\">\\r\\n</span></span><br><span class=\"line\"><span class=\"string\">Chunk_2</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> <code>Cocoa</code>  <code>Azure</code>  <strong></strong>  <code>Azure</code>  <code>chunk</code></p>\n<h3 id=\"-CRLF\"><a href=\"#-CRLF\" class=\"headerlink\" title=\" CRLF\"></a> CRLF</h3><p> <code>Azure</code>  <code>CRLF</code> <code>chunk</code>  <code>CRLF</code>  <code>CRLF</code>  <code>chunk-size</code>  <code>chunk</code>  <code>CRLFCRLF</code> <code>chunk</code>  <code>0CRLFCRLF</code> <code>CRLFCRLF</code> </p>\n<h3 id=\"-chunk\"><a href=\"#-chunk\" class=\"headerlink\" title=\" chunk\"></a> chunk</h3><p> <code>CRLF</code> <code>name_channel</code>  <code>chunk</code> <code>Azure</code> </p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">C\\r\\n</span></span><br><span class=\"line\"><span class=\"string\">name_channel</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">\\r\\n</span></span><br><span class=\"line\"><span class=\"number\">2</span><span class=\"string\">\\r\\n</span></span><br><span class=\"line\"><span class=\"string\">OK</span></span><br></pre></td></tr></table></figure>\n\n<p> <code>chunk</code> <code>\\r\\n</code> </p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">C\\r\\nname_channel\\r\\n2\\r\\nOK</span></span><br></pre></td></tr></table></figure>\n\n<p> <code>Azure</code>  <code>chunk</code> <code>C\\r\\nname_channel\\r\\n</code> <code>chunk</code>  <code>CRLF</code> <code>Azure</code>  <code>name_channel</code>  <code>chunk</code> </p>\n<p> <code>chunk</code>  <code>chunk</code> <code>ack</code>  <code>ack</code> </p>\n<h3 id=\"libcurl\"><a href=\"#libcurl\" class=\"headerlink\" title=\"libcurl\"></a>libcurl</h3><p> <code>libcurl</code>  <code>chunk</code>  <code>CRLF</code></p>\n<h2 id=\"Conclusion\"><a href=\"#Conclusion\" class=\"headerlink\" title=\"Conclusion\"></a>Conclusion</h2><p>A  B B  C C  A  A  C  A  C </p>\n<p> <code>chunk</code>  <code>http</code>  <code>https</code> <code>Azure CDN</code> </p>\n<p> <a href=\"https://en.wikipedia.org/wiki/HTTP_request_smuggling\">HTTP request smuggling - Wikipedia</a>  <code>Azure</code> </p>\n"},{"title":"Parser Combinator","date":"2017-05-28T12:00:00.000Z","_content":"\n\n## Parser\n\n AST\n\n`( 4 + 3  )`  `(`  `4` `` `+` `3`  `)`  ** (AST )\n\n\n`func parser(_ string: String) -> AST`\n\n\n\n`func parser(_ string: String) -> (AST, String)`\n\n `4` `+`  `4`  `+` \n\n`func parser<T>(_ string: String) -> (T, String)?`\n\n 4 \n\n```swift\nfunc parser(_ string: String) -> (Int, String)? {\n    guard let head = string.characters.first, head == \"4\" else {\n        return nil\n    }\n    return Optional.some((4, String(string.characters.dropFirst())))\n}\n```\n\n## Combinator\n\n> One of the distinguishing features of functional programming is the widespread use of combinators to construct programs. *A combinator is a function which builds program fragments from program fragments*; in a sense the programmer using combinators constructs much of the desired program automatically, rather that writing every detail by hand. -- John Hughes\n\n Combinator   \n\n## Parser Combinator\n\n** \n\n```swift\nstruct Parser<A> {\n    let parse: (String) -> (A, String)?\n    // (input) -> (result, remaining)\n}\n```\n\n `Parser`  `parse`  `typealias Parser<Result> = (String) -> (Result, String)?`\n\n\n\n```swift\nstruct Parser<I, O> {\n    let parse: (I) -> (O, I)?\n    // (input) -> (output, remaining input)\n}\n```\n\n `4` \n\n```swift\nfunc character4() -> Parser<Character> {\n    return Parser { input in\n        guard let head = input.characters.first, head == \"4\" else {\n            return nil\n        }\n        return (\"4\", String(input.characters.dropFirst()))\n    }\n}\n```\n\n `func character4() -> Parser<Character>` \n\n```swift\nfunc character(_ character: Character) -> Parser<Character> {\n    return Parser { input in\n        guard let head = input.characters.first, head == character else {\n            return nil\n        }\n        return (head, String(input.characters.dropFirst()))\n    }\n}\n```\n\n `character`  `digit` \n\n```swift\nfunc digit() -> Parser<Character> {\n    return Parser { input in\n        guard let head = input.characters.first, \"0\"...\"9\" ~= head else {\n            return nil\n        }\n        return (head, String(input.characters.dropFirst()))\n    }\n}\n```\n\n `character`  `digit` \n\n```swift\nfunc satisfy(_ condition: @escaping (Character) -> Bool) -> Parser<Character> {\n    return Parser { input in\n        guard let head = input.characters.first, condition(head) else {\n            return nil\n        }\n        return (head, String(input.characters.dropFirst()))\n    }\n}\n```\n\n\n\n`(satisfy { \"0\"...\"9\" ~= $0 }).parse(\"1abc\")`\n\n\n\n```swift\nfunc isSpace(_ character: Character) -> Bool {\n    return String(character).trimmingCharacters(in: .whitespacesAndNewlines).isEmpty\n}\n(satisfy(isSpace)).parse(\" abc\")\n```\n\n `satisfy`  X  x \n\n## Next\n\n `character` `digit`  `alex`  `alex`  `a` `l` `e` `x` 4  `character`  `string` \n\n```swift\nfunc string(_ str: String) -> Parser<String> {\n    let parsers = str.characters.map { character($0) }\n    return Parser { input in\n        var results: [Character] = []\n        var stream = input\n        for parser in parsers {\n            guard let (result, remainder) = parser.parse(stream) {\n                return nil\n            }\n            results.append(result)\n            stream = remainder\n        }\n        return (String(results), stream)\n    }\n}\n```\n\n parse  `(String) -> (A, String)` ****  `alex` \n\n1. \"alex\": 'a' -> ('a', \"lex\")\n2. \"lex\": 'l' -> ('l', \"ex\")\n3. \"ex\": 'e' -> ('e', \"x\")\n4. \"x\": 'x' -> ('x', \"\")\n5. Parser<\"alex\">\n\n** `` **\n\n\n\n```swift\nfunc string(_ str: String) -> Parser<String> {\n    return Parser { input in\n        guard let (head, tail) = uncons(str.characters) else {\n            // 0. \n            return (\"\", input)\n        }\n        // 1. \n        guard let (_, remainder1) = character(head).parse(input) else {\n            return nil\n        }\n        // 2. \n        guard let (_, remainder2) = string1(String(tail)).parse(remainder1) else {\n            return nil\n        }\n        // 3. (\"\", \"\")\n        return (str, remainder2)\n    }\n}\n\nfunc uncons<C: Collection>(_ xs: C) -> (C.Iterator.Element, C.SubSequence)? {\n    guard let head = xs.first else {\n        return nil\n    }\n    return (head, xs.suffix(from: xs.index(after: xs.startIndex)))\n}\n```\n\n 1  2 **** ** `` ** 3  1  2 \n\n\n\n```swift\nfunc discarding<A, B>(_ x: Parser<A>, _ y: Parser<B>) -> Parser<B> {\n    return Parser { input in\n        guard let (_, remainder1) = x.parse(input) else {\n            return nil\n        }\n        guard let (result2, remainder2) = y.parse(remainder1) else {\n            return nil\n        }\n        //  result2 result1\n        return (result2, remainder2)\n    }\n}\n```\n\n`discarding`  ****  `x`  `y`  `discarding`  `string` \n\n```swift\nfunc string(_ str: String) -> Parser<String> {\n    return Parser { input in\n        guard let (head, tail) = uncons(str.characters) else {\n            // \n            return (\"\", input)\n        }\n        // 1  character(head) \n        guard let (_, remainder) = discarding(character(head), string2(String(tail))).parse(input) else {\n            return nil\n        }\n        // 2  (\"\", \"\")\n        return (str, remainder)\n    }\n}\n```\n\n `string`  1  `discarding`  `discarding`  `lift` \n\n `string`  `return Parser {}` `discarding`  `Parser {}`  `lift` `string`  `discarding` \n\n```swift\nfunc string(_ str: String) -> Parser<String> {\n    let lhs = Parser {}\n    let rhs = Parser<String> {}\n    return lift(x, y)\n}\n```\n\n 2  `return (str, remainder)`  `(lhs )` `let rhs = Parser<String> { (str, $0) }` lhs  1 \n\n```swift\nfunc string(_ str: String) -> Parser<String> {\n    guard let (head, tail) = uncons(str.characters) else {\n        // 1 \n        return (\"\", input)\n    }\n    // 2 \n    let lhs = discarding(character(head), string2(String(tail)))\n    // 3 \n    let rhs = Parser<String> { (str, $0) }\n    // 4 \n    return discarding(lhs, rhs)\n}\n```\n\n `Parser` Parser {}  1  `Parser`\n\n```swift\nfunc string(_ str: String) -> Parser<String> {\n    guard let (head, tail) = uncons(str.characters) else {\n        // 1 \n        return Parser<String> { (\"\", $0) }\n    }\n    // 2\n    let lhs = discarding(character(head), string2(String(tail)))\n    // 3\n    let rhs = Parser<String> { (str, $0) }\n    // 4\n    return discarding(lhs, rhs)\n}\n```\n\n 1  3  `\"\"`  `str` \n\n```swift\nfunc string(_ str: String) -> Parser<String> {\n    guard let (head, tail) = uncons(str.characters) else {\n        // 1 \n        return pure(\"\")\n    }\n    // 2\n    let lhs = discarding(character(head), string2(String(tail)))\n    // 3\n    let rhs = pure(str)\n    // 4\n    return discarding(lhs, rhs)\n}\n\n// Lift a value\nfunc pure<A>(_ x: A) -> Parser<A> {\n    return Parser<A> { (x, $0) }\n}\n```\n\n `string` \n\n## Combine\n\n `( 4 + 3  )` `(`  `4`  1  `3`  `)`  2  *many*  *skip* \n\n#### Many\n\n\n\n```swift\nfunc space() -> Parser<Character> {\n    return satisfy(isSpace)\n}\n```\n\n *many*  *many*  parser loop \n\n```swift\nfunc many<A>(_ x: Parser<A>) -> Parser<[A]> {\n    return Parser { input in\n        var results: [A] = []\n        var stream = input\n        while let (result, remainder) = x.parse(stream) {\n            results.append(result)\n            stream = remainder\n        }\n        return (results, stream)\n    }\n}\n```\n\n\n\n```swift\nfunc spaces() -> Parser<[Character]> {\n    return many(space())\n}\n```\n\n`spaces`  `Parser<[Character]>`  parser `Parser<String>`  parser Swift `String([Character])`  `[Character]`  `String`  `many` \n\n```swift\nfunc many<Character>(_ x: Parser<Character>) -> Parser<String> {\n    return Parser { input in\n        var results: [Character] = []\n        var stream = input\n        while let (result, remainder) = x.parse(stream) {\n            results.append(result)\n            stream = remainder\n        }\n        return (String(results), stream)\n    }\n}\n```\n\n A  String  A  Character  `many`  Character  `manyCharacter` `many` \n\n#### Skip\n\n `skip`  `discarding`  `skip` \n\n```swift\nfunc skip<A>(_ x: Parser<A>) -> Parser<Void> {\n    return Parser { input in\n        guard let (_, remainder) = x.parse(input) else {\n            return ((), input)\n        }\n        \n        return ((), remainder)\n    }\n}\n```\n\n `skip`  `spaces` \n\n```swift\nfunc skipSpaces() -> Parser<Void> {\n    return skip(spaces)\n}\n```\n\n#### Many1\n\n `digit`  `digit` `number`  *number*  *many*  *digit* \n\n```swift\nfunc number() -> Parser<[Character]> {\n    return many(digit())\n}\n\nnumber().parse(\"123abc\") // ([\"1\", \"2\", \"3\"], \"abc\")\nnumber().parse(\"abc\") // ([], \"abc\")\n```\n\n`number().parse(\"abc\")`  *string* *space*  *number*  `many` `*`  `+` {0, +}  {1, +}\n\n```swift\nfunc many1<A>(_ x: Parser<A>) -> Parser<[A]> {\n    return Parser { input in\n        // \n        guard let (_, _) = x.parse(input) else {\n            return nil\n        }\n        var results: [A] = []\n        var stream = input\n        while let (result, remainder) = x.parse(stream) {\n            results.append(result)\n            stream = remainder\n        }\n        return (results, stream)\n    }\n}\n```\n\n `number` \n\n```swift\nfunc number() -> Parser<[Character]> {\n    return many1(digit())\n}\n```\n\n `number`  `spaces` `number`  `Int` `[Character]` `manyCharacter`\n\n`[Character]`  `String([Character])`  `String` `digit` character `String([Character])`  `Int(String)`  `number`\n\n Swift  OOP `Combinable` :D\n\n```swift\nprotocol Combinable {\n    static func combine(_ xs: [Character]) -> Self\n}\n\nextension Int: Combinable {\n    \n    static func combine(_ xs: [Character]) -> Int {\n        return Int(String(describing: xs))!\n    }\n}\n\nextension String: Combinable {\n    static func combine(_ xs: [Character]) -> String {\n        return String(describing: xs)\n    }\n}\n\nfunc many1<A: Combinable>(_ x: Parser<Character>) -> Parser<A> {\n    return Parser { input in\n        guard let (_, _) = x.parse(input) else {\n            return nil\n        }\n        var results: [Character] = []\n        var stream = input\n        while let (result, remainder) = x.parse(stream) {\n            results.append(result)\n            stream = remainder\n        }\n        return (A.combine(results), stream)\n    }\n}\n```\n\n\n\n```swift\nfunc number() -> Parser<Int> {\n    return many1(digit())\n}\n\nfunc spaces() -> Parser<String> {\n    return many1(space()) //  spaces \n}\n```\n\n `skipSpaces`  *many*  *skip*  *skip*  *many*  `skip`  `many`  parser  `skipMany`  **Combinator**  parser case\n\n#### Zip\n\n parser  `zip` \n\n```swift\nfunc zip<A, B>(_ x: Parser<A>, _ y: Parser<B>) -> Parser<(A, B)> {\n    return Parser { input in\n        guard let (result1, remainder1) = x.parse(input) else {\n            return nil\n        }\n        guard let (result2, remainder2) = y.parse(remainder1) else {\n            return nil\n        }\n        return ((result1, result2), remainder2)\n    }\n}\n```\n\n#### Choice\n\n `+` `-` `*` `/`\n\n```swift\nfunc opt() -> Parser<Character> {\n    let opts = [\"+\", \"-\", \"*\", \"/\"].map { character($0.characters.first!) }\n    return choice(opts)\n}\n```\n\n```swift\n//  one(of:)\nfunc choice<A, S: Sequence>(_ xs: S) -> Parser<A> where S.Iterator.Element == Parser<A> {\n    return xs.reduce(empty(), { $0 <|> $1 })\n}\n\nfunc empty<A>() -> Parser<A> {\n    return Parser { _ in nil }\n}\n```\n\n## Transform\n\n Protocol  `number`  `space`  `many`  ~~~~ **** `Combinable`  `Parser<A>`  `[A]`  `many` ****  `Parser<[A]`  `Parser<B>` `many`  `many` \n\n `func character(_ character: Character) -> Parser<Character>`  `character(\"4\")` `Parser<Character>`  `parse`  `Character`  `4 + 3`  `4`  `3`  `Character`  `Int`  `Parser<Character>`  `Parser<Int>` \n\n `Parser<A>`  `Parser<B>` `many`  `Parser<A>`  `Parser<[A]>` `number`  `Parser<[A]>`  `Parser<Int>`\n\n### Functor\n\n Swift  Optional  map \n\n```swift\nlet a: Optional<Int> = 1\nlet b: Optional<String> = a.map { String($0) }\n```\n\n `Optional<Int>`  `Optional<String>` `Optional`  `Parser`\n\n`Optional`  `func map<U>(_ transform: (Wrapped) -> U) -> U?`\n\n```swift\nstruct Parser<A> {\n    func map<B>(_ transform: (A) -> B) -> Parser<B> {\n        return Parser { input in\n            guard let (result, remainder) = self.parse(input) else { return nil }\n            return (transform(result), remainder)\n        }\n    }\n}\n```\n\n `satisfy`  `map` \n\n```swift\nfunc map<A, B>(_ x: Parser<A>, _ f: @escaping (A) -> B) -> Parser<B> {\n    return Parser { input in\n        guard let (result, remainder) = x.parse(input)else {\n            return nil\n        }\n        return (f(result), remainder)\n    }\n}\n```\n\n `Parser`  `Parser<Character`  `Parser<Int>` `Parser<Character>` <Character><Int> `map`  `(Character) -> Int`\n\n `number`  `spaces`\n\n```swift\nfunc number() -> Parser<Int> {\n    return map(many1(digit()), { Int(String($0))! })\n}\n\nfunc spaces() -> Parser<String> {\n    return map(many(space()), { String($0) })\n}\n```\n\n `Optional<T>`  `Parser<A>` `map`  `map`  `Functor`\n\n>  `Functor`  ****  ****\n\n`Functor`  `Functor` Category Theory `Functor` Functor  [Group Theory and Category Theory](http://blessingsoft.com/2017/06/12/group-theory-and-category-theory/)\n\n### Applicative\n\n```swift\nfunc pure<A>(_ x: A) -> Parser<A> {\n    return Parser<A> { (x, $0) }\n}\n```\n\n `pure`  `discarding`  Applicative `discarding`  `discarding`  parser  parser  symbol `discarding2(parser, string(\")\"))`  \")\"\n\n```swift\n/// \nfunc discarding2<A, B>(_ x: Parser<A>, _ y: Parser<B>) -> Parser<B> {\n    return Parser { input in\n        guard let (result1, remainder1) = x.parse(input) else {\n            return nil\n        }\n        guard let (_, remainder2) = y.parse(remainder1) else {\n            return nil\n        }\n        //  result1 result2\n        return (result1, remainder2)\n    }\n}\n```\n\n```swift\n/// \nfunc discarding1<A, B>(_ x: Parser<A>, _ y: Parser<B>) -> Parser<B> {\n    return Parser { input in\n        guard let (_, remainder1) = x.parse(input) else {\n            return nil\n        }\n        guard let (result2, remainder2) = y.parse(remainder1) else {\n            return nil\n        }\n        //  result2 result1\n        return (result2, remainder2)\n    }\n}\n```\n\n `discarding` \n\n\n\n```swift\n///  B\nfunc f<A, B>(_ a: A, _ b: B) -> A {\n    return a\n}\n```\n\n```swift\n///  A\nfunc f<A, B>(_ a: A, _ b: B) -> B {\n    return b\n}\n```\n\n```swift\n/// \nfunc left<A, B>(_ x: Parser<A>, _ y: Parser<B>) -> Parser<B> {\n    \n    func discarding<A, B>(_ a: A, _ b: B) -> A {\n        return b\n    }\n    \n    return Parser { input in\n        guard let (result1, remainder1) = x.parse(input) else {\n            return nil\n        }\n        guard let (result2, remainder2) = y.parse(remainder1) else {\n            return nil\n        }\n        return (discarding(result1, result2), remainder2)\n    }\n}\n```\n\n\n\n### Monad\n\n `map`  `func map<A, B>(_ x: Parser<A>, _ f: (A) -> B) -> Parser<B>`\n\n `Parser<A>` `A -> B` **Combinator** **Parser Combinator**  `Parser`  parser `func string(_ str: String) -> Parser<String>` `(String) -> Parser<String>` `map`  `(A) -> B` `(A) -> Parser<B>` `map`  `(A) -> Parser<B>` `parser`  `Parser`\n\n```swift\nfunc flatMap<A, B>(_ x: Parser<A>, _ f: (A) -> Parser<B>) -> Parser<B>\n```\n\n\n\n```swift\nlet parser = flatMap(stringParser, string(\"alex\"))\n```\n\n `map` \n\n```swift\nfunc flatMap<A, B>(_ x: Parser<A>, _ f: @escaping (A) -> Parser<B>) -> Parser<B> {\n    return Parser { input in\n        guard let (result, remainder) = x.parse(input)else {\n            return nil\n        }\n        return f(result).parse(remainder)\n    }\n}\n```\n\n[Group Theory and Category Theory](http://blessingsoft.com/2017/06/12/group-theory-and-category-theory/)\n\n### Alternative\n\n```swift\nfunc empty<A>() -> Parser<A> {\n    return Parser { _ in nil }\n}\n```\n\n```swift\nfunc choice<A>(_ x: Parser<A>, _ y: Parser<A>) -> Parser<A> {\n    return Parser { input in\n        return x.parse(input) ?? y.parse(input)\n    }\n}\n```\n\nAlternative  `Swift Standard Library`  `??` `parser` `parser` `parser`  `parser`  `Parser`\n\n Int, String, Bool  `parser` scalar  `parser`  Int, String, Bool  scalar  Int, String, Bool  `Parser<Int>`, `Parser<String>`, `Parser<Bool>`  parser  `Parser<Scalar>`  parse\n\n```swift\nlet scalar = parserInt <|> parserString <|> parserBool\n```\n\n one of  choice\n\n### Applicative & Monad\n\nApplicative  Monad \n\nApplicative  parser  parser  Monad Monad \n\n```swift\nfunc alex(_ x: Parser<String>) -> Bool {\n    if let (_, _) = x.parse(\"alex.huo\") {\n        return true\n    }\n    return false\n}\n\nlet af: Parser<(String) -> String> = pure(id)\nlet ax = string(\"alex\")\nalex(af <*> ax) // true\n\nlet mf: (String) -> Parser<String> = { string($0) }\nlet mx = string(\"alex\")\nalex(mx >>- mf) // false\n```\n\n## Ref\n\n[Jiffy](https://github.com/hlian/jiffy)\n[Parser combinators](https://news.realm.io/news/tryswift-yasuhiro-inami-parser-combinator/)\n[Monadic Parser Combinators](http://www.cs.nott.ac.uk/~pszgmh/monparsing.pdf)\n\n\n","source":"_posts/parser-combinator.md","raw":"---\ntitle: Parser Combinator\ndate: 2017-05-28 20:00:00\ntags:\n\t- parser\n\t- parser combinator\n\t- monad\n\t- functional programming\n\t- swift\ncategories: functional programming\n---\n\n\n## Parser\n\n AST\n\n`( 4 + 3  )`  `(`  `4` `` `+` `3`  `)`  ** (AST )\n\n\n`func parser(_ string: String) -> AST`\n\n\n\n`func parser(_ string: String) -> (AST, String)`\n\n `4` `+`  `4`  `+` \n\n`func parser<T>(_ string: String) -> (T, String)?`\n\n 4 \n\n```swift\nfunc parser(_ string: String) -> (Int, String)? {\n    guard let head = string.characters.first, head == \"4\" else {\n        return nil\n    }\n    return Optional.some((4, String(string.characters.dropFirst())))\n}\n```\n\n## Combinator\n\n> One of the distinguishing features of functional programming is the widespread use of combinators to construct programs. *A combinator is a function which builds program fragments from program fragments*; in a sense the programmer using combinators constructs much of the desired program automatically, rather that writing every detail by hand. -- John Hughes\n\n Combinator   \n\n## Parser Combinator\n\n** \n\n```swift\nstruct Parser<A> {\n    let parse: (String) -> (A, String)?\n    // (input) -> (result, remaining)\n}\n```\n\n `Parser`  `parse`  `typealias Parser<Result> = (String) -> (Result, String)?`\n\n\n\n```swift\nstruct Parser<I, O> {\n    let parse: (I) -> (O, I)?\n    // (input) -> (output, remaining input)\n}\n```\n\n `4` \n\n```swift\nfunc character4() -> Parser<Character> {\n    return Parser { input in\n        guard let head = input.characters.first, head == \"4\" else {\n            return nil\n        }\n        return (\"4\", String(input.characters.dropFirst()))\n    }\n}\n```\n\n `func character4() -> Parser<Character>` \n\n```swift\nfunc character(_ character: Character) -> Parser<Character> {\n    return Parser { input in\n        guard let head = input.characters.first, head == character else {\n            return nil\n        }\n        return (head, String(input.characters.dropFirst()))\n    }\n}\n```\n\n `character`  `digit` \n\n```swift\nfunc digit() -> Parser<Character> {\n    return Parser { input in\n        guard let head = input.characters.first, \"0\"...\"9\" ~= head else {\n            return nil\n        }\n        return (head, String(input.characters.dropFirst()))\n    }\n}\n```\n\n `character`  `digit` \n\n```swift\nfunc satisfy(_ condition: @escaping (Character) -> Bool) -> Parser<Character> {\n    return Parser { input in\n        guard let head = input.characters.first, condition(head) else {\n            return nil\n        }\n        return (head, String(input.characters.dropFirst()))\n    }\n}\n```\n\n\n\n`(satisfy { \"0\"...\"9\" ~= $0 }).parse(\"1abc\")`\n\n\n\n```swift\nfunc isSpace(_ character: Character) -> Bool {\n    return String(character).trimmingCharacters(in: .whitespacesAndNewlines).isEmpty\n}\n(satisfy(isSpace)).parse(\" abc\")\n```\n\n `satisfy`  X  x \n\n## Next\n\n `character` `digit`  `alex`  `alex`  `a` `l` `e` `x` 4  `character`  `string` \n\n```swift\nfunc string(_ str: String) -> Parser<String> {\n    let parsers = str.characters.map { character($0) }\n    return Parser { input in\n        var results: [Character] = []\n        var stream = input\n        for parser in parsers {\n            guard let (result, remainder) = parser.parse(stream) {\n                return nil\n            }\n            results.append(result)\n            stream = remainder\n        }\n        return (String(results), stream)\n    }\n}\n```\n\n parse  `(String) -> (A, String)` ****  `alex` \n\n1. \"alex\": 'a' -> ('a', \"lex\")\n2. \"lex\": 'l' -> ('l', \"ex\")\n3. \"ex\": 'e' -> ('e', \"x\")\n4. \"x\": 'x' -> ('x', \"\")\n5. Parser<\"alex\">\n\n** `` **\n\n\n\n```swift\nfunc string(_ str: String) -> Parser<String> {\n    return Parser { input in\n        guard let (head, tail) = uncons(str.characters) else {\n            // 0. \n            return (\"\", input)\n        }\n        // 1. \n        guard let (_, remainder1) = character(head).parse(input) else {\n            return nil\n        }\n        // 2. \n        guard let (_, remainder2) = string1(String(tail)).parse(remainder1) else {\n            return nil\n        }\n        // 3. (\"\", \"\")\n        return (str, remainder2)\n    }\n}\n\nfunc uncons<C: Collection>(_ xs: C) -> (C.Iterator.Element, C.SubSequence)? {\n    guard let head = xs.first else {\n        return nil\n    }\n    return (head, xs.suffix(from: xs.index(after: xs.startIndex)))\n}\n```\n\n 1  2 **** ** `` ** 3  1  2 \n\n\n\n```swift\nfunc discarding<A, B>(_ x: Parser<A>, _ y: Parser<B>) -> Parser<B> {\n    return Parser { input in\n        guard let (_, remainder1) = x.parse(input) else {\n            return nil\n        }\n        guard let (result2, remainder2) = y.parse(remainder1) else {\n            return nil\n        }\n        //  result2 result1\n        return (result2, remainder2)\n    }\n}\n```\n\n`discarding`  ****  `x`  `y`  `discarding`  `string` \n\n```swift\nfunc string(_ str: String) -> Parser<String> {\n    return Parser { input in\n        guard let (head, tail) = uncons(str.characters) else {\n            // \n            return (\"\", input)\n        }\n        // 1  character(head) \n        guard let (_, remainder) = discarding(character(head), string2(String(tail))).parse(input) else {\n            return nil\n        }\n        // 2  (\"\", \"\")\n        return (str, remainder)\n    }\n}\n```\n\n `string`  1  `discarding`  `discarding`  `lift` \n\n `string`  `return Parser {}` `discarding`  `Parser {}`  `lift` `string`  `discarding` \n\n```swift\nfunc string(_ str: String) -> Parser<String> {\n    let lhs = Parser {}\n    let rhs = Parser<String> {}\n    return lift(x, y)\n}\n```\n\n 2  `return (str, remainder)`  `(lhs )` `let rhs = Parser<String> { (str, $0) }` lhs  1 \n\n```swift\nfunc string(_ str: String) -> Parser<String> {\n    guard let (head, tail) = uncons(str.characters) else {\n        // 1 \n        return (\"\", input)\n    }\n    // 2 \n    let lhs = discarding(character(head), string2(String(tail)))\n    // 3 \n    let rhs = Parser<String> { (str, $0) }\n    // 4 \n    return discarding(lhs, rhs)\n}\n```\n\n `Parser` Parser {}  1  `Parser`\n\n```swift\nfunc string(_ str: String) -> Parser<String> {\n    guard let (head, tail) = uncons(str.characters) else {\n        // 1 \n        return Parser<String> { (\"\", $0) }\n    }\n    // 2\n    let lhs = discarding(character(head), string2(String(tail)))\n    // 3\n    let rhs = Parser<String> { (str, $0) }\n    // 4\n    return discarding(lhs, rhs)\n}\n```\n\n 1  3  `\"\"`  `str` \n\n```swift\nfunc string(_ str: String) -> Parser<String> {\n    guard let (head, tail) = uncons(str.characters) else {\n        // 1 \n        return pure(\"\")\n    }\n    // 2\n    let lhs = discarding(character(head), string2(String(tail)))\n    // 3\n    let rhs = pure(str)\n    // 4\n    return discarding(lhs, rhs)\n}\n\n// Lift a value\nfunc pure<A>(_ x: A) -> Parser<A> {\n    return Parser<A> { (x, $0) }\n}\n```\n\n `string` \n\n## Combine\n\n `( 4 + 3  )` `(`  `4`  1  `3`  `)`  2  *many*  *skip* \n\n#### Many\n\n\n\n```swift\nfunc space() -> Parser<Character> {\n    return satisfy(isSpace)\n}\n```\n\n *many*  *many*  parser loop \n\n```swift\nfunc many<A>(_ x: Parser<A>) -> Parser<[A]> {\n    return Parser { input in\n        var results: [A] = []\n        var stream = input\n        while let (result, remainder) = x.parse(stream) {\n            results.append(result)\n            stream = remainder\n        }\n        return (results, stream)\n    }\n}\n```\n\n\n\n```swift\nfunc spaces() -> Parser<[Character]> {\n    return many(space())\n}\n```\n\n`spaces`  `Parser<[Character]>`  parser `Parser<String>`  parser Swift `String([Character])`  `[Character]`  `String`  `many` \n\n```swift\nfunc many<Character>(_ x: Parser<Character>) -> Parser<String> {\n    return Parser { input in\n        var results: [Character] = []\n        var stream = input\n        while let (result, remainder) = x.parse(stream) {\n            results.append(result)\n            stream = remainder\n        }\n        return (String(results), stream)\n    }\n}\n```\n\n A  String  A  Character  `many`  Character  `manyCharacter` `many` \n\n#### Skip\n\n `skip`  `discarding`  `skip` \n\n```swift\nfunc skip<A>(_ x: Parser<A>) -> Parser<Void> {\n    return Parser { input in\n        guard let (_, remainder) = x.parse(input) else {\n            return ((), input)\n        }\n        \n        return ((), remainder)\n    }\n}\n```\n\n `skip`  `spaces` \n\n```swift\nfunc skipSpaces() -> Parser<Void> {\n    return skip(spaces)\n}\n```\n\n#### Many1\n\n `digit`  `digit` `number`  *number*  *many*  *digit* \n\n```swift\nfunc number() -> Parser<[Character]> {\n    return many(digit())\n}\n\nnumber().parse(\"123abc\") // ([\"1\", \"2\", \"3\"], \"abc\")\nnumber().parse(\"abc\") // ([], \"abc\")\n```\n\n`number().parse(\"abc\")`  *string* *space*  *number*  `many` `*`  `+` {0, +}  {1, +}\n\n```swift\nfunc many1<A>(_ x: Parser<A>) -> Parser<[A]> {\n    return Parser { input in\n        // \n        guard let (_, _) = x.parse(input) else {\n            return nil\n        }\n        var results: [A] = []\n        var stream = input\n        while let (result, remainder) = x.parse(stream) {\n            results.append(result)\n            stream = remainder\n        }\n        return (results, stream)\n    }\n}\n```\n\n `number` \n\n```swift\nfunc number() -> Parser<[Character]> {\n    return many1(digit())\n}\n```\n\n `number`  `spaces` `number`  `Int` `[Character]` `manyCharacter`\n\n`[Character]`  `String([Character])`  `String` `digit` character `String([Character])`  `Int(String)`  `number`\n\n Swift  OOP `Combinable` :D\n\n```swift\nprotocol Combinable {\n    static func combine(_ xs: [Character]) -> Self\n}\n\nextension Int: Combinable {\n    \n    static func combine(_ xs: [Character]) -> Int {\n        return Int(String(describing: xs))!\n    }\n}\n\nextension String: Combinable {\n    static func combine(_ xs: [Character]) -> String {\n        return String(describing: xs)\n    }\n}\n\nfunc many1<A: Combinable>(_ x: Parser<Character>) -> Parser<A> {\n    return Parser { input in\n        guard let (_, _) = x.parse(input) else {\n            return nil\n        }\n        var results: [Character] = []\n        var stream = input\n        while let (result, remainder) = x.parse(stream) {\n            results.append(result)\n            stream = remainder\n        }\n        return (A.combine(results), stream)\n    }\n}\n```\n\n\n\n```swift\nfunc number() -> Parser<Int> {\n    return many1(digit())\n}\n\nfunc spaces() -> Parser<String> {\n    return many1(space()) //  spaces \n}\n```\n\n `skipSpaces`  *many*  *skip*  *skip*  *many*  `skip`  `many`  parser  `skipMany`  **Combinator**  parser case\n\n#### Zip\n\n parser  `zip` \n\n```swift\nfunc zip<A, B>(_ x: Parser<A>, _ y: Parser<B>) -> Parser<(A, B)> {\n    return Parser { input in\n        guard let (result1, remainder1) = x.parse(input) else {\n            return nil\n        }\n        guard let (result2, remainder2) = y.parse(remainder1) else {\n            return nil\n        }\n        return ((result1, result2), remainder2)\n    }\n}\n```\n\n#### Choice\n\n `+` `-` `*` `/`\n\n```swift\nfunc opt() -> Parser<Character> {\n    let opts = [\"+\", \"-\", \"*\", \"/\"].map { character($0.characters.first!) }\n    return choice(opts)\n}\n```\n\n```swift\n//  one(of:)\nfunc choice<A, S: Sequence>(_ xs: S) -> Parser<A> where S.Iterator.Element == Parser<A> {\n    return xs.reduce(empty(), { $0 <|> $1 })\n}\n\nfunc empty<A>() -> Parser<A> {\n    return Parser { _ in nil }\n}\n```\n\n## Transform\n\n Protocol  `number`  `space`  `many`  ~~~~ **** `Combinable`  `Parser<A>`  `[A]`  `many` ****  `Parser<[A]`  `Parser<B>` `many`  `many` \n\n `func character(_ character: Character) -> Parser<Character>`  `character(\"4\")` `Parser<Character>`  `parse`  `Character`  `4 + 3`  `4`  `3`  `Character`  `Int`  `Parser<Character>`  `Parser<Int>` \n\n `Parser<A>`  `Parser<B>` `many`  `Parser<A>`  `Parser<[A]>` `number`  `Parser<[A]>`  `Parser<Int>`\n\n### Functor\n\n Swift  Optional  map \n\n```swift\nlet a: Optional<Int> = 1\nlet b: Optional<String> = a.map { String($0) }\n```\n\n `Optional<Int>`  `Optional<String>` `Optional`  `Parser`\n\n`Optional`  `func map<U>(_ transform: (Wrapped) -> U) -> U?`\n\n```swift\nstruct Parser<A> {\n    func map<B>(_ transform: (A) -> B) -> Parser<B> {\n        return Parser { input in\n            guard let (result, remainder) = self.parse(input) else { return nil }\n            return (transform(result), remainder)\n        }\n    }\n}\n```\n\n `satisfy`  `map` \n\n```swift\nfunc map<A, B>(_ x: Parser<A>, _ f: @escaping (A) -> B) -> Parser<B> {\n    return Parser { input in\n        guard let (result, remainder) = x.parse(input)else {\n            return nil\n        }\n        return (f(result), remainder)\n    }\n}\n```\n\n `Parser`  `Parser<Character`  `Parser<Int>` `Parser<Character>` <Character><Int> `map`  `(Character) -> Int`\n\n `number`  `spaces`\n\n```swift\nfunc number() -> Parser<Int> {\n    return map(many1(digit()), { Int(String($0))! })\n}\n\nfunc spaces() -> Parser<String> {\n    return map(many(space()), { String($0) })\n}\n```\n\n `Optional<T>`  `Parser<A>` `map`  `map`  `Functor`\n\n>  `Functor`  ****  ****\n\n`Functor`  `Functor` Category Theory `Functor` Functor  [Group Theory and Category Theory](http://blessingsoft.com/2017/06/12/group-theory-and-category-theory/)\n\n### Applicative\n\n```swift\nfunc pure<A>(_ x: A) -> Parser<A> {\n    return Parser<A> { (x, $0) }\n}\n```\n\n `pure`  `discarding`  Applicative `discarding`  `discarding`  parser  parser  symbol `discarding2(parser, string(\")\"))`  \")\"\n\n```swift\n/// \nfunc discarding2<A, B>(_ x: Parser<A>, _ y: Parser<B>) -> Parser<B> {\n    return Parser { input in\n        guard let (result1, remainder1) = x.parse(input) else {\n            return nil\n        }\n        guard let (_, remainder2) = y.parse(remainder1) else {\n            return nil\n        }\n        //  result1 result2\n        return (result1, remainder2)\n    }\n}\n```\n\n```swift\n/// \nfunc discarding1<A, B>(_ x: Parser<A>, _ y: Parser<B>) -> Parser<B> {\n    return Parser { input in\n        guard let (_, remainder1) = x.parse(input) else {\n            return nil\n        }\n        guard let (result2, remainder2) = y.parse(remainder1) else {\n            return nil\n        }\n        //  result2 result1\n        return (result2, remainder2)\n    }\n}\n```\n\n `discarding` \n\n\n\n```swift\n///  B\nfunc f<A, B>(_ a: A, _ b: B) -> A {\n    return a\n}\n```\n\n```swift\n///  A\nfunc f<A, B>(_ a: A, _ b: B) -> B {\n    return b\n}\n```\n\n```swift\n/// \nfunc left<A, B>(_ x: Parser<A>, _ y: Parser<B>) -> Parser<B> {\n    \n    func discarding<A, B>(_ a: A, _ b: B) -> A {\n        return b\n    }\n    \n    return Parser { input in\n        guard let (result1, remainder1) = x.parse(input) else {\n            return nil\n        }\n        guard let (result2, remainder2) = y.parse(remainder1) else {\n            return nil\n        }\n        return (discarding(result1, result2), remainder2)\n    }\n}\n```\n\n\n\n### Monad\n\n `map`  `func map<A, B>(_ x: Parser<A>, _ f: (A) -> B) -> Parser<B>`\n\n `Parser<A>` `A -> B` **Combinator** **Parser Combinator**  `Parser`  parser `func string(_ str: String) -> Parser<String>` `(String) -> Parser<String>` `map`  `(A) -> B` `(A) -> Parser<B>` `map`  `(A) -> Parser<B>` `parser`  `Parser`\n\n```swift\nfunc flatMap<A, B>(_ x: Parser<A>, _ f: (A) -> Parser<B>) -> Parser<B>\n```\n\n\n\n```swift\nlet parser = flatMap(stringParser, string(\"alex\"))\n```\n\n `map` \n\n```swift\nfunc flatMap<A, B>(_ x: Parser<A>, _ f: @escaping (A) -> Parser<B>) -> Parser<B> {\n    return Parser { input in\n        guard let (result, remainder) = x.parse(input)else {\n            return nil\n        }\n        return f(result).parse(remainder)\n    }\n}\n```\n\n[Group Theory and Category Theory](http://blessingsoft.com/2017/06/12/group-theory-and-category-theory/)\n\n### Alternative\n\n```swift\nfunc empty<A>() -> Parser<A> {\n    return Parser { _ in nil }\n}\n```\n\n```swift\nfunc choice<A>(_ x: Parser<A>, _ y: Parser<A>) -> Parser<A> {\n    return Parser { input in\n        return x.parse(input) ?? y.parse(input)\n    }\n}\n```\n\nAlternative  `Swift Standard Library`  `??` `parser` `parser` `parser`  `parser`  `Parser`\n\n Int, String, Bool  `parser` scalar  `parser`  Int, String, Bool  scalar  Int, String, Bool  `Parser<Int>`, `Parser<String>`, `Parser<Bool>`  parser  `Parser<Scalar>`  parse\n\n```swift\nlet scalar = parserInt <|> parserString <|> parserBool\n```\n\n one of  choice\n\n### Applicative & Monad\n\nApplicative  Monad \n\nApplicative  parser  parser  Monad Monad \n\n```swift\nfunc alex(_ x: Parser<String>) -> Bool {\n    if let (_, _) = x.parse(\"alex.huo\") {\n        return true\n    }\n    return false\n}\n\nlet af: Parser<(String) -> String> = pure(id)\nlet ax = string(\"alex\")\nalex(af <*> ax) // true\n\nlet mf: (String) -> Parser<String> = { string($0) }\nlet mx = string(\"alex\")\nalex(mx >>- mf) // false\n```\n\n## Ref\n\n[Jiffy](https://github.com/hlian/jiffy)\n[Parser combinators](https://news.realm.io/news/tryswift-yasuhiro-inami-parser-combinator/)\n[Monadic Parser Combinators](http://www.cs.nott.ac.uk/~pszgmh/monparsing.pdf)\n\n\n","slug":"parser-combinator","published":1,"updated":"2022-01-02T11:26:31.731Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckxx810xc000c9ithe6tt7fs8","content":"<p></p>\n<h2 id=\"Parser\"><a href=\"#Parser\" class=\"headerlink\" title=\"Parser\"></a>Parser</h2><p> AST</p>\n<p><code>( 4 + 3  )</code>  <code>(</code>  <code>4</code> <code></code> <code>+</code> <code>3</code>  <code>)</code>  <em></em> (AST )</p>\n<p><br><code>func parser(_ string: String) -&gt; AST</code></p>\n<p></p>\n<p><code>func parser(_ string: String) -&gt; (AST, String)</code></p>\n<p> <code>4</code> <code>+</code>  <code>4</code>  <code>+</code> </p>\n<p><code>func parser&lt;T&gt;(_ string: String) -&gt; (T, String)?</code></p>\n<p> 4 </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">parser</span>(<span class=\"keyword\">_</span> <span class=\"params\">string</span>: <span class=\"type\">String</span>)</span> -&gt; (<span class=\"type\">Int</span>, <span class=\"type\">String</span>)<span class=\"operator\">?</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> head <span class=\"operator\">=</span> string.characters.first, head <span class=\"operator\">==</span> <span class=\"string\">&quot;4&quot;</span> <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Optional</span>.some((<span class=\"number\">4</span>, <span class=\"type\">String</span>(string.characters.dropFirst())))</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Combinator\"><a href=\"#Combinator\" class=\"headerlink\" title=\"Combinator\"></a>Combinator</h2><blockquote>\n<p>One of the distinguishing features of functional programming is the widespread use of combinators to construct programs. <em>A combinator is a function which builds program fragments from program fragments</em>; in a sense the programmer using combinators constructs much of the desired program automatically, rather that writing every detail by hand.  John Hughes</p>\n</blockquote>\n<p> Combinator   </p>\n<h2 id=\"Parser-Combinator\"><a href=\"#Parser-Combinator\" class=\"headerlink\" title=\"Parser Combinator\"></a>Parser Combinator</h2><p><em></em> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Parser</span>&lt;<span class=\"title\">A</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> parse: (<span class=\"type\">String</span>) -&gt; (<span class=\"type\">A</span>, <span class=\"type\">String</span>)<span class=\"operator\">?</span></span><br><span class=\"line\">    <span class=\"comment\">// (input) -&gt; (result, remaining)</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>Parser</code>  <code>parse</code>  <code>typealias Parser&lt;Result&gt; = (String) -&gt; (Result, String)?</code></p>\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Parser</span>&lt;<span class=\"title\">I</span>, <span class=\"title\">O</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> parse: (<span class=\"type\">I</span>) -&gt; (<span class=\"type\">O</span>, <span class=\"type\">I</span>)<span class=\"operator\">?</span></span><br><span class=\"line\">    <span class=\"comment\">// (input) -&gt; (output, remaining input)</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>4</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">character4</span>()</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">Character</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> head <span class=\"operator\">=</span> input.characters.first, head <span class=\"operator\">==</span> <span class=\"string\">&quot;4&quot;</span> <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (<span class=\"string\">&quot;4&quot;</span>, <span class=\"type\">String</span>(input.characters.dropFirst()))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>func character4() -&gt; Parser&lt;Character&gt;</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">character</span>(<span class=\"keyword\">_</span> <span class=\"params\">character</span>: <span class=\"type\">Character</span>)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">Character</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> head <span class=\"operator\">=</span> input.characters.first, head <span class=\"operator\">==</span> character <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (head, <span class=\"type\">String</span>(input.characters.dropFirst()))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>character</code>  <code>digit</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">digit</span>()</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">Character</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> head <span class=\"operator\">=</span> input.characters.first, <span class=\"string\">&quot;0&quot;</span><span class=\"operator\">...</span><span class=\"string\">&quot;9&quot;</span> <span class=\"operator\">~=</span> head <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (head, <span class=\"type\">String</span>(input.characters.dropFirst()))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>character</code>  <code>digit</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">satisfy</span>(<span class=\"keyword\">_</span> <span class=\"params\">condition</span>: <span class=\"keyword\">@escaping</span> (<span class=\"type\">Character</span>) -&gt; <span class=\"type\">Bool</span>)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">Character</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> head <span class=\"operator\">=</span> input.characters.first, condition(head) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (head, <span class=\"type\">String</span>(input.characters.dropFirst()))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><code>(satisfy &#123; &quot;0&quot;...&quot;9&quot; ~= $0 &#125;).parse(&quot;1abc&quot;)</code></p>\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">isSpace</span>(<span class=\"keyword\">_</span> <span class=\"params\">character</span>: <span class=\"type\">Character</span>)</span> -&gt; <span class=\"type\">Bool</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">String</span>(character).trimmingCharacters(in: .whitespacesAndNewlines).isEmpty</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">(satisfy(isSpace)).parse(<span class=\"string\">&quot; abc&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<p> <code>satisfy</code>  X  x </p>\n<h2 id=\"Next\"><a href=\"#Next\" class=\"headerlink\" title=\"Next\"></a>Next</h2><p> <code>character</code> <code>digit</code>  <code>alex</code>  <code>alex</code>  <code>a</code> <code>l</code> <code>e</code> <code>x</code> 4  <code>character</code>  <code>string</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">string</span>(<span class=\"keyword\">_</span> <span class=\"params\">str</span>: <span class=\"type\">String</span>)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> parsers <span class=\"operator\">=</span> str.characters.map &#123; character(<span class=\"variable\">$0</span>) &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> results: [<span class=\"type\">Character</span>] <span class=\"operator\">=</span> []</span><br><span class=\"line\">        <span class=\"keyword\">var</span> stream <span class=\"operator\">=</span> input</span><br><span class=\"line\">        <span class=\"keyword\">for</span> parser <span class=\"keyword\">in</span> parsers &#123;</span><br><span class=\"line\">            <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (result, remainder) <span class=\"operator\">=</span> parser.parse(stream) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            results.append(result)</span><br><span class=\"line\">            stream <span class=\"operator\">=</span> remainder</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (<span class=\"type\">String</span>(results), stream)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> parse  <code>(String) -&gt; (A, String)</code> <strong></strong>  <code>alex</code> </p>\n<ol>\n<li>alex: a -&gt; (a, lex)</li>\n<li>lex: l -&gt; (l, ex)</li>\n<li>ex: e -&gt; (e, x)</li>\n<li>x: x -&gt; (x, )</li>\n<li>Parser&lt;alex&gt;</li>\n</ol>\n<p><strong> <code></code> </strong></p>\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">string</span>(<span class=\"keyword\">_</span> <span class=\"params\">str</span>: <span class=\"type\">String</span>)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (head, tail) <span class=\"operator\">=</span> uncons(str.characters) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 0. </span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> (<span class=\"string\">&quot;&quot;</span>, input)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 1. </span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (<span class=\"keyword\">_</span>, remainder1) <span class=\"operator\">=</span> character(head).parse(input) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 2. </span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (<span class=\"keyword\">_</span>, remainder2) <span class=\"operator\">=</span> string1(<span class=\"type\">String</span>(tail)).parse(remainder1) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 3. (&quot;&quot;, &quot;&quot;)</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> (str, remainder2)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">uncons</span>&lt;<span class=\"type\">C</span>: <span class=\"type\">Collection</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">xs</span>: <span class=\"type\">C</span>)</span> -&gt; (<span class=\"type\">C</span>.<span class=\"type\">Iterator</span>.<span class=\"type\">Element</span>, <span class=\"type\">C</span>.<span class=\"type\">SubSequence</span>)<span class=\"operator\">?</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> head <span class=\"operator\">=</span> xs.first <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (head, xs.suffix(from: xs.index(after: xs.startIndex)))</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> 1  2 <strong></strong> <strong> <code></code> </strong> 3  1  2 </p>\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">discarding</span>&lt;<span class=\"type\">A</span>, <span class=\"type\">B</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">x</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt;, <span class=\"keyword\">_</span> <span class=\"params\">y</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">B</span>&gt;)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">B</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (<span class=\"keyword\">_</span>, remainder1) <span class=\"operator\">=</span> x.parse(input) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (result2, remainder2) <span class=\"operator\">=</span> y.parse(remainder1) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//  result2 result1</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> (result2, remainder2)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>discarding</code>  <strong></strong>  <code>x</code>  <code>y</code>  <code>discarding</code>  <code>string</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">string</span>(<span class=\"keyword\">_</span> <span class=\"params\">str</span>: <span class=\"type\">String</span>)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (head, tail) <span class=\"operator\">=</span> uncons(str.characters) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> (<span class=\"string\">&quot;&quot;</span>, input)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 1  character(head) </span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (<span class=\"keyword\">_</span>, remainder) <span class=\"operator\">=</span> discarding(character(head), string2(<span class=\"type\">String</span>(tail))).parse(input) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 2  (&quot;&quot;, &quot;&quot;)</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> (str, remainder)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>string</code>  1  <code>discarding</code>  <code>discarding</code>  <code>lift</code> </p>\n<p> <code>string</code>  <code>return Parser &#123;&#125;</code> <code>discarding</code>  <code>Parser &#123;&#125;</code>  <code>lift</code> <code>string</code>  <code>discarding</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">string</span>(<span class=\"keyword\">_</span> <span class=\"params\">str</span>: <span class=\"type\">String</span>)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> lhs <span class=\"operator\">=</span> <span class=\"type\">Parser</span> &#123;&#125;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> rhs <span class=\"operator\">=</span> <span class=\"type\">Parser</span>&lt;<span class=\"type\">String</span>&gt; &#123;&#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> lift(x, y)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> 2  <code>return (str, remainder)</code>  <code>(lhs )</code> <code>let rhs = Parser&lt;String&gt; &#123; (str, $0) &#125;</code> lhs  1 </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">string</span>(<span class=\"keyword\">_</span> <span class=\"params\">str</span>: <span class=\"type\">String</span>)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (head, tail) <span class=\"operator\">=</span> uncons(str.characters) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 1 </span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> (<span class=\"string\">&quot;&quot;</span>, input)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 2 </span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> lhs <span class=\"operator\">=</span> discarding(character(head), string2(<span class=\"type\">String</span>(tail)))</span><br><span class=\"line\">    <span class=\"comment\">// 3 </span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> rhs <span class=\"operator\">=</span> <span class=\"type\">Parser</span>&lt;<span class=\"type\">String</span>&gt; &#123; (str, <span class=\"variable\">$0</span>) &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 4 </span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> discarding(lhs, rhs)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>Parser</code> Parser {}  1  <code>Parser</code></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">string</span>(<span class=\"keyword\">_</span> <span class=\"params\">str</span>: <span class=\"type\">String</span>)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (head, tail) <span class=\"operator\">=</span> uncons(str.characters) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 1 </span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"type\">Parser</span>&lt;<span class=\"type\">String</span>&gt; &#123; (<span class=\"string\">&quot;&quot;</span>, <span class=\"variable\">$0</span>) &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 2</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> lhs <span class=\"operator\">=</span> discarding(character(head), string2(<span class=\"type\">String</span>(tail)))</span><br><span class=\"line\">    <span class=\"comment\">// 3</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> rhs <span class=\"operator\">=</span> <span class=\"type\">Parser</span>&lt;<span class=\"type\">String</span>&gt; &#123; (str, <span class=\"variable\">$0</span>) &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 4</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> discarding(lhs, rhs)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> 1  3  <code>&quot;&quot;</code>  <code>str</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">string</span>(<span class=\"keyword\">_</span> <span class=\"params\">str</span>: <span class=\"type\">String</span>)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (head, tail) <span class=\"operator\">=</span> uncons(str.characters) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 1 </span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> pure(<span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 2</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> lhs <span class=\"operator\">=</span> discarding(character(head), string2(<span class=\"type\">String</span>(tail)))</span><br><span class=\"line\">    <span class=\"comment\">// 3</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> rhs <span class=\"operator\">=</span> pure(str)</span><br><span class=\"line\">    <span class=\"comment\">// 4</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> discarding(lhs, rhs)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Lift a value</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">pure</span>&lt;<span class=\"type\">A</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">x</span>: <span class=\"type\">A</span>)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt; &#123; (x, <span class=\"variable\">$0</span>) &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>string</code> </p>\n<h2 id=\"Combine\"><a href=\"#Combine\" class=\"headerlink\" title=\"Combine\"></a>Combine</h2><p> <code>( 4 + 3  )</code> <code>(</code>  <code>4</code>  1  <code>3</code>  <code>)</code>  2  <em>many</em>  <em>skip</em> </p>\n<h4 id=\"Many\"><a href=\"#Many\" class=\"headerlink\" title=\"Many\"></a>Many</h4><p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">space</span>()</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">Character</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> satisfy(isSpace)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <em>many</em>  <em>many</em>  parser loop </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">many</span>&lt;<span class=\"type\">A</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">x</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt;)</span> -&gt; <span class=\"type\">Parser</span>&lt;[<span class=\"type\">A</span>]&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> results: [<span class=\"type\">A</span>] <span class=\"operator\">=</span> []</span><br><span class=\"line\">        <span class=\"keyword\">var</span> stream <span class=\"operator\">=</span> input</span><br><span class=\"line\">        <span class=\"keyword\">while</span> <span class=\"keyword\">let</span> (result, remainder) <span class=\"operator\">=</span> x.parse(stream) &#123;</span><br><span class=\"line\">            results.append(result)</span><br><span class=\"line\">            stream <span class=\"operator\">=</span> remainder</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (results, stream)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">spaces</span>()</span> -&gt; <span class=\"type\">Parser</span>&lt;[<span class=\"type\">Character</span>]&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> many(space())</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>spaces</code>  <code>Parser&lt;[Character]&gt;</code>  parser <code>Parser&lt;String&gt;</code>  parser Swift <code>String([Character])</code>  <code>[Character]</code>  <code>String</code>  <code>many</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">many</span>&lt;<span class=\"type\">Character</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">x</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">Character</span>&gt;)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> results: [<span class=\"type\">Character</span>] <span class=\"operator\">=</span> []</span><br><span class=\"line\">        <span class=\"keyword\">var</span> stream <span class=\"operator\">=</span> input</span><br><span class=\"line\">        <span class=\"keyword\">while</span> <span class=\"keyword\">let</span> (result, remainder) <span class=\"operator\">=</span> x.parse(stream) &#123;</span><br><span class=\"line\">            results.append(result)</span><br><span class=\"line\">            stream <span class=\"operator\">=</span> remainder</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (<span class=\"type\">String</span>(results), stream)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> A  String  A  Character  <code>many</code>  Character  <code>manyCharacter</code> <code>many</code> </p>\n<h4 id=\"Skip\"><a href=\"#Skip\" class=\"headerlink\" title=\"Skip\"></a>Skip</h4><p> <code>skip</code>  <code>discarding</code>  <code>skip</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">skip</span>&lt;<span class=\"type\">A</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">x</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt;)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">Void</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (<span class=\"keyword\">_</span>, remainder) <span class=\"operator\">=</span> x.parse(input) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> ((), input)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">return</span> ((), remainder)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>skip</code>  <code>spaces</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">skipSpaces</span>()</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">Void</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> skip(spaces)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Many1\"><a href=\"#Many1\" class=\"headerlink\" title=\"Many1\"></a>Many1</h4><p> <code>digit</code>  <code>digit</code> <code>number</code>  <em>number</em>  <em>many</em>  <em>digit</em> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">number</span>()</span> -&gt; <span class=\"type\">Parser</span>&lt;[<span class=\"type\">Character</span>]&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> many(digit())</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">number().parse(<span class=\"string\">&quot;123abc&quot;</span>) <span class=\"comment\">// ([&quot;1&quot;, &quot;2&quot;, &quot;3&quot;], &quot;abc&quot;)</span></span><br><span class=\"line\">number().parse(<span class=\"string\">&quot;abc&quot;</span>) <span class=\"comment\">// ([], &quot;abc&quot;)</span></span><br></pre></td></tr></table></figure>\n\n<p><code>number().parse(&quot;abc&quot;)</code>  <em>string</em> <em>space</em>  <em>number</em>  <code>many</code> <code>*</code>  <code>+</code> {0, +}  {1, +}</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">many1</span>&lt;<span class=\"type\">A</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">x</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt;)</span> -&gt; <span class=\"type\">Parser</span>&lt;[<span class=\"type\">A</span>]&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (<span class=\"keyword\">_</span>, <span class=\"keyword\">_</span>) <span class=\"operator\">=</span> x.parse(input) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> results: [<span class=\"type\">A</span>] <span class=\"operator\">=</span> []</span><br><span class=\"line\">        <span class=\"keyword\">var</span> stream <span class=\"operator\">=</span> input</span><br><span class=\"line\">        <span class=\"keyword\">while</span> <span class=\"keyword\">let</span> (result, remainder) <span class=\"operator\">=</span> x.parse(stream) &#123;</span><br><span class=\"line\">            results.append(result)</span><br><span class=\"line\">            stream <span class=\"operator\">=</span> remainder</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (results, stream)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>number</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">number</span>()</span> -&gt; <span class=\"type\">Parser</span>&lt;[<span class=\"type\">Character</span>]&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> many1(digit())</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>number</code>  <code>spaces</code> <code>number</code>  <code>Int</code> <code>[Character]</code> <code>manyCharacter</code></p>\n<p><code>[Character]</code>  <code>String([Character])</code>  <code>String</code> <code>digit</code> character <code>String([Character])</code>  <code>Int(String)</code>  <code>number</code></p>\n<p> Swift  OOP <code>Combinable</code> :D</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">protocol</span> <span class=\"title\">Combinable</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">combine</span>(<span class=\"keyword\">_</span> <span class=\"params\">xs</span>: [<span class=\"type\">Character</span>])</span> -&gt; <span class=\"keyword\">Self</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">Int</span>: <span class=\"title\">Combinable</span> </span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">combine</span>(<span class=\"keyword\">_</span> <span class=\"params\">xs</span>: [<span class=\"type\">Character</span>])</span> -&gt; <span class=\"type\">Int</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"type\">Int</span>(<span class=\"type\">String</span>(describing: xs))<span class=\"operator\">!</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">String</span>: <span class=\"title\">Combinable</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">combine</span>(<span class=\"keyword\">_</span> <span class=\"params\">xs</span>: [<span class=\"type\">Character</span>])</span> -&gt; <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"type\">String</span>(describing: xs)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">many1</span>&lt;<span class=\"type\">A</span>: <span class=\"type\">Combinable</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">x</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">Character</span>&gt;)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (<span class=\"keyword\">_</span>, <span class=\"keyword\">_</span>) <span class=\"operator\">=</span> x.parse(input) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> results: [<span class=\"type\">Character</span>] <span class=\"operator\">=</span> []</span><br><span class=\"line\">        <span class=\"keyword\">var</span> stream <span class=\"operator\">=</span> input</span><br><span class=\"line\">        <span class=\"keyword\">while</span> <span class=\"keyword\">let</span> (result, remainder) <span class=\"operator\">=</span> x.parse(stream) &#123;</span><br><span class=\"line\">            results.append(result)</span><br><span class=\"line\">            stream <span class=\"operator\">=</span> remainder</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (<span class=\"type\">A</span>.combine(results), stream)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">number</span>()</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">Int</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> many1(digit())</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">spaces</span>()</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> many1(space()) <span class=\"comment\">//  spaces </span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>skipSpaces</code>  <em>many</em>  <em>skip</em>  <em>skip</em>  <em>many</em>  <code>skip</code>  <code>many</code>  parser  <code>skipMany</code>  <strong>Combinator</strong>  parser case</p>\n<h4 id=\"Zip\"><a href=\"#Zip\" class=\"headerlink\" title=\"Zip\"></a>Zip</h4><p> parser  <code>zip</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">zip</span>&lt;<span class=\"type\">A</span>, <span class=\"type\">B</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">x</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt;, <span class=\"keyword\">_</span> <span class=\"params\">y</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">B</span>&gt;)</span> -&gt; <span class=\"type\">Parser</span>&lt;(<span class=\"type\">A</span>, <span class=\"type\">B</span>)&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (result1, remainder1) <span class=\"operator\">=</span> x.parse(input) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (result2, remainder2) <span class=\"operator\">=</span> y.parse(remainder1) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ((result1, result2), remainder2)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Choice\"><a href=\"#Choice\" class=\"headerlink\" title=\"Choice\"></a>Choice</h4><p> <code>+</code> <code>-</code> <code>*</code> <code>/</code></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">opt</span>()</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">Character</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> opts <span class=\"operator\">=</span> [<span class=\"string\">&quot;+&quot;</span>, <span class=\"string\">&quot;-&quot;</span>, <span class=\"string\">&quot;*&quot;</span>, <span class=\"string\">&quot;/&quot;</span>].map &#123; character(<span class=\"variable\">$0</span>.characters.first<span class=\"operator\">!</span>) &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> choice(opts)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//  one(of:)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">choice</span>&lt;<span class=\"type\">A</span>, <span class=\"type\">S</span>: <span class=\"type\">Sequence</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">xs</span>: <span class=\"type\">S</span>)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt; <span class=\"keyword\">where</span> <span class=\"type\">S</span>.<span class=\"type\">Iterator</span>.<span class=\"type\">Element</span> <span class=\"operator\">==</span> <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> xs.reduce(empty(), &#123; <span class=\"variable\">$0</span> <span class=\"operator\">&lt;|&gt;</span> <span class=\"variable\">$1</span> &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">empty</span>&lt;<span class=\"type\">A</span>&gt;()</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; <span class=\"keyword\">_</span> <span class=\"keyword\">in</span> <span class=\"literal\">nil</span> &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Transform\"><a href=\"#Transform\" class=\"headerlink\" title=\"Transform\"></a>Transform</h2><p> Protocol  <code>number</code>  <code>space</code>  <code>many</code>  <del></del> <strong></strong> <code>Combinable</code>  <code>Parser&lt;A&gt;</code>  <code>[A]</code>  <code>many</code> <strong></strong>  <code>Parser&lt;[A]</code>  <code>Parser&lt;B&gt;</code> <code>many</code>  <code>many</code> </p>\n<p> <code>func character(_ character: Character) -&gt; Parser&lt;Character&gt;</code>  <code>character(&quot;4&quot;)</code> <code>Parser&lt;Character&gt;</code>  <code>parse</code>  <code>Character</code>  <code>4 + 3</code>  <code>4</code>  <code>3</code>  <code>Character</code>  <code>Int</code>  <code>Parser&lt;Character&gt;</code>  <code>Parser&lt;Int&gt;</code> </p>\n<p> <code>Parser&lt;A&gt;</code>  <code>Parser&lt;B&gt;</code> <code>many</code>  <code>Parser&lt;A&gt;</code>  <code>Parser&lt;[A]&gt;</code> <code>number</code>  <code>Parser&lt;[A]&gt;</code>  <code>Parser&lt;Int&gt;</code></p>\n<h3 id=\"Functor\"><a href=\"#Functor\" class=\"headerlink\" title=\"Functor\"></a>Functor</h3><p> Swift  Optional  map </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> a: <span class=\"type\">Optional</span>&lt;<span class=\"type\">Int</span>&gt; <span class=\"operator\">=</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> b: <span class=\"type\">Optional</span>&lt;<span class=\"type\">String</span>&gt; <span class=\"operator\">=</span> a.map &#123; <span class=\"type\">String</span>(<span class=\"variable\">$0</span>) &#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>Optional&lt;Int&gt;</code>  <code>Optional&lt;String&gt;</code> <code>Optional</code>  <code>Parser</code></p>\n<p><code>Optional</code>  <code>func map&lt;U&gt;(_ transform: (Wrapped) -&gt; U) -&gt; U?</code></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Parser</span>&lt;<span class=\"title\">A</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">map</span>&lt;<span class=\"type\">B</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">transform</span>: (<span class=\"type\">A</span>) -&gt; <span class=\"type\">B</span>)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">B</span>&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">            <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (result, remainder) <span class=\"operator\">=</span> <span class=\"keyword\">self</span>.parse(input) <span class=\"keyword\">else</span> &#123; <span class=\"keyword\">return</span> <span class=\"literal\">nil</span> &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> (transform(result), remainder)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>satisfy</code>  <code>map</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">map</span>&lt;<span class=\"type\">A</span>, <span class=\"type\">B</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">x</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt;, <span class=\"keyword\">_</span> <span class=\"params\">f</span>: <span class=\"keyword\">@escaping</span> (<span class=\"type\">A</span>) -&gt; <span class=\"type\">B</span>)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">B</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (result, remainder) <span class=\"operator\">=</span> x.parse(input)<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (f(result), remainder)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>Parser</code>  <code>Parser&lt;Character</code>  <code>Parser&lt;Int&gt;</code> <code>Parser&lt;Character&gt;</code> <Character><Int> <code>map</code>  <code>(Character) -&gt; Int</code></p>\n<p> <code>number</code>  <code>spaces</code></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">number</span>()</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">Int</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> map(many1(digit()), &#123; <span class=\"type\">Int</span>(<span class=\"type\">String</span>(<span class=\"variable\">$0</span>))<span class=\"operator\">!</span> &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">spaces</span>()</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> map(many(space()), &#123; <span class=\"type\">String</span>(<span class=\"variable\">$0</span>) &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>Optional&lt;T&gt;</code>  <code>Parser&lt;A&gt;</code> <code>map</code>  <code>map</code>  <code>Functor</code></p>\n<blockquote>\n<p> <code>Functor</code>  <strong></strong>  <strong></strong></p>\n</blockquote>\n<p><code>Functor</code>  <code>Functor</code> Category Theory <code>Functor</code> Functor  <a href=\"http://blessingsoft.com/2017/06/12/group-theory-and-category-theory/\">Group Theory and Category Theory</a></p>\n<h3 id=\"Applicative\"><a href=\"#Applicative\" class=\"headerlink\" title=\"Applicative\"></a>Applicative</h3><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">pure</span>&lt;<span class=\"type\">A</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">x</span>: <span class=\"type\">A</span>)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt; &#123; (x, <span class=\"variable\">$0</span>) &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>pure</code>  <code>discarding</code>  Applicative <code>discarding</code>  <code>discarding</code>  parser  parser  symbol <code>discarding2(parser, string(&quot;)&quot;))</code>  )</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">discarding2</span>&lt;<span class=\"type\">A</span>, <span class=\"type\">B</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">x</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt;, <span class=\"keyword\">_</span> <span class=\"params\">y</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">B</span>&gt;)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">B</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (result1, remainder1) <span class=\"operator\">=</span> x.parse(input) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (<span class=\"keyword\">_</span>, remainder2) <span class=\"operator\">=</span> y.parse(remainder1) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//  result1 result2</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> (result1, remainder2)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">discarding1</span>&lt;<span class=\"type\">A</span>, <span class=\"type\">B</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">x</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt;, <span class=\"keyword\">_</span> <span class=\"params\">y</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">B</span>&gt;)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">B</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (<span class=\"keyword\">_</span>, remainder1) <span class=\"operator\">=</span> x.parse(input) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (result2, remainder2) <span class=\"operator\">=</span> y.parse(remainder1) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//  result2 result1</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> (result2, remainder2)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>discarding</code> </p>\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">///  B</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">f</span>&lt;<span class=\"type\">A</span>, <span class=\"type\">B</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">a</span>: <span class=\"type\">A</span>, <span class=\"keyword\">_</span> <span class=\"params\">b</span>: <span class=\"type\">B</span>)</span> -&gt; <span class=\"type\">A</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">///  A</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">f</span>&lt;<span class=\"type\">A</span>, <span class=\"type\">B</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">a</span>: <span class=\"type\">A</span>, <span class=\"keyword\">_</span> <span class=\"params\">b</span>: <span class=\"type\">B</span>)</span> -&gt; <span class=\"type\">B</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> b</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">left</span>&lt;<span class=\"type\">A</span>, <span class=\"type\">B</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">x</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt;, <span class=\"keyword\">_</span> <span class=\"params\">y</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">B</span>&gt;)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">B</span>&gt; &#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">discarding</span>&lt;<span class=\"type\">A</span>, <span class=\"type\">B</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">a</span>: <span class=\"type\">A</span>, <span class=\"keyword\">_</span> <span class=\"params\">b</span>: <span class=\"type\">B</span>)</span> -&gt; <span class=\"type\">A</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> b</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (result1, remainder1) <span class=\"operator\">=</span> x.parse(input) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (result2, remainder2) <span class=\"operator\">=</span> y.parse(remainder1) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (discarding(result1, result2), remainder2)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<h3 id=\"Monad\"><a href=\"#Monad\" class=\"headerlink\" title=\"Monad\"></a>Monad</h3><p> <code>map</code>  <code>func map&lt;A, B&gt;(_ x: Parser&lt;A&gt;, _ f: (A) -&gt; B) -&gt; Parser&lt;B&gt;</code></p>\n<p> <code>Parser&lt;A&gt;</code> <code>A -&gt; B</code> <strong>Combinator</strong> <strong>Parser Combinator</strong>  <code>Parser</code>  parser <code>func string(_ str: String) -&gt; Parser&lt;String&gt;</code> <code>(String) -&gt; Parser&lt;String&gt;</code> <code>map</code>  <code>(A) -&gt; B</code> <code>(A) -&gt; Parser&lt;B&gt;</code> <code>map</code>  <code>(A) -&gt; Parser&lt;B&gt;</code> <code>parser</code>  <code>Parser</code></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">flatMap</span>&lt;<span class=\"type\">A</span>, <span class=\"type\">B</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">x</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt;, <span class=\"keyword\">_</span> <span class=\"params\">f</span>: (<span class=\"type\">A</span>) -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">B</span>&gt;)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">B</span>&gt;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> parser <span class=\"operator\">=</span> flatMap(stringParser, string(<span class=\"string\">&quot;alex&quot;</span>))</span><br></pre></td></tr></table></figure>\n\n<p> <code>map</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">flatMap</span>&lt;<span class=\"type\">A</span>, <span class=\"type\">B</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">x</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt;, <span class=\"keyword\">_</span> <span class=\"params\">f</span>: <span class=\"keyword\">@escaping</span> (<span class=\"type\">A</span>) -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">B</span>&gt;)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">B</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (result, remainder) <span class=\"operator\">=</span> x.parse(input)<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> f(result).parse(remainder)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"http://blessingsoft.com/2017/06/12/group-theory-and-category-theory/\">Group Theory and Category Theory</a></p>\n<h3 id=\"Alternative\"><a href=\"#Alternative\" class=\"headerlink\" title=\"Alternative\"></a>Alternative</h3><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">empty</span>&lt;<span class=\"type\">A</span>&gt;()</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; <span class=\"keyword\">_</span> <span class=\"keyword\">in</span> <span class=\"literal\">nil</span> &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">choice</span>&lt;<span class=\"type\">A</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">x</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt;, <span class=\"keyword\">_</span> <span class=\"params\">y</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt;)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> x.parse(input) <span class=\"operator\">??</span> y.parse(input)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Alternative  <code>Swift Standard Library</code>  <code>??</code> <code>parser</code> <code>parser</code> <code>parser</code>  <code>parser</code>  <code>Parser</code></p>\n<p> Int, String, Bool  <code>parser</code> scalar  <code>parser</code>  Int, String, Bool  scalar  Int, String, Bool  <code>Parser&lt;Int&gt;</code>, <code>Parser&lt;String&gt;</code>, <code>Parser&lt;Bool&gt;</code>  parser  <code>Parser&lt;Scalar&gt;</code>  parse</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> scalar <span class=\"operator\">=</span> parserInt <span class=\"operator\">&lt;|&gt;</span> parserString <span class=\"operator\">&lt;|&gt;</span> parserBool</span><br></pre></td></tr></table></figure>\n\n<p> one of  choice</p>\n<h3 id=\"Applicative-amp-Monad\"><a href=\"#Applicative-amp-Monad\" class=\"headerlink\" title=\"Applicative &amp; Monad\"></a>Applicative &amp; Monad</h3><p>Applicative  Monad </p>\n<p>Applicative  parser  parser  Monad Monad </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">alex</span>(<span class=\"keyword\">_</span> <span class=\"params\">x</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">String</span>&gt;)</span> -&gt; <span class=\"type\">Bool</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> (<span class=\"keyword\">_</span>, <span class=\"keyword\">_</span>) <span class=\"operator\">=</span> x.parse(<span class=\"string\">&quot;alex.huo&quot;</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> af: <span class=\"type\">Parser</span>&lt;(<span class=\"type\">String</span>) -&gt; <span class=\"type\">String</span>&gt; <span class=\"operator\">=</span> pure(id)</span><br><span class=\"line\"><span class=\"keyword\">let</span> ax <span class=\"operator\">=</span> string(<span class=\"string\">&quot;alex&quot;</span>)</span><br><span class=\"line\">alex(af <span class=\"operator\">&lt;*&gt;</span> ax) <span class=\"comment\">// true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> mf: (<span class=\"type\">String</span>) -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">String</span>&gt; <span class=\"operator\">=</span> &#123; string(<span class=\"variable\">$0</span>) &#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> mx <span class=\"operator\">=</span> string(<span class=\"string\">&quot;alex&quot;</span>)</span><br><span class=\"line\">alex(mx <span class=\"operator\">&gt;&gt;-</span> mf) <span class=\"comment\">// false</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Ref\"><a href=\"#Ref\" class=\"headerlink\" title=\"Ref\"></a>Ref</h2><p><a href=\"https://github.com/hlian/jiffy\">Jiffy</a><br><a href=\"https://news.realm.io/news/tryswift-yasuhiro-inami-parser-combinator/\">Parser combinators</a><br><a href=\"http://www.cs.nott.ac.uk/~pszgmh/monparsing.pdf\">Monadic Parser Combinators</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p></p>\n<h2 id=\"Parser\"><a href=\"#Parser\" class=\"headerlink\" title=\"Parser\"></a>Parser</h2><p> AST</p>\n<p><code>( 4 + 3  )</code>  <code>(</code>  <code>4</code> <code></code> <code>+</code> <code>3</code>  <code>)</code>  <em></em> (AST )</p>\n<p><br><code>func parser(_ string: String) -&gt; AST</code></p>\n<p></p>\n<p><code>func parser(_ string: String) -&gt; (AST, String)</code></p>\n<p> <code>4</code> <code>+</code>  <code>4</code>  <code>+</code> </p>\n<p><code>func parser&lt;T&gt;(_ string: String) -&gt; (T, String)?</code></p>\n<p> 4 </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">parser</span>(<span class=\"keyword\">_</span> <span class=\"params\">string</span>: <span class=\"type\">String</span>)</span> -&gt; (<span class=\"type\">Int</span>, <span class=\"type\">String</span>)<span class=\"operator\">?</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> head <span class=\"operator\">=</span> string.characters.first, head <span class=\"operator\">==</span> <span class=\"string\">&quot;4&quot;</span> <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Optional</span>.some((<span class=\"number\">4</span>, <span class=\"type\">String</span>(string.characters.dropFirst())))</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Combinator\"><a href=\"#Combinator\" class=\"headerlink\" title=\"Combinator\"></a>Combinator</h2><blockquote>\n<p>One of the distinguishing features of functional programming is the widespread use of combinators to construct programs. <em>A combinator is a function which builds program fragments from program fragments</em>; in a sense the programmer using combinators constructs much of the desired program automatically, rather that writing every detail by hand.  John Hughes</p>\n</blockquote>\n<p> Combinator   </p>\n<h2 id=\"Parser-Combinator\"><a href=\"#Parser-Combinator\" class=\"headerlink\" title=\"Parser Combinator\"></a>Parser Combinator</h2><p><em></em> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Parser</span>&lt;<span class=\"title\">A</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> parse: (<span class=\"type\">String</span>) -&gt; (<span class=\"type\">A</span>, <span class=\"type\">String</span>)<span class=\"operator\">?</span></span><br><span class=\"line\">    <span class=\"comment\">// (input) -&gt; (result, remaining)</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>Parser</code>  <code>parse</code>  <code>typealias Parser&lt;Result&gt; = (String) -&gt; (Result, String)?</code></p>\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Parser</span>&lt;<span class=\"title\">I</span>, <span class=\"title\">O</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> parse: (<span class=\"type\">I</span>) -&gt; (<span class=\"type\">O</span>, <span class=\"type\">I</span>)<span class=\"operator\">?</span></span><br><span class=\"line\">    <span class=\"comment\">// (input) -&gt; (output, remaining input)</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>4</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">character4</span>()</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">Character</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> head <span class=\"operator\">=</span> input.characters.first, head <span class=\"operator\">==</span> <span class=\"string\">&quot;4&quot;</span> <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (<span class=\"string\">&quot;4&quot;</span>, <span class=\"type\">String</span>(input.characters.dropFirst()))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>func character4() -&gt; Parser&lt;Character&gt;</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">character</span>(<span class=\"keyword\">_</span> <span class=\"params\">character</span>: <span class=\"type\">Character</span>)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">Character</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> head <span class=\"operator\">=</span> input.characters.first, head <span class=\"operator\">==</span> character <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (head, <span class=\"type\">String</span>(input.characters.dropFirst()))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>character</code>  <code>digit</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">digit</span>()</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">Character</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> head <span class=\"operator\">=</span> input.characters.first, <span class=\"string\">&quot;0&quot;</span><span class=\"operator\">...</span><span class=\"string\">&quot;9&quot;</span> <span class=\"operator\">~=</span> head <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (head, <span class=\"type\">String</span>(input.characters.dropFirst()))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>character</code>  <code>digit</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">satisfy</span>(<span class=\"keyword\">_</span> <span class=\"params\">condition</span>: <span class=\"keyword\">@escaping</span> (<span class=\"type\">Character</span>) -&gt; <span class=\"type\">Bool</span>)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">Character</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> head <span class=\"operator\">=</span> input.characters.first, condition(head) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (head, <span class=\"type\">String</span>(input.characters.dropFirst()))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><code>(satisfy &#123; &quot;0&quot;...&quot;9&quot; ~= $0 &#125;).parse(&quot;1abc&quot;)</code></p>\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">isSpace</span>(<span class=\"keyword\">_</span> <span class=\"params\">character</span>: <span class=\"type\">Character</span>)</span> -&gt; <span class=\"type\">Bool</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">String</span>(character).trimmingCharacters(in: .whitespacesAndNewlines).isEmpty</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">(satisfy(isSpace)).parse(<span class=\"string\">&quot; abc&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<p> <code>satisfy</code>  X  x </p>\n<h2 id=\"Next\"><a href=\"#Next\" class=\"headerlink\" title=\"Next\"></a>Next</h2><p> <code>character</code> <code>digit</code>  <code>alex</code>  <code>alex</code>  <code>a</code> <code>l</code> <code>e</code> <code>x</code> 4  <code>character</code>  <code>string</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">string</span>(<span class=\"keyword\">_</span> <span class=\"params\">str</span>: <span class=\"type\">String</span>)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> parsers <span class=\"operator\">=</span> str.characters.map &#123; character(<span class=\"variable\">$0</span>) &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> results: [<span class=\"type\">Character</span>] <span class=\"operator\">=</span> []</span><br><span class=\"line\">        <span class=\"keyword\">var</span> stream <span class=\"operator\">=</span> input</span><br><span class=\"line\">        <span class=\"keyword\">for</span> parser <span class=\"keyword\">in</span> parsers &#123;</span><br><span class=\"line\">            <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (result, remainder) <span class=\"operator\">=</span> parser.parse(stream) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            results.append(result)</span><br><span class=\"line\">            stream <span class=\"operator\">=</span> remainder</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (<span class=\"type\">String</span>(results), stream)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> parse  <code>(String) -&gt; (A, String)</code> <strong></strong>  <code>alex</code> </p>\n<ol>\n<li>alex: a -&gt; (a, lex)</li>\n<li>lex: l -&gt; (l, ex)</li>\n<li>ex: e -&gt; (e, x)</li>\n<li>x: x -&gt; (x, )</li>\n<li>Parser&lt;alex&gt;</li>\n</ol>\n<p><strong> <code></code> </strong></p>\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">string</span>(<span class=\"keyword\">_</span> <span class=\"params\">str</span>: <span class=\"type\">String</span>)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (head, tail) <span class=\"operator\">=</span> uncons(str.characters) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 0. </span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> (<span class=\"string\">&quot;&quot;</span>, input)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 1. </span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (<span class=\"keyword\">_</span>, remainder1) <span class=\"operator\">=</span> character(head).parse(input) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 2. </span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (<span class=\"keyword\">_</span>, remainder2) <span class=\"operator\">=</span> string1(<span class=\"type\">String</span>(tail)).parse(remainder1) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 3. (&quot;&quot;, &quot;&quot;)</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> (str, remainder2)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">uncons</span>&lt;<span class=\"type\">C</span>: <span class=\"type\">Collection</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">xs</span>: <span class=\"type\">C</span>)</span> -&gt; (<span class=\"type\">C</span>.<span class=\"type\">Iterator</span>.<span class=\"type\">Element</span>, <span class=\"type\">C</span>.<span class=\"type\">SubSequence</span>)<span class=\"operator\">?</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> head <span class=\"operator\">=</span> xs.first <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (head, xs.suffix(from: xs.index(after: xs.startIndex)))</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> 1  2 <strong></strong> <strong> <code></code> </strong> 3  1  2 </p>\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">discarding</span>&lt;<span class=\"type\">A</span>, <span class=\"type\">B</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">x</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt;, <span class=\"keyword\">_</span> <span class=\"params\">y</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">B</span>&gt;)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">B</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (<span class=\"keyword\">_</span>, remainder1) <span class=\"operator\">=</span> x.parse(input) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (result2, remainder2) <span class=\"operator\">=</span> y.parse(remainder1) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//  result2 result1</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> (result2, remainder2)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>discarding</code>  <strong></strong>  <code>x</code>  <code>y</code>  <code>discarding</code>  <code>string</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">string</span>(<span class=\"keyword\">_</span> <span class=\"params\">str</span>: <span class=\"type\">String</span>)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (head, tail) <span class=\"operator\">=</span> uncons(str.characters) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> (<span class=\"string\">&quot;&quot;</span>, input)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 1  character(head) </span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (<span class=\"keyword\">_</span>, remainder) <span class=\"operator\">=</span> discarding(character(head), string2(<span class=\"type\">String</span>(tail))).parse(input) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 2  (&quot;&quot;, &quot;&quot;)</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> (str, remainder)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>string</code>  1  <code>discarding</code>  <code>discarding</code>  <code>lift</code> </p>\n<p> <code>string</code>  <code>return Parser &#123;&#125;</code> <code>discarding</code>  <code>Parser &#123;&#125;</code>  <code>lift</code> <code>string</code>  <code>discarding</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">string</span>(<span class=\"keyword\">_</span> <span class=\"params\">str</span>: <span class=\"type\">String</span>)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> lhs <span class=\"operator\">=</span> <span class=\"type\">Parser</span> &#123;&#125;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> rhs <span class=\"operator\">=</span> <span class=\"type\">Parser</span>&lt;<span class=\"type\">String</span>&gt; &#123;&#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> lift(x, y)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> 2  <code>return (str, remainder)</code>  <code>(lhs )</code> <code>let rhs = Parser&lt;String&gt; &#123; (str, $0) &#125;</code> lhs  1 </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">string</span>(<span class=\"keyword\">_</span> <span class=\"params\">str</span>: <span class=\"type\">String</span>)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (head, tail) <span class=\"operator\">=</span> uncons(str.characters) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 1 </span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> (<span class=\"string\">&quot;&quot;</span>, input)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 2 </span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> lhs <span class=\"operator\">=</span> discarding(character(head), string2(<span class=\"type\">String</span>(tail)))</span><br><span class=\"line\">    <span class=\"comment\">// 3 </span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> rhs <span class=\"operator\">=</span> <span class=\"type\">Parser</span>&lt;<span class=\"type\">String</span>&gt; &#123; (str, <span class=\"variable\">$0</span>) &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 4 </span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> discarding(lhs, rhs)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>Parser</code> Parser {}  1  <code>Parser</code></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">string</span>(<span class=\"keyword\">_</span> <span class=\"params\">str</span>: <span class=\"type\">String</span>)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (head, tail) <span class=\"operator\">=</span> uncons(str.characters) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 1 </span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"type\">Parser</span>&lt;<span class=\"type\">String</span>&gt; &#123; (<span class=\"string\">&quot;&quot;</span>, <span class=\"variable\">$0</span>) &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 2</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> lhs <span class=\"operator\">=</span> discarding(character(head), string2(<span class=\"type\">String</span>(tail)))</span><br><span class=\"line\">    <span class=\"comment\">// 3</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> rhs <span class=\"operator\">=</span> <span class=\"type\">Parser</span>&lt;<span class=\"type\">String</span>&gt; &#123; (str, <span class=\"variable\">$0</span>) &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 4</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> discarding(lhs, rhs)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> 1  3  <code>&quot;&quot;</code>  <code>str</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">string</span>(<span class=\"keyword\">_</span> <span class=\"params\">str</span>: <span class=\"type\">String</span>)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (head, tail) <span class=\"operator\">=</span> uncons(str.characters) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 1 </span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> pure(<span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 2</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> lhs <span class=\"operator\">=</span> discarding(character(head), string2(<span class=\"type\">String</span>(tail)))</span><br><span class=\"line\">    <span class=\"comment\">// 3</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> rhs <span class=\"operator\">=</span> pure(str)</span><br><span class=\"line\">    <span class=\"comment\">// 4</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> discarding(lhs, rhs)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Lift a value</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">pure</span>&lt;<span class=\"type\">A</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">x</span>: <span class=\"type\">A</span>)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt; &#123; (x, <span class=\"variable\">$0</span>) &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>string</code> </p>\n<h2 id=\"Combine\"><a href=\"#Combine\" class=\"headerlink\" title=\"Combine\"></a>Combine</h2><p> <code>( 4 + 3  )</code> <code>(</code>  <code>4</code>  1  <code>3</code>  <code>)</code>  2  <em>many</em>  <em>skip</em> </p>\n<h4 id=\"Many\"><a href=\"#Many\" class=\"headerlink\" title=\"Many\"></a>Many</h4><p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">space</span>()</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">Character</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> satisfy(isSpace)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <em>many</em>  <em>many</em>  parser loop </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">many</span>&lt;<span class=\"type\">A</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">x</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt;)</span> -&gt; <span class=\"type\">Parser</span>&lt;[<span class=\"type\">A</span>]&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> results: [<span class=\"type\">A</span>] <span class=\"operator\">=</span> []</span><br><span class=\"line\">        <span class=\"keyword\">var</span> stream <span class=\"operator\">=</span> input</span><br><span class=\"line\">        <span class=\"keyword\">while</span> <span class=\"keyword\">let</span> (result, remainder) <span class=\"operator\">=</span> x.parse(stream) &#123;</span><br><span class=\"line\">            results.append(result)</span><br><span class=\"line\">            stream <span class=\"operator\">=</span> remainder</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (results, stream)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">spaces</span>()</span> -&gt; <span class=\"type\">Parser</span>&lt;[<span class=\"type\">Character</span>]&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> many(space())</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>spaces</code>  <code>Parser&lt;[Character]&gt;</code>  parser <code>Parser&lt;String&gt;</code>  parser Swift <code>String([Character])</code>  <code>[Character]</code>  <code>String</code>  <code>many</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">many</span>&lt;<span class=\"type\">Character</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">x</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">Character</span>&gt;)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> results: [<span class=\"type\">Character</span>] <span class=\"operator\">=</span> []</span><br><span class=\"line\">        <span class=\"keyword\">var</span> stream <span class=\"operator\">=</span> input</span><br><span class=\"line\">        <span class=\"keyword\">while</span> <span class=\"keyword\">let</span> (result, remainder) <span class=\"operator\">=</span> x.parse(stream) &#123;</span><br><span class=\"line\">            results.append(result)</span><br><span class=\"line\">            stream <span class=\"operator\">=</span> remainder</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (<span class=\"type\">String</span>(results), stream)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> A  String  A  Character  <code>many</code>  Character  <code>manyCharacter</code> <code>many</code> </p>\n<h4 id=\"Skip\"><a href=\"#Skip\" class=\"headerlink\" title=\"Skip\"></a>Skip</h4><p> <code>skip</code>  <code>discarding</code>  <code>skip</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">skip</span>&lt;<span class=\"type\">A</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">x</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt;)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">Void</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (<span class=\"keyword\">_</span>, remainder) <span class=\"operator\">=</span> x.parse(input) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> ((), input)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">return</span> ((), remainder)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>skip</code>  <code>spaces</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">skipSpaces</span>()</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">Void</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> skip(spaces)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Many1\"><a href=\"#Many1\" class=\"headerlink\" title=\"Many1\"></a>Many1</h4><p> <code>digit</code>  <code>digit</code> <code>number</code>  <em>number</em>  <em>many</em>  <em>digit</em> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">number</span>()</span> -&gt; <span class=\"type\">Parser</span>&lt;[<span class=\"type\">Character</span>]&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> many(digit())</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">number().parse(<span class=\"string\">&quot;123abc&quot;</span>) <span class=\"comment\">// ([&quot;1&quot;, &quot;2&quot;, &quot;3&quot;], &quot;abc&quot;)</span></span><br><span class=\"line\">number().parse(<span class=\"string\">&quot;abc&quot;</span>) <span class=\"comment\">// ([], &quot;abc&quot;)</span></span><br></pre></td></tr></table></figure>\n\n<p><code>number().parse(&quot;abc&quot;)</code>  <em>string</em> <em>space</em>  <em>number</em>  <code>many</code> <code>*</code>  <code>+</code> {0, +}  {1, +}</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">many1</span>&lt;<span class=\"type\">A</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">x</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt;)</span> -&gt; <span class=\"type\">Parser</span>&lt;[<span class=\"type\">A</span>]&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (<span class=\"keyword\">_</span>, <span class=\"keyword\">_</span>) <span class=\"operator\">=</span> x.parse(input) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> results: [<span class=\"type\">A</span>] <span class=\"operator\">=</span> []</span><br><span class=\"line\">        <span class=\"keyword\">var</span> stream <span class=\"operator\">=</span> input</span><br><span class=\"line\">        <span class=\"keyword\">while</span> <span class=\"keyword\">let</span> (result, remainder) <span class=\"operator\">=</span> x.parse(stream) &#123;</span><br><span class=\"line\">            results.append(result)</span><br><span class=\"line\">            stream <span class=\"operator\">=</span> remainder</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (results, stream)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>number</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">number</span>()</span> -&gt; <span class=\"type\">Parser</span>&lt;[<span class=\"type\">Character</span>]&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> many1(digit())</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>number</code>  <code>spaces</code> <code>number</code>  <code>Int</code> <code>[Character]</code> <code>manyCharacter</code></p>\n<p><code>[Character]</code>  <code>String([Character])</code>  <code>String</code> <code>digit</code> character <code>String([Character])</code>  <code>Int(String)</code>  <code>number</code></p>\n<p> Swift  OOP <code>Combinable</code> :D</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">protocol</span> <span class=\"title\">Combinable</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">combine</span>(<span class=\"keyword\">_</span> <span class=\"params\">xs</span>: [<span class=\"type\">Character</span>])</span> -&gt; <span class=\"keyword\">Self</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">Int</span>: <span class=\"title\">Combinable</span> </span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">combine</span>(<span class=\"keyword\">_</span> <span class=\"params\">xs</span>: [<span class=\"type\">Character</span>])</span> -&gt; <span class=\"type\">Int</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"type\">Int</span>(<span class=\"type\">String</span>(describing: xs))<span class=\"operator\">!</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">String</span>: <span class=\"title\">Combinable</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">combine</span>(<span class=\"keyword\">_</span> <span class=\"params\">xs</span>: [<span class=\"type\">Character</span>])</span> -&gt; <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"type\">String</span>(describing: xs)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">many1</span>&lt;<span class=\"type\">A</span>: <span class=\"type\">Combinable</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">x</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">Character</span>&gt;)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (<span class=\"keyword\">_</span>, <span class=\"keyword\">_</span>) <span class=\"operator\">=</span> x.parse(input) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> results: [<span class=\"type\">Character</span>] <span class=\"operator\">=</span> []</span><br><span class=\"line\">        <span class=\"keyword\">var</span> stream <span class=\"operator\">=</span> input</span><br><span class=\"line\">        <span class=\"keyword\">while</span> <span class=\"keyword\">let</span> (result, remainder) <span class=\"operator\">=</span> x.parse(stream) &#123;</span><br><span class=\"line\">            results.append(result)</span><br><span class=\"line\">            stream <span class=\"operator\">=</span> remainder</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (<span class=\"type\">A</span>.combine(results), stream)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">number</span>()</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">Int</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> many1(digit())</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">spaces</span>()</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> many1(space()) <span class=\"comment\">//  spaces </span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>skipSpaces</code>  <em>many</em>  <em>skip</em>  <em>skip</em>  <em>many</em>  <code>skip</code>  <code>many</code>  parser  <code>skipMany</code>  <strong>Combinator</strong>  parser case</p>\n<h4 id=\"Zip\"><a href=\"#Zip\" class=\"headerlink\" title=\"Zip\"></a>Zip</h4><p> parser  <code>zip</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">zip</span>&lt;<span class=\"type\">A</span>, <span class=\"type\">B</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">x</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt;, <span class=\"keyword\">_</span> <span class=\"params\">y</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">B</span>&gt;)</span> -&gt; <span class=\"type\">Parser</span>&lt;(<span class=\"type\">A</span>, <span class=\"type\">B</span>)&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (result1, remainder1) <span class=\"operator\">=</span> x.parse(input) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (result2, remainder2) <span class=\"operator\">=</span> y.parse(remainder1) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ((result1, result2), remainder2)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Choice\"><a href=\"#Choice\" class=\"headerlink\" title=\"Choice\"></a>Choice</h4><p> <code>+</code> <code>-</code> <code>*</code> <code>/</code></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">opt</span>()</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">Character</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> opts <span class=\"operator\">=</span> [<span class=\"string\">&quot;+&quot;</span>, <span class=\"string\">&quot;-&quot;</span>, <span class=\"string\">&quot;*&quot;</span>, <span class=\"string\">&quot;/&quot;</span>].map &#123; character(<span class=\"variable\">$0</span>.characters.first<span class=\"operator\">!</span>) &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> choice(opts)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//  one(of:)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">choice</span>&lt;<span class=\"type\">A</span>, <span class=\"type\">S</span>: <span class=\"type\">Sequence</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">xs</span>: <span class=\"type\">S</span>)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt; <span class=\"keyword\">where</span> <span class=\"type\">S</span>.<span class=\"type\">Iterator</span>.<span class=\"type\">Element</span> <span class=\"operator\">==</span> <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> xs.reduce(empty(), &#123; <span class=\"variable\">$0</span> <span class=\"operator\">&lt;|&gt;</span> <span class=\"variable\">$1</span> &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">empty</span>&lt;<span class=\"type\">A</span>&gt;()</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; <span class=\"keyword\">_</span> <span class=\"keyword\">in</span> <span class=\"literal\">nil</span> &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Transform\"><a href=\"#Transform\" class=\"headerlink\" title=\"Transform\"></a>Transform</h2><p> Protocol  <code>number</code>  <code>space</code>  <code>many</code>  <del></del> <strong></strong> <code>Combinable</code>  <code>Parser&lt;A&gt;</code>  <code>[A]</code>  <code>many</code> <strong></strong>  <code>Parser&lt;[A]</code>  <code>Parser&lt;B&gt;</code> <code>many</code>  <code>many</code> </p>\n<p> <code>func character(_ character: Character) -&gt; Parser&lt;Character&gt;</code>  <code>character(&quot;4&quot;)</code> <code>Parser&lt;Character&gt;</code>  <code>parse</code>  <code>Character</code>  <code>4 + 3</code>  <code>4</code>  <code>3</code>  <code>Character</code>  <code>Int</code>  <code>Parser&lt;Character&gt;</code>  <code>Parser&lt;Int&gt;</code> </p>\n<p> <code>Parser&lt;A&gt;</code>  <code>Parser&lt;B&gt;</code> <code>many</code>  <code>Parser&lt;A&gt;</code>  <code>Parser&lt;[A]&gt;</code> <code>number</code>  <code>Parser&lt;[A]&gt;</code>  <code>Parser&lt;Int&gt;</code></p>\n<h3 id=\"Functor\"><a href=\"#Functor\" class=\"headerlink\" title=\"Functor\"></a>Functor</h3><p> Swift  Optional  map </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> a: <span class=\"type\">Optional</span>&lt;<span class=\"type\">Int</span>&gt; <span class=\"operator\">=</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> b: <span class=\"type\">Optional</span>&lt;<span class=\"type\">String</span>&gt; <span class=\"operator\">=</span> a.map &#123; <span class=\"type\">String</span>(<span class=\"variable\">$0</span>) &#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>Optional&lt;Int&gt;</code>  <code>Optional&lt;String&gt;</code> <code>Optional</code>  <code>Parser</code></p>\n<p><code>Optional</code>  <code>func map&lt;U&gt;(_ transform: (Wrapped) -&gt; U) -&gt; U?</code></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Parser</span>&lt;<span class=\"title\">A</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">map</span>&lt;<span class=\"type\">B</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">transform</span>: (<span class=\"type\">A</span>) -&gt; <span class=\"type\">B</span>)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">B</span>&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">            <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (result, remainder) <span class=\"operator\">=</span> <span class=\"keyword\">self</span>.parse(input) <span class=\"keyword\">else</span> &#123; <span class=\"keyword\">return</span> <span class=\"literal\">nil</span> &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> (transform(result), remainder)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>satisfy</code>  <code>map</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">map</span>&lt;<span class=\"type\">A</span>, <span class=\"type\">B</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">x</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt;, <span class=\"keyword\">_</span> <span class=\"params\">f</span>: <span class=\"keyword\">@escaping</span> (<span class=\"type\">A</span>) -&gt; <span class=\"type\">B</span>)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">B</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (result, remainder) <span class=\"operator\">=</span> x.parse(input)<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (f(result), remainder)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>Parser</code>  <code>Parser&lt;Character</code>  <code>Parser&lt;Int&gt;</code> <code>Parser&lt;Character&gt;</code> <Character><Int> <code>map</code>  <code>(Character) -&gt; Int</code></p>\n<p> <code>number</code>  <code>spaces</code></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">number</span>()</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">Int</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> map(many1(digit()), &#123; <span class=\"type\">Int</span>(<span class=\"type\">String</span>(<span class=\"variable\">$0</span>))<span class=\"operator\">!</span> &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">spaces</span>()</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> map(many(space()), &#123; <span class=\"type\">String</span>(<span class=\"variable\">$0</span>) &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>Optional&lt;T&gt;</code>  <code>Parser&lt;A&gt;</code> <code>map</code>  <code>map</code>  <code>Functor</code></p>\n<blockquote>\n<p> <code>Functor</code>  <strong></strong>  <strong></strong></p>\n</blockquote>\n<p><code>Functor</code>  <code>Functor</code> Category Theory <code>Functor</code> Functor  <a href=\"http://blessingsoft.com/2017/06/12/group-theory-and-category-theory/\">Group Theory and Category Theory</a></p>\n<h3 id=\"Applicative\"><a href=\"#Applicative\" class=\"headerlink\" title=\"Applicative\"></a>Applicative</h3><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">pure</span>&lt;<span class=\"type\">A</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">x</span>: <span class=\"type\">A</span>)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt; &#123; (x, <span class=\"variable\">$0</span>) &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>pure</code>  <code>discarding</code>  Applicative <code>discarding</code>  <code>discarding</code>  parser  parser  symbol <code>discarding2(parser, string(&quot;)&quot;))</code>  )</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">discarding2</span>&lt;<span class=\"type\">A</span>, <span class=\"type\">B</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">x</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt;, <span class=\"keyword\">_</span> <span class=\"params\">y</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">B</span>&gt;)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">B</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (result1, remainder1) <span class=\"operator\">=</span> x.parse(input) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (<span class=\"keyword\">_</span>, remainder2) <span class=\"operator\">=</span> y.parse(remainder1) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//  result1 result2</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> (result1, remainder2)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">discarding1</span>&lt;<span class=\"type\">A</span>, <span class=\"type\">B</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">x</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt;, <span class=\"keyword\">_</span> <span class=\"params\">y</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">B</span>&gt;)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">B</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (<span class=\"keyword\">_</span>, remainder1) <span class=\"operator\">=</span> x.parse(input) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (result2, remainder2) <span class=\"operator\">=</span> y.parse(remainder1) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//  result2 result1</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> (result2, remainder2)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>discarding</code> </p>\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">///  B</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">f</span>&lt;<span class=\"type\">A</span>, <span class=\"type\">B</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">a</span>: <span class=\"type\">A</span>, <span class=\"keyword\">_</span> <span class=\"params\">b</span>: <span class=\"type\">B</span>)</span> -&gt; <span class=\"type\">A</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">///  A</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">f</span>&lt;<span class=\"type\">A</span>, <span class=\"type\">B</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">a</span>: <span class=\"type\">A</span>, <span class=\"keyword\">_</span> <span class=\"params\">b</span>: <span class=\"type\">B</span>)</span> -&gt; <span class=\"type\">B</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> b</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">left</span>&lt;<span class=\"type\">A</span>, <span class=\"type\">B</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">x</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt;, <span class=\"keyword\">_</span> <span class=\"params\">y</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">B</span>&gt;)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">B</span>&gt; &#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">discarding</span>&lt;<span class=\"type\">A</span>, <span class=\"type\">B</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">a</span>: <span class=\"type\">A</span>, <span class=\"keyword\">_</span> <span class=\"params\">b</span>: <span class=\"type\">B</span>)</span> -&gt; <span class=\"type\">A</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> b</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (result1, remainder1) <span class=\"operator\">=</span> x.parse(input) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (result2, remainder2) <span class=\"operator\">=</span> y.parse(remainder1) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (discarding(result1, result2), remainder2)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<h3 id=\"Monad\"><a href=\"#Monad\" class=\"headerlink\" title=\"Monad\"></a>Monad</h3><p> <code>map</code>  <code>func map&lt;A, B&gt;(_ x: Parser&lt;A&gt;, _ f: (A) -&gt; B) -&gt; Parser&lt;B&gt;</code></p>\n<p> <code>Parser&lt;A&gt;</code> <code>A -&gt; B</code> <strong>Combinator</strong> <strong>Parser Combinator</strong>  <code>Parser</code>  parser <code>func string(_ str: String) -&gt; Parser&lt;String&gt;</code> <code>(String) -&gt; Parser&lt;String&gt;</code> <code>map</code>  <code>(A) -&gt; B</code> <code>(A) -&gt; Parser&lt;B&gt;</code> <code>map</code>  <code>(A) -&gt; Parser&lt;B&gt;</code> <code>parser</code>  <code>Parser</code></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">flatMap</span>&lt;<span class=\"type\">A</span>, <span class=\"type\">B</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">x</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt;, <span class=\"keyword\">_</span> <span class=\"params\">f</span>: (<span class=\"type\">A</span>) -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">B</span>&gt;)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">B</span>&gt;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> parser <span class=\"operator\">=</span> flatMap(stringParser, string(<span class=\"string\">&quot;alex&quot;</span>))</span><br></pre></td></tr></table></figure>\n\n<p> <code>map</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">flatMap</span>&lt;<span class=\"type\">A</span>, <span class=\"type\">B</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">x</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt;, <span class=\"keyword\">_</span> <span class=\"params\">f</span>: <span class=\"keyword\">@escaping</span> (<span class=\"type\">A</span>) -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">B</span>&gt;)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">B</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> (result, remainder) <span class=\"operator\">=</span> x.parse(input)<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> f(result).parse(remainder)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"http://blessingsoft.com/2017/06/12/group-theory-and-category-theory/\">Group Theory and Category Theory</a></p>\n<h3 id=\"Alternative\"><a href=\"#Alternative\" class=\"headerlink\" title=\"Alternative\"></a>Alternative</h3><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">empty</span>&lt;<span class=\"type\">A</span>&gt;()</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; <span class=\"keyword\">_</span> <span class=\"keyword\">in</span> <span class=\"literal\">nil</span> &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">choice</span>&lt;<span class=\"type\">A</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">x</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt;, <span class=\"keyword\">_</span> <span class=\"params\">y</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt;)</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Parser</span> &#123; input <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> x.parse(input) <span class=\"operator\">??</span> y.parse(input)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Alternative  <code>Swift Standard Library</code>  <code>??</code> <code>parser</code> <code>parser</code> <code>parser</code>  <code>parser</code>  <code>Parser</code></p>\n<p> Int, String, Bool  <code>parser</code> scalar  <code>parser</code>  Int, String, Bool  scalar  Int, String, Bool  <code>Parser&lt;Int&gt;</code>, <code>Parser&lt;String&gt;</code>, <code>Parser&lt;Bool&gt;</code>  parser  <code>Parser&lt;Scalar&gt;</code>  parse</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> scalar <span class=\"operator\">=</span> parserInt <span class=\"operator\">&lt;|&gt;</span> parserString <span class=\"operator\">&lt;|&gt;</span> parserBool</span><br></pre></td></tr></table></figure>\n\n<p> one of  choice</p>\n<h3 id=\"Applicative-amp-Monad\"><a href=\"#Applicative-amp-Monad\" class=\"headerlink\" title=\"Applicative &amp; Monad\"></a>Applicative &amp; Monad</h3><p>Applicative  Monad </p>\n<p>Applicative  parser  parser  Monad Monad </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">alex</span>(<span class=\"keyword\">_</span> <span class=\"params\">x</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">String</span>&gt;)</span> -&gt; <span class=\"type\">Bool</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> (<span class=\"keyword\">_</span>, <span class=\"keyword\">_</span>) <span class=\"operator\">=</span> x.parse(<span class=\"string\">&quot;alex.huo&quot;</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> af: <span class=\"type\">Parser</span>&lt;(<span class=\"type\">String</span>) -&gt; <span class=\"type\">String</span>&gt; <span class=\"operator\">=</span> pure(id)</span><br><span class=\"line\"><span class=\"keyword\">let</span> ax <span class=\"operator\">=</span> string(<span class=\"string\">&quot;alex&quot;</span>)</span><br><span class=\"line\">alex(af <span class=\"operator\">&lt;*&gt;</span> ax) <span class=\"comment\">// true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> mf: (<span class=\"type\">String</span>) -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">String</span>&gt; <span class=\"operator\">=</span> &#123; string(<span class=\"variable\">$0</span>) &#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> mx <span class=\"operator\">=</span> string(<span class=\"string\">&quot;alex&quot;</span>)</span><br><span class=\"line\">alex(mx <span class=\"operator\">&gt;&gt;-</span> mf) <span class=\"comment\">// false</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Ref\"><a href=\"#Ref\" class=\"headerlink\" title=\"Ref\"></a>Ref</h2><p><a href=\"https://github.com/hlian/jiffy\">Jiffy</a><br><a href=\"https://news.realm.io/news/tryswift-yasuhiro-inami-parser-combinator/\">Parser combinators</a><br><a href=\"http://www.cs.nott.ac.uk/~pszgmh/monparsing.pdf\">Monadic Parser Combinators</a></p>\n"},{"title":"PATs","date":"2018-08-26T12:00:00.000Z","_content":">  Swift  [SE-0309](https://github.com/apple/swift-evolution/blob/main/proposals/0309-unlock-existential-types-for-all-protocols.md)  [SE-0335](https://github.com/apple/swift-evolution/blob/main/proposals/0335-existential-any.md) Swift  Protocol --2022.01.01\n\n>  Swift Protocol with Associated Types\n\n## Protocol-Oriented Programming\n\n Swift  ****  [Standard Library](https://github.com/apple/swift)  POP \n\n POP  Cache\n\n```swift\nprotocol Caching {\n    var name: String { get }\n}\n\nstruct MemoryCache: Caching {\n    var name: String {\n        return \"Memory Cache\"\n    }\n}\n\nstruct DiskCache: Caching {\n    var name: String {\n        return \"Disk Cache\"\n    }\n}\n\nlet memory: Caching = MemoryCache() // \nlet disk: Caching = DiskCache() // \nlet caches: [Caching] = [memory, disk] // \n```\n\n work** *protocol* **\n\n## Generics\n\n> \n\nCache   `as? XXX`\n\n\n\n```swift\nprotocol Caching {\n    associatedtype Object\n\n    func store(_ object: Object, forKey key: String)\n    func retrieve(forKey key: String) -> Object?\n}\n\nstruct MemoryCache: Caching {\n    typealias Object = UIImage\n\n    func store(_ object: Object, forKey key: String) {\n        //\n    }\n    func retrieve(forKey key: String) -> Object? {\n        //\n    }\n}\n\nstruct DiskCache: Caching {\n    typealias Object = UIImage\n\n    func store(_ object: Object, forKey key: String) {\n        //\n    }\n    func retrieve(forKey key: String) -> Object? {\n        //\n    }\n}\n\nlet memory: Caching = MemoryCache() // \nlet disk: Caching = DiskCache() // \nlet caches: [Caching] = [memory, disk] // \n```\n\n Xcode \n\n> Protocol 'Caching' can only be used as generic constraint because it has Self or associated type requirements\n\nWTF?\n\n## What is Protocol with Associated Types?\n\n Swift  `Caching` \n\n **\n\n```swift\nlet cache: Caching<UIImage> =  ...\n// Protocol 'Caching' can only be used as generic constraint because it has Self or associated type requirements\n```\n\n```swift\nprotocol Caching<Object> {\n}\n// Protocols do not allow generic parameters; use associated types instead\n```\n\nWTF\n\n## Protocol as Types\n\n protocol[Protocols  The Swift Programming Language (Swift 4.2)](https://docs.swift.org/swift-book/LanguageGuide/Protocols.html) Protocol as Types \n\n> Protocols dont actually implement any functionality themselves. Nonetheless, any protocol you create will become a fully-fledged type for use in your code.\n> Because its a type, you can use a protocol in many places where other types are allowed, including:\n> * As a parameter type or return type in a function, method, or initializer\n> * As the type of a constant, variable, or property\n> * As the type of items in an array, dictionary, or other container\n\n protocol + generic \n\n## PATs in Swift Standard Library\n\n Standard Library \n\n```swift\npublic protocol IteratorProtocol {\n    /// The type of element traversed by the iterator.\n    associatedtype Element\n\n    /// - Returns: The next element in the underlying sequence, if a next element\n    ///   exists; otherwise, `nil`.\n    mutating func next() -> Element?\n}\n\npublic protocol Sequence {\n    /// A type representing the sequence's elements.\n    associatedtype Element\n\n    /// A type that provides the sequence's iteration interface and\n    /// encapsulates its iteration state.\n    associatedtype Iterator : IteratorProtocol where Iterator.Element == Element\n\n    /// Returns an iterator over the elements of this sequence.\n    func makeIterator() -> Iterator\n}\n```\n\n `AnyIterator`  `AnySequence` \n\n```swift\npublic struct AnyIterator<Element> {\n    internal let _box: _AnyIteratorBoxBase<Element>\n\n    public init<I : IteratorProtocol>(_ base: I) where I.Element == Element {\n        self._box = _IteratorBox(base)\n    }\n\n    public init(_ body: @escaping () -> Element?) {\n        self._box = _IteratorBox(_ClosureBasedIterator(body))\n    }\n\n    internal init(_box: _AnyIteratorBoxBase<Element>) {\n        self._box = _box\n    }\n}\n\nextension AnyIterator: IteratorProtocol {\n\n    public func next() -> Element? {\n        return _box.next()\n    }\n}\n\npublic struct AnySequence<Element> {\n    internal let _box: _AnySequenceBox<Element>\n\n    public init<I : IteratorProtocol>(_ makeUnderlyingIterator: @escaping () -> I) where I.Element == Element {\n        self.init(_ClosureBasedSequence(makeUnderlyingIterator))\n    }\n\n    internal init(_box: _AnySequenceBox<Element>) {\n        self._box = _box\n    }\n}\n\nextension AnySequence: Sequence {\n    public typealias Iterator = AnyIterator<Element>\n\n    public init<S : Sequence>(_ base: S) where S.Element == Element {\n        self._box = _SequenceBox(_base: base)\n    }\n}\n```\n\n\n\n> This iterator forwards its next() method to an arbitrary underlying iterator having the same Element type, hiding the specifics of the underlying IteratorProtocol. [AnyIterator - Swift Standard Library | Apple Developer Documentation](https://developer.apple.com/documentation/swift/anyiterator)\n\n> An instance of AnySequence forwards its operations to an underlying base sequence having the same Element type, hiding the specifics of the underlying sequence.[AnySequence - Swift Standard Library | Apple Developer Documentation](https://developer.apple.com/documentation/swift/anysequence)\n\n **Type Erasure**\n\n## What is Type Erasure?\n\n Swift \n\n* Concrete Type: Int, Bool\n* Abstract Type: associatedType, <T>\n\nSwift \n\n> Type erasure is a process in code that makes abstract types concrete.\n\n Swift Standard Library \n\n```swift\n// 1. abstract base\ninternal class _AnyIteratorBoxBase<Element> : IteratorProtocol {\n    internal init() {}\n\n    internal func next() -> Element? { _abstract() }\n}\n\n// 2. private box\ninternal final class _IteratorBox<Base : IteratorProtocol> : _AnyIteratorBoxBase<Base.Element> {\n    internal init(_ base: Base) { self._base = base }\n\n    internal override func next() -> Base.Element? { return _base.next() }\n\n    internal var _base: Base\n}\n\n// 3. public wrapper\npublic struct AnyIterator<Element> {\n    internal let _box: _AnyIteratorBoxBase<Element>\n\n    public init<I : IteratorProtocol>(_ base: I) where I.Element == Element {\n        self._box = _IteratorBox(base)\n    }\n\n    public init(_ body: @escaping () -> Element?) {\n        self._box = _IteratorBox(_ClosureBasedIterator(body))\n    }\n\n    internal init(_box: _AnyIteratorBoxBase<Element>) {\n        self._box = _box\n    }\n}\n```\n\n\n\n* an abstract base class\n* a private box class\n* a public wrapper class\n\n*Existential* \n\n## One more thing\n\n PATs \n\n```swift\nprotocol Logging: Hashtable {\n}\n```\n\n```swift\nlet loggers: Set<Logging> = []\n// Using 'Logging' as a concrete type conforming to protocol 'Hashable' is no supported\n```\n\n```swift\nfunc add(_ logger: Logging) {\n}\n// Protocol 'Logging' can only be used as generic constraint because it has Self or associated type requirements\n```\n\n `Hashable`  `Equatable`  `Equatable`  `Self`  PATs \n\n type erasure \n\n```swift\n// 1. abstract baes\nclass _AnyLoggerBoxBase<T> : Logging {\n}\n\n// 2. private box\nclass _LoggerBox<Base : Logging> : _AnyLoggerBoxBase <Base.Self> {\n}\n\n// 3. public wrapper\nstruct AnyLogger<T> {\n    init<L : Logging>(_ base: L) where L.Self == Self {\n    }\n}\n```\n\n\n\n>  \n\n Swift  `AnyHashable` \n\n## Ref\n\n* [Alexis Gallagher - Protocols with Associated Types - YouTube](https://www.youtube.com/watch?v=XWoNjiSPqI8&t=2391s)\n* [Keep Calm and Type Erase On](https://academy.realm.io/posts/tryswift-gwendolyn-weston-type-erasure/)\n* [AnySequence - Swift Standard Library | Apple Developer Documentation](https://developer.apple.com/documentation/swift/anysequence)\n* [swift/ExistentialCollection.swift.gyb at master  apple/swift  GitHub](https://github.com/apple/swift/blob/master/stdlib/public/core/ExistentialCollection.swift.gyb)\n* [swift/AnyHashable.swift at master  apple/swift  GitHub](https://github.com/apple/swift/blob/master/stdlib/public/core/AnyHashable.swift)","source":"_posts/pats.md","raw":"---\ntitle: PATs\ndate: 2018-08-26 20:00:00\ntags:\n\t- swift\n\t- type erasure\n\t- type erased\n\t- pats\n\t- protocol\n\t- generic\ncategories: advanced swift\n---\n>  Swift  [SE-0309](https://github.com/apple/swift-evolution/blob/main/proposals/0309-unlock-existential-types-for-all-protocols.md)  [SE-0335](https://github.com/apple/swift-evolution/blob/main/proposals/0335-existential-any.md) Swift  Protocol --2022.01.01\n\n>  Swift Protocol with Associated Types\n\n## Protocol-Oriented Programming\n\n Swift  ****  [Standard Library](https://github.com/apple/swift)  POP \n\n POP  Cache\n\n```swift\nprotocol Caching {\n    var name: String { get }\n}\n\nstruct MemoryCache: Caching {\n    var name: String {\n        return \"Memory Cache\"\n    }\n}\n\nstruct DiskCache: Caching {\n    var name: String {\n        return \"Disk Cache\"\n    }\n}\n\nlet memory: Caching = MemoryCache() // \nlet disk: Caching = DiskCache() // \nlet caches: [Caching] = [memory, disk] // \n```\n\n work** *protocol* **\n\n## Generics\n\n> \n\nCache   `as? XXX`\n\n\n\n```swift\nprotocol Caching {\n    associatedtype Object\n\n    func store(_ object: Object, forKey key: String)\n    func retrieve(forKey key: String) -> Object?\n}\n\nstruct MemoryCache: Caching {\n    typealias Object = UIImage\n\n    func store(_ object: Object, forKey key: String) {\n        //\n    }\n    func retrieve(forKey key: String) -> Object? {\n        //\n    }\n}\n\nstruct DiskCache: Caching {\n    typealias Object = UIImage\n\n    func store(_ object: Object, forKey key: String) {\n        //\n    }\n    func retrieve(forKey key: String) -> Object? {\n        //\n    }\n}\n\nlet memory: Caching = MemoryCache() // \nlet disk: Caching = DiskCache() // \nlet caches: [Caching] = [memory, disk] // \n```\n\n Xcode \n\n> Protocol 'Caching' can only be used as generic constraint because it has Self or associated type requirements\n\nWTF?\n\n## What is Protocol with Associated Types?\n\n Swift  `Caching` \n\n **\n\n```swift\nlet cache: Caching<UIImage> =  ...\n// Protocol 'Caching' can only be used as generic constraint because it has Self or associated type requirements\n```\n\n```swift\nprotocol Caching<Object> {\n}\n// Protocols do not allow generic parameters; use associated types instead\n```\n\nWTF\n\n## Protocol as Types\n\n protocol[Protocols  The Swift Programming Language (Swift 4.2)](https://docs.swift.org/swift-book/LanguageGuide/Protocols.html) Protocol as Types \n\n> Protocols dont actually implement any functionality themselves. Nonetheless, any protocol you create will become a fully-fledged type for use in your code.\n> Because its a type, you can use a protocol in many places where other types are allowed, including:\n> * As a parameter type or return type in a function, method, or initializer\n> * As the type of a constant, variable, or property\n> * As the type of items in an array, dictionary, or other container\n\n protocol + generic \n\n## PATs in Swift Standard Library\n\n Standard Library \n\n```swift\npublic protocol IteratorProtocol {\n    /// The type of element traversed by the iterator.\n    associatedtype Element\n\n    /// - Returns: The next element in the underlying sequence, if a next element\n    ///   exists; otherwise, `nil`.\n    mutating func next() -> Element?\n}\n\npublic protocol Sequence {\n    /// A type representing the sequence's elements.\n    associatedtype Element\n\n    /// A type that provides the sequence's iteration interface and\n    /// encapsulates its iteration state.\n    associatedtype Iterator : IteratorProtocol where Iterator.Element == Element\n\n    /// Returns an iterator over the elements of this sequence.\n    func makeIterator() -> Iterator\n}\n```\n\n `AnyIterator`  `AnySequence` \n\n```swift\npublic struct AnyIterator<Element> {\n    internal let _box: _AnyIteratorBoxBase<Element>\n\n    public init<I : IteratorProtocol>(_ base: I) where I.Element == Element {\n        self._box = _IteratorBox(base)\n    }\n\n    public init(_ body: @escaping () -> Element?) {\n        self._box = _IteratorBox(_ClosureBasedIterator(body))\n    }\n\n    internal init(_box: _AnyIteratorBoxBase<Element>) {\n        self._box = _box\n    }\n}\n\nextension AnyIterator: IteratorProtocol {\n\n    public func next() -> Element? {\n        return _box.next()\n    }\n}\n\npublic struct AnySequence<Element> {\n    internal let _box: _AnySequenceBox<Element>\n\n    public init<I : IteratorProtocol>(_ makeUnderlyingIterator: @escaping () -> I) where I.Element == Element {\n        self.init(_ClosureBasedSequence(makeUnderlyingIterator))\n    }\n\n    internal init(_box: _AnySequenceBox<Element>) {\n        self._box = _box\n    }\n}\n\nextension AnySequence: Sequence {\n    public typealias Iterator = AnyIterator<Element>\n\n    public init<S : Sequence>(_ base: S) where S.Element == Element {\n        self._box = _SequenceBox(_base: base)\n    }\n}\n```\n\n\n\n> This iterator forwards its next() method to an arbitrary underlying iterator having the same Element type, hiding the specifics of the underlying IteratorProtocol. [AnyIterator - Swift Standard Library | Apple Developer Documentation](https://developer.apple.com/documentation/swift/anyiterator)\n\n> An instance of AnySequence forwards its operations to an underlying base sequence having the same Element type, hiding the specifics of the underlying sequence.[AnySequence - Swift Standard Library | Apple Developer Documentation](https://developer.apple.com/documentation/swift/anysequence)\n\n **Type Erasure**\n\n## What is Type Erasure?\n\n Swift \n\n* Concrete Type: Int, Bool\n* Abstract Type: associatedType, <T>\n\nSwift \n\n> Type erasure is a process in code that makes abstract types concrete.\n\n Swift Standard Library \n\n```swift\n// 1. abstract base\ninternal class _AnyIteratorBoxBase<Element> : IteratorProtocol {\n    internal init() {}\n\n    internal func next() -> Element? { _abstract() }\n}\n\n// 2. private box\ninternal final class _IteratorBox<Base : IteratorProtocol> : _AnyIteratorBoxBase<Base.Element> {\n    internal init(_ base: Base) { self._base = base }\n\n    internal override func next() -> Base.Element? { return _base.next() }\n\n    internal var _base: Base\n}\n\n// 3. public wrapper\npublic struct AnyIterator<Element> {\n    internal let _box: _AnyIteratorBoxBase<Element>\n\n    public init<I : IteratorProtocol>(_ base: I) where I.Element == Element {\n        self._box = _IteratorBox(base)\n    }\n\n    public init(_ body: @escaping () -> Element?) {\n        self._box = _IteratorBox(_ClosureBasedIterator(body))\n    }\n\n    internal init(_box: _AnyIteratorBoxBase<Element>) {\n        self._box = _box\n    }\n}\n```\n\n\n\n* an abstract base class\n* a private box class\n* a public wrapper class\n\n*Existential* \n\n## One more thing\n\n PATs \n\n```swift\nprotocol Logging: Hashtable {\n}\n```\n\n```swift\nlet loggers: Set<Logging> = []\n// Using 'Logging' as a concrete type conforming to protocol 'Hashable' is no supported\n```\n\n```swift\nfunc add(_ logger: Logging) {\n}\n// Protocol 'Logging' can only be used as generic constraint because it has Self or associated type requirements\n```\n\n `Hashable`  `Equatable`  `Equatable`  `Self`  PATs \n\n type erasure \n\n```swift\n// 1. abstract baes\nclass _AnyLoggerBoxBase<T> : Logging {\n}\n\n// 2. private box\nclass _LoggerBox<Base : Logging> : _AnyLoggerBoxBase <Base.Self> {\n}\n\n// 3. public wrapper\nstruct AnyLogger<T> {\n    init<L : Logging>(_ base: L) where L.Self == Self {\n    }\n}\n```\n\n\n\n>  \n\n Swift  `AnyHashable` \n\n## Ref\n\n* [Alexis Gallagher - Protocols with Associated Types - YouTube](https://www.youtube.com/watch?v=XWoNjiSPqI8&t=2391s)\n* [Keep Calm and Type Erase On](https://academy.realm.io/posts/tryswift-gwendolyn-weston-type-erasure/)\n* [AnySequence - Swift Standard Library | Apple Developer Documentation](https://developer.apple.com/documentation/swift/anysequence)\n* [swift/ExistentialCollection.swift.gyb at master  apple/swift  GitHub](https://github.com/apple/swift/blob/master/stdlib/public/core/ExistentialCollection.swift.gyb)\n* [swift/AnyHashable.swift at master  apple/swift  GitHub](https://github.com/apple/swift/blob/master/stdlib/public/core/AnyHashable.swift)","slug":"pats","published":1,"updated":"2022-01-02T11:27:52.361Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckxx810xf000g9ith0tr985fe","content":"<blockquote>\n<p> Swift  <a href=\"https://github.com/apple/swift-evolution/blob/main/proposals/0309-unlock-existential-types-for-all-protocols.md\">SE-0309</a>  <a href=\"https://github.com/apple/swift-evolution/blob/main/proposals/0335-existential-any.md\">SE-0335</a> Swift  Protocol 2022.01.01</p>\n</blockquote>\n<blockquote>\n<p> Swift Protocol with Associated Types</p>\n</blockquote>\n<h2 id=\"Protocol-Oriented-Programming\"><a href=\"#Protocol-Oriented-Programming\" class=\"headerlink\" title=\"Protocol-Oriented Programming\"></a>Protocol-Oriented Programming</h2><p> Swift  <strong></strong>  <a href=\"https://github.com/apple/swift\">Standard Library</a>  POP </p>\n<p> POP  Cache</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">protocol</span> <span class=\"title\">Caching</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> name: <span class=\"type\">String</span> &#123; <span class=\"keyword\">get</span> &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">MemoryCache</span>: <span class=\"title\">Caching</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> name: <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;Memory Cache&quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">DiskCache</span>: <span class=\"title\">Caching</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> name: <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;Disk Cache&quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> memory: <span class=\"type\">Caching</span> <span class=\"operator\">=</span> <span class=\"type\">MemoryCache</span>() <span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">let</span> disk: <span class=\"type\">Caching</span> <span class=\"operator\">=</span> <span class=\"type\">DiskCache</span>() <span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">let</span> caches: [<span class=\"type\">Caching</span>] <span class=\"operator\">=</span> [memory, disk] <span class=\"comment\">// </span></span><br></pre></td></tr></table></figure>\n\n<p> work<strong> <em>protocol</em> </strong></p>\n<h2 id=\"Generics\"><a href=\"#Generics\" class=\"headerlink\" title=\"Generics\"></a>Generics</h2><blockquote>\n<p></p>\n</blockquote>\n<p>Cache   <code>as? XXX</code></p>\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">protocol</span> <span class=\"title\">Caching</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">associatedtype</span> <span class=\"type\">Object</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">store</span>(<span class=\"keyword\">_</span> <span class=\"params\">object</span>: <span class=\"type\">Object</span>, <span class=\"params\">forKey</span> <span class=\"params\">key</span>: <span class=\"type\">String</span>)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">retrieve</span>(<span class=\"params\">forKey</span> <span class=\"params\">key</span>: <span class=\"type\">String</span>)</span> -&gt; <span class=\"type\">Object</span>?</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">MemoryCache</span>: <span class=\"title\">Caching</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">typealias</span> <span class=\"type\">Object</span> <span class=\"operator\">=</span> <span class=\"type\">UIImage</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">store</span>(<span class=\"keyword\">_</span> <span class=\"params\">object</span>: <span class=\"type\">Object</span>, <span class=\"params\">forKey</span> <span class=\"params\">key</span>: <span class=\"type\">String</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">retrieve</span>(<span class=\"params\">forKey</span> <span class=\"params\">key</span>: <span class=\"type\">String</span>)</span> -&gt; <span class=\"type\">Object</span>? &#123;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">DiskCache</span>: <span class=\"title\">Caching</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">typealias</span> <span class=\"type\">Object</span> <span class=\"operator\">=</span> <span class=\"type\">UIImage</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">store</span>(<span class=\"keyword\">_</span> <span class=\"params\">object</span>: <span class=\"type\">Object</span>, <span class=\"params\">forKey</span> <span class=\"params\">key</span>: <span class=\"type\">String</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">retrieve</span>(<span class=\"params\">forKey</span> <span class=\"params\">key</span>: <span class=\"type\">String</span>)</span> -&gt; <span class=\"type\">Object</span>? &#123;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> memory: <span class=\"type\">Caching</span> <span class=\"operator\">=</span> <span class=\"type\">MemoryCache</span>() <span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">let</span> disk: <span class=\"type\">Caching</span> <span class=\"operator\">=</span> <span class=\"type\">DiskCache</span>() <span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">let</span> caches: [<span class=\"type\">Caching</span>] <span class=\"operator\">=</span> [memory, disk] <span class=\"comment\">// </span></span><br></pre></td></tr></table></figure>\n\n<p> Xcode </p>\n<blockquote>\n<p>Protocol Caching can only be used as generic constraint because it has Self or associated type requirements</p>\n</blockquote>\n<p>WTF?</p>\n<h2 id=\"What-is-Protocol-with-Associated-Types\"><a href=\"#What-is-Protocol-with-Associated-Types\" class=\"headerlink\" title=\"What is Protocol with Associated Types?\"></a>What is Protocol with Associated Types?</h2><p> Swift  <code>Caching</code> </p>\n<p> <em></em></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> cache: <span class=\"type\">Caching</span>&lt;<span class=\"type\">UIImage</span>&gt; <span class=\"operator\">=</span>  <span class=\"operator\">...</span></span><br><span class=\"line\"><span class=\"comment\">// Protocol &#x27;Caching&#x27; can only be used as generic constraint because it has Self or associated type requirements</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">protocol</span> <span class=\"title\">Caching</span>&lt;<span class=\"title\">Object</span>&gt; </span>&#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// Protocols do not allow generic parameters; use associated types instead</span></span><br></pre></td></tr></table></figure>\n\n<p>WTF</p>\n<h2 id=\"Protocol-as-Types\"><a href=\"#Protocol-as-Types\" class=\"headerlink\" title=\"Protocol as Types\"></a>Protocol as Types</h2><p> protocol<a href=\"https://docs.swift.org/swift-book/LanguageGuide/Protocols.html\">Protocols  The Swift Programming Language (Swift 4.2)</a> Protocol as Types </p>\n<blockquote>\n<p>Protocols dont actually implement any functionality themselves. Nonetheless, any protocol you create will become a fully-fledged type for use in your code.<br>Because its a type, you can use a protocol in many places where other types are allowed, including:</p>\n<ul>\n<li>As a parameter type or return type in a function, method, or initializer</li>\n<li>As the type of a constant, variable, or property</li>\n<li>As the type of items in an array, dictionary, or other container</li>\n</ul>\n</blockquote>\n<p> protocol + generic </p>\n<h2 id=\"PATs-in-Swift-Standard-Library\"><a href=\"#PATs-in-Swift-Standard-Library\" class=\"headerlink\" title=\"PATs in Swift Standard Library\"></a>PATs in Swift Standard Library</h2><p> Standard Library </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">protocol</span> <span class=\"title\">IteratorProtocol</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/// The type of element traversed by the iterator.</span></span><br><span class=\"line\">    <span class=\"keyword\">associatedtype</span> <span class=\"type\">Element</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/// - Returns: The next element in the underlying sequence, if a next element</span></span><br><span class=\"line\">    <span class=\"comment\">///   exists; otherwise, `nil`.</span></span><br><span class=\"line\">    <span class=\"keyword\">mutating</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">next</span>()</span> -&gt; <span class=\"type\">Element</span>?</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">protocol</span> <span class=\"title\">Sequence</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/// A type representing the sequence&#x27;s elements.</span></span><br><span class=\"line\">    <span class=\"keyword\">associatedtype</span> <span class=\"type\">Element</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/// A type that provides the sequence&#x27;s iteration interface and</span></span><br><span class=\"line\">    <span class=\"comment\">/// encapsulates its iteration state.</span></span><br><span class=\"line\">    <span class=\"keyword\">associatedtype</span> <span class=\"type\">Iterator</span> : <span class=\"type\">IteratorProtocol</span> <span class=\"keyword\">where</span> <span class=\"type\">Iterator</span>.<span class=\"type\">Element</span> <span class=\"operator\">==</span> <span class=\"type\">Element</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/// Returns an iterator over the elements of this sequence.</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">makeIterator</span>()</span> -&gt; <span class=\"type\">Iterator</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>AnyIterator</code>  <code>AnySequence</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">AnyIterator</span>&lt;<span class=\"title\">Element</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">internal</span> <span class=\"keyword\">let</span> _box: _AnyIteratorBoxBase<span class=\"operator\">&lt;</span><span class=\"type\">Element</span><span class=\"operator\">&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">init</span>&lt;<span class=\"type\">I</span> : <span class=\"type\">IteratorProtocol</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">base</span>: <span class=\"type\">I</span>)</span> <span class=\"keyword\">where</span> <span class=\"type\">I</span>.<span class=\"type\">Element</span> <span class=\"operator\">==</span> <span class=\"type\">Element</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>._box <span class=\"operator\">=</span> _IteratorBox(base)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">init</span>(<span class=\"keyword\">_</span> <span class=\"params\">body</span>: <span class=\"keyword\">@escaping</span> () -&gt; <span class=\"type\">Element</span>?)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>._box <span class=\"operator\">=</span> _IteratorBox(_ClosureBasedIterator(body))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">internal</span> <span class=\"function\"><span class=\"keyword\">init</span>(<span class=\"params\">_box</span>: _AnyIteratorBoxBase<span class=\"operator\">&lt;</span><span class=\"type\">Element</span><span class=\"operator\">&gt;</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>._box <span class=\"operator\">=</span> _box</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">AnyIterator</span>: <span class=\"title\">IteratorProtocol</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">next</span>()</span> -&gt; <span class=\"type\">Element</span>? &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> _box.next()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">AnySequence</span>&lt;<span class=\"title\">Element</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">internal</span> <span class=\"keyword\">let</span> _box: _AnySequenceBox<span class=\"operator\">&lt;</span><span class=\"type\">Element</span><span class=\"operator\">&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">init</span>&lt;<span class=\"type\">I</span> : <span class=\"type\">IteratorProtocol</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">makeUnderlyingIterator</span>: <span class=\"keyword\">@escaping</span> () -&gt; <span class=\"type\">I</span>)</span> <span class=\"keyword\">where</span> <span class=\"type\">I</span>.<span class=\"type\">Element</span> <span class=\"operator\">==</span> <span class=\"type\">Element</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.<span class=\"keyword\">init</span>(_ClosureBasedSequence(makeUnderlyingIterator))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">internal</span> <span class=\"function\"><span class=\"keyword\">init</span>(<span class=\"params\">_box</span>: _AnySequenceBox<span class=\"operator\">&lt;</span><span class=\"type\">Element</span><span class=\"operator\">&gt;</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>._box <span class=\"operator\">=</span> _box</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">AnySequence</span>: <span class=\"title\">Sequence</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">typealias</span> <span class=\"type\">Iterator</span> <span class=\"operator\">=</span> <span class=\"type\">AnyIterator</span>&lt;<span class=\"type\">Element</span>&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">init</span>&lt;<span class=\"type\">S</span> : <span class=\"type\">Sequence</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">base</span>: <span class=\"type\">S</span>)</span> <span class=\"keyword\">where</span> <span class=\"type\">S</span>.<span class=\"type\">Element</span> <span class=\"operator\">==</span> <span class=\"type\">Element</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>._box <span class=\"operator\">=</span> _SequenceBox(_base: base)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<blockquote>\n<p>This iterator forwards its next() method to an arbitrary underlying iterator having the same Element type, hiding the specifics of the underlying IteratorProtocol. <a href=\"https://developer.apple.com/documentation/swift/anyiterator\">AnyIterator - Swift Standard Library | Apple Developer Documentation</a></p>\n</blockquote>\n<blockquote>\n<p>An instance of AnySequence forwards its operations to an underlying base sequence having the same Element type, hiding the specifics of the underlying sequence.<a href=\"https://developer.apple.com/documentation/swift/anysequence\">AnySequence - Swift Standard Library | Apple Developer Documentation</a></p>\n</blockquote>\n<p> <strong>Type Erasure</strong></p>\n<h2 id=\"What-is-Type-Erasure\"><a href=\"#What-is-Type-Erasure\" class=\"headerlink\" title=\"What is Type Erasure?\"></a>What is Type Erasure?</h2><p> Swift </p>\n<ul>\n<li>Concrete Type: Int, Bool</li>\n<li>Abstract Type: associatedType, <T></li>\n</ul>\n<p>Swift </p>\n<blockquote>\n<p>Type erasure is a process in code that makes abstract types concrete.</p>\n</blockquote>\n<p> Swift Standard Library </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1. abstract base</span></span><br><span class=\"line\"><span class=\"keyword\">internal</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">_AnyIteratorBoxBase</span>&lt;<span class=\"title\">Element</span>&gt; : <span class=\"title\">IteratorProtocol</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">internal</span> <span class=\"function\"><span class=\"keyword\">init</span>()</span> &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">internal</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">next</span>()</span> -&gt; <span class=\"type\">Element</span>? &#123; _abstract() &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2. private box</span></span><br><span class=\"line\"><span class=\"keyword\">internal</span> <span class=\"keyword\">final</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">_IteratorBox</span>&lt;<span class=\"title\">Base</span> : <span class=\"title\">IteratorProtocol</span>&gt; : <span class=\"title\">_AnyIteratorBoxBase</span>&lt;<span class=\"title\">Base</span>.<span class=\"title\">Element</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">internal</span> <span class=\"function\"><span class=\"keyword\">init</span>(<span class=\"keyword\">_</span> <span class=\"params\">base</span>: <span class=\"type\">Base</span>)</span> &#123; <span class=\"keyword\">self</span>._base <span class=\"operator\">=</span> base &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">internal</span> <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">next</span>()</span> -&gt; <span class=\"type\">Base</span>.<span class=\"type\">Element</span>? &#123; <span class=\"keyword\">return</span> _base.next() &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">internal</span> <span class=\"keyword\">var</span> _base: <span class=\"type\">Base</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 3. public wrapper</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">AnyIterator</span>&lt;<span class=\"title\">Element</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">internal</span> <span class=\"keyword\">let</span> _box: _AnyIteratorBoxBase<span class=\"operator\">&lt;</span><span class=\"type\">Element</span><span class=\"operator\">&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">init</span>&lt;<span class=\"type\">I</span> : <span class=\"type\">IteratorProtocol</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">base</span>: <span class=\"type\">I</span>)</span> <span class=\"keyword\">where</span> <span class=\"type\">I</span>.<span class=\"type\">Element</span> <span class=\"operator\">==</span> <span class=\"type\">Element</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>._box <span class=\"operator\">=</span> _IteratorBox(base)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">init</span>(<span class=\"keyword\">_</span> <span class=\"params\">body</span>: <span class=\"keyword\">@escaping</span> () -&gt; <span class=\"type\">Element</span>?)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>._box <span class=\"operator\">=</span> _IteratorBox(_ClosureBasedIterator(body))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">internal</span> <span class=\"function\"><span class=\"keyword\">init</span>(<span class=\"params\">_box</span>: _AnyIteratorBoxBase<span class=\"operator\">&lt;</span><span class=\"type\">Element</span><span class=\"operator\">&gt;</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>._box <span class=\"operator\">=</span> _box</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<ul>\n<li>an abstract base class</li>\n<li>a private box class</li>\n<li>a public wrapper class</li>\n</ul>\n<p><em>Existential</em> </p>\n<h2 id=\"One-more-thing\"><a href=\"#One-more-thing\" class=\"headerlink\" title=\"One more thing\"></a>One more thing</h2><p> PATs </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">protocol</span> <span class=\"title\">Logging</span>: <span class=\"title\">Hashtable</span> </span>&#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> loggers: <span class=\"type\">Set</span>&lt;<span class=\"type\">Logging</span>&gt; <span class=\"operator\">=</span> []</span><br><span class=\"line\"><span class=\"comment\">// Using &#x27;Logging&#x27; as a concrete type conforming to protocol &#x27;Hashable&#x27; is no supported</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">add</span>(<span class=\"keyword\">_</span> <span class=\"params\">logger</span>: <span class=\"type\">Logging</span>)</span> &#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// Protocol &#x27;Logging&#x27; can only be used as generic constraint because it has Self or associated type requirements</span></span><br></pre></td></tr></table></figure>\n\n<p> <code>Hashable</code>  <code>Equatable</code>  <code>Equatable</code>  <code>Self</code>  PATs </p>\n<p> type erasure </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1. abstract baes</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">_AnyLoggerBoxBase</span>&lt;<span class=\"title\">T</span>&gt; : <span class=\"title\">Logging</span> </span>&#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2. private box</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">_LoggerBox</span>&lt;<span class=\"title\">Base</span> : <span class=\"title\">Logging</span>&gt; : <span class=\"title\">_AnyLoggerBoxBase</span> &lt;<span class=\"title\">Base</span>.<span class=\"title\">Self</span>&gt; </span>&#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 3. public wrapper</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">AnyLogger</span>&lt;<span class=\"title\">T</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">init</span>&lt;<span class=\"type\">L</span> : <span class=\"type\">Logging</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">base</span>: <span class=\"type\">L</span>)</span> <span class=\"keyword\">where</span> <span class=\"type\">L</span>.<span class=\"keyword\">Self</span> <span class=\"operator\">==</span> <span class=\"keyword\">Self</span> &#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<blockquote>\n<p> </p>\n</blockquote>\n<p> Swift  <code>AnyHashable</code> </p>\n<h2 id=\"Ref\"><a href=\"#Ref\" class=\"headerlink\" title=\"Ref\"></a>Ref</h2><ul>\n<li><a href=\"https://www.youtube.com/watch?v=XWoNjiSPqI8&t=2391s\">Alexis Gallagher - Protocols with Associated Types - YouTube</a></li>\n<li><a href=\"https://academy.realm.io/posts/tryswift-gwendolyn-weston-type-erasure/\">Keep Calm and Type Erase On</a></li>\n<li><a href=\"https://developer.apple.com/documentation/swift/anysequence\">AnySequence - Swift Standard Library | Apple Developer Documentation</a></li>\n<li><a href=\"https://github.com/apple/swift/blob/master/stdlib/public/core/ExistentialCollection.swift.gyb\">swift/ExistentialCollection.swift.gyb at master  apple/swift  GitHub</a></li>\n<li><a href=\"https://github.com/apple/swift/blob/master/stdlib/public/core/AnyHashable.swift\">swift/AnyHashable.swift at master  apple/swift  GitHub</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p> Swift  <a href=\"https://github.com/apple/swift-evolution/blob/main/proposals/0309-unlock-existential-types-for-all-protocols.md\">SE-0309</a>  <a href=\"https://github.com/apple/swift-evolution/blob/main/proposals/0335-existential-any.md\">SE-0335</a> Swift  Protocol 2022.01.01</p>\n</blockquote>\n<blockquote>\n<p> Swift Protocol with Associated Types</p>\n</blockquote>\n<h2 id=\"Protocol-Oriented-Programming\"><a href=\"#Protocol-Oriented-Programming\" class=\"headerlink\" title=\"Protocol-Oriented Programming\"></a>Protocol-Oriented Programming</h2><p> Swift  <strong></strong>  <a href=\"https://github.com/apple/swift\">Standard Library</a>  POP </p>\n<p> POP  Cache</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">protocol</span> <span class=\"title\">Caching</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> name: <span class=\"type\">String</span> &#123; <span class=\"keyword\">get</span> &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">MemoryCache</span>: <span class=\"title\">Caching</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> name: <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;Memory Cache&quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">DiskCache</span>: <span class=\"title\">Caching</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> name: <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;Disk Cache&quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> memory: <span class=\"type\">Caching</span> <span class=\"operator\">=</span> <span class=\"type\">MemoryCache</span>() <span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">let</span> disk: <span class=\"type\">Caching</span> <span class=\"operator\">=</span> <span class=\"type\">DiskCache</span>() <span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">let</span> caches: [<span class=\"type\">Caching</span>] <span class=\"operator\">=</span> [memory, disk] <span class=\"comment\">// </span></span><br></pre></td></tr></table></figure>\n\n<p> work<strong> <em>protocol</em> </strong></p>\n<h2 id=\"Generics\"><a href=\"#Generics\" class=\"headerlink\" title=\"Generics\"></a>Generics</h2><blockquote>\n<p></p>\n</blockquote>\n<p>Cache   <code>as? XXX</code></p>\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">protocol</span> <span class=\"title\">Caching</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">associatedtype</span> <span class=\"type\">Object</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">store</span>(<span class=\"keyword\">_</span> <span class=\"params\">object</span>: <span class=\"type\">Object</span>, <span class=\"params\">forKey</span> <span class=\"params\">key</span>: <span class=\"type\">String</span>)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">retrieve</span>(<span class=\"params\">forKey</span> <span class=\"params\">key</span>: <span class=\"type\">String</span>)</span> -&gt; <span class=\"type\">Object</span>?</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">MemoryCache</span>: <span class=\"title\">Caching</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">typealias</span> <span class=\"type\">Object</span> <span class=\"operator\">=</span> <span class=\"type\">UIImage</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">store</span>(<span class=\"keyword\">_</span> <span class=\"params\">object</span>: <span class=\"type\">Object</span>, <span class=\"params\">forKey</span> <span class=\"params\">key</span>: <span class=\"type\">String</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">retrieve</span>(<span class=\"params\">forKey</span> <span class=\"params\">key</span>: <span class=\"type\">String</span>)</span> -&gt; <span class=\"type\">Object</span>? &#123;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">DiskCache</span>: <span class=\"title\">Caching</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">typealias</span> <span class=\"type\">Object</span> <span class=\"operator\">=</span> <span class=\"type\">UIImage</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">store</span>(<span class=\"keyword\">_</span> <span class=\"params\">object</span>: <span class=\"type\">Object</span>, <span class=\"params\">forKey</span> <span class=\"params\">key</span>: <span class=\"type\">String</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">retrieve</span>(<span class=\"params\">forKey</span> <span class=\"params\">key</span>: <span class=\"type\">String</span>)</span> -&gt; <span class=\"type\">Object</span>? &#123;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> memory: <span class=\"type\">Caching</span> <span class=\"operator\">=</span> <span class=\"type\">MemoryCache</span>() <span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">let</span> disk: <span class=\"type\">Caching</span> <span class=\"operator\">=</span> <span class=\"type\">DiskCache</span>() <span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">let</span> caches: [<span class=\"type\">Caching</span>] <span class=\"operator\">=</span> [memory, disk] <span class=\"comment\">// </span></span><br></pre></td></tr></table></figure>\n\n<p> Xcode </p>\n<blockquote>\n<p>Protocol Caching can only be used as generic constraint because it has Self or associated type requirements</p>\n</blockquote>\n<p>WTF?</p>\n<h2 id=\"What-is-Protocol-with-Associated-Types\"><a href=\"#What-is-Protocol-with-Associated-Types\" class=\"headerlink\" title=\"What is Protocol with Associated Types?\"></a>What is Protocol with Associated Types?</h2><p> Swift  <code>Caching</code> </p>\n<p> <em></em></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> cache: <span class=\"type\">Caching</span>&lt;<span class=\"type\">UIImage</span>&gt; <span class=\"operator\">=</span>  <span class=\"operator\">...</span></span><br><span class=\"line\"><span class=\"comment\">// Protocol &#x27;Caching&#x27; can only be used as generic constraint because it has Self or associated type requirements</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">protocol</span> <span class=\"title\">Caching</span>&lt;<span class=\"title\">Object</span>&gt; </span>&#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// Protocols do not allow generic parameters; use associated types instead</span></span><br></pre></td></tr></table></figure>\n\n<p>WTF</p>\n<h2 id=\"Protocol-as-Types\"><a href=\"#Protocol-as-Types\" class=\"headerlink\" title=\"Protocol as Types\"></a>Protocol as Types</h2><p> protocol<a href=\"https://docs.swift.org/swift-book/LanguageGuide/Protocols.html\">Protocols  The Swift Programming Language (Swift 4.2)</a> Protocol as Types </p>\n<blockquote>\n<p>Protocols dont actually implement any functionality themselves. Nonetheless, any protocol you create will become a fully-fledged type for use in your code.<br>Because its a type, you can use a protocol in many places where other types are allowed, including:</p>\n<ul>\n<li>As a parameter type or return type in a function, method, or initializer</li>\n<li>As the type of a constant, variable, or property</li>\n<li>As the type of items in an array, dictionary, or other container</li>\n</ul>\n</blockquote>\n<p> protocol + generic </p>\n<h2 id=\"PATs-in-Swift-Standard-Library\"><a href=\"#PATs-in-Swift-Standard-Library\" class=\"headerlink\" title=\"PATs in Swift Standard Library\"></a>PATs in Swift Standard Library</h2><p> Standard Library </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">protocol</span> <span class=\"title\">IteratorProtocol</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/// The type of element traversed by the iterator.</span></span><br><span class=\"line\">    <span class=\"keyword\">associatedtype</span> <span class=\"type\">Element</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/// - Returns: The next element in the underlying sequence, if a next element</span></span><br><span class=\"line\">    <span class=\"comment\">///   exists; otherwise, `nil`.</span></span><br><span class=\"line\">    <span class=\"keyword\">mutating</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">next</span>()</span> -&gt; <span class=\"type\">Element</span>?</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">protocol</span> <span class=\"title\">Sequence</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/// A type representing the sequence&#x27;s elements.</span></span><br><span class=\"line\">    <span class=\"keyword\">associatedtype</span> <span class=\"type\">Element</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/// A type that provides the sequence&#x27;s iteration interface and</span></span><br><span class=\"line\">    <span class=\"comment\">/// encapsulates its iteration state.</span></span><br><span class=\"line\">    <span class=\"keyword\">associatedtype</span> <span class=\"type\">Iterator</span> : <span class=\"type\">IteratorProtocol</span> <span class=\"keyword\">where</span> <span class=\"type\">Iterator</span>.<span class=\"type\">Element</span> <span class=\"operator\">==</span> <span class=\"type\">Element</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/// Returns an iterator over the elements of this sequence.</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">makeIterator</span>()</span> -&gt; <span class=\"type\">Iterator</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>AnyIterator</code>  <code>AnySequence</code> </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">AnyIterator</span>&lt;<span class=\"title\">Element</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">internal</span> <span class=\"keyword\">let</span> _box: _AnyIteratorBoxBase<span class=\"operator\">&lt;</span><span class=\"type\">Element</span><span class=\"operator\">&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">init</span>&lt;<span class=\"type\">I</span> : <span class=\"type\">IteratorProtocol</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">base</span>: <span class=\"type\">I</span>)</span> <span class=\"keyword\">where</span> <span class=\"type\">I</span>.<span class=\"type\">Element</span> <span class=\"operator\">==</span> <span class=\"type\">Element</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>._box <span class=\"operator\">=</span> _IteratorBox(base)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">init</span>(<span class=\"keyword\">_</span> <span class=\"params\">body</span>: <span class=\"keyword\">@escaping</span> () -&gt; <span class=\"type\">Element</span>?)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>._box <span class=\"operator\">=</span> _IteratorBox(_ClosureBasedIterator(body))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">internal</span> <span class=\"function\"><span class=\"keyword\">init</span>(<span class=\"params\">_box</span>: _AnyIteratorBoxBase<span class=\"operator\">&lt;</span><span class=\"type\">Element</span><span class=\"operator\">&gt;</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>._box <span class=\"operator\">=</span> _box</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">AnyIterator</span>: <span class=\"title\">IteratorProtocol</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">next</span>()</span> -&gt; <span class=\"type\">Element</span>? &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> _box.next()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">AnySequence</span>&lt;<span class=\"title\">Element</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">internal</span> <span class=\"keyword\">let</span> _box: _AnySequenceBox<span class=\"operator\">&lt;</span><span class=\"type\">Element</span><span class=\"operator\">&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">init</span>&lt;<span class=\"type\">I</span> : <span class=\"type\">IteratorProtocol</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">makeUnderlyingIterator</span>: <span class=\"keyword\">@escaping</span> () -&gt; <span class=\"type\">I</span>)</span> <span class=\"keyword\">where</span> <span class=\"type\">I</span>.<span class=\"type\">Element</span> <span class=\"operator\">==</span> <span class=\"type\">Element</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.<span class=\"keyword\">init</span>(_ClosureBasedSequence(makeUnderlyingIterator))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">internal</span> <span class=\"function\"><span class=\"keyword\">init</span>(<span class=\"params\">_box</span>: _AnySequenceBox<span class=\"operator\">&lt;</span><span class=\"type\">Element</span><span class=\"operator\">&gt;</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>._box <span class=\"operator\">=</span> _box</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">AnySequence</span>: <span class=\"title\">Sequence</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">typealias</span> <span class=\"type\">Iterator</span> <span class=\"operator\">=</span> <span class=\"type\">AnyIterator</span>&lt;<span class=\"type\">Element</span>&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">init</span>&lt;<span class=\"type\">S</span> : <span class=\"type\">Sequence</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">base</span>: <span class=\"type\">S</span>)</span> <span class=\"keyword\">where</span> <span class=\"type\">S</span>.<span class=\"type\">Element</span> <span class=\"operator\">==</span> <span class=\"type\">Element</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>._box <span class=\"operator\">=</span> _SequenceBox(_base: base)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<blockquote>\n<p>This iterator forwards its next() method to an arbitrary underlying iterator having the same Element type, hiding the specifics of the underlying IteratorProtocol. <a href=\"https://developer.apple.com/documentation/swift/anyiterator\">AnyIterator - Swift Standard Library | Apple Developer Documentation</a></p>\n</blockquote>\n<blockquote>\n<p>An instance of AnySequence forwards its operations to an underlying base sequence having the same Element type, hiding the specifics of the underlying sequence.<a href=\"https://developer.apple.com/documentation/swift/anysequence\">AnySequence - Swift Standard Library | Apple Developer Documentation</a></p>\n</blockquote>\n<p> <strong>Type Erasure</strong></p>\n<h2 id=\"What-is-Type-Erasure\"><a href=\"#What-is-Type-Erasure\" class=\"headerlink\" title=\"What is Type Erasure?\"></a>What is Type Erasure?</h2><p> Swift </p>\n<ul>\n<li>Concrete Type: Int, Bool</li>\n<li>Abstract Type: associatedType, <T></li>\n</ul>\n<p>Swift </p>\n<blockquote>\n<p>Type erasure is a process in code that makes abstract types concrete.</p>\n</blockquote>\n<p> Swift Standard Library </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1. abstract base</span></span><br><span class=\"line\"><span class=\"keyword\">internal</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">_AnyIteratorBoxBase</span>&lt;<span class=\"title\">Element</span>&gt; : <span class=\"title\">IteratorProtocol</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">internal</span> <span class=\"function\"><span class=\"keyword\">init</span>()</span> &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">internal</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">next</span>()</span> -&gt; <span class=\"type\">Element</span>? &#123; _abstract() &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2. private box</span></span><br><span class=\"line\"><span class=\"keyword\">internal</span> <span class=\"keyword\">final</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">_IteratorBox</span>&lt;<span class=\"title\">Base</span> : <span class=\"title\">IteratorProtocol</span>&gt; : <span class=\"title\">_AnyIteratorBoxBase</span>&lt;<span class=\"title\">Base</span>.<span class=\"title\">Element</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">internal</span> <span class=\"function\"><span class=\"keyword\">init</span>(<span class=\"keyword\">_</span> <span class=\"params\">base</span>: <span class=\"type\">Base</span>)</span> &#123; <span class=\"keyword\">self</span>._base <span class=\"operator\">=</span> base &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">internal</span> <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">next</span>()</span> -&gt; <span class=\"type\">Base</span>.<span class=\"type\">Element</span>? &#123; <span class=\"keyword\">return</span> _base.next() &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">internal</span> <span class=\"keyword\">var</span> _base: <span class=\"type\">Base</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 3. public wrapper</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">AnyIterator</span>&lt;<span class=\"title\">Element</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">internal</span> <span class=\"keyword\">let</span> _box: _AnyIteratorBoxBase<span class=\"operator\">&lt;</span><span class=\"type\">Element</span><span class=\"operator\">&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">init</span>&lt;<span class=\"type\">I</span> : <span class=\"type\">IteratorProtocol</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">base</span>: <span class=\"type\">I</span>)</span> <span class=\"keyword\">where</span> <span class=\"type\">I</span>.<span class=\"type\">Element</span> <span class=\"operator\">==</span> <span class=\"type\">Element</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>._box <span class=\"operator\">=</span> _IteratorBox(base)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">init</span>(<span class=\"keyword\">_</span> <span class=\"params\">body</span>: <span class=\"keyword\">@escaping</span> () -&gt; <span class=\"type\">Element</span>?)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>._box <span class=\"operator\">=</span> _IteratorBox(_ClosureBasedIterator(body))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">internal</span> <span class=\"function\"><span class=\"keyword\">init</span>(<span class=\"params\">_box</span>: _AnyIteratorBoxBase<span class=\"operator\">&lt;</span><span class=\"type\">Element</span><span class=\"operator\">&gt;</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>._box <span class=\"operator\">=</span> _box</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<ul>\n<li>an abstract base class</li>\n<li>a private box class</li>\n<li>a public wrapper class</li>\n</ul>\n<p><em>Existential</em> </p>\n<h2 id=\"One-more-thing\"><a href=\"#One-more-thing\" class=\"headerlink\" title=\"One more thing\"></a>One more thing</h2><p> PATs </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">protocol</span> <span class=\"title\">Logging</span>: <span class=\"title\">Hashtable</span> </span>&#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> loggers: <span class=\"type\">Set</span>&lt;<span class=\"type\">Logging</span>&gt; <span class=\"operator\">=</span> []</span><br><span class=\"line\"><span class=\"comment\">// Using &#x27;Logging&#x27; as a concrete type conforming to protocol &#x27;Hashable&#x27; is no supported</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">add</span>(<span class=\"keyword\">_</span> <span class=\"params\">logger</span>: <span class=\"type\">Logging</span>)</span> &#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// Protocol &#x27;Logging&#x27; can only be used as generic constraint because it has Self or associated type requirements</span></span><br></pre></td></tr></table></figure>\n\n<p> <code>Hashable</code>  <code>Equatable</code>  <code>Equatable</code>  <code>Self</code>  PATs </p>\n<p> type erasure </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1. abstract baes</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">_AnyLoggerBoxBase</span>&lt;<span class=\"title\">T</span>&gt; : <span class=\"title\">Logging</span> </span>&#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2. private box</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">_LoggerBox</span>&lt;<span class=\"title\">Base</span> : <span class=\"title\">Logging</span>&gt; : <span class=\"title\">_AnyLoggerBoxBase</span> &lt;<span class=\"title\">Base</span>.<span class=\"title\">Self</span>&gt; </span>&#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 3. public wrapper</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">AnyLogger</span>&lt;<span class=\"title\">T</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">init</span>&lt;<span class=\"type\">L</span> : <span class=\"type\">Logging</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">base</span>: <span class=\"type\">L</span>)</span> <span class=\"keyword\">where</span> <span class=\"type\">L</span>.<span class=\"keyword\">Self</span> <span class=\"operator\">==</span> <span class=\"keyword\">Self</span> &#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<blockquote>\n<p> </p>\n</blockquote>\n<p> Swift  <code>AnyHashable</code> </p>\n<h2 id=\"Ref\"><a href=\"#Ref\" class=\"headerlink\" title=\"Ref\"></a>Ref</h2><ul>\n<li><a href=\"https://www.youtube.com/watch?v=XWoNjiSPqI8&t=2391s\">Alexis Gallagher - Protocols with Associated Types - YouTube</a></li>\n<li><a href=\"https://academy.realm.io/posts/tryswift-gwendolyn-weston-type-erasure/\">Keep Calm and Type Erase On</a></li>\n<li><a href=\"https://developer.apple.com/documentation/swift/anysequence\">AnySequence - Swift Standard Library | Apple Developer Documentation</a></li>\n<li><a href=\"https://github.com/apple/swift/blob/master/stdlib/public/core/ExistentialCollection.swift.gyb\">swift/ExistentialCollection.swift.gyb at master  apple/swift  GitHub</a></li>\n<li><a href=\"https://github.com/apple/swift/blob/master/stdlib/public/core/AnyHashable.swift\">swift/AnyHashable.swift at master  apple/swift  GitHub</a></li>\n</ul>\n"},{"title":"Plist Parser","date":"2017-08-10T12:00:00.000Z","_content":"Plist  Apple  XML  Binary  HTML Plist tag functional  parser combinator  plist parser \n\n## Plist\n\n Plist \n\n```\n<dict>\n    <key>number</key>\n    <integer>0</integer>\n    <key>date</key>\n    <date>2017-08-05T14:25:14Z</date>\n    <key>data</key>\n    <data>VGVzdFZhbHVl</data>\n    <key>boolean</key>\n    <true/>\n    <key>array</key>\n    <array>\n        <string>string</string>\n        <false/>\n        <integer>0</integer>\n    </array>\n </dict>\n```\n\n[wikipedia](https://zh.wikipedia.org/zh-hans/)  `XML`  macOS/iOS \n\n| Foundation  | Core Foundation  | XML  |  |\n| :--- | :--- | :--- | :--- |\n| NSString | CFString | &lt;string&gt; | UTF-8  |\n| NSNumber\t| CFNumber | &lt;real&gt;, &lt;integer&gt; |  |\n| NSNumber | CFBoolean\t| &lt;true/&gt;, or &lt;false/&gt; | |\n| NSDate | CFDate | &lt;date&gt; | ISO 8601  |\n| NSData | CFData | &lt;data&gt; | Base64  |\n| NSArray | CFArray | &lt;array&gt; |  |\n| NSDictionary | CFDictionary | &lt;dict&gt; |  &lt;key&gt;  plist  |\n\n Plist \n\n## Model\n\n```swift\n/// The plist data model\npublic enum PLIST {\n    /// <true/> or <false/>\n    case bool(Bool)\n    \n    /// 2017-08-05T14:25:14Z\n    case date(Date)\n    \n    /// <data>VGVzdFZhbHVl</data> (<54657374 56616c75 65>\n    case data(Data)\n    \n    /// <integer>233</integer> or <real>2.33</real>\n    case number(Int)\n    \n    /// <string>string</string>\n    case string(String)\n    \n    /// <array><string>The String</string></array>\n    indirect case array([PLIST])\n    \n    /// <dict><key>The Key</key><string>The String</string></dict>\n    indirect case dict([String: PLIST])\n}\n```\n\n## Parser\n\n Plist data model Plist   `PLIST`  `parser`\n\n parser parser \n\n```swift\nlet parser: Parser<PLIST>\nlet result = parser.parse(\"plist\")\n```\n\n `let parser: Parser<PLIST>`  `PLIST`  `Bool` `Date` `Data` `Number` `String` 5  `Array<PLIST>` `Dictionary<PLIST>` 2 nested `Parser<PLIST>`  `Parser<Bool>` `Parser<Date>` `Parser<Data>` `Parser<Number>` `Parser<String>` 5  parser  `Parser<Array>` `Parser<Dictionary>` 2  parser \n\n### Bool Parser\n\n Plist Bool  `<true/>`  `<false/>` Bool  parser  `<true/>`  `<false/>`\n\n```swift\nlet _true = string(\"<true/>\") <&> const(PLIST.bool(true))\nlet _false = string(\"<false/>\") <&> const(PLIST.bool(false))\n\nlet _bool = _true <|> _false\n_bool.parse(\"<false/>\")\n```\n\n### Date Parser\n\nPlist  Date  UTC  `<date>2017-08-05T14:25:14Z</date>` `<date>`  `</date>`  Date  parser  `PLIST.date(date)`, date  2017-08-05T14:25:14Z  format \n\n```swift\nlet _date = string(\"<date>\") *> manyTill(_any, string(\"</date>\")) <&> { PLIST.date(String($0).date!) }\n_date.parse(\"<date>2017-08-05T14:25:14Z</date>\")\n\n/// UTC Date\npublic extension String {\n    public var date: Date? {\n        let formatter = DateFormatter()\n        formatter.dateFormat = \"yyyy-MM-dd'T'HH:mm:ss'Z'\"\n        return formatter.date(from: self)\n    }\n}\n```\n\n### Data Parser\n\nPlist  Data  Base64  Data Parser  Date Parser  tag  Data \n\n```swift\nlet _data = string(\"<data>\") *> manyTill(_any, string(\"</data>\")) <&> { PLIST.data(Data(base64Encoded: String($0))!) }\nlet dataString = _data.parse(\"<data>VGVzdFZhbHVl</data>\")\n```\n\n### Number Parser\n\nPlist  Number  `tag`  `integer` `real`\n\n Integer Parser\n\n```swift\nlet _integer = string(\"<integer>\") *> manyTill(_digit, string(\"</integer>\")) <&> { PLIST.number(Int(String($0))!) }\n```\n\n### String Parser\n\nString Parser  Date Parser  Data Parser \n\n```swift\nlet _string = string(\"<string>\") *> manyTill(_any, string(\"</string>\")) <&> { PLIST.string(String($0)) }\n_string.parse(\"<string>The String</string>\")\n```\n\n### Tag Parser\n\n Bool Parser  Parser\n\n* closed tag\n* \n\n Parser \n\n```swift\nfunc tag<A>(_ tag: String, _ p: Parser<A>) -> Parser<[A]> {\n    return string(\"<\\(tag)>\") *> manyTill(p, string(\"</\\(tag)>\"))\n}\n\nlet _date1 = tag(\"<date>\", _any) <&> { PLIST.date(String($0).date!) }\n_date1.parse(\"<date>2017-08-05T14:25:14Z</date>\")\n\nlet _string1 = tag(\"string\", _any) <&> { PLIST.string(String($0)) }\n_string1.parse(\"<string>The String</string>\")\n```\n\n### Array Parser\n\nArray Parser  Dictionary Parser  PLIST  Enum PLIST  `indirect`  parser \n\n Swift  Dictionary \n\n```swift\nlet _plist = plist()\nfunc plist() -> Parser<PLIST> {\n    return _bool <|> _string <|> _integer <|> _date <|> _data <|> _array\n}\n\nlet _array = tag(\"array\", _plist) <&> {\n    PLIST.array($0)\n}\n```\n\n### Dictionary Parser\n\nDictionary Parser  Array Parser \n\n```swift\nlet _plist = plist()\nfunc plist() -> Parser<PLIST> {\n    return _bool <|> _string <|> _integer <|> _date <|> _data <|> _array <|> _dict\n}\n\nlet _dict = tag(\"dict\", ?) <&> {\n   ///  PLIST.dict\n}\n```\n\n Dictionary  Array Array  Plist  Dictionary  key-value  key-value  `tag(\"dict\", _keyValue)`\n\n Key-Value Parser\n\n```swift\nlet _key = string(\"<key>\") *> manyTill(_any, string(\"</key>\")) <&> { String($0) }\nlet _keyValue = ({ a in { b in (a, b) }} <^> _key <*> (value))\n```\n\n Dictionary Parser\n\n```swift\nlet _dict = tag(\"dict\", _keyValue) <&> { PLIST.dict(atod($0)) }\n/// Tuple Array to Dictionary\npublic func atod<Key: Hashable, Value>(_ tuples: [(Key, Value)]) -> [Key: Value] {\n    var dict: [Key: Value] = [:]\n    for (key, value) in tuples {\n        dict[key] = value\n    }\n    return dict\n}\n```\n\n\n\n```swift\nlet _kv = _keyValue <&> { ttod($0) }\n\nlet _dict1 = tag(\"dict\", _kv) <&> {\n    PLIST.dict(\n    \t\t$0.flatMap { $0 }\n        .reduce([String: PLIST]()) { d, kv in\n            var dict = d\n            dict.updateValue(kv.value, forKey: kv.key)\n            return dict\n        })\n}\n\npublic func ttod<Key: Hashable, Value>(_ tuple: (Key, Value)) -> [Key: Value] {\n    return [tuple.0: tuple.1]\n}\n```\n\n### Plist Parser\n\n\n\n```swift\nlet _plist = _bool <|> _string <|> _integer <|> _date <|> _data <|> _array <|> _dict\n\nlet result = _plist.parse(plist)\ndump(result)\n```\n\n## Ref\n\n[](https://zh.wikipedia.org/zh-hans/)\n[Parser Combinator](http://blessingsoft.com/2017/05/28/parser-combinator/)\n[](https://github.com/nixzhu/dev-blog/blob/master/2017-04-12-json-parser.md)\n\n\n","source":"_posts/plist-parser.md","raw":"---\ntitle: Plist Parser\ndate: 2017-08-10 20:00:00\ntags:\n\t- plist parser\n\t- parser\n\t- parser combinator\n\t- monad\n\t- functional programming\n\t- swift\ncategories: functional programming\n---\nPlist  Apple  XML  Binary  HTML Plist tag functional  parser combinator  plist parser \n\n## Plist\n\n Plist \n\n```\n<dict>\n    <key>number</key>\n    <integer>0</integer>\n    <key>date</key>\n    <date>2017-08-05T14:25:14Z</date>\n    <key>data</key>\n    <data>VGVzdFZhbHVl</data>\n    <key>boolean</key>\n    <true/>\n    <key>array</key>\n    <array>\n        <string>string</string>\n        <false/>\n        <integer>0</integer>\n    </array>\n </dict>\n```\n\n[wikipedia](https://zh.wikipedia.org/zh-hans/)  `XML`  macOS/iOS \n\n| Foundation  | Core Foundation  | XML  |  |\n| :--- | :--- | :--- | :--- |\n| NSString | CFString | &lt;string&gt; | UTF-8  |\n| NSNumber\t| CFNumber | &lt;real&gt;, &lt;integer&gt; |  |\n| NSNumber | CFBoolean\t| &lt;true/&gt;, or &lt;false/&gt; | |\n| NSDate | CFDate | &lt;date&gt; | ISO 8601  |\n| NSData | CFData | &lt;data&gt; | Base64  |\n| NSArray | CFArray | &lt;array&gt; |  |\n| NSDictionary | CFDictionary | &lt;dict&gt; |  &lt;key&gt;  plist  |\n\n Plist \n\n## Model\n\n```swift\n/// The plist data model\npublic enum PLIST {\n    /// <true/> or <false/>\n    case bool(Bool)\n    \n    /// 2017-08-05T14:25:14Z\n    case date(Date)\n    \n    /// <data>VGVzdFZhbHVl</data> (<54657374 56616c75 65>\n    case data(Data)\n    \n    /// <integer>233</integer> or <real>2.33</real>\n    case number(Int)\n    \n    /// <string>string</string>\n    case string(String)\n    \n    /// <array><string>The String</string></array>\n    indirect case array([PLIST])\n    \n    /// <dict><key>The Key</key><string>The String</string></dict>\n    indirect case dict([String: PLIST])\n}\n```\n\n## Parser\n\n Plist data model Plist   `PLIST`  `parser`\n\n parser parser \n\n```swift\nlet parser: Parser<PLIST>\nlet result = parser.parse(\"plist\")\n```\n\n `let parser: Parser<PLIST>`  `PLIST`  `Bool` `Date` `Data` `Number` `String` 5  `Array<PLIST>` `Dictionary<PLIST>` 2 nested `Parser<PLIST>`  `Parser<Bool>` `Parser<Date>` `Parser<Data>` `Parser<Number>` `Parser<String>` 5  parser  `Parser<Array>` `Parser<Dictionary>` 2  parser \n\n### Bool Parser\n\n Plist Bool  `<true/>`  `<false/>` Bool  parser  `<true/>`  `<false/>`\n\n```swift\nlet _true = string(\"<true/>\") <&> const(PLIST.bool(true))\nlet _false = string(\"<false/>\") <&> const(PLIST.bool(false))\n\nlet _bool = _true <|> _false\n_bool.parse(\"<false/>\")\n```\n\n### Date Parser\n\nPlist  Date  UTC  `<date>2017-08-05T14:25:14Z</date>` `<date>`  `</date>`  Date  parser  `PLIST.date(date)`, date  2017-08-05T14:25:14Z  format \n\n```swift\nlet _date = string(\"<date>\") *> manyTill(_any, string(\"</date>\")) <&> { PLIST.date(String($0).date!) }\n_date.parse(\"<date>2017-08-05T14:25:14Z</date>\")\n\n/// UTC Date\npublic extension String {\n    public var date: Date? {\n        let formatter = DateFormatter()\n        formatter.dateFormat = \"yyyy-MM-dd'T'HH:mm:ss'Z'\"\n        return formatter.date(from: self)\n    }\n}\n```\n\n### Data Parser\n\nPlist  Data  Base64  Data Parser  Date Parser  tag  Data \n\n```swift\nlet _data = string(\"<data>\") *> manyTill(_any, string(\"</data>\")) <&> { PLIST.data(Data(base64Encoded: String($0))!) }\nlet dataString = _data.parse(\"<data>VGVzdFZhbHVl</data>\")\n```\n\n### Number Parser\n\nPlist  Number  `tag`  `integer` `real`\n\n Integer Parser\n\n```swift\nlet _integer = string(\"<integer>\") *> manyTill(_digit, string(\"</integer>\")) <&> { PLIST.number(Int(String($0))!) }\n```\n\n### String Parser\n\nString Parser  Date Parser  Data Parser \n\n```swift\nlet _string = string(\"<string>\") *> manyTill(_any, string(\"</string>\")) <&> { PLIST.string(String($0)) }\n_string.parse(\"<string>The String</string>\")\n```\n\n### Tag Parser\n\n Bool Parser  Parser\n\n* closed tag\n* \n\n Parser \n\n```swift\nfunc tag<A>(_ tag: String, _ p: Parser<A>) -> Parser<[A]> {\n    return string(\"<\\(tag)>\") *> manyTill(p, string(\"</\\(tag)>\"))\n}\n\nlet _date1 = tag(\"<date>\", _any) <&> { PLIST.date(String($0).date!) }\n_date1.parse(\"<date>2017-08-05T14:25:14Z</date>\")\n\nlet _string1 = tag(\"string\", _any) <&> { PLIST.string(String($0)) }\n_string1.parse(\"<string>The String</string>\")\n```\n\n### Array Parser\n\nArray Parser  Dictionary Parser  PLIST  Enum PLIST  `indirect`  parser \n\n Swift  Dictionary \n\n```swift\nlet _plist = plist()\nfunc plist() -> Parser<PLIST> {\n    return _bool <|> _string <|> _integer <|> _date <|> _data <|> _array\n}\n\nlet _array = tag(\"array\", _plist) <&> {\n    PLIST.array($0)\n}\n```\n\n### Dictionary Parser\n\nDictionary Parser  Array Parser \n\n```swift\nlet _plist = plist()\nfunc plist() -> Parser<PLIST> {\n    return _bool <|> _string <|> _integer <|> _date <|> _data <|> _array <|> _dict\n}\n\nlet _dict = tag(\"dict\", ?) <&> {\n   ///  PLIST.dict\n}\n```\n\n Dictionary  Array Array  Plist  Dictionary  key-value  key-value  `tag(\"dict\", _keyValue)`\n\n Key-Value Parser\n\n```swift\nlet _key = string(\"<key>\") *> manyTill(_any, string(\"</key>\")) <&> { String($0) }\nlet _keyValue = ({ a in { b in (a, b) }} <^> _key <*> (value))\n```\n\n Dictionary Parser\n\n```swift\nlet _dict = tag(\"dict\", _keyValue) <&> { PLIST.dict(atod($0)) }\n/// Tuple Array to Dictionary\npublic func atod<Key: Hashable, Value>(_ tuples: [(Key, Value)]) -> [Key: Value] {\n    var dict: [Key: Value] = [:]\n    for (key, value) in tuples {\n        dict[key] = value\n    }\n    return dict\n}\n```\n\n\n\n```swift\nlet _kv = _keyValue <&> { ttod($0) }\n\nlet _dict1 = tag(\"dict\", _kv) <&> {\n    PLIST.dict(\n    \t\t$0.flatMap { $0 }\n        .reduce([String: PLIST]()) { d, kv in\n            var dict = d\n            dict.updateValue(kv.value, forKey: kv.key)\n            return dict\n        })\n}\n\npublic func ttod<Key: Hashable, Value>(_ tuple: (Key, Value)) -> [Key: Value] {\n    return [tuple.0: tuple.1]\n}\n```\n\n### Plist Parser\n\n\n\n```swift\nlet _plist = _bool <|> _string <|> _integer <|> _date <|> _data <|> _array <|> _dict\n\nlet result = _plist.parse(plist)\ndump(result)\n```\n\n## Ref\n\n[](https://zh.wikipedia.org/zh-hans/)\n[Parser Combinator](http://blessingsoft.com/2017/05/28/parser-combinator/)\n[](https://github.com/nixzhu/dev-blog/blob/master/2017-04-12-json-parser.md)\n\n\n","slug":"plist-parser","published":1,"updated":"2022-01-02T11:27:03.726Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckxx810xg000i9ith73ww8npz","content":"<p>Plist  Apple  XML  Binary  HTML Plist tag functional  parser combinator  plist parser </p>\n<h2 id=\"Plist\"><a href=\"#Plist\" class=\"headerlink\" title=\"Plist\"></a>Plist</h2><p> Plist </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;dict&gt;</span><br><span class=\"line\">    &lt;key&gt;number&lt;/key&gt;</span><br><span class=\"line\">    &lt;integer&gt;0&lt;/integer&gt;</span><br><span class=\"line\">    &lt;key&gt;date&lt;/key&gt;</span><br><span class=\"line\">    &lt;date&gt;2017-08-05T14:25:14Z&lt;/date&gt;</span><br><span class=\"line\">    &lt;key&gt;data&lt;/key&gt;</span><br><span class=\"line\">    &lt;data&gt;VGVzdFZhbHVl&lt;/data&gt;</span><br><span class=\"line\">    &lt;key&gt;boolean&lt;/key&gt;</span><br><span class=\"line\">    &lt;true/&gt;</span><br><span class=\"line\">    &lt;key&gt;array&lt;/key&gt;</span><br><span class=\"line\">    &lt;array&gt;</span><br><span class=\"line\">        &lt;string&gt;string&lt;/string&gt;</span><br><span class=\"line\">        &lt;false/&gt;</span><br><span class=\"line\">        &lt;integer&gt;0&lt;/integer&gt;</span><br><span class=\"line\">    &lt;/array&gt;</span><br><span class=\"line\"> &lt;/dict&gt;</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://zh.wikipedia.org/zh-hans/%E5%B1%9E%E6%80%A7%E5%88%97%E8%A1%A8\">wikipedia</a>  <code>XML</code>  macOS/iOS </p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">Foundation </th>\n<th align=\"left\">Core Foundation </th>\n<th align=\"left\">XML </th>\n<th align=\"left\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">NSString</td>\n<td align=\"left\">CFString</td>\n<td align=\"left\">&lt;string&gt;</td>\n<td align=\"left\">UTF-8 </td>\n</tr>\n<tr>\n<td align=\"left\">NSNumber</td>\n<td align=\"left\">CFNumber</td>\n<td align=\"left\">&lt;real&gt;, &lt;integer&gt;</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">NSNumber</td>\n<td align=\"left\">CFBoolean</td>\n<td align=\"left\">&lt;true/&gt;, or &lt;false/&gt;</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">NSDate</td>\n<td align=\"left\">CFDate</td>\n<td align=\"left\">&lt;date&gt;</td>\n<td align=\"left\">ISO 8601 </td>\n</tr>\n<tr>\n<td align=\"left\">NSData</td>\n<td align=\"left\">CFData</td>\n<td align=\"left\">&lt;data&gt;</td>\n<td align=\"left\">Base64 </td>\n</tr>\n<tr>\n<td align=\"left\">NSArray</td>\n<td align=\"left\">CFArray</td>\n<td align=\"left\">&lt;array&gt;</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">NSDictionary</td>\n<td align=\"left\">CFDictionary</td>\n<td align=\"left\">&lt;dict&gt;</td>\n<td align=\"left\"> &lt;key&gt;  plist </td>\n</tr>\n</tbody></table>\n<p> Plist </p>\n<h2 id=\"Model\"><a href=\"#Model\" class=\"headerlink\" title=\"Model\"></a>Model</h2><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// The plist data model</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">enum</span> <span class=\"title\">PLIST</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/// &lt;true/&gt; or &lt;false/&gt;</span></span><br><span class=\"line\">    <span class=\"keyword\">case</span> bool(<span class=\"type\">Bool</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/// 2017-08-05T14:25:14Z</span></span><br><span class=\"line\">    <span class=\"keyword\">case</span> date(<span class=\"type\">Date</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/// &lt;data&gt;VGVzdFZhbHVl&lt;/data&gt; (&lt;54657374 56616c75 65&gt;</span></span><br><span class=\"line\">    <span class=\"keyword\">case</span> data(<span class=\"type\">Data</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/// &lt;integer&gt;233&lt;/integer&gt; or &lt;real&gt;2.33&lt;/real&gt;</span></span><br><span class=\"line\">    <span class=\"keyword\">case</span> number(<span class=\"type\">Int</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/// &lt;string&gt;string&lt;/string&gt;</span></span><br><span class=\"line\">    <span class=\"keyword\">case</span> string(<span class=\"type\">String</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/// &lt;array&gt;&lt;string&gt;The String&lt;/string&gt;&lt;/array&gt;</span></span><br><span class=\"line\">    <span class=\"keyword\">indirect</span> <span class=\"keyword\">case</span> array([<span class=\"type\">PLIST</span>])</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/// &lt;dict&gt;&lt;key&gt;The Key&lt;/key&gt;&lt;string&gt;The String&lt;/string&gt;&lt;/dict&gt;</span></span><br><span class=\"line\">    <span class=\"keyword\">indirect</span> <span class=\"keyword\">case</span> dict([String: <span class=\"type\">PLIST</span>])</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Parser\"><a href=\"#Parser\" class=\"headerlink\" title=\"Parser\"></a>Parser</h2><p> Plist data model Plist   <code>PLIST</code>  <code>parser</code></p>\n<p> parser parser </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> parser: <span class=\"type\">Parser</span>&lt;<span class=\"type\">PLIST</span>&gt;</span><br><span class=\"line\"><span class=\"keyword\">let</span> result <span class=\"operator\">=</span> parser.parse(<span class=\"string\">&quot;plist&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<p> <code>let parser: Parser&lt;PLIST&gt;</code>  <code>PLIST</code>  <code>Bool</code> <code>Date</code> <code>Data</code> <code>Number</code> <code>String</code> 5  <code>Array&lt;PLIST&gt;</code> <code>Dictionary&lt;PLIST&gt;</code> 2 nested <code>Parser&lt;PLIST&gt;</code>  <code>Parser&lt;Bool&gt;</code> <code>Parser&lt;Date&gt;</code> <code>Parser&lt;Data&gt;</code> <code>Parser&lt;Number&gt;</code> <code>Parser&lt;String&gt;</code> 5  parser  <code>Parser&lt;Array&gt;</code> <code>Parser&lt;Dictionary&gt;</code> 2  parser </p>\n<h3 id=\"Bool-Parser\"><a href=\"#Bool-Parser\" class=\"headerlink\" title=\"Bool Parser\"></a>Bool Parser</h3><p> Plist Bool  <code>&lt;true/&gt;</code>  <code>&lt;false/&gt;</code> Bool  parser  <code>&lt;true/&gt;</code>  <code>&lt;false/&gt;</code></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> _true <span class=\"operator\">=</span> string(<span class=\"string\">&quot;&lt;true/&gt;&quot;</span>) <span class=\"operator\">&lt;&amp;&gt;</span> const(<span class=\"type\">PLIST</span>.bool(<span class=\"literal\">true</span>))</span><br><span class=\"line\"><span class=\"keyword\">let</span> _false <span class=\"operator\">=</span> string(<span class=\"string\">&quot;&lt;false/&gt;&quot;</span>) <span class=\"operator\">&lt;&amp;&gt;</span> const(<span class=\"type\">PLIST</span>.bool(<span class=\"literal\">false</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> _bool <span class=\"operator\">=</span> _true <span class=\"operator\">&lt;|&gt;</span> _false</span><br><span class=\"line\">_bool.parse(<span class=\"string\">&quot;&lt;false/&gt;&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Date-Parser\"><a href=\"#Date-Parser\" class=\"headerlink\" title=\"Date Parser\"></a>Date Parser</h3><p>Plist  Date  UTC  <code>&lt;date&gt;2017-08-05T14:25:14Z&lt;/date&gt;</code> <code>&lt;date&gt;</code>  <code>&lt;/date&gt;</code>  Date  parser  <code>PLIST.date(date)</code>, date  2017-08-05T14:25:14Z  format </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> _date <span class=\"operator\">=</span> string(<span class=\"string\">&quot;&lt;date&gt;&quot;</span>) <span class=\"operator\">*&gt;</span> manyTill(_any, string(<span class=\"string\">&quot;&lt;/date&gt;&quot;</span>)) <span class=\"operator\">&lt;&amp;&gt;</span> &#123; <span class=\"type\">PLIST</span>.date(<span class=\"type\">String</span>(<span class=\"variable\">$0</span>).date<span class=\"operator\">!</span>) &#125;</span><br><span class=\"line\">_date.parse(<span class=\"string\">&quot;&lt;date&gt;2017-08-05T14:25:14Z&lt;/date&gt;&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/// UTC Date</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">String</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">var</span> date: <span class=\"type\">Date</span>? &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> formatter <span class=\"operator\">=</span> <span class=\"type\">DateFormatter</span>()</span><br><span class=\"line\">        formatter.dateFormat <span class=\"operator\">=</span> <span class=\"string\">&quot;yyyy-MM-dd&#x27;T&#x27;HH:mm:ss&#x27;Z&#x27;&quot;</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> formatter.date(from: <span class=\"keyword\">self</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Data-Parser\"><a href=\"#Data-Parser\" class=\"headerlink\" title=\"Data Parser\"></a>Data Parser</h3><p>Plist  Data  Base64  Data Parser  Date Parser  tag  Data </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> _data <span class=\"operator\">=</span> string(<span class=\"string\">&quot;&lt;data&gt;&quot;</span>) <span class=\"operator\">*&gt;</span> manyTill(_any, string(<span class=\"string\">&quot;&lt;/data&gt;&quot;</span>)) <span class=\"operator\">&lt;&amp;&gt;</span> &#123; <span class=\"type\">PLIST</span>.data(<span class=\"type\">Data</span>(base64Encoded: <span class=\"type\">String</span>(<span class=\"variable\">$0</span>))<span class=\"operator\">!</span>) &#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> dataString <span class=\"operator\">=</span> _data.parse(<span class=\"string\">&quot;&lt;data&gt;VGVzdFZhbHVl&lt;/data&gt;&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Number-Parser\"><a href=\"#Number-Parser\" class=\"headerlink\" title=\"Number Parser\"></a>Number Parser</h3><p>Plist  Number  <code>tag</code>  <code>integer</code> <code>real</code></p>\n<p> Integer Parser</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> _integer <span class=\"operator\">=</span> string(<span class=\"string\">&quot;&lt;integer&gt;&quot;</span>) <span class=\"operator\">*&gt;</span> manyTill(_digit, string(<span class=\"string\">&quot;&lt;/integer&gt;&quot;</span>)) <span class=\"operator\">&lt;&amp;&gt;</span> &#123; <span class=\"type\">PLIST</span>.number(<span class=\"type\">Int</span>(<span class=\"type\">String</span>(<span class=\"variable\">$0</span>))<span class=\"operator\">!</span>) &#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"String-Parser\"><a href=\"#String-Parser\" class=\"headerlink\" title=\"String Parser\"></a>String Parser</h3><p>String Parser  Date Parser  Data Parser </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> _string <span class=\"operator\">=</span> string(<span class=\"string\">&quot;&lt;string&gt;&quot;</span>) <span class=\"operator\">*&gt;</span> manyTill(_any, string(<span class=\"string\">&quot;&lt;/string&gt;&quot;</span>)) <span class=\"operator\">&lt;&amp;&gt;</span> &#123; <span class=\"type\">PLIST</span>.string(<span class=\"type\">String</span>(<span class=\"variable\">$0</span>)) &#125;</span><br><span class=\"line\">_string.parse(<span class=\"string\">&quot;&lt;string&gt;The String&lt;/string&gt;&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Tag-Parser\"><a href=\"#Tag-Parser\" class=\"headerlink\" title=\"Tag Parser\"></a>Tag Parser</h3><p> Bool Parser  Parser</p>\n<ul>\n<li>closed tag</li>\n<li></li>\n</ul>\n<p> Parser </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">tag</span>&lt;<span class=\"type\">A</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">tag</span>: <span class=\"type\">String</span>, <span class=\"keyword\">_</span> <span class=\"params\">p</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt;)</span> -&gt; <span class=\"type\">Parser</span>&lt;[<span class=\"type\">A</span>]&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> string(<span class=\"string\">&quot;&lt;<span class=\"subst\">\\(tag)</span>&gt;&quot;</span>) <span class=\"operator\">*&gt;</span> manyTill(p, string(<span class=\"string\">&quot;&lt;/<span class=\"subst\">\\(tag)</span>&gt;&quot;</span>))</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> _date1 <span class=\"operator\">=</span> tag(<span class=\"string\">&quot;&lt;date&gt;&quot;</span>, _any) <span class=\"operator\">&lt;&amp;&gt;</span> &#123; <span class=\"type\">PLIST</span>.date(<span class=\"type\">String</span>(<span class=\"variable\">$0</span>).date<span class=\"operator\">!</span>) &#125;</span><br><span class=\"line\">_date1.parse(<span class=\"string\">&quot;&lt;date&gt;2017-08-05T14:25:14Z&lt;/date&gt;&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> _string1 <span class=\"operator\">=</span> tag(<span class=\"string\">&quot;string&quot;</span>, _any) <span class=\"operator\">&lt;&amp;&gt;</span> &#123; <span class=\"type\">PLIST</span>.string(<span class=\"type\">String</span>(<span class=\"variable\">$0</span>)) &#125;</span><br><span class=\"line\">_string1.parse(<span class=\"string\">&quot;&lt;string&gt;The String&lt;/string&gt;&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Array-Parser\"><a href=\"#Array-Parser\" class=\"headerlink\" title=\"Array Parser\"></a>Array Parser</h3><p>Array Parser  Dictionary Parser  PLIST  Enum PLIST  <code>indirect</code>  parser </p>\n<p> Swift  Dictionary </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> _plist <span class=\"operator\">=</span> plist()</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">plist</span>()</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">PLIST</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> _bool <span class=\"operator\">&lt;|&gt;</span> _string <span class=\"operator\">&lt;|&gt;</span> _integer <span class=\"operator\">&lt;|&gt;</span> _date <span class=\"operator\">&lt;|&gt;</span> _data <span class=\"operator\">&lt;|&gt;</span> _array</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> _array <span class=\"operator\">=</span> tag(<span class=\"string\">&quot;array&quot;</span>, _plist) <span class=\"operator\">&lt;&amp;&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">PLIST</span>.array(<span class=\"variable\">$0</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Dictionary-Parser\"><a href=\"#Dictionary-Parser\" class=\"headerlink\" title=\"Dictionary Parser\"></a>Dictionary Parser</h3><p>Dictionary Parser  Array Parser </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> _plist <span class=\"operator\">=</span> plist()</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">plist</span>()</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">PLIST</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> _bool <span class=\"operator\">&lt;|&gt;</span> _string <span class=\"operator\">&lt;|&gt;</span> _integer <span class=\"operator\">&lt;|&gt;</span> _date <span class=\"operator\">&lt;|&gt;</span> _data <span class=\"operator\">&lt;|&gt;</span> _array <span class=\"operator\">&lt;|&gt;</span> _dict</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> _dict <span class=\"operator\">=</span> tag(<span class=\"string\">&quot;dict&quot;</span>, <span class=\"operator\">?</span>) <span class=\"operator\">&lt;&amp;&gt;</span> &#123;</span><br><span class=\"line\">   <span class=\"comment\">///  PLIST.dict</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> Dictionary  Array Array  Plist  Dictionary  key-value  key-value  <code>tag(&quot;dict&quot;, _keyValue)</code></p>\n<p> Key-Value Parser</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> _key <span class=\"operator\">=</span> string(<span class=\"string\">&quot;&lt;key&gt;&quot;</span>) <span class=\"operator\">*&gt;</span> manyTill(_any, string(<span class=\"string\">&quot;&lt;/key&gt;&quot;</span>)) <span class=\"operator\">&lt;&amp;&gt;</span> &#123; <span class=\"type\">String</span>(<span class=\"variable\">$0</span>) &#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> _keyValue <span class=\"operator\">=</span> (&#123; a <span class=\"keyword\">in</span> &#123; b <span class=\"keyword\">in</span> (a, b) &#125;&#125; <span class=\"operator\">&lt;^&gt;</span> _key <span class=\"operator\">&lt;*&gt;</span> (value))</span><br></pre></td></tr></table></figure>\n\n<p> Dictionary Parser</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> _dict <span class=\"operator\">=</span> tag(<span class=\"string\">&quot;dict&quot;</span>, _keyValue) <span class=\"operator\">&lt;&amp;&gt;</span> &#123; <span class=\"type\">PLIST</span>.dict(atod(<span class=\"variable\">$0</span>)) &#125;</span><br><span class=\"line\"><span class=\"comment\">/// Tuple Array to Dictionary</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">atod</span>&lt;<span class=\"type\">Key</span>: <span class=\"type\">Hashable</span>, <span class=\"type\">Value</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">tuples</span>: [(<span class=\"type\">Key</span>, <span class=\"type\">Value</span>)])</span> -&gt; [<span class=\"type\">Key</span>: <span class=\"type\">Value</span>] &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> dict: [<span class=\"type\">Key</span>: <span class=\"type\">Value</span>] <span class=\"operator\">=</span> [:]</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (key, value) <span class=\"keyword\">in</span> tuples &#123;</span><br><span class=\"line\">        dict[key] <span class=\"operator\">=</span> value</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> dict</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> _kv <span class=\"operator\">=</span> _keyValue <span class=\"operator\">&lt;&amp;&gt;</span> &#123; ttod(<span class=\"variable\">$0</span>) &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> _dict1 <span class=\"operator\">=</span> tag(<span class=\"string\">&quot;dict&quot;</span>, _kv) <span class=\"operator\">&lt;&amp;&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">PLIST</span>.dict(</span><br><span class=\"line\">    \t\t<span class=\"variable\">$0</span>.flatMap &#123; <span class=\"variable\">$0</span> &#125;</span><br><span class=\"line\">        .reduce([String: <span class=\"type\">PLIST</span>]()) &#123; d, kv <span class=\"keyword\">in</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> dict <span class=\"operator\">=</span> d</span><br><span class=\"line\">            dict.updateValue(kv.value, forKey: kv.key)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> dict</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">ttod</span>&lt;<span class=\"type\">Key</span>: <span class=\"type\">Hashable</span>, <span class=\"type\">Value</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">tuple</span>: (<span class=\"type\">Key</span>, <span class=\"type\">Value</span>))</span> -&gt; [<span class=\"type\">Key</span>: <span class=\"type\">Value</span>] &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [tuple.<span class=\"number\">0</span>: tuple.<span class=\"number\">1</span>]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Plist-Parser\"><a href=\"#Plist-Parser\" class=\"headerlink\" title=\"Plist Parser\"></a>Plist Parser</h3><p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> _plist <span class=\"operator\">=</span> _bool <span class=\"operator\">&lt;|&gt;</span> _string <span class=\"operator\">&lt;|&gt;</span> _integer <span class=\"operator\">&lt;|&gt;</span> _date <span class=\"operator\">&lt;|&gt;</span> _data <span class=\"operator\">&lt;|&gt;</span> _array <span class=\"operator\">&lt;|&gt;</span> _dict</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> result <span class=\"operator\">=</span> _plist.parse(plist)</span><br><span class=\"line\"><span class=\"built_in\">dump</span>(result)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Ref\"><a href=\"#Ref\" class=\"headerlink\" title=\"Ref\"></a>Ref</h2><p><a href=\"https://zh.wikipedia.org/zh-hans/%E5%B1%9E%E6%80%A7%E5%88%97%E8%A1%A8\"></a><br><a href=\"http://blessingsoft.com/2017/05/28/parser-combinator/\">Parser Combinator</a><br><a href=\"https://github.com/nixzhu/dev-blog/blob/master/2017-04-12-json-parser.md\"></a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>Plist  Apple  XML  Binary  HTML Plist tag functional  parser combinator  plist parser </p>\n<h2 id=\"Plist\"><a href=\"#Plist\" class=\"headerlink\" title=\"Plist\"></a>Plist</h2><p> Plist </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;dict&gt;</span><br><span class=\"line\">    &lt;key&gt;number&lt;/key&gt;</span><br><span class=\"line\">    &lt;integer&gt;0&lt;/integer&gt;</span><br><span class=\"line\">    &lt;key&gt;date&lt;/key&gt;</span><br><span class=\"line\">    &lt;date&gt;2017-08-05T14:25:14Z&lt;/date&gt;</span><br><span class=\"line\">    &lt;key&gt;data&lt;/key&gt;</span><br><span class=\"line\">    &lt;data&gt;VGVzdFZhbHVl&lt;/data&gt;</span><br><span class=\"line\">    &lt;key&gt;boolean&lt;/key&gt;</span><br><span class=\"line\">    &lt;true/&gt;</span><br><span class=\"line\">    &lt;key&gt;array&lt;/key&gt;</span><br><span class=\"line\">    &lt;array&gt;</span><br><span class=\"line\">        &lt;string&gt;string&lt;/string&gt;</span><br><span class=\"line\">        &lt;false/&gt;</span><br><span class=\"line\">        &lt;integer&gt;0&lt;/integer&gt;</span><br><span class=\"line\">    &lt;/array&gt;</span><br><span class=\"line\"> &lt;/dict&gt;</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://zh.wikipedia.org/zh-hans/%E5%B1%9E%E6%80%A7%E5%88%97%E8%A1%A8\">wikipedia</a>  <code>XML</code>  macOS/iOS </p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">Foundation </th>\n<th align=\"left\">Core Foundation </th>\n<th align=\"left\">XML </th>\n<th align=\"left\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">NSString</td>\n<td align=\"left\">CFString</td>\n<td align=\"left\">&lt;string&gt;</td>\n<td align=\"left\">UTF-8 </td>\n</tr>\n<tr>\n<td align=\"left\">NSNumber</td>\n<td align=\"left\">CFNumber</td>\n<td align=\"left\">&lt;real&gt;, &lt;integer&gt;</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">NSNumber</td>\n<td align=\"left\">CFBoolean</td>\n<td align=\"left\">&lt;true/&gt;, or &lt;false/&gt;</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">NSDate</td>\n<td align=\"left\">CFDate</td>\n<td align=\"left\">&lt;date&gt;</td>\n<td align=\"left\">ISO 8601 </td>\n</tr>\n<tr>\n<td align=\"left\">NSData</td>\n<td align=\"left\">CFData</td>\n<td align=\"left\">&lt;data&gt;</td>\n<td align=\"left\">Base64 </td>\n</tr>\n<tr>\n<td align=\"left\">NSArray</td>\n<td align=\"left\">CFArray</td>\n<td align=\"left\">&lt;array&gt;</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">NSDictionary</td>\n<td align=\"left\">CFDictionary</td>\n<td align=\"left\">&lt;dict&gt;</td>\n<td align=\"left\"> &lt;key&gt;  plist </td>\n</tr>\n</tbody></table>\n<p> Plist </p>\n<h2 id=\"Model\"><a href=\"#Model\" class=\"headerlink\" title=\"Model\"></a>Model</h2><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// The plist data model</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">enum</span> <span class=\"title\">PLIST</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/// &lt;true/&gt; or &lt;false/&gt;</span></span><br><span class=\"line\">    <span class=\"keyword\">case</span> bool(<span class=\"type\">Bool</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/// 2017-08-05T14:25:14Z</span></span><br><span class=\"line\">    <span class=\"keyword\">case</span> date(<span class=\"type\">Date</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/// &lt;data&gt;VGVzdFZhbHVl&lt;/data&gt; (&lt;54657374 56616c75 65&gt;</span></span><br><span class=\"line\">    <span class=\"keyword\">case</span> data(<span class=\"type\">Data</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/// &lt;integer&gt;233&lt;/integer&gt; or &lt;real&gt;2.33&lt;/real&gt;</span></span><br><span class=\"line\">    <span class=\"keyword\">case</span> number(<span class=\"type\">Int</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/// &lt;string&gt;string&lt;/string&gt;</span></span><br><span class=\"line\">    <span class=\"keyword\">case</span> string(<span class=\"type\">String</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/// &lt;array&gt;&lt;string&gt;The String&lt;/string&gt;&lt;/array&gt;</span></span><br><span class=\"line\">    <span class=\"keyword\">indirect</span> <span class=\"keyword\">case</span> array([<span class=\"type\">PLIST</span>])</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/// &lt;dict&gt;&lt;key&gt;The Key&lt;/key&gt;&lt;string&gt;The String&lt;/string&gt;&lt;/dict&gt;</span></span><br><span class=\"line\">    <span class=\"keyword\">indirect</span> <span class=\"keyword\">case</span> dict([String: <span class=\"type\">PLIST</span>])</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Parser\"><a href=\"#Parser\" class=\"headerlink\" title=\"Parser\"></a>Parser</h2><p> Plist data model Plist   <code>PLIST</code>  <code>parser</code></p>\n<p> parser parser </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> parser: <span class=\"type\">Parser</span>&lt;<span class=\"type\">PLIST</span>&gt;</span><br><span class=\"line\"><span class=\"keyword\">let</span> result <span class=\"operator\">=</span> parser.parse(<span class=\"string\">&quot;plist&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<p> <code>let parser: Parser&lt;PLIST&gt;</code>  <code>PLIST</code>  <code>Bool</code> <code>Date</code> <code>Data</code> <code>Number</code> <code>String</code> 5  <code>Array&lt;PLIST&gt;</code> <code>Dictionary&lt;PLIST&gt;</code> 2 nested <code>Parser&lt;PLIST&gt;</code>  <code>Parser&lt;Bool&gt;</code> <code>Parser&lt;Date&gt;</code> <code>Parser&lt;Data&gt;</code> <code>Parser&lt;Number&gt;</code> <code>Parser&lt;String&gt;</code> 5  parser  <code>Parser&lt;Array&gt;</code> <code>Parser&lt;Dictionary&gt;</code> 2  parser </p>\n<h3 id=\"Bool-Parser\"><a href=\"#Bool-Parser\" class=\"headerlink\" title=\"Bool Parser\"></a>Bool Parser</h3><p> Plist Bool  <code>&lt;true/&gt;</code>  <code>&lt;false/&gt;</code> Bool  parser  <code>&lt;true/&gt;</code>  <code>&lt;false/&gt;</code></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> _true <span class=\"operator\">=</span> string(<span class=\"string\">&quot;&lt;true/&gt;&quot;</span>) <span class=\"operator\">&lt;&amp;&gt;</span> const(<span class=\"type\">PLIST</span>.bool(<span class=\"literal\">true</span>))</span><br><span class=\"line\"><span class=\"keyword\">let</span> _false <span class=\"operator\">=</span> string(<span class=\"string\">&quot;&lt;false/&gt;&quot;</span>) <span class=\"operator\">&lt;&amp;&gt;</span> const(<span class=\"type\">PLIST</span>.bool(<span class=\"literal\">false</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> _bool <span class=\"operator\">=</span> _true <span class=\"operator\">&lt;|&gt;</span> _false</span><br><span class=\"line\">_bool.parse(<span class=\"string\">&quot;&lt;false/&gt;&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Date-Parser\"><a href=\"#Date-Parser\" class=\"headerlink\" title=\"Date Parser\"></a>Date Parser</h3><p>Plist  Date  UTC  <code>&lt;date&gt;2017-08-05T14:25:14Z&lt;/date&gt;</code> <code>&lt;date&gt;</code>  <code>&lt;/date&gt;</code>  Date  parser  <code>PLIST.date(date)</code>, date  2017-08-05T14:25:14Z  format </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> _date <span class=\"operator\">=</span> string(<span class=\"string\">&quot;&lt;date&gt;&quot;</span>) <span class=\"operator\">*&gt;</span> manyTill(_any, string(<span class=\"string\">&quot;&lt;/date&gt;&quot;</span>)) <span class=\"operator\">&lt;&amp;&gt;</span> &#123; <span class=\"type\">PLIST</span>.date(<span class=\"type\">String</span>(<span class=\"variable\">$0</span>).date<span class=\"operator\">!</span>) &#125;</span><br><span class=\"line\">_date.parse(<span class=\"string\">&quot;&lt;date&gt;2017-08-05T14:25:14Z&lt;/date&gt;&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/// UTC Date</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">String</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">var</span> date: <span class=\"type\">Date</span>? &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> formatter <span class=\"operator\">=</span> <span class=\"type\">DateFormatter</span>()</span><br><span class=\"line\">        formatter.dateFormat <span class=\"operator\">=</span> <span class=\"string\">&quot;yyyy-MM-dd&#x27;T&#x27;HH:mm:ss&#x27;Z&#x27;&quot;</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> formatter.date(from: <span class=\"keyword\">self</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Data-Parser\"><a href=\"#Data-Parser\" class=\"headerlink\" title=\"Data Parser\"></a>Data Parser</h3><p>Plist  Data  Base64  Data Parser  Date Parser  tag  Data </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> _data <span class=\"operator\">=</span> string(<span class=\"string\">&quot;&lt;data&gt;&quot;</span>) <span class=\"operator\">*&gt;</span> manyTill(_any, string(<span class=\"string\">&quot;&lt;/data&gt;&quot;</span>)) <span class=\"operator\">&lt;&amp;&gt;</span> &#123; <span class=\"type\">PLIST</span>.data(<span class=\"type\">Data</span>(base64Encoded: <span class=\"type\">String</span>(<span class=\"variable\">$0</span>))<span class=\"operator\">!</span>) &#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> dataString <span class=\"operator\">=</span> _data.parse(<span class=\"string\">&quot;&lt;data&gt;VGVzdFZhbHVl&lt;/data&gt;&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Number-Parser\"><a href=\"#Number-Parser\" class=\"headerlink\" title=\"Number Parser\"></a>Number Parser</h3><p>Plist  Number  <code>tag</code>  <code>integer</code> <code>real</code></p>\n<p> Integer Parser</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> _integer <span class=\"operator\">=</span> string(<span class=\"string\">&quot;&lt;integer&gt;&quot;</span>) <span class=\"operator\">*&gt;</span> manyTill(_digit, string(<span class=\"string\">&quot;&lt;/integer&gt;&quot;</span>)) <span class=\"operator\">&lt;&amp;&gt;</span> &#123; <span class=\"type\">PLIST</span>.number(<span class=\"type\">Int</span>(<span class=\"type\">String</span>(<span class=\"variable\">$0</span>))<span class=\"operator\">!</span>) &#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"String-Parser\"><a href=\"#String-Parser\" class=\"headerlink\" title=\"String Parser\"></a>String Parser</h3><p>String Parser  Date Parser  Data Parser </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> _string <span class=\"operator\">=</span> string(<span class=\"string\">&quot;&lt;string&gt;&quot;</span>) <span class=\"operator\">*&gt;</span> manyTill(_any, string(<span class=\"string\">&quot;&lt;/string&gt;&quot;</span>)) <span class=\"operator\">&lt;&amp;&gt;</span> &#123; <span class=\"type\">PLIST</span>.string(<span class=\"type\">String</span>(<span class=\"variable\">$0</span>)) &#125;</span><br><span class=\"line\">_string.parse(<span class=\"string\">&quot;&lt;string&gt;The String&lt;/string&gt;&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Tag-Parser\"><a href=\"#Tag-Parser\" class=\"headerlink\" title=\"Tag Parser\"></a>Tag Parser</h3><p> Bool Parser  Parser</p>\n<ul>\n<li>closed tag</li>\n<li></li>\n</ul>\n<p> Parser </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">tag</span>&lt;<span class=\"type\">A</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">tag</span>: <span class=\"type\">String</span>, <span class=\"keyword\">_</span> <span class=\"params\">p</span>: <span class=\"type\">Parser</span>&lt;<span class=\"type\">A</span>&gt;)</span> -&gt; <span class=\"type\">Parser</span>&lt;[<span class=\"type\">A</span>]&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> string(<span class=\"string\">&quot;&lt;<span class=\"subst\">\\(tag)</span>&gt;&quot;</span>) <span class=\"operator\">*&gt;</span> manyTill(p, string(<span class=\"string\">&quot;&lt;/<span class=\"subst\">\\(tag)</span>&gt;&quot;</span>))</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> _date1 <span class=\"operator\">=</span> tag(<span class=\"string\">&quot;&lt;date&gt;&quot;</span>, _any) <span class=\"operator\">&lt;&amp;&gt;</span> &#123; <span class=\"type\">PLIST</span>.date(<span class=\"type\">String</span>(<span class=\"variable\">$0</span>).date<span class=\"operator\">!</span>) &#125;</span><br><span class=\"line\">_date1.parse(<span class=\"string\">&quot;&lt;date&gt;2017-08-05T14:25:14Z&lt;/date&gt;&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> _string1 <span class=\"operator\">=</span> tag(<span class=\"string\">&quot;string&quot;</span>, _any) <span class=\"operator\">&lt;&amp;&gt;</span> &#123; <span class=\"type\">PLIST</span>.string(<span class=\"type\">String</span>(<span class=\"variable\">$0</span>)) &#125;</span><br><span class=\"line\">_string1.parse(<span class=\"string\">&quot;&lt;string&gt;The String&lt;/string&gt;&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Array-Parser\"><a href=\"#Array-Parser\" class=\"headerlink\" title=\"Array Parser\"></a>Array Parser</h3><p>Array Parser  Dictionary Parser  PLIST  Enum PLIST  <code>indirect</code>  parser </p>\n<p> Swift  Dictionary </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> _plist <span class=\"operator\">=</span> plist()</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">plist</span>()</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">PLIST</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> _bool <span class=\"operator\">&lt;|&gt;</span> _string <span class=\"operator\">&lt;|&gt;</span> _integer <span class=\"operator\">&lt;|&gt;</span> _date <span class=\"operator\">&lt;|&gt;</span> _data <span class=\"operator\">&lt;|&gt;</span> _array</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> _array <span class=\"operator\">=</span> tag(<span class=\"string\">&quot;array&quot;</span>, _plist) <span class=\"operator\">&lt;&amp;&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">PLIST</span>.array(<span class=\"variable\">$0</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Dictionary-Parser\"><a href=\"#Dictionary-Parser\" class=\"headerlink\" title=\"Dictionary Parser\"></a>Dictionary Parser</h3><p>Dictionary Parser  Array Parser </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> _plist <span class=\"operator\">=</span> plist()</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">plist</span>()</span> -&gt; <span class=\"type\">Parser</span>&lt;<span class=\"type\">PLIST</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> _bool <span class=\"operator\">&lt;|&gt;</span> _string <span class=\"operator\">&lt;|&gt;</span> _integer <span class=\"operator\">&lt;|&gt;</span> _date <span class=\"operator\">&lt;|&gt;</span> _data <span class=\"operator\">&lt;|&gt;</span> _array <span class=\"operator\">&lt;|&gt;</span> _dict</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> _dict <span class=\"operator\">=</span> tag(<span class=\"string\">&quot;dict&quot;</span>, <span class=\"operator\">?</span>) <span class=\"operator\">&lt;&amp;&gt;</span> &#123;</span><br><span class=\"line\">   <span class=\"comment\">///  PLIST.dict</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> Dictionary  Array Array  Plist  Dictionary  key-value  key-value  <code>tag(&quot;dict&quot;, _keyValue)</code></p>\n<p> Key-Value Parser</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> _key <span class=\"operator\">=</span> string(<span class=\"string\">&quot;&lt;key&gt;&quot;</span>) <span class=\"operator\">*&gt;</span> manyTill(_any, string(<span class=\"string\">&quot;&lt;/key&gt;&quot;</span>)) <span class=\"operator\">&lt;&amp;&gt;</span> &#123; <span class=\"type\">String</span>(<span class=\"variable\">$0</span>) &#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> _keyValue <span class=\"operator\">=</span> (&#123; a <span class=\"keyword\">in</span> &#123; b <span class=\"keyword\">in</span> (a, b) &#125;&#125; <span class=\"operator\">&lt;^&gt;</span> _key <span class=\"operator\">&lt;*&gt;</span> (value))</span><br></pre></td></tr></table></figure>\n\n<p> Dictionary Parser</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> _dict <span class=\"operator\">=</span> tag(<span class=\"string\">&quot;dict&quot;</span>, _keyValue) <span class=\"operator\">&lt;&amp;&gt;</span> &#123; <span class=\"type\">PLIST</span>.dict(atod(<span class=\"variable\">$0</span>)) &#125;</span><br><span class=\"line\"><span class=\"comment\">/// Tuple Array to Dictionary</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">atod</span>&lt;<span class=\"type\">Key</span>: <span class=\"type\">Hashable</span>, <span class=\"type\">Value</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">tuples</span>: [(<span class=\"type\">Key</span>, <span class=\"type\">Value</span>)])</span> -&gt; [<span class=\"type\">Key</span>: <span class=\"type\">Value</span>] &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> dict: [<span class=\"type\">Key</span>: <span class=\"type\">Value</span>] <span class=\"operator\">=</span> [:]</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (key, value) <span class=\"keyword\">in</span> tuples &#123;</span><br><span class=\"line\">        dict[key] <span class=\"operator\">=</span> value</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> dict</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> _kv <span class=\"operator\">=</span> _keyValue <span class=\"operator\">&lt;&amp;&gt;</span> &#123; ttod(<span class=\"variable\">$0</span>) &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> _dict1 <span class=\"operator\">=</span> tag(<span class=\"string\">&quot;dict&quot;</span>, _kv) <span class=\"operator\">&lt;&amp;&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">PLIST</span>.dict(</span><br><span class=\"line\">    \t\t<span class=\"variable\">$0</span>.flatMap &#123; <span class=\"variable\">$0</span> &#125;</span><br><span class=\"line\">        .reduce([String: <span class=\"type\">PLIST</span>]()) &#123; d, kv <span class=\"keyword\">in</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> dict <span class=\"operator\">=</span> d</span><br><span class=\"line\">            dict.updateValue(kv.value, forKey: kv.key)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> dict</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">ttod</span>&lt;<span class=\"type\">Key</span>: <span class=\"type\">Hashable</span>, <span class=\"type\">Value</span>&gt;(<span class=\"keyword\">_</span> <span class=\"params\">tuple</span>: (<span class=\"type\">Key</span>, <span class=\"type\">Value</span>))</span> -&gt; [<span class=\"type\">Key</span>: <span class=\"type\">Value</span>] &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [tuple.<span class=\"number\">0</span>: tuple.<span class=\"number\">1</span>]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Plist-Parser\"><a href=\"#Plist-Parser\" class=\"headerlink\" title=\"Plist Parser\"></a>Plist Parser</h3><p></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> _plist <span class=\"operator\">=</span> _bool <span class=\"operator\">&lt;|&gt;</span> _string <span class=\"operator\">&lt;|&gt;</span> _integer <span class=\"operator\">&lt;|&gt;</span> _date <span class=\"operator\">&lt;|&gt;</span> _data <span class=\"operator\">&lt;|&gt;</span> _array <span class=\"operator\">&lt;|&gt;</span> _dict</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> result <span class=\"operator\">=</span> _plist.parse(plist)</span><br><span class=\"line\"><span class=\"built_in\">dump</span>(result)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Ref\"><a href=\"#Ref\" class=\"headerlink\" title=\"Ref\"></a>Ref</h2><p><a href=\"https://zh.wikipedia.org/zh-hans/%E5%B1%9E%E6%80%A7%E5%88%97%E8%A1%A8\"></a><br><a href=\"http://blessingsoft.com/2017/05/28/parser-combinator/\">Parser Combinator</a><br><a href=\"https://github.com/nixzhu/dev-blog/blob/master/2017-04-12-json-parser.md\"></a></p>\n"},{"title":"HTTP Streaming/Chunked","date":"2020-04-15T12:00:00.000Z","_content":"## TL;DR\n\n `Cocoa Foundation`  `HTTP Streaming/Chunked`  `Transfer-Encoding: chunked`  `Chunked`  `hook`  `Content-Type`  `text/html` `first 512 bytes` \n\n\n## \n\n IM  **** \n\n\n\n* IP/Port (TCP)\n* TLS (TLS Resumption or TLS Verify)\n* GCM (FCM)\n* WebSocket\n* HTTP Persistent Connection\n\n `IP/Port`  IP  IP  IP  `GCM`([FCM](https://firebase.google.com/docs/cloud-messaging/)) `WebSocket` `Nginx`  `Amazon Cloudfront`  `Azure`  `Azure Domain Fronting`  HTTP \n\n\n## HTTP Persistent Connection\n\nHTTP Persistent Connection  HTTP Connection Reuse  Keep Alive  IM  HTTP(s)  TCP  SSL/TLS  10+  RTT IM  HTTPS \n\nHTTP 1.1  `Keep-Alive`  IM  `Long Poll`  `Streaming` \n\n> HTTP 2.0 \n\n\n## Streaming/Chunked\n\nHTTP 1.1  chunked message  [Chunked transfer encoding - Wikipedia](https://en.wikipedia.org/wiki/Chunked_transfer_encoding) chunked \n\n\n\n1.  URL  chunked  `cloudfront`  `Azure` Azure cdn  chunked \n2.  URL s\n\n\n### How to\n\n HTTP  `Foundation`  `URLSession`  URL  `uplink`  URL   `downlink`\n\n `HTTP 1.1`  `uplink`  `Transfer-Encoding`  `chunked` `Bound Pair Stream` `InputStream`  `httpBody` `OutputStream` `OutputStream`  `InputStream` `URLSession` \n\n `downlink` response  `Transfer-Encoding`  `chunked`  `delegate`  `func urlSession(_:dataTask:didReceive:)` \n\n `uplink`  `downlink`  `name channel` `uplink`  `name channel`  `Connection ID`  `downlink`  `name channel`  `Connection ID`  `downlink` \n\n\n### But\n\n\n\n\n####  1\n\n`uplink`  chunk  `Server 500`  `Transfer-Encoding`  `header`  `body`  `python`  iOS \n\n `uplink`  `Post`  `Stream`  `Transfer-Encoding`  `Server 500` `Tranfer-Encoding`  `Chunked`  `Post`  `Post`  `body`  `Server 500` `Transfer-Encoding`  `body` \n\niOS  python ****  `Chunked`  `chunked` [Wireshark](https://www.wireshark.org)  `[Expert Info (Warning/Undecoded): Unknown transfer coding name in Transfer-Encoding header]` `Transfer-Encoding`  `chunked` `URLSession` HTTP RFC  header field  value  python  `Transfer-Encoding`  `Chunked`\n\n Hook  `header`  `Transfer-Encoding` \n\n>  `URLSessionDataTask`  `orignalRequest`  `currentRequest`  `Transfer-Encoding`  `nil`\n\n\n####  2\n\n `downlink`  `name channel` `HTTP/1.1 200 OK` `downlink`  `POST` `name channel`  `header`  `body`  `Transfer-Encoding`  `Identity` \n\n `header`  `body`  `Transfer-Encoding`  `chunked` `URLSession` `URLSession`  `delegate`  `func urlSession(_:dataTask:didReceive, completionHandler:` `header`  `chunk`  `body` \n\n 1  `Transfer-Encoding`  `chunked`  `Identity`  `header`  `Content-Length`  `chunked` \n\n `downlink`  `name channel`  `uplink` `downlink`  `name channel`  `chunk`  `chunk``downlink`  `name channel`  `seq`  `ack`  `name channel` \n\n `name channel` ** `URLSession`  512 bytes  buffer  512 bytes  response  data**\n\n `first 512 bytes`  [HTML 5 rules for determining content types](https://dev.w3.org/html5/cts/html5-type-sniffing.html)  H5  `first 512 bytes`  `Content-Type`  `text/html` \n\n `URLSession`  `Java`  `Python`  `text/html` `application/json`  `web` \n\n**  `Content-Type`  `application/octet-stream` **\n\n\n####  3\n\n `Proxy`  `Proxy`  `Proxy`  `header`  `End-to-end headers`  `Hop-by-hop headers`([HTTP headers - HTTP | MDN](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers)\n\n `Charles`  `ProxyMan`  `HTTPS`  1 `Server 500`  `Proxy` `Server 500`\n\n\n\n\n#### \n\n `URLSession`  `libcurl` \n\n apple  Swift  [Foundation](https://github.com/apple/swift-corelibs-foundation) [URLSession](https://github.com/apple/swift-corelibs-foundation/tree/master/Sources/FoundationNetworking/URLSession)  `body`  ` Body  Stream  libcurl  read function  body  chunk inputStream `  iOS  `URLSession` `input stream`  `output stream` `Output stream`  `buffer` [](https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Streams/Streams.html#//apple_ref/doc/uid/10000188-SW1)  `RunLoop` \n\n `RunLoop`  `read function`  `input stream`  `retryLater` `libcurl`  `read socket`  `RunLoop`  `hasBytesAvailable`  `read socket`  `resume` `File`  `Body` \n\n\n### Conclusion\n\n `Cocoa Foundation`  `Streaming/Chunked` `Cocoa Foundation`  low level  ->  -> ","source":"_posts/http-chunked.md","raw":"---\ntitle: HTTP Streaming/Chunked\ndate: 2020-04-15 20:00:00\ntags:\n    - swift\n    - chunked\n    - streaming\n    - http\ncategories: networking\n---\n## TL;DR\n\n `Cocoa Foundation`  `HTTP Streaming/Chunked`  `Transfer-Encoding: chunked`  `Chunked`  `hook`  `Content-Type`  `text/html` `first 512 bytes` \n\n\n## \n\n IM  **** \n\n\n\n* IP/Port (TCP)\n* TLS (TLS Resumption or TLS Verify)\n* GCM (FCM)\n* WebSocket\n* HTTP Persistent Connection\n\n `IP/Port`  IP  IP  IP  `GCM`([FCM](https://firebase.google.com/docs/cloud-messaging/)) `WebSocket` `Nginx`  `Amazon Cloudfront`  `Azure`  `Azure Domain Fronting`  HTTP \n\n\n## HTTP Persistent Connection\n\nHTTP Persistent Connection  HTTP Connection Reuse  Keep Alive  IM  HTTP(s)  TCP  SSL/TLS  10+  RTT IM  HTTPS \n\nHTTP 1.1  `Keep-Alive`  IM  `Long Poll`  `Streaming` \n\n> HTTP 2.0 \n\n\n## Streaming/Chunked\n\nHTTP 1.1  chunked message  [Chunked transfer encoding - Wikipedia](https://en.wikipedia.org/wiki/Chunked_transfer_encoding) chunked \n\n\n\n1.  URL  chunked  `cloudfront`  `Azure` Azure cdn  chunked \n2.  URL s\n\n\n### How to\n\n HTTP  `Foundation`  `URLSession`  URL  `uplink`  URL   `downlink`\n\n `HTTP 1.1`  `uplink`  `Transfer-Encoding`  `chunked` `Bound Pair Stream` `InputStream`  `httpBody` `OutputStream` `OutputStream`  `InputStream` `URLSession` \n\n `downlink` response  `Transfer-Encoding`  `chunked`  `delegate`  `func urlSession(_:dataTask:didReceive:)` \n\n `uplink`  `downlink`  `name channel` `uplink`  `name channel`  `Connection ID`  `downlink`  `name channel`  `Connection ID`  `downlink` \n\n\n### But\n\n\n\n\n####  1\n\n`uplink`  chunk  `Server 500`  `Transfer-Encoding`  `header`  `body`  `python`  iOS \n\n `uplink`  `Post`  `Stream`  `Transfer-Encoding`  `Server 500` `Tranfer-Encoding`  `Chunked`  `Post`  `Post`  `body`  `Server 500` `Transfer-Encoding`  `body` \n\niOS  python ****  `Chunked`  `chunked` [Wireshark](https://www.wireshark.org)  `[Expert Info (Warning/Undecoded): Unknown transfer coding name in Transfer-Encoding header]` `Transfer-Encoding`  `chunked` `URLSession` HTTP RFC  header field  value  python  `Transfer-Encoding`  `Chunked`\n\n Hook  `header`  `Transfer-Encoding` \n\n>  `URLSessionDataTask`  `orignalRequest`  `currentRequest`  `Transfer-Encoding`  `nil`\n\n\n####  2\n\n `downlink`  `name channel` `HTTP/1.1 200 OK` `downlink`  `POST` `name channel`  `header`  `body`  `Transfer-Encoding`  `Identity` \n\n `header`  `body`  `Transfer-Encoding`  `chunked` `URLSession` `URLSession`  `delegate`  `func urlSession(_:dataTask:didReceive, completionHandler:` `header`  `chunk`  `body` \n\n 1  `Transfer-Encoding`  `chunked`  `Identity`  `header`  `Content-Length`  `chunked` \n\n `downlink`  `name channel`  `uplink` `downlink`  `name channel`  `chunk`  `chunk``downlink`  `name channel`  `seq`  `ack`  `name channel` \n\n `name channel` ** `URLSession`  512 bytes  buffer  512 bytes  response  data**\n\n `first 512 bytes`  [HTML 5 rules for determining content types](https://dev.w3.org/html5/cts/html5-type-sniffing.html)  H5  `first 512 bytes`  `Content-Type`  `text/html` \n\n `URLSession`  `Java`  `Python`  `text/html` `application/json`  `web` \n\n**  `Content-Type`  `application/octet-stream` **\n\n\n####  3\n\n `Proxy`  `Proxy`  `Proxy`  `header`  `End-to-end headers`  `Hop-by-hop headers`([HTTP headers - HTTP | MDN](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers)\n\n `Charles`  `ProxyMan`  `HTTPS`  1 `Server 500`  `Proxy` `Server 500`\n\n\n\n\n#### \n\n `URLSession`  `libcurl` \n\n apple  Swift  [Foundation](https://github.com/apple/swift-corelibs-foundation) [URLSession](https://github.com/apple/swift-corelibs-foundation/tree/master/Sources/FoundationNetworking/URLSession)  `body`  ` Body  Stream  libcurl  read function  body  chunk inputStream `  iOS  `URLSession` `input stream`  `output stream` `Output stream`  `buffer` [](https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Streams/Streams.html#//apple_ref/doc/uid/10000188-SW1)  `RunLoop` \n\n `RunLoop`  `read function`  `input stream`  `retryLater` `libcurl`  `read socket`  `RunLoop`  `hasBytesAvailable`  `read socket`  `resume` `File`  `Body` \n\n\n### Conclusion\n\n `Cocoa Foundation`  `Streaming/Chunked` `Cocoa Foundation`  low level  ->  -> ","slug":"http-chunked","published":1,"updated":"2022-01-02T11:46:40.949Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckxx810xh000m9ith27rh8my9","content":"<h2 id=\"TL-DR\"><a href=\"#TL-DR\" class=\"headerlink\" title=\"TL;DR\"></a>TL;DR</h2><p> <code>Cocoa Foundation</code>  <code>HTTP Streaming/Chunked</code>  <code>Transfer-Encoding: chunked</code>  <code>Chunked</code>  <code>hook</code>  <code>Content-Type</code>  <code>text/html</code> <code>first 512 bytes</code> </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> IM  <strong></strong> </p>\n<p></p>\n<ul>\n<li>IP/Port (TCP)</li>\n<li>TLS (TLS Resumption or TLS Verify)</li>\n<li>GCM (FCM)</li>\n<li>WebSocket</li>\n<li>HTTP Persistent Connection</li>\n</ul>\n<p> <code>IP/Port</code>  IP  IP  IP  <code>GCM</code>(<a href=\"https://firebase.google.com/docs/cloud-messaging/\">FCM</a>) <code>WebSocket</code> <code>Nginx</code>  <code>Amazon Cloudfront</code>  <code>Azure</code>  <code>Azure Domain Fronting</code>  HTTP </p>\n<h2 id=\"HTTP-Persistent-Connection\"><a href=\"#HTTP-Persistent-Connection\" class=\"headerlink\" title=\"HTTP Persistent Connection\"></a>HTTP Persistent Connection</h2><p>HTTP Persistent Connection  HTTP Connection Reuse  Keep Alive  IM  HTTP(s)  TCP  SSL/TLS  10+  RTT IM  HTTPS </p>\n<p>HTTP 1.1  <code>Keep-Alive</code>  IM  <code>Long Poll</code>  <code>Streaming</code> </p>\n<blockquote>\n<p>HTTP 2.0 </p>\n</blockquote>\n<h2 id=\"Streaming-Chunked\"><a href=\"#Streaming-Chunked\" class=\"headerlink\" title=\"Streaming/Chunked\"></a>Streaming/Chunked</h2><p>HTTP 1.1  chunked message  <a href=\"https://en.wikipedia.org/wiki/Chunked_transfer_encoding\">Chunked transfer encoding - Wikipedia</a> chunked </p>\n<p></p>\n<ol>\n<li> URL  chunked  <code>cloudfront</code>  <code>Azure</code> Azure cdn  chunked </li>\n<li> URL s</li>\n</ol>\n<h3 id=\"How-to\"><a href=\"#How-to\" class=\"headerlink\" title=\"How to\"></a>How to</h3><p> HTTP  <code>Foundation</code>  <code>URLSession</code>  URL  <code>uplink</code>  URL   <code>downlink</code></p>\n<p> <code>HTTP 1.1</code>  <code>uplink</code>  <code>Transfer-Encoding</code>  <code>chunked</code> <code>Bound Pair Stream</code> <code>InputStream</code>  <code>httpBody</code> <code>OutputStream</code> <code>OutputStream</code>  <code>InputStream</code> <code>URLSession</code> </p>\n<p> <code>downlink</code> response  <code>Transfer-Encoding</code>  <code>chunked</code>  <code>delegate</code>  <code>func urlSession(_:dataTask:didReceive:)</code> </p>\n<p> <code>uplink</code>  <code>downlink</code>  <code>name channel</code> <code>uplink</code>  <code>name channel</code>  <code>Connection ID</code>  <code>downlink</code>  <code>name channel</code>  <code>Connection ID</code>  <code>downlink</code> </p>\n<h3 id=\"But\"><a href=\"#But\" class=\"headerlink\" title=\"But\"></a>But</h3><p></p>\n<h4 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\" 1\"></a> 1</h4><p><code>uplink</code>  chunk  <code>Server 500</code>  <code>Transfer-Encoding</code>  <code>header</code>  <code>body</code>  <code>python</code>  iOS </p>\n<p> <code>uplink</code>  <code>Post</code>  <code>Stream</code>  <code>Transfer-Encoding</code>  <code>Server 500</code> <code>Tranfer-Encoding</code>  <code>Chunked</code>  <code>Post</code>  <code>Post</code>  <code>body</code>  <code>Server 500</code> <code>Transfer-Encoding</code>  <code>body</code> </p>\n<p>iOS  python <strong></strong>  <code>Chunked</code>  <code>chunked</code> <a href=\"https://www.wireshark.org/\">Wireshark</a>  <code>[Expert Info (Warning/Undecoded): Unknown transfer coding name in Transfer-Encoding header]</code> <code>Transfer-Encoding</code>  <code>chunked</code> <code>URLSession</code> HTTP RFC  header field  value  python  <code>Transfer-Encoding</code>  <code>Chunked</code></p>\n<p> Hook  <code>header</code>  <code>Transfer-Encoding</code> </p>\n<blockquote>\n<p> <code>URLSessionDataTask</code>  <code>orignalRequest</code>  <code>currentRequest</code>  <code>Transfer-Encoding</code>  <code>nil</code></p>\n</blockquote>\n<h4 id=\"-2\"><a href=\"#-2\" class=\"headerlink\" title=\" 2\"></a> 2</h4><p> <code>downlink</code>  <code>name channel</code> <code>HTTP/1.1 200 OK</code> <code>downlink</code>  <code>POST</code> <code>name channel</code>  <code>header</code>  <code>body</code>  <code>Transfer-Encoding</code>  <code>Identity</code> </p>\n<p> <code>header</code>  <code>body</code>  <code>Transfer-Encoding</code>  <code>chunked</code> <code>URLSession</code> <code>URLSession</code>  <code>delegate</code>  <code>func urlSession(_:dataTask:didReceive, completionHandler:</code> <code>header</code>  <code>chunk</code>  <code>body</code> </p>\n<p> 1  <code>Transfer-Encoding</code>  <code>chunked</code>  <code>Identity</code>  <code>header</code>  <code>Content-Length</code>  <code>chunked</code> </p>\n<p> <code>downlink</code>  <code>name channel</code>  <code>uplink</code> <code>downlink</code>  <code>name channel</code>  <code>chunk</code>  <code>chunk</code><code>downlink</code>  <code>name channel</code>  <code>seq</code>  <code>ack</code>  <code>name channel</code> </p>\n<p> <code>name channel</code> ** <code>URLSession</code>  512 bytes  buffer  512 bytes  response  data**</p>\n<p> <code>first 512 bytes</code>  <a href=\"https://dev.w3.org/html5/cts/html5-type-sniffing.html\">HTML 5 rules for determining content types</a>  H5  <code>first 512 bytes</code>  <code>Content-Type</code>  <code>text/html</code> </p>\n<p> <code>URLSession</code>  <code>Java</code>  <code>Python</code>  <code>text/html</code> <code>application/json</code>  <code>web</code> </p>\n<p>**  <code>Content-Type</code>  <code>application/octet-stream</code> **</p>\n<h4 id=\"-3\"><a href=\"#-3\" class=\"headerlink\" title=\" 3\"></a> 3</h4><p> <code>Proxy</code>  <code>Proxy</code>  <code>Proxy</code>  <code>header</code>  <code>End-to-end headers</code>  <code>Hop-by-hop headers</code>(<a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers\">HTTP headers - HTTP | MDN</a></p>\n<p> <code>Charles</code>  <code>ProxyMan</code>  <code>HTTPS</code>  1 <code>Server 500</code>  <code>Proxy</code> <code>Server 500</code></p>\n<p></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> <code>URLSession</code>  <code>libcurl</code> </p>\n<p> apple  Swift  <a href=\"https://github.com/apple/swift-corelibs-foundation\">Foundation</a> <a href=\"https://github.com/apple/swift-corelibs-foundation/tree/master/Sources/FoundationNetworking/URLSession\">URLSession</a>  <code>body</code>  <code> Body  Stream  libcurl  read function  body  chunk inputStream </code>  iOS  <code>URLSession</code> <code>input stream</code>  <code>output stream</code> <code>Output stream</code>  <code>buffer</code> <a href=\"https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Streams/Streams.html#//apple_ref/doc/uid/10000188-SW1\"></a>  <code>RunLoop</code> </p>\n<p> <code>RunLoop</code>  <code>read function</code>  <code>input stream</code>  <code>retryLater</code> <code>libcurl</code>  <code>read socket</code>  <code>RunLoop</code>  <code>hasBytesAvailable</code>  <code>read socket</code>  <code>resume</code> <code>File</code>  <code>Body</code> </p>\n<h3 id=\"Conclusion\"><a href=\"#Conclusion\" class=\"headerlink\" title=\"Conclusion\"></a>Conclusion</h3><p> <code>Cocoa Foundation</code>  <code>Streaming/Chunked</code> <code>Cocoa Foundation</code>  low level  -&gt;  -&gt; </p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"TL-DR\"><a href=\"#TL-DR\" class=\"headerlink\" title=\"TL;DR\"></a>TL;DR</h2><p> <code>Cocoa Foundation</code>  <code>HTTP Streaming/Chunked</code>  <code>Transfer-Encoding: chunked</code>  <code>Chunked</code>  <code>hook</code>  <code>Content-Type</code>  <code>text/html</code> <code>first 512 bytes</code> </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> IM  <strong></strong> </p>\n<p></p>\n<ul>\n<li>IP/Port (TCP)</li>\n<li>TLS (TLS Resumption or TLS Verify)</li>\n<li>GCM (FCM)</li>\n<li>WebSocket</li>\n<li>HTTP Persistent Connection</li>\n</ul>\n<p> <code>IP/Port</code>  IP  IP  IP  <code>GCM</code>(<a href=\"https://firebase.google.com/docs/cloud-messaging/\">FCM</a>) <code>WebSocket</code> <code>Nginx</code>  <code>Amazon Cloudfront</code>  <code>Azure</code>  <code>Azure Domain Fronting</code>  HTTP </p>\n<h2 id=\"HTTP-Persistent-Connection\"><a href=\"#HTTP-Persistent-Connection\" class=\"headerlink\" title=\"HTTP Persistent Connection\"></a>HTTP Persistent Connection</h2><p>HTTP Persistent Connection  HTTP Connection Reuse  Keep Alive  IM  HTTP(s)  TCP  SSL/TLS  10+  RTT IM  HTTPS </p>\n<p>HTTP 1.1  <code>Keep-Alive</code>  IM  <code>Long Poll</code>  <code>Streaming</code> </p>\n<blockquote>\n<p>HTTP 2.0 </p>\n</blockquote>\n<h2 id=\"Streaming-Chunked\"><a href=\"#Streaming-Chunked\" class=\"headerlink\" title=\"Streaming/Chunked\"></a>Streaming/Chunked</h2><p>HTTP 1.1  chunked message  <a href=\"https://en.wikipedia.org/wiki/Chunked_transfer_encoding\">Chunked transfer encoding - Wikipedia</a> chunked </p>\n<p></p>\n<ol>\n<li> URL  chunked  <code>cloudfront</code>  <code>Azure</code> Azure cdn  chunked </li>\n<li> URL s</li>\n</ol>\n<h3 id=\"How-to\"><a href=\"#How-to\" class=\"headerlink\" title=\"How to\"></a>How to</h3><p> HTTP  <code>Foundation</code>  <code>URLSession</code>  URL  <code>uplink</code>  URL   <code>downlink</code></p>\n<p> <code>HTTP 1.1</code>  <code>uplink</code>  <code>Transfer-Encoding</code>  <code>chunked</code> <code>Bound Pair Stream</code> <code>InputStream</code>  <code>httpBody</code> <code>OutputStream</code> <code>OutputStream</code>  <code>InputStream</code> <code>URLSession</code> </p>\n<p> <code>downlink</code> response  <code>Transfer-Encoding</code>  <code>chunked</code>  <code>delegate</code>  <code>func urlSession(_:dataTask:didReceive:)</code> </p>\n<p> <code>uplink</code>  <code>downlink</code>  <code>name channel</code> <code>uplink</code>  <code>name channel</code>  <code>Connection ID</code>  <code>downlink</code>  <code>name channel</code>  <code>Connection ID</code>  <code>downlink</code> </p>\n<h3 id=\"But\"><a href=\"#But\" class=\"headerlink\" title=\"But\"></a>But</h3><p></p>\n<h4 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\" 1\"></a> 1</h4><p><code>uplink</code>  chunk  <code>Server 500</code>  <code>Transfer-Encoding</code>  <code>header</code>  <code>body</code>  <code>python</code>  iOS </p>\n<p> <code>uplink</code>  <code>Post</code>  <code>Stream</code>  <code>Transfer-Encoding</code>  <code>Server 500</code> <code>Tranfer-Encoding</code>  <code>Chunked</code>  <code>Post</code>  <code>Post</code>  <code>body</code>  <code>Server 500</code> <code>Transfer-Encoding</code>  <code>body</code> </p>\n<p>iOS  python <strong></strong>  <code>Chunked</code>  <code>chunked</code> <a href=\"https://www.wireshark.org/\">Wireshark</a>  <code>[Expert Info (Warning/Undecoded): Unknown transfer coding name in Transfer-Encoding header]</code> <code>Transfer-Encoding</code>  <code>chunked</code> <code>URLSession</code> HTTP RFC  header field  value  python  <code>Transfer-Encoding</code>  <code>Chunked</code></p>\n<p> Hook  <code>header</code>  <code>Transfer-Encoding</code> </p>\n<blockquote>\n<p> <code>URLSessionDataTask</code>  <code>orignalRequest</code>  <code>currentRequest</code>  <code>Transfer-Encoding</code>  <code>nil</code></p>\n</blockquote>\n<h4 id=\"-2\"><a href=\"#-2\" class=\"headerlink\" title=\" 2\"></a> 2</h4><p> <code>downlink</code>  <code>name channel</code> <code>HTTP/1.1 200 OK</code> <code>downlink</code>  <code>POST</code> <code>name channel</code>  <code>header</code>  <code>body</code>  <code>Transfer-Encoding</code>  <code>Identity</code> </p>\n<p> <code>header</code>  <code>body</code>  <code>Transfer-Encoding</code>  <code>chunked</code> <code>URLSession</code> <code>URLSession</code>  <code>delegate</code>  <code>func urlSession(_:dataTask:didReceive, completionHandler:</code> <code>header</code>  <code>chunk</code>  <code>body</code> </p>\n<p> 1  <code>Transfer-Encoding</code>  <code>chunked</code>  <code>Identity</code>  <code>header</code>  <code>Content-Length</code>  <code>chunked</code> </p>\n<p> <code>downlink</code>  <code>name channel</code>  <code>uplink</code> <code>downlink</code>  <code>name channel</code>  <code>chunk</code>  <code>chunk</code><code>downlink</code>  <code>name channel</code>  <code>seq</code>  <code>ack</code>  <code>name channel</code> </p>\n<p> <code>name channel</code> ** <code>URLSession</code>  512 bytes  buffer  512 bytes  response  data**</p>\n<p> <code>first 512 bytes</code>  <a href=\"https://dev.w3.org/html5/cts/html5-type-sniffing.html\">HTML 5 rules for determining content types</a>  H5  <code>first 512 bytes</code>  <code>Content-Type</code>  <code>text/html</code> </p>\n<p> <code>URLSession</code>  <code>Java</code>  <code>Python</code>  <code>text/html</code> <code>application/json</code>  <code>web</code> </p>\n<p>**  <code>Content-Type</code>  <code>application/octet-stream</code> **</p>\n<h4 id=\"-3\"><a href=\"#-3\" class=\"headerlink\" title=\" 3\"></a> 3</h4><p> <code>Proxy</code>  <code>Proxy</code>  <code>Proxy</code>  <code>header</code>  <code>End-to-end headers</code>  <code>Hop-by-hop headers</code>(<a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers\">HTTP headers - HTTP | MDN</a></p>\n<p> <code>Charles</code>  <code>ProxyMan</code>  <code>HTTPS</code>  1 <code>Server 500</code>  <code>Proxy</code> <code>Server 500</code></p>\n<p></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> <code>URLSession</code>  <code>libcurl</code> </p>\n<p> apple  Swift  <a href=\"https://github.com/apple/swift-corelibs-foundation\">Foundation</a> <a href=\"https://github.com/apple/swift-corelibs-foundation/tree/master/Sources/FoundationNetworking/URLSession\">URLSession</a>  <code>body</code>  <code> Body  Stream  libcurl  read function  body  chunk inputStream </code>  iOS  <code>URLSession</code> <code>input stream</code>  <code>output stream</code> <code>Output stream</code>  <code>buffer</code> <a href=\"https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Streams/Streams.html#//apple_ref/doc/uid/10000188-SW1\"></a>  <code>RunLoop</code> </p>\n<p> <code>RunLoop</code>  <code>read function</code>  <code>input stream</code>  <code>retryLater</code> <code>libcurl</code>  <code>read socket</code>  <code>RunLoop</code>  <code>hasBytesAvailable</code>  <code>read socket</code>  <code>resume</code> <code>File</code>  <code>Body</code> </p>\n<h3 id=\"Conclusion\"><a href=\"#Conclusion\" class=\"headerlink\" title=\"Conclusion\"></a>Conclusion</h3><p> <code>Cocoa Foundation</code>  <code>Streaming/Chunked</code> <code>Cocoa Foundation</code>  low level  -&gt;  -&gt; </p>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"ckxx810x100019ithgkok4y2u","category_id":"ckxx810x600049ith5nfg6ej7","_id":"ckxx810xd000d9ithggzf7r4u"},{"post_id":"ckxx810xa00089ithdlbsbdbf","category_id":"ckxx810x600049ith5nfg6ej7","_id":"ckxx810xf000h9itharvu01vn"},{"post_id":"ckxx810x400039ith5vew3297","category_id":"ckxx810xb00099ithfzo6gcuj","_id":"ckxx810xh000k9ithb5km2xuq"},{"post_id":"ckxx810xc000c9ithe6tt7fs8","category_id":"ckxx810xb00099ithfzo6gcuj","_id":"ckxx810xi000n9ithaky9gff3"},{"post_id":"ckxx810xf000g9ith0tr985fe","category_id":"ckxx810x600049ith5nfg6ej7","_id":"ckxx810xi000p9ithg2e50lcs"},{"post_id":"ckxx810x800069ithgptq97vn","category_id":"ckxx810x600049ith5nfg6ej7","_id":"ckxx810xj000s9ithh914fp2n"},{"post_id":"ckxx810xg000i9ith73ww8npz","category_id":"ckxx810xb00099ithfzo6gcuj","_id":"ckxx810xj000u9ith8r9vapyo"},{"post_id":"ckxx810xh000m9ith27rh8my9","category_id":"ckxx810xg000j9ith3w6fgxtw","_id":"ckxx810xj000w9ithenvq5vy2"},{"post_id":"ckxx810xb000b9ith7wjda3v3","category_id":"ckxx810xg000j9ith3w6fgxtw","_id":"ckxx810xk000x9ith6fixg6h7"}],"PostTag":[{"post_id":"ckxx810x100019ithgkok4y2u","tag_id":"ckxx810x700059ith9hgibdb1","_id":"ckxx810xi000o9ithgen9bono"},{"post_id":"ckxx810x100019ithgkok4y2u","tag_id":"ckxx810xb000a9ith3yvl6h31","_id":"ckxx810xi000q9ith9bzo0wx4"},{"post_id":"ckxx810x100019ithgkok4y2u","tag_id":"ckxx810xd000f9ithccfaa4qe","_id":"ckxx810xj000t9ith1yh8e5k6"},{"post_id":"ckxx810x400039ith5vew3297","tag_id":"ckxx810xh000l9ith7nfvaq0z","_id":"ckxx810xm00159ith4a3c0bdt"},{"post_id":"ckxx810x400039ith5vew3297","tag_id":"ckxx810xj000r9ith4qc2f4j4","_id":"ckxx810xm00169ith69taddab"},{"post_id":"ckxx810x400039ith5vew3297","tag_id":"ckxx810xj000v9ithgqfe3qv1","_id":"ckxx810xm00189ithh1um4vss"},{"post_id":"ckxx810x400039ith5vew3297","tag_id":"ckxx810xk000y9ithdwc7hf7y","_id":"ckxx810xm00199ith1xbm4men"},{"post_id":"ckxx810x400039ith5vew3297","tag_id":"ckxx810xk000z9ith6izx2pz7","_id":"ckxx810xm001b9ith03b81und"},{"post_id":"ckxx810x400039ith5vew3297","tag_id":"ckxx810xk00109ith8lmg1bf0","_id":"ckxx810xm001c9ith3jrxaft7"},{"post_id":"ckxx810x400039ith5vew3297","tag_id":"ckxx810xk00119ith0o62g1dx","_id":"ckxx810xn001e9ithe9iudp65"},{"post_id":"ckxx810x400039ith5vew3297","tag_id":"ckxx810xl00129ithceh0318b","_id":"ckxx810xn001f9ith2adk7bgd"},{"post_id":"ckxx810x400039ith5vew3297","tag_id":"ckxx810x700059ith9hgibdb1","_id":"ckxx810xn001h9ith9wyjdddw"},{"post_id":"ckxx810x800069ithgptq97vn","tag_id":"ckxx810x700059ith9hgibdb1","_id":"ckxx810xn001j9ith7jq103tz"},{"post_id":"ckxx810x800069ithgptq97vn","tag_id":"ckxx810xm00179ith70zc4dm7","_id":"ckxx810xo001k9ith6zbhb4im"},{"post_id":"ckxx810x800069ithgptq97vn","tag_id":"ckxx810xm001a9ithc1ui18m5","_id":"ckxx810xo001m9ithdk0b1auv"},{"post_id":"ckxx810x800069ithgptq97vn","tag_id":"ckxx810xn001d9ith191v7di2","_id":"ckxx810xo001n9ithbhlf8zoz"},{"post_id":"ckxx810x800069ithgptq97vn","tag_id":"ckxx810xn001g9ithggng520c","_id":"ckxx810xo001p9ithc55475uk"},{"post_id":"ckxx810xa00089ithdlbsbdbf","tag_id":"ckxx810x700059ith9hgibdb1","_id":"ckxx810xo001q9ithedbsdipu"},{"post_id":"ckxx810xa00089ithdlbsbdbf","tag_id":"ckxx810xn001i9ith2r8u1n9k","_id":"ckxx810xp001s9ith3fgf1snr"},{"post_id":"ckxx810xa00089ithdlbsbdbf","tag_id":"ckxx810xo001l9itheh0d9hvw","_id":"ckxx810xp001t9itheb7l9mg3"},{"post_id":"ckxx810xb000b9ith7wjda3v3","tag_id":"ckxx810x700059ith9hgibdb1","_id":"ckxx810xp001w9ith0d9t4fxg"},{"post_id":"ckxx810xb000b9ith7wjda3v3","tag_id":"ckxx810xo001o9ith6vfq4ltb","_id":"ckxx810xq001x9itheit7fbiq"},{"post_id":"ckxx810xb000b9ith7wjda3v3","tag_id":"ckxx810xo001r9ith5xd4d64s","_id":"ckxx810xq001z9ith4q636s76"},{"post_id":"ckxx810xb000b9ith7wjda3v3","tag_id":"ckxx810xp001u9ithgp3s2g8z","_id":"ckxx810xq00209ithd973dusa"},{"post_id":"ckxx810xc000c9ithe6tt7fs8","tag_id":"ckxx810xp001v9ith0qpyfjqh","_id":"ckxx810xr00249ith4ux0057r"},{"post_id":"ckxx810xc000c9ithe6tt7fs8","tag_id":"ckxx810xq001y9ith80yrabkc","_id":"ckxx810xr00259ithcxfcgy8f"},{"post_id":"ckxx810xc000c9ithe6tt7fs8","tag_id":"ckxx810xk00119ith0o62g1dx","_id":"ckxx810xs00279ithdzevh9ty"},{"post_id":"ckxx810xc000c9ithe6tt7fs8","tag_id":"ckxx810xl00129ithceh0318b","_id":"ckxx810xs00289ithgiq50l5x"},{"post_id":"ckxx810xc000c9ithe6tt7fs8","tag_id":"ckxx810x700059ith9hgibdb1","_id":"ckxx810xs002a9ithd4xzfhil"},{"post_id":"ckxx810xf000g9ith0tr985fe","tag_id":"ckxx810x700059ith9hgibdb1","_id":"ckxx810xt002e9ithh21z4q8x"},{"post_id":"ckxx810xf000g9ith0tr985fe","tag_id":"ckxx810xr00239ith4jfo1am3","_id":"ckxx810xt002f9ith9yuc7cy1"},{"post_id":"ckxx810xf000g9ith0tr985fe","tag_id":"ckxx810xr00269ith8qin6vol","_id":"ckxx810xt002h9itha8xrf5xu"},{"post_id":"ckxx810xf000g9ith0tr985fe","tag_id":"ckxx810xn001g9ithggng520c","_id":"ckxx810xu002i9ithh2m65wpz"},{"post_id":"ckxx810xf000g9ith0tr985fe","tag_id":"ckxx810xm001a9ithc1ui18m5","_id":"ckxx810xu002k9ith6rte5w6k"},{"post_id":"ckxx810xf000g9ith0tr985fe","tag_id":"ckxx810xn001d9ith191v7di2","_id":"ckxx810xu002l9ith76300m6c"},{"post_id":"ckxx810xg000i9ith73ww8npz","tag_id":"ckxx810xt002d9ith0gi483na","_id":"ckxx810xv002p9ithbq4ua6s4"},{"post_id":"ckxx810xg000i9ith73ww8npz","tag_id":"ckxx810xp001v9ith0qpyfjqh","_id":"ckxx810xv002q9ithd6fx9p0y"},{"post_id":"ckxx810xg000i9ith73ww8npz","tag_id":"ckxx810xq001y9ith80yrabkc","_id":"ckxx810xv002s9ith9hy714f2"},{"post_id":"ckxx810xg000i9ith73ww8npz","tag_id":"ckxx810xk00119ith0o62g1dx","_id":"ckxx810xv002t9ith14b04hig"},{"post_id":"ckxx810xg000i9ith73ww8npz","tag_id":"ckxx810xl00129ithceh0318b","_id":"ckxx810xw002v9ith84dh107j"},{"post_id":"ckxx810xg000i9ith73ww8npz","tag_id":"ckxx810x700059ith9hgibdb1","_id":"ckxx810xw002w9ith5dy3327r"},{"post_id":"ckxx810xh000m9ith27rh8my9","tag_id":"ckxx810x700059ith9hgibdb1","_id":"ckxx810xw002x9ithb6b309p2"},{"post_id":"ckxx810xh000m9ith27rh8my9","tag_id":"ckxx810xo001o9ith6vfq4ltb","_id":"ckxx810xw002y9ithbuv1b2du"},{"post_id":"ckxx810xh000m9ith27rh8my9","tag_id":"ckxx810xo001r9ith5xd4d64s","_id":"ckxx810xw002z9ith3wyfbgeo"},{"post_id":"ckxx810xh000m9ith27rh8my9","tag_id":"ckxx810xp001u9ithgp3s2g8z","_id":"ckxx810xw00309ith2avt4wci"}],"Tag":[{"name":"swift","_id":"ckxx810x700059ith9hgibdb1"},{"name":"error handling","_id":"ckxx810xb000a9ith3yvl6h31"},{"name":"result","_id":"ckxx810xd000f9ithccfaa4qe"},{"name":"group theory","_id":"ckxx810xh000l9ith7nfvaq0z"},{"name":"category theory","_id":"ckxx810xj000r9ith4qc2f4j4"},{"name":"semigroup","_id":"ckxx810xj000v9ithgqfe3qv1"},{"name":"monoid","_id":"ckxx810xk000y9ithdwc7hf7y"},{"name":"functor","_id":"ckxx810xk000z9ith6izx2pz7"},{"name":"applicative","_id":"ckxx810xk00109ith8lmg1bf0"},{"name":"monad","_id":"ckxx810xk00119ith0o62g1dx"},{"name":"functional programming","_id":"ckxx810xl00129ithceh0318b"},{"name":"existential","_id":"ckxx810xm00179ith70zc4dm7"},{"name":"protocol","_id":"ckxx810xm001a9ithc1ui18m5"},{"name":"generic","_id":"ckxx810xn001d9ith191v7di2"},{"name":"pats","_id":"ckxx810xn001g9ithggng520c"},{"name":"logger","_id":"ckxx810xn001i9ith2r8u1n9k"},{"name":"logging","_id":"ckxx810xo001l9itheh0d9hvw"},{"name":"chunked","_id":"ckxx810xo001o9ith6vfq4ltb"},{"name":"streaming","_id":"ckxx810xo001r9ith5xd4d64s"},{"name":"http","_id":"ckxx810xp001u9ithgp3s2g8z"},{"name":"parser","_id":"ckxx810xp001v9ith0qpyfjqh"},{"name":"parser combinator","_id":"ckxx810xq001y9ith80yrabkc"},{"name":"type erasure","_id":"ckxx810xr00239ith4jfo1am3"},{"name":"type erased","_id":"ckxx810xr00269ith8qin6vol"},{"name":"plist parser","_id":"ckxx810xt002d9ith0gi483na"}]}}